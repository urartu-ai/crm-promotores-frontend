"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4984,3666,8812],{3274:(E,f,i)=>{i.d(f,{K:()=>t});var e=i(177),u=i(3953);let t=(()=>{var m;class a{}return(m=a).\u0275fac=function(s){return new(s||m)},m.\u0275mod=u.$C({type:m}),m.\u0275inj=u.G2t({imports:[e.MD]}),a})()},6580:(E,f,i)=>{i.d(f,{k:()=>m});var e=i(3953);function u(a,v){if(1&a&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&a){const s=e.XpG(2);e.R7$(),e.SpI(" ",null==s.listPaginationConfig?null:s.listPaginationConfig.checkedItems," seleccionado ")}}function t(a,v){if(1&a&&(e.j41(0,"div",14),e.DNE(1,u,2,1,"div",15),e.k0s()),2&a){const s=e.XpG();e.R7$(),e.vxM(null!=s.listPaginationConfig&&s.listPaginationConfig.checkedItems||0===(null==s.listPaginationConfig?null:s.listPaginationConfig.checkedItems)?1:-1)}}let m=(()=>{var a;class v{constructor(){this.listPaginationConfig={},this.goPreviousPage=new e.bkB,this.goNextPage=new e.bkB,this.sort=new e.bkB}ngOnInit(){}onGoPreviousPage(c){this.goPreviousPage.emit(c)}onGoNextPage(c){this.goNextPage.emit(c)}onSort(c){this.sort.emit(c)}}return(a=v).\u0275fac=function(c){return new(c||a)},a.\u0275cmp=e.VBU({type:a,selectors:[["app-list-pagination-selectors"]],inputs:{listPaginationConfig:"listPaginationConfig"},outputs:{goPreviousPage:"goPreviousPage",goNextPage:"goNextPage",sort:"sort"},decls:21,vars:6,consts:[[1,"crm-block-pagination-selectors"],[1,"crm-button-pagination"],[1,"crm-button-pagination-text"],[1,"crm-button-pagination-buttons"],[1,"crm-button-pagination-arrow","crm-button-icon-solo",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-button-pagination-number"],[1,"fas","fa-arrow-right"],[1,"crm-dropdown",3,"click"],[1,"crm-dropdown-text"],[1,"crm-dropdown-right"],[1,"crm-dropdown-value"],[1,"crm-dropdown-arrow"],[1,"fas","fa-chevron-down"],[1,"crm-input-checkbox"],[1,"crm-input-checkbox-pre-label"]],template:function(c,r){1&c&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.EFF(3),e.k0s(),e.j41(4,"div",3)(5,"button",4),e.bIt("click",function(C){return r.onGoPreviousPage(C)}),e.nrm(6,"i",5),e.k0s(),e.j41(7,"div",6),e.EFF(8),e.k0s(),e.j41(9,"button",4),e.bIt("click",function(C){return r.onGoNextPage(C)}),e.nrm(10,"i",7),e.k0s()(),e.j41(11,"div",8),e.bIt("click",function(C){return r.onSort(C)}),e.j41(12,"div",9),e.EFF(13," Ordenar por "),e.k0s(),e.j41(14,"div",10)(15,"div",11),e.EFF(16),e.k0s(),e.j41(17,"div",12),e.nrm(18,"i",13),e.k0s()()()(),e.j41(19,"div"),e.DNE(20,t,2,1,"div",14),e.k0s()()),2&c&&(e.R7$(3),e.E5c(" ",null==r.listPaginationConfig?null:r.listPaginationConfig.pageStartIndex," - ",null==r.listPaginationConfig?null:r.listPaginationConfig.pageEndIndex," de ",null==r.listPaginationConfig?null:r.listPaginationConfig.totalCount," "),e.R7$(5),e.SpI(" P\xe1g ",null==r.listPaginationConfig?null:r.listPaginationConfig.paginationPage," "),e.R7$(8),e.SpI(" ",null==r.listPaginationConfig?null:r.listPaginationConfig.sortField," "),e.R7$(4),e.vxM(null!=r.listPaginationConfig&&r.listPaginationConfig.showSelectItems?20:-1))}}),v})()},5603:(E,f,i)=>{i.d(f,{P:()=>m});var e=i(177),u=i(9417),t=i(3953);let m=(()=>{var a;class v{}return(a=v).\u0275fac=function(c){return new(c||a)},a.\u0275mod=t.$C({type:a}),a.\u0275inj=t.G2t({imports:[e.MD,u.YN]}),v})()},3895:(E,f,i)=>{i.d(f,{b:()=>v});var e=i(177),u=i(9417),t=i(9465),m=i(4842),a=i(3953);let v=(()=>{var s;class c{}return(s=c).\u0275fac=function(b){return new(b||s)},s.\u0275mod=a.$C({type:s}),s.\u0275inj=a.G2t({imports:[e.MD,u.YN,t.bv,m.h]}),c})()},4984:(E,f,i)=>{i.r(f),i.d(f,{DocumentsModule:()=>x});var e=i(177),u=i(467),t=i(3953),m=i(5970),a=i(6039),v=i(1296),s=i(4501),c=i(8397),r=i(345),b=i(8374),C=i(517),T=i(1213),k=i(9465),S=i(1880),R=i(6580);const w=(l,h,d,n,o)=>({pageStartIndex:l,pageEndIndex:h,totalCount:d,paginationPage:n,sortField:o});function O(l,h){if(1&l){const d=t.RV6();t.j41(0,"button",16),t.bIt("click",function(){t.eBV(d);const o=t.XpG(2);return t.Njj(o.onDeleteSelectedDocuments())}),t.nrm(1,"i",17),t.EFF(2," Borrar documentos seleccionados "),t.k0s()}}function U(l,h){if(1&l){const d=t.RV6();t.j41(0,"div",12)(1,"button",13),t.bIt("click",function(){t.eBV(d);const o=t.XpG();return t.Njj(o.openCreateDocumentModal())}),t.nrm(2,"i",14),t.EFF(3," A\xf1adir Documento "),t.k0s(),t.DNE(4,O,3,0,"button",15),t.k0s()}if(2&l){const d=t.XpG();t.R7$(4),t.vxM((null==d.checkedRows?null:d.checkedRows.length)>0&&"promoter"===(null==d.currentUser?null:d.currentUser.accountType)?4:-1)}}let j=(()=>{var l;class h{constructor(n,o,g,p,M,I,N,$,X,K){this.popoversService=n,this.api=o,this.tableService=g,this.headerService=p,this.toastService=M,this.sanitizer=I,this.modalsService=N,this.router=$,this.activatedRoute=X,this.byvaroState=K,this.documents=[],this.checkedRows=[],this.allSystemOperationsCount=0,this.filters=null,this.sort={field:"createdAt",order:"desc"},this.pagination={page:0,itemsPerPage:50},this.agencyId=null,this.promotionId=null,this.documentsTableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"createdAt",label:"A\xf1adido en",size:"medium",type:"date"},{key:"title",label:"T\xedtulo",size:"large",type:"text"},{key:"url",label:"Documento",size:"medium",type:"file"},{key:"documentType",label:"Tipo de documento",size:"large",type:"text",fn:P=>"collaborationContract"===(null==P?void 0:P.documentType)?"Contrato de colaboraci\xf3n":""},{key:"promotions",label:"Promociones",size:"extra-large",type:"text",fn:P=>{var y;return P.allPromotionsIncluded?"Todas incluidas":null==P||null===(y=P.promotionsIncluded)||void 0===y?void 0:y.map(_=>_.projectName||(null==_?void 0:_.title)||(null==_?void 0:_.byvaroId)||"").join(", ")}},{key:"agency.name",label:"Agencia",size:"medium",type:"reference"},{key:"fromDate",label:"Valido desde",size:"medium",type:"date"},{key:"toDate",label:"Fecha Expiraci\xf3n",size:"medium",type:"text",fn:P=>{const y=new Date(P.toDate),_=new Date,W=y.getTime()-_.getTime(),D=Math.floor(W/864e5);return D<0?`Expirado hace ${Math.abs(D)} d\xedas`:`Expira en ${D} d\xedas`}}],rows:[]}}ngOnInit(){this.getUserInfo()}getUserInfo(){this.byvaroState.getState().subscribe(n=>{this.currentUser=n.user})}ionViewWillEnter(){var n=this;return(0,u.A)(function*(){n.headerService.setConfig({title:"documents"}),n.agencyId=n.activatedRoute.snapshot.queryParamMap.get("agencyId"),n.promotionId=n.activatedRoute.snapshot.queryParamMap.get("promotionId"),console.log("agencyId",n.agencyId),console.log("promotionId",n.promotionId),n.getData()})()}getData(){var n=this;return(0,u.A)(function*(){var o;n.filters={},n.agencyId&&(n.filters.agencyId={equals:n.agencyId}),n.promotionId&&(n.filters.promotionId={equals:n.promotionId});const g=yield n.api.getDocument(n.filters,n.sort,n.pagination,null);if(n.documents=null==g||null===(o=g.success)||void 0===o?void 0:o.data,n.documents){let p=n.tableService.convertDataToTableRows(n.documents,n.documentsTableConfig);n.documentsTableConfig.rows=p}})()}openCreateDocumentModal(){var n=this;return(0,u.A)(function*(){yield n.modalsService.onShowCreateDocumentModal(n.agencyId),n.getData()})()}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemOperationsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemOperationsCount)}}onSort(n){}onRowClicked(n){return(0,u.A)(function*(){})()}onTableButtonClick(n){return(0,u.A)(function*(){})()}onRowChecked(n){var o=this;return(0,u.A)(function*(){const g=o.documentsTableConfig.rows[n],p=o.checkedRows.findIndex(I=>I.rawObject.id===g.rawObject.id);-1!==p?o.checkedRows.splice(p,1):(o.checkedRows=o.checkedRows.filter(I=>I.rowIndex!==n),o.checkedRows.push(g))})()}onDeleteSelectedDocuments(){var n=this;return(0,u.A)(function*(){try{for(const o of n.checkedRows)yield n.api.deleteDocumentById(o.rawObject.id);n.checkedRows=[],n.getData(),n.toastService.showSuccessToast("Documentos eliminados correctamente")}catch(o){console.error(o),n.toastService.showErrorToast("Error al eliminar los documentos")}})()}}return(l=h).\u0275fac=function(n){return new(n||l)(t.rXU(m.m),t.rXU(a.i),t.rXU(v.a),t.rXU(s.d),t.rXU(c.f),t.rXU(r.up),t.rXU(b.M),t.rXU(C.Ix),t.rXU(C.nX),t.rXU(T.c))},l.\u0275cmp=t.VBU({type:l,selectors:[["app-documents"]],decls:12,vars:11,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content"],[1,"crm-block-body",2,"padding","20px"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar documento"],["class","crm-buttons-group",4,"ngIf"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[1,"crm-section"],[3,"actionButtonClick","rowClicked","rowCheckboxClicked","table"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[1,"fa","fa-plus"],[1,"crm-button","crm-button-red"],[1,"crm-button","crm-button-red",3,"click"],[1,"fa-solid","fa-trash"]],template:function(n,o){1&n&&(t.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"i",6)(7,"input",7),t.k0s()(),t.DNE(8,U,5,1,"div",8),t.k0s(),t.j41(9,"app-list-pagination-selectors",9),t.bIt("goPreviousPage",function(){return o.onGoPreviousPage()})("goNextPage",function(){return o.onGoNextPage()})("sort",function(p){return o.onSort(p)}),t.k0s(),t.j41(10,"div",10)(11,"app-table",11),t.bIt("actionButtonClick",function(p){return o.onTableButtonClick(p)})("rowClicked",function(p){return o.onRowClicked(p)})("rowCheckboxClicked",function(p){return o.onRowChecked(p)}),t.k0s()()()()()),2&n&&(t.Y8G("fullscreen",!0)("scrollY",!1),t.R7$(8),t.Y8G("ngIf",(null==o.currentUser?null:o.currentUser.promoterId)&&o.agencyId),t.R7$(),t.Y8G("listPaginationConfig",t.s1E(5,w,o.updatePagination().startIndex,o.updatePagination().endIndex,o.allSystemOperationsCount,o.pagination.page+1,null!=o.sort&&o.sort.field?(null==o.sort?null:o.sort.field)+" "+(null==o.sort?null:o.sort.order):"Fecha de creaci\xf3n")),t.R7$(2),t.Y8G("table",o.documentsTableConfig))},dependencies:[e.bT,k.W9,S.O,R.k]}),h})();var L=i(9417),A=i(3274),B=i(5603),F=i(3895);const G=[{path:"",component:j}];let x=(()=>{var l;class h{}return(l=h).\u0275fac=function(n){return new(n||l)},l.\u0275mod=t.$C({type:l}),l.\u0275inj=t.G2t({imports:[e.MD,L.YN,k.bv,F.b,B.P,A.K,C.iI.forChild(G)]}),h})()}}]);