"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[802],{9491:(V,j,d)=>{d.d(j,{j:()=>_});var f=d(177),F=d(9465),b=d(9417),C=d(3953);let _=(()=>{var n;class x{}return(n=x).\u0275fac=function(S){return new(S||n)},n.\u0275mod=C.$C({type:n}),n.\u0275inj=C.G2t({imports:[f.MD,F.bv,b.YN,b.X1]}),x})()},802:(V,j,d)=>{d.r(j),d.d(j,{AgenciesListPageModule:()=>G});var f=d(177),F=d(9417),b=d(9465),C=d(5188),_=d(2465),n=d(3953);const x=[{path:"",component:_.F}];let T=(()=>{var p;class m{}return(p=m).\u0275fac=function(A){return new(A||p)},p.\u0275mod=n.$C({type:p}),p.\u0275inj=n.G2t({imports:[C.iI.forChild(x),C.iI]}),m})(),S=(()=>{var p;class m{}return(p=m).\u0275fac=function(A){return new(A||p)},p.\u0275mod=n.$C({type:p}),p.\u0275inj=n.G2t({imports:[f.MD,F.YN,F.X1,b.bv]}),m})();var O=d(5603),D=d(9491);let G=(()=>{var p;class m{}return(p=m).\u0275fac=function(A){return new(A||p)},p.\u0275mod=n.$C({type:p}),p.\u0275inj=n.G2t({imports:[f.MD,F.YN,b.bv,T,S,O.P,D.j]}),m})()},2465:(V,j,d)=>{d.d(j,{F:()=>Mn});var f=d(467),F=d(1413),b=d(7944),C=d(7376),_=d(9969),n=d(3953),x=d(5188),T=d(8397),S=d(4501),O=d(9465),D=d(6039),G=d(1213),p=d(5970),m=d(177),k=d(6552);function A(i,s){if(1&i&&n.nrm(0,"span",26),2&i){let o;const e=n.XpG().$implicit,t=n.XpG(3);n.HbH(null==(o=t.utils.getLanguageInfo(e))?null:o.flagClass)}}function J(i,s){if(1&i&&(n.qex(0),n.DNE(1,A,1,2,"span",25),n.bVm()),2&i){const o=s.index;n.R7$(),n.Y8G("ngIf",o<3)}}function z(i,s){if(1&i&&(n.j41(0,"span",27),n.EFF(1),n.k0s()),2&i){const o=n.XpG(3);n.R7$(),n.SpI(" +",o.agency.languages.length-3," ")}}function H(i,s){if(1&i&&(n.j41(0,"div",22),n.DNE(1,J,2,1,"ng-container",23)(2,z,2,1,"span",24),n.k0s()),2&i){const o=n.XpG(2);n.R7$(),n.Y8G("ngForOf",o.agency.languages),n.R7$(),n.Y8G("ngIf",o.agency.languages.length>3)}}function W(i,s){1&i&&(n.j41(0,"div",28),n.EFF(1," Sin idiomas "),n.k0s())}function Z(i,s){1&i&&(n.j41(0,"button",19),n.EFF(1," Pendiente "),n.nrm(2,"i",29),n.k0s())}function K(i,s){1&i&&(n.j41(0,"button",20),n.EFF(1," Colaborador "),n.nrm(2,"i",30),n.k0s())}function Q(i,s){if(1&i){const o=n.RV6();n.j41(0,"button",31),n.bIt("click",function(t){n.eBV(o);const a=n.XpG(2);return n.Njj(a.onInviteAgencyClick(t))}),n.nrm(1,"i",32),n.EFF(2," Invitar agencia "),n.k0s()}}function q(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",3),n.bIt("click",function(){n.eBV(o);const t=n.XpG();return n.Njj(t.onNavigateToAgency())}),n.j41(1,"div",4),n.nrm(2,"img",5),n.j41(3,"div",6)(4,"div",7)(5,"span",8),n.EFF(6),n.k0s()(),n.j41(7,"div",9),n.EFF(8),n.k0s(),n.DNE(9,H,3,2,"div",10)(10,W,2,0,"ng-template",null,0,n.C5r),n.k0s()(),n.j41(12,"div",11),n.EFF(13),n.k0s(),n.nrm(14,"div",12),n.j41(15,"div",13)(16,"div",14),n.nrm(17,"i",15),n.j41(18,"span"),n.EFF(19),n.k0s()(),n.j41(20,"div",14),n.nrm(21,"i",16),n.j41(22,"span"),n.EFF(23),n.k0s()(),n.j41(24,"div",14),n.nrm(25,"i",17),n.j41(26,"span"),n.EFF(27,"Operaciones"),n.k0s()()(),n.j41(28,"div",18),n.DNE(29,Z,3,0,"button",19)(30,K,3,0,"button",20)(31,Q,3,0,"button",21),n.k0s()()}if(2&i){const o=n.sdS(11),e=n.XpG();n.R7$(2),n.FS9("alt",null==e.agency?null:e.agency.name),n.Y8G("src",(null==e.agency?null:e.agency.photoUrl)||"assets/images/building.png",n.B4B),n.R7$(4),n.JRh(null==e.agency?null:e.agency.name),n.R7$(2),n.Lme(" ",(null==e.agency?null:e.agency.city)||"Valencia"," / ",(null==e.agency?null:e.agency.country)||"Spain"," "),n.R7$(),n.Y8G("ngIf",(null==e.agency||null==e.agency.languages?null:e.agency.languages.length)>0)("ngIfElse",o),n.R7$(4),n.Lme(" Promociones compartidas: ",(null==e.agency||null==e.agency.promotions?null:e.agency.promotions.length)||0," / ",e.promoterPromotions||0," "),n.R7$(6),n.SpI("Oficinas: ",(null==e.agency||null==e.agency.agencyOffices?null:e.agency.agencyOffices.length)||0,""),n.R7$(4),n.SpI("Agentes: ",(null==e.agency||null==e.agency._count?null:e.agency._count.users)||0,""),n.R7$(6),n.vxM("pending"===(null==e.options?null:e.options.invitationStatus)?29:"collaborator"===(null==e.options?null:e.options.invitationStatus)?30:31)}}function nn(i,s){1&i&&(n.j41(0,"div",2)(1,"div",4),n.nrm(2,"div",33),n.j41(3,"div",6),n.nrm(4,"div",34)(5,"div",35)(6,"div",36),n.k0s()(),n.nrm(7,"div",37)(8,"div",38),n.j41(9,"div",13),n.nrm(10,"div",39)(11,"div",39)(12,"div",39),n.k0s(),n.nrm(13,"div",40),n.k0s())}let en=(()=>{var i;class s{constructor(e,t){this.router=e,this.utils=t,this.promoterPromotions=0,this.inviteAgencyClick=new n.bkB}ngOnInit(){console.log(this.options)}onInviteAgencyClick(e){e.stopPropagation(),e.preventDefault(),this.inviteAgencyClick.emit({agency:this.agency,options:this.options})}onNavigateToAgency(){this.router.navigate([`/agencies/${this.agency.id}`])}}return(i=s).\u0275fac=function(e){return new(e||i)(n.rXU(x.Ix),n.rXU(k.T))},i.\u0275cmp=n.VBU({type:i,selectors:[["app-card-agency"]],inputs:{agency:"agency",isSkeleton:"isSkeleton",options:"options",promoterPromotions:"promoterPromotions"},outputs:{inviteAgencyClick:"inviteAgencyClick"},decls:2,vars:1,consts:[["noLangs",""],[1,"collaboration-card"],[1,"collaboration-card","collaboration-card--skeleton"],[1,"collaboration-card",3,"click"],[1,"collaboration-card__header"],[1,"collaboration-card__logo",3,"src","alt"],[1,"collaboration-card__info"],[1,"collaboration-card__top-row"],[1,"collaboration-card__name"],[1,"collaboration-card__location"],["class","collaboration-card__languages",4,"ngIf","ngIfElse"],[1,"collaboration-card__shared"],[1,"collaboration-card__divider"],[1,"collaboration-card__meta"],[1,"collaboration-card__meta-item"],[1,"fas","fa-building"],[1,"fas","fa-user"],[1,"fas","fa-chart-line"],[1,"collaboration-card__footer",2,"margin-top","8px"],[1,"collaboration-card__button","collaboration-card__button--pending"],[1,"collaboration-card__button","collaboration-card__button--collaborator"],[1,"crm-button",2,"width","100%","justify-content","center"],[1,"collaboration-card__languages"],[4,"ngFor","ngForOf"],["class","collaboration-card__flag-plus",4,"ngIf"],["class","collaboration-card__flag",3,"class",4,"ngIf"],[1,"collaboration-card__flag"],[1,"collaboration-card__flag-plus"],[1,"collaboration-card__languages-empty"],[1,"fas","fa-clock"],[1,"fas","fa-check-circle"],[1,"crm-button",2,"width","100%","justify-content","center",3,"click"],[1,"fas","fa-add"],[1,"collaboration-card__logo","skeleton-block"],[1,"collaboration-card__top-row","skeleton-block"],[1,"collaboration-card__location","skeleton-block"],[1,"collaboration-card__languages","skeleton-block"],[1,"collaboration-card__shared","skeleton-block"],[1,"collaboration-card__divider","skeleton-block"],[1,"collaboration-card__meta-item","skeleton-block"],[1,"collaboration-card__footer","skeleton-block"]],template:function(e,t){1&e&&n.DNE(0,q,32,12,"div",1)(1,nn,14,0,"div",2),2&e&&n.vxM(t.isSkeleton?1:0)},dependencies:[m.Sq,m.bT],styles:[".collaboration-card[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #eaeaea;border-radius:12px;padding:16px;width:340px;box-sizing:border-box;display:flex;flex-direction:column;cursor:pointer;position:relative}.collaboration-card__header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.collaboration-card__logo[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;object-fit:cover;flex-shrink:0}.collaboration-card__info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.collaboration-card__top-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.collaboration-card__name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;margin-bottom:4px;color:#111}.collaboration-card__verified[_ngcontent-%COMP%]{font-size:14px;color:#1890ff;display:inline-flex;align-items:center}.collaboration-card__location[_ngcontent-%COMP%]{font-size:14px;color:#888}.collaboration-card__languages[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.collaboration-card__languages[_ngcontent-%COMP%]   .collaboration-card__flag[_ngcontent-%COMP%]{width:20px;height:14px;border-radius:2px;background-size:cover;background-position:center}.collaboration-card__languages[_ngcontent-%COMP%]   .collaboration-card__flag-plus[_ngcontent-%COMP%]{font-size:13px;color:#666}.collaboration-card__languages-empty[_ngcontent-%COMP%]{font-size:13px;color:#999}.collaboration-card__shared[_ngcontent-%COMP%]{margin-top:12px;font-size:14px;color:#333;font-weight:500}.collaboration-card__divider[_ngcontent-%COMP%]{width:100%;height:1px;background-color:#eaeaea;border:none;margin:12px 0}.collaboration-card__meta[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:12px}.collaboration-card__meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:12px;color:#666}.collaboration-card__meta-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:13px}.collaboration-card__footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:8px;margin-top:auto}.collaboration-card__chip[_ngcontent-%COMP%]{font-size:13px;padding:4px 8px;border-radius:6px;display:inline-flex;align-items:center;gap:4px}.collaboration-card__chip--warning[_ngcontent-%COMP%]{background-color:#fff8e6;color:#e69900;border:1px solid #ffe5b4}.collaboration-card__button[_ngcontent-%COMP%]{font-size:14px;border-radius:4px;padding:6px 12px;outline:none;cursor:pointer;display:inline-flex;align-items:center;gap:8px;border:1px solid transparent}.collaboration-card__button--collaborator[_ngcontent-%COMP%]{background-color:#ecf2ff;color:#3a50e4}.collaboration-card__button--pending[_ngcontent-%COMP%]{background-color:#fbf4ec;color:#e49d3a}.collaboration-card__button--invite[_ngcontent-%COMP%]{background-color:#1890ff;color:#fff}.collaboration-card--skeleton[_ngcontent-%COMP%]{pointer-events:none}.collaboration-card--skeleton[_ngcontent-%COMP%]   .skeleton-block[_ngcontent-%COMP%]{background-color:#eee;border-radius:4px;width:100%;height:16px}.collaboration-card--skeleton__logo.skeleton-block[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%}.collaboration-card--skeleton__divider.skeleton-block[_ngcontent-%COMP%]{height:1px;margin:12px 0}.collaboration-card--skeleton__footer.skeleton-block[_ngcontent-%COMP%]{height:24px;width:100px}"]}),s})();var tn=d(6580),I=d(9417);const on=["provinceInput"],an=["cityInput"],E=()=>({standalone:!0}),ln=i=>({"crm-item-tag-active":i});function sn(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",31)(1,"div",32)(2,"div",33),n.nrm(3,"span"),n.k0s(),n.j41(4,"div",34),n.EFF(5),n.k0s()(),n.j41(6,"div",35),n.bIt("click",function(){const t=n.eBV(o).$implicit,a=n.XpG();return n.Njj(a.onRemoveLanguage(t))}),n.nrm(7,"i",36),n.k0s()()}if(2&i){let o,e;const t=s.$implicit,a=n.XpG();n.R7$(3),n.HbH(null==(o=a.utils.getLanguageInfo(t))?null:o.flagClass),n.R7$(2),n.SpI(" ",null==(e=a.utils.getLanguageInfo(t))?null:e.name," ")}}function cn(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",25)(1,"ion-checkbox",37),n.bIt("ionChange",function(t){const a=n.eBV(o).$implicit,l=n.XpG();return n.Njj(l.onCheckboxChange(a.value,t,"offices"))}),n.k0s(),n.j41(2,"div",27),n.EFF(3),n.k0s()()}if(2&i){const o=s.$implicit,e=n.XpG();n.R7$(),n.Y8G("value",o.value)("checked",e.filterData.offices.includes(o.value)),n.R7$(2),n.JRh(o.label)}}function rn(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",25)(1,"ion-checkbox",37),n.bIt("ionChange",function(t){const a=n.eBV(o).$implicit,l=n.XpG();return n.Njj(l.onCheckboxChange(a.value,t,"agentsCount"))}),n.k0s(),n.j41(2,"div",27),n.EFF(3),n.k0s()()}if(2&i){const o=s.$implicit,e=n.XpG();n.R7$(),n.Y8G("value",o.value)("checked",e.filterData.agentsCount.includes(o.value)),n.R7$(2),n.JRh(o.label)}}function dn(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",25)(1,"ion-checkbox",37),n.bIt("ionChange",function(t){const a=n.eBV(o).$implicit,l=n.XpG();return n.Njj(l.onCheckboxChange(a.value,t,"annualSales"))}),n.k0s(),n.j41(2,"div",27),n.EFF(3),n.k0s()()}if(2&i){const o=s.$implicit,e=n.XpG();n.R7$(),n.Y8G("value",o.value)("checked",e.filterData.annualSales.includes(o.value)),n.R7$(2),n.JRh(o.label)}}function gn(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",38),n.bIt("click",function(){const t=n.eBV(o).$implicit,a=n.XpG();return n.Njj(a.onTogglePromotion(t))}),n.EFF(1),n.k0s()}if(2&i){const o=s.$implicit,e=n.XpG();n.Y8G("ngClass",n.eq3(2,ln,e.filterData.sharedPromotionsIds.includes(o.id))),n.R7$(),n.SpI(" ",o.projectName," ")}}let pn=(()=>{var i;class s{constructor(e,t,a,l){this.ngZone=e,this.popoverService=t,this.utils=a,this.api=l,this.onFilter=new n.bkB,this.filterData={country:"Espa\xf1a",province:"",city:"",languages:[],offices:[],agentsCount:[],annualSales:[],hasOperations:!1,hasVisits:!1,sharedPromotionsIds:[]},this.officeOptions=[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4 o m\xe1s"}],this.commercialOptions=[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4 o m\xe1s"}],this.annualSalesOptions=[{value:2e5,label:"200 k"},{value:4e5,label:"400 k"},{value:6e5,label:"600 k"},{value:1e6,label:"1 M o m\xe1s"}],this.sort=null,this.pagination={page:0,itemsPerPage:25},this.promotions=[]}ngOnInit(){}ngAfterViewInit(){this.getPromotions(),this.provinceAutocomplete=new google.maps.places.Autocomplete(this.provinceInput.nativeElement,{types:["(regions)"],componentRestrictions:{country:"es"},fields:["address_component","geometry"]}),this.provinceAutocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{var e,t;const a=this.provinceAutocomplete.getPlace(),l=null===(e=a.address_components)||void 0===e?void 0:e.find(c=>c.types.includes("administrative_area_level_2"));l&&(this.filterData.province=l.long_name,this.provinceInput.nativeElement.value=l.long_name),null!==(t=a.geometry)&&void 0!==t&&t.viewport&&this.cityAutocomplete.setBounds(a.geometry.viewport)})}),this.cityAutocomplete=new google.maps.places.Autocomplete(this.cityInput.nativeElement,{types:["locality"],componentRestrictions:{country:"es"},fields:["address_component"]}),this.cityAutocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{var e;const a=null===(e=this.cityAutocomplete.getPlace().address_components)||void 0===e?void 0:e.find(l=>l.types.includes("locality"));a&&(this.filterData.city=a.long_name,this.cityInput.nativeElement.value=a.long_name)})})}getPromotions(){var e=this;return(0,f.A)(function*(){const t=yield e.api.getPromotions({},e.sort,e.pagination,null);e.promotions=t.success.data||[]})()}onAddLanguage(e){this.popoverService.onShowCountrySelectorPopover(e,{languageSelector:!0,showCountryCode:!1,selectedCodes:this.filterData.languages}).then(a=>{var l;null!=a&&null!==(l=a.data)&&void 0!==l&&l.country&&this.filterData.languages.push(a.data.country.code)})}onRemoveLanguage(e){this.filterData.languages=this.filterData.languages.filter(t=>t!==e)}onCheckboxChange(e,t,a){const l=this.filterData[a],c={offices:this.officeOptions,agentsCount:this.commercialOptions,annualSales:this.annualSalesOptions}[a].map(r=>r.value);if(t.detail.checked)c.filter(r=>r>=e).forEach(r=>{l.includes(r)||l.push(r)});else{const r=l.indexOf(e);r>-1&&l.splice(r,1)}}onTogglePromotion(e){const t=this.filterData.sharedPromotionsIds,a=t.indexOf(e.id);a>-1?t.splice(a,1):t.push(e.id)}onClickFilter(){const e={},t=[];if(this.filterData.province&&(e.province={equals:this.filterData.province}),this.filterData.city&&(e.city={equals:this.filterData.city}),this.filterData.languages.length&&(e.languages={hasSome:this.filterData.languages}),this.filterData.offices.length){const c=this.officeOptions.map(u=>u.value),r=this.buildNumConditions(this.filterData.offices,c);1===r.length?e.officesCount=r[0]:t.push(...r.map(u=>({officesCount:u})))}if(this.filterData.agentsCount.length){const c=this.commercialOptions.map(u=>u.value),r=this.buildNumConditions(this.filterData.agentsCount,c);1===r.length?e.agentsCount=r[0]:t.push(...r.map(u=>({agentsCount:u})))}if(this.filterData.annualSales.length){const c=this.annualSalesOptions.map(u=>u.value),r=this.buildNumConditions(this.filterData.annualSales,c);1===r.length?e.annualSales=r[0]:t.push(...r.map(u=>({annualSales:u})))}t.length&&(e.OR=t),this.filterData.hasOperations&&(e.hasOperations=!0),this.filterData.hasVisits&&(e.hasVisits=!0),console.log("sharedPromotionsIds",this.filterData.sharedPromotionsIds);const l={};this.filterData.sharedPromotionsIds.length&&(l.promotions={apply:!0,filter:{id:{in:this.filterData.sharedPromotionsIds}},onlyCount:!1}),this.filterData.hasVisits&&(l.visits={apply:!0,filter:{},onlyCount:!1}),console.log(this.filterData),console.log(e),console.log("join",l),this.onFilter.emit({filter:e,joinTables:l})}onResetFilters(){this.filterData={country:"Espa\xf1a",province:"",city:"",languages:[],offices:[],agentsCount:[],annualSales:[],hasOperations:!1,hasVisits:!1,sharedPromotionsIds:[]},this.provinceInput.nativeElement.value="",this.cityInput.nativeElement.value="",this.cityAutocomplete.setBounds(void 0),this.onFilter.emit({filter:{},joinTables:{}})}buildNumConditions(e,t){const a=t[t.length-1],c=e.filter(r=>r!==a).map(r=>({equals:r}));return e.includes(a)&&c.push({gte:a}),c}}return(i=s).\u0275fac=function(e){return new(e||i)(n.rXU(n.SKi),n.rXU(p.m),n.rXU(k.T),n.rXU(D.i))},i.\u0275cmp=n.VBU({type:i,selectors:[["app-agencies-filter-block"]],viewQuery:function(e,t){if(1&e&&(n.GBs(on,5),n.GBs(an,5)),2&e){let a;n.mGM(a=n.lsd())&&(t.provinceInput=a.first),n.mGM(a=n.lsd())&&(t.cityInput=a.first)}},outputs:{onFilter:"onFilter"},decls:73,vars:17,consts:[["provinceInput",""],["cityInput",""],[2,"position","relative","background","white"],["autocomplete","off","novalidate",""],["type","text","autocomplete","username",2,"display","none"],["type","password","autocomplete","new-password",2,"display","none"],[1,"crm-header-modal","crm-header-modal-fixed-top"],[1,"crm-modal-header-title"],[1,"crm-buttons-group"],["type","button",1,"crm-button",3,"click"],["type","button",1,"crm-button-secondary","crm-button-secondary-red",3,"click"],[1,"crm-block-inputs","crm-block-filters-inputs"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input"],["type","text","placeholder","Seleccione provincia","name","province","autocomplete","off","autocorrect","off","spellcheck","false",3,"ngModelChange","ngModel","ngModelOptions"],["type","text","placeholder","Seleccione ciudad","name","city","autocomplete","off","autocorrect","off","spellcheck","false",3,"ngModelChange","ngModel","ngModelOptions"],[1,"crm-input","crm-input-medium"],[1,"crm-section-items"],["class","crm-item-option crm-item-option-lang edit",4,"ngFor","ngForOf"],["type","button",1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fas","fa-add"],[1,"crm-input-checkboxes",2,"grid-template-columns","1fr"],["class","crm-input-checkbox",4,"ngFor","ngForOf"],[1,"crm-input-checkboxes"],[1,"crm-input-checkbox"],["name","hasOperations",3,"ngModelChange","ngModel","ngModelOptions"],[1,"crm-input-checkbox-label"],["name","hasVisits",3,"ngModelChange","ngModel","ngModelOptions"],[1,"crm-section-tags"],["class","crm-item-tag",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"crm-item-option","crm-item-option-lang","edit"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[1,"crm-item-option-label"],[1,"crm-item-option-remove",3,"click"],[1,"fas","fa-trash"],[3,"ionChange","value","checked"],[1,"crm-item-tag",3,"click","ngClass"]],template:function(e,t){if(1&e){const a=n.RV6();n.j41(0,"div",2)(1,"form",3),n.nrm(2,"input",4)(3,"input",5),n.j41(4,"div",6)(5,"div",7),n.EFF(6,"Filtrar"),n.k0s(),n.j41(7,"div",8)(8,"button",9),n.bIt("click",function(){return n.eBV(a),n.Njj(t.onClickFilter())}),n.EFF(9,"Filtrar"),n.k0s(),n.j41(10,"button",10),n.bIt("click",function(){return n.eBV(a),n.Njj(t.onResetFilters())}),n.EFF(11,"Reiniciar"),n.k0s()()(),n.j41(12,"div",11)(13,"div",12)(14,"div",13),n.EFF(15,"Provincia"),n.k0s(),n.j41(16,"div",14)(17,"input",15,0),n.mxI("ngModelChange",function(c){return n.eBV(a),n.DH7(t.filterData.province,c)||(t.filterData.province=c),n.Njj(c)}),n.k0s()()(),n.j41(19,"div",12)(20,"div",13),n.EFF(21,"Ciudad"),n.k0s(),n.j41(22,"div",14)(23,"input",16,1),n.mxI("ngModelChange",function(c){return n.eBV(a),n.DH7(t.filterData.city,c)||(t.filterData.city=c),n.Njj(c)}),n.k0s()()(),n.j41(25,"div",17)(26,"div",13),n.EFF(27,"Idiomas"),n.k0s(),n.j41(28,"div",18),n.DNE(29,sn,8,3,"div",19),n.j41(30,"button",20),n.bIt("click",function(c){return n.eBV(a),n.Njj(t.onAddLanguage(c))}),n.nrm(31,"i",21),n.EFF(32," A\xf1adir idioma "),n.k0s()()(),n.j41(33,"div",12)(34,"div",13),n.EFF(35,"Oficinas"),n.k0s(),n.j41(36,"div",22),n.DNE(37,cn,4,3,"div",23),n.k0s()(),n.j41(38,"div",12)(39,"div",13),n.EFF(40,"Comerciales"),n.k0s(),n.j41(41,"div",22),n.DNE(42,rn,4,3,"div",23),n.k0s()(),n.j41(43,"div",12)(44,"div",13),n.EFF(45,"Facturaci\xf3n anual"),n.k0s(),n.j41(46,"div",22),n.DNE(47,dn,4,3,"div",23),n.k0s()(),n.j41(48,"div",12)(49,"div",13),n.EFF(50,"Agencias con operaciones"),n.k0s(),n.j41(51,"div",24)(52,"div",25)(53,"ion-checkbox",26),n.mxI("ngModelChange",function(c){return n.eBV(a),n.DH7(t.filterData.hasOperations,c)||(t.filterData.hasOperations=c),n.Njj(c)}),n.k0s(),n.j41(54,"div",27),n.EFF(55,"S\xed"),n.k0s()()()(),n.j41(56,"div",12)(57,"div",13),n.EFF(58,"Agencias con visitas"),n.k0s(),n.j41(59,"div",24)(60,"div",25)(61,"ion-checkbox",28),n.mxI("ngModelChange",function(c){return n.eBV(a),n.DH7(t.filterData.hasVisits,c)||(t.filterData.hasVisits=c),n.Njj(c)}),n.k0s(),n.j41(62,"div",27),n.EFF(63,"S\xed"),n.k0s()()()(),n.j41(64,"div",12)(65,"div",13),n.EFF(66,"Promociones compartidas"),n.k0s(),n.j41(67,"div",29),n.DNE(68,gn,2,4,"div",30),n.k0s()(),n.nrm(69,"br")(70,"br")(71,"br")(72,"br"),n.k0s()()()}2&e&&(n.R7$(17),n.R50("ngModel",t.filterData.province),n.Y8G("ngModelOptions",n.lJ4(13,E)),n.R7$(6),n.R50("ngModel",t.filterData.city),n.Y8G("ngModelOptions",n.lJ4(14,E)),n.R7$(6),n.Y8G("ngForOf",t.filterData.languages),n.R7$(8),n.Y8G("ngForOf",t.officeOptions),n.R7$(5),n.Y8G("ngForOf",t.commercialOptions),n.R7$(5),n.Y8G("ngForOf",t.annualSalesOptions),n.R7$(6),n.R50("ngModel",t.filterData.hasOperations),n.Y8G("ngModelOptions",n.lJ4(15,E)),n.R7$(8),n.R50("ngModel",t.filterData.hasVisits),n.Y8G("ngModelOptions",n.lJ4(16,E)),n.R7$(7),n.Y8G("ngForOf",t.promotions))},dependencies:[m.YU,m.Sq,I.qT,I.me,I.BC,I.cb,I.vS,I.cV,O.eY,O.hB]}),s})();const un=i=>({"crm-block-body-fixed":i}),mn=i=>({"crm-button-secondary-primary":i}),X=(i,s,o,e,t)=>({pageStartIndex:i,pageEndIndex:s,totalCount:o,paginationPage:e,sortField:t}),_n=i=>({active:i}),fn=(i,s)=>({"background-color":i,border:s});function vn(i,s){if(1&i){const o=n.RV6();n.j41(0,"button",17),n.bIt("click",function(){n.eBV(o);const t=n.XpG();return n.Njj(t.onInviteAgencies())}),n.nrm(1,"i",18),n.EFF(2," Invitar agencia "),n.k0s()}}function hn(i,s){1&i&&(n.nrm(0,"i",19),n.EFF(1," Cerrar filtros "))}function yn(i,s){1&i&&(n.nrm(0,"i",20),n.EFF(1," Filtros activados "))}function bn(i,s){1&i&&(n.nrm(0,"i",20),n.EFF(1," Filtrar "))}function Cn(i,s){if(1&i&&n.DNE(0,yn,2,0)(1,bn,2,0),2&i){const o=n.XpG();n.vxM(o.filters?0:1)}}function kn(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",12)(1,"app-list-pagination-selectors",21),n.bIt("goPreviousPage",function(){n.eBV(o);const t=n.XpG();return n.Njj(t.onGoPreviousPage())})("goNextPage",function(){n.eBV(o);const t=n.XpG();return n.Njj(t.onGoNextPage())})("sort",function(t){n.eBV(o);const a=n.XpG();return n.Njj(a.onSort(t))}),n.k0s()()}if(2&i){const o=n.XpG();n.R7$(),n.Y8G("listPaginationConfig",n.s1E(1,X,o.updatePagination().startIndex,o.updatePagination().endIndex,o.allSystemAgenciesCount,o.pagination.page+1,null!=o.sort&&o.sort.field?(null==o.sort?null:o.sort.field)+" "+(null==o.sort?null:o.sort.order):"Fecha de creaci\xf3n"))}}function Pn(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",13)(1,"app-list-pagination-selectors",21),n.bIt("goPreviousPage",function(){n.eBV(o);const t=n.XpG();return n.Njj(t.onGoPreviousPage())})("goNextPage",function(){n.eBV(o);const t=n.XpG();return n.Njj(t.onGoNextPage())})("sort",function(t){n.eBV(o);const a=n.XpG();return n.Njj(a.onSort(t))}),n.k0s()()}if(2&i){const o=n.XpG();n.R7$(),n.Y8G("listPaginationConfig",n.s1E(1,X,o.updatePagination().startIndex,o.updatePagination().endIndex,o.allSystemAgenciesCount,o.pagination.page+1,null!=o.sort&&o.sort.field?(null==o.sort?null:o.sort.field)+" "+(null==o.sort?null:o.sort.order):"Fecha de creaci\xf3n"))}}function Fn(i,s){1&i&&(n.j41(0,"div",15),n.nrm(1,"app-card-agency",22)(2,"app-card-agency",22)(3,"app-card-agency",22),n.k0s()),2&i&&(n.R7$(),n.Y8G("isSkeleton",!0),n.R7$(),n.Y8G("isSkeleton",!0),n.R7$(),n.Y8G("isSkeleton",!0))}function xn(i,s){if(1&i&&n.EFF(0),2&i){const o=n.XpG().$implicit;n.SpI(" (",null==o?null:o.count,") ")}}function An(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",26),n.bIt("click",function(){const t=n.eBV(o).$implicit,a=n.XpG(2);return n.Njj(a.onClickAgencyRelation(t))}),n.j41(1,"div",27),n.EFF(2),n.DNE(3,xn,1,1),n.nrm(4,"div",28),n.k0s()()}if(2&i){const o=s.$implicit;n.Y8G("ngClass",n.eq3(4,_n,null==o?null:o.isSelected)),n.R7$(2),n.SpI(" ",null==o?null:o.title," "),n.R7$(),n.vxM(null!==(null==o?null:o.count)?3:-1),n.R7$(),n.Y8G("ngStyle",n.l_i(6,fn,null==o?null:o.color,"1px solid "+(null==o?null:o.color)))}}function jn(i,s){if(1&i){const o=n.RV6();n.j41(0,"app-card-agency",29),n.bIt("inviteAgencyClick",function(t){n.eBV(o);const a=n.XpG(2);return n.Njj(a.onInviteAgencyClick(t))}),n.k0s()}if(2&i){const o=s.$implicit,e=n.XpG(2);n.Y8G("promoterPromotions",e.promoterPromotions)("agency",o)("options",o.agencyCardOptions)}}function On(i,s){if(1&i&&(n.j41(0,"div",23),n.Z7z(1,An,5,9,"div",24,n.fX1),n.k0s(),n.j41(3,"div",15),n.Z7z(4,jn,1,3,"app-card-agency",25,n.fX1),n.k0s()),2&i){const o=n.XpG();n.R7$(),n.Dyx(o.agencyRelations),n.R7$(3),n.Dyx(o.agencies)}}function In(i,s){if(1&i){const o=n.RV6();n.j41(0,"div",16)(1,"app-agencies-filter-block",30),n.bIt("onFilter",function(t){n.eBV(o);const a=n.XpG();return n.Njj(a.onFilter(t))}),n.k0s()()}2&i&&n.Y8G("@biggerFadeSlideIn",void 0)}let Mn=(()=>{var i;class s{constructor(e,t,a,l,c,r,u){this.router=e,this.toastService=t,this.headerService=a,this.modalCtrl=l,this.api=c,this.state=r,this.popoversService=u,this.promotion=null,this.agenciesAlreadyLinked=[],this.agenciesNotLinked=[],this.agencies=[],this.allSystemAgenciesCount=0,this.searchString="",this.searchSubject=new F.B,this.agencyCardOptions={type:"globalAgencies"},this.aside={type:"filters",visible:!0},this.agencyRelations=[{id:"agencias-colaboradoras",title:"Agencias colaboradoras",subtitle:"",color:"#4CAF50",isSelected:!0,count:0},{id:"agencias-no-colaboradoras",title:"Agencias no colaboradoras",subtitle:"",color:"#FF9800",isSelected:null,count:null}],this.filters=null,this.sort=null,this.pagination={page:0,itemsPerPage:25},this.agencyPrismaFilter={},this.agencyJoinTables={},this.promoterPromotions=0,this.loadingList=!1}ngOnInit(){this.getState(),this.getData()}ionViewWillEnter(){this.promotion?this.agencyCardOptions.type="promotionAgencies":this.headerService.setConfig({title:"agencies"})}getState(){this.state.getState().subscribe(e=>{this.currentUser=e.user,this.currentPromoter=e.promoter})}onInviteAgencies(){var e=this;return(0,f.A)(function*(){yield(yield e.modalCtrl.create({component:b.v,cssClass:"modal-invite-agency"})).present()})()}onSearchInputChange(e){var t=this;let a=e.target.value;this.agencyPrismaFilter={},clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((0,f.A)(function*(){t.agencyPrismaFilter.OR=[{email:{contains:a}},{email1:{contains:a}},{email2:{contains:a}},{email3:{contains:a}},{email4:{contains:a}},{email5:{contains:a}},{nifCif:{contains:a}},{phone1:{contains:a}},{phone2:{contains:a}},{phone3:{contains:a}},{phone4:{contains:a}},{phone5:{contains:a}},{legalName:{contains:a}},{name:{contains:a}}],console.log(t.agencyPrismaFilter),t.getData()}),1e3)}onSearchChanged(e){this.searchString=e}onToggleAside(){this.aside.visible=!this.aside.visible}onFilter(e){this.agencyPrismaFilter=e.filter,this.agencyJoinTables=e.joinTables,this.pagination.page=0,this.getData()}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemAgenciesCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}onInviteAgencyClick(e){var t=this;return(0,f.A)(function*(){const{agency:a,options:l}=e;if("globalAgencies"===l.type)yield(yield t.modalCtrl.create({component:b.v,cssClass:"modal-invite-agency",componentProps:{agencyCardOpen:a}})).present();else if("promotionAgencies"===l.type){const c=l.promotion;let r={status:"pending",type:"register",agencyEmail:a.email,agencyId:a.id};const P=(yield t.api.createAgencyInvitationToPromotions(r)).success.data,M=[c.id],h=yield t.api.addPromotionsToAgencyInvitationToPromotions(M,P.id);if(h.error)return void t.toastService.showErrorToast("Ha ocurrido un error al invitar la agencia."+h.error.errorMessage);t.toastService.showSuccessToast("Agencia invitada correctamente"),t.getData()}})()}onClickAgencyRelation(e){this.agencyRelations.forEach(t=>{t.isSelected=t.id===e.id}),this.getData()}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemAgenciesCount)}}getData(){var e=this;return(0,f.A)(function*(){var t,a,l,c,r,u;let P,M;e.loadingList=!0,console.log("this.currentPromoter",e.currentPromoter),e.currentPromoter||(yield new Promise(g=>{setTimeout(g,100)}),e.getData()),e.promotion&&(e.agencyCardOptions.type="promotionAgencies"),console.log(3244324324,e.agencyRelations,"this.agencyRelations");const h=e.agencyRelations.find(g=>"agencias-colaboradoras"===g.id).isSelected,R=e.agencyRelations.find(g=>"agencias-no-colaboradoras"===g.id).isSelected;if(console.log(88888888,h),console.log(999999999,R),!0===h||null===h&&null===R||!1===h&&!1===R){var N;let g={promoters:{apply:!0,filter:{id:{equals:null===(N=e.currentPromoter)||void 0===N?void 0:N.id}},onlyCount:!1}};var L;if(g=e.promotion?{...g,promotions:{apply:!0,filter:{id:{equals:e.promotion.id}},onlyCount:!1}}:{...g,...e.agencyJoinTables},g={...g,users:{apply:!0,filter:{},onlyCount:!0},...e.agencyJoinTables.promotions?{promotions:e.agencyJoinTables.promotions}:{promotions:{apply:!0}}},P=yield e.api.getAgency(e.agencyPrismaFilter,e.sort,e.pagination,g),P.error)return e.toastService.showToast({text:"Ha ocurrido un error al cargar las agencias, "+(null===(L=P.error)||void 0===L?void 0:L.errorMessage),theme:"red",icon:"fas fa-exclamation-triangle",time:1e4}),void(e.loadingList=!1);e.agencyRelations.map(y=>{var v;"agencias-colaboradoras"===y.id&&(y.count=null===(v=P)||void 0===v||null===(v=v.success)||void 0===v?void 0:v.metadata)})}if(!0===R||null===h&&null===R||!1===h&&!1===R){let g={};var B;g=e.promotion?{promotions:{apply:!0,filter:{id:{equals:e.promotion.id}},onlyCount:!1,negativeFiler:!0},agencyInvitationToPromotions:{apply:!0,mode:"include",filter:{status:{equals:"pending"}},onlyCount:!1}}:{promoters:{apply:!0,filter:{id:{equals:null===(B=e.currentPromoter)||void 0===B?void 0:B.id}},onlyCount:!1,negativeFiler:!0}},g={...g,users:{apply:!0,filter:{},onlyCount:!0},promotions:{apply:!0}},M=yield e.api.getAgency(e.agencyPrismaFilter,e.sort,e.pagination,g)}let $=(null===(t=P)||void 0===t||null===(t=t.success)||void 0===t?void 0:t.data)||[];$=$.map(g=>(g.isLinked=!0,g.agencyCardOptions=C.cloneDeep(e.agencyCardOptions),e.promotion&&(g.agencyCardOptions.promotion=e.promotion,g.agencyCardOptions.invitationStatus="collaborator"),g));let Y=(null===(a=M)||void 0===a||null===(a=a.success)||void 0===a?void 0:a.data)||[];Y=Y.map(g=>{if(g.agencyCardOptions=C.cloneDeep(e.agencyCardOptions),e.promotion){g.agencyCardOptions.promotion=e.promotion;for(const y of g.agencyInvitationToPromotions)y.promotions.find(v=>v.id===e.promotion.id)&&"pending"===y.status&&(g.agencyCardOptions.invitationStatus="pending")}return g}),e.agencies=$.concat((null===(l=M)||void 0===l||null===(l=l.success)||void 0===l?void 0:l.data)||[]),e.allSystemAgenciesCount=((null===(c=P)||void 0===c||null===(c=c.success)||void 0===c||null===(c=c.metadata)||void 0===c?void 0:c.count)||0)+((null===(r=M)||void 0===r||null===(r=r.success)||void 0===r||null===(r=r.metadata)||void 0===r?void 0:r.count)||0),e.pagination.page=0,e.updatePagination(),e.loadingList=!1,console.log("this.agencies",e.agencies);const U=yield e.api.getPromotions({},null,{page:0,itemsPerPage:1e3},null);console.log("ELL RESULT DE OTTES LES PROMOCIONS",U),e.promoterPromotions=U.success.data.length,e.promotion&&(e.agencyJoinTables.promotions={apply:!0,filter:{id:{equals:e.promotion.id}},onlyCount:!1});let Rn={promoters:{apply:!0,filter:{id:{equals:e.currentPromoter.id}},onlyCount:!1},promotions:{apply:!0},...e.agencyJoinTables};const w=(null===(u=yield e.api.getAgency(e.agencyPrismaFilter,e.sort,e.pagination,Rn))||void 0===u||null===(u=u.success)||void 0===u?void 0:u.data)||[];console.log("AGENCIES",JSON.parse(JSON.stringify(w))),e.agencies=e.agencies.map(g=>{const y=w.find(v=>v.id===g.id);return console.log("LA AGENCY WITH PROMOTIONS",y),y&&(g.promotions=y.promotions),g})})()}onSort(e){var t=this;return(0,f.A)(function*(){const a=yield t.popoversService.onShowMenuPopover(e,"list-order");if(console.log("Popover result:",a),null!=a&&a.data){const l=a.data;if(l.includes("_")){const c=l.split("_")[0],r=l.split("_")[1];t.sort={field:c,order:r}}else t.sort={field:l,order:"asc"};t.getData()}})()}}return(i=s).\u0275fac=function(e){return new(e||i)(n.rXU(x.Ix),n.rXU(T.f),n.rXU(S.d),n.rXU(O.W3),n.rXU(D.i),n.rXU(G.c),n.rXU(p.m))},i.\u0275cmp=n.VBU({type:i,selectors:[["app-agencies-list"]],inputs:{promotion:"promotion"},decls:29,vars:14,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content",2,"padding-top","10px","background","#F9F9F9"],[1,"crm-block-body"],[3,"ngClass"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar agencia",3,"input"],[1,"crm-buttons-group"],[1,"crm-button"],[1,"crm-button-secondary",3,"click","ngClass"],[2,"background","white"],[1,"crm-block-body-fixed","crm-block-body-fixed-padding-bigger"],[1,"crm-block-body-blue-content"],[1,"crm-section-inline-cards"],[1,"crm-block-content-aside"],[1,"crm-button",3,"click"],[1,"fas","fa-envelope"],[1,"fa","fa-times"],[1,"fa","fa-filter"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[3,"isSkeleton"],[1,"crm-section-operations-list-buttons",2,"padding","0"],[1,"crm-operations-list-pipe-button",3,"ngClass"],[3,"promoterPromotions","agency","options"],[1,"crm-operations-list-pipe-button",3,"click","ngClass"],[1,"crm-operations-list-pipe-button-subtitle"],[1,"crm-dot","success",3,"ngStyle"],[3,"inviteAgencyClick","promoterPromotions","agency","options"],[3,"onFilter"]],template:function(e,t){1&e&&(n.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),n.nrm(7,"i",7),n.j41(8,"input",8),n.bIt("input",function(l){return t.onSearchInputChange(l)}),n.k0s()()(),n.j41(9,"div",9),n.DNE(10,vn,3,0,"button",10),n.j41(11,"button",11),n.bIt("click",function(){return t.onToggleAside()}),n.DNE(12,hn,2,0)(13,Cn,2,1),n.k0s()()(),n.DNE(14,kn,2,7,"div",12),n.k0s(),n.DNE(15,Pn,2,7,"div",13),n.j41(16,"div",14),n.DNE(17,Fn,4,3,"div",15)(18,On,6,0),n.nrm(19,"br")(20,"br")(21,"br")(22,"br")(23,"br")(24,"br")(25,"br")(26,"br")(27,"br"),n.k0s()(),n.DNE(28,In,2,1,"div",16),n.k0s()()),2&e&&(n.Y8G("fullscreen",!0)("scrollY",!1),n.R7$(3),n.Y8G("ngClass",n.eq3(10,un,!t.promotion)),n.R7$(7),n.vxM(t.promotion?-1:10),n.R7$(),n.Y8G("ngClass",n.eq3(12,mn,!(null!=t.aside&&t.aside.visible)&&t.filters)),n.R7$(),n.vxM(null!=t.aside&&t.aside.visible?12:13),n.R7$(2),n.vxM(t.promotion?-1:14),n.R7$(),n.vxM(t.promotion?15:-1),n.R7$(2),n.vxM(t.loadingList?17:18),n.R7$(11),n.vxM(null!=t.aside&&t.aside.visible?28:-1))},dependencies:[m.YU,m.B3,O.W9,en,tn.k,pn],data:{animation:[(0,_.hZ)("fadeSlideIn",[(0,_.kY)(":enter",[(0,_.iF)({opacity:0,transform:"translateX(30px)"}),(0,_.i0)("150ms ease-out",(0,_.iF)({opacity:1,transform:"translateX(0)"}))])]),(0,_.hZ)("biggerFadeSlideIn",[(0,_.kY)(":enter",[(0,_.iF)({opacity:0,transform:"translateX(150px)"}),(0,_.i0)("100ms ease-out",(0,_.iF)({opacity:1,transform:"translateX(0)"}))])])]}}),s})()}}]);