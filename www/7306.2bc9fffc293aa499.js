"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7306],{8129:(G,D,i)=>{i.d(D,{K:()=>g});var c=i(3953);let g=(()=>{var m;class v{constructor(r,f){this.el=r,this.renderer=f,this.isLoading=!1}ngOnChanges(r){"isLoading"in r&&this.updateButtonState()}updateButtonState(){const r=this.el.nativeElement;if(this.isLoading){r.getAttribute("data-original-content")||this.renderer.setAttribute(r,"data-original-content",r.innerHTML),this.renderer.setProperty(r,"disabled",!0),this.renderer.setStyle(r,"opacity","0.6"),this.renderer.setStyle(r,"pointer-events","none"),this.renderer.setStyle(r,"cursor","not-allowed");const f=this.renderer.createElement("ion-spinner"),A=this.renderer.createText(" Cargando...");this.renderer.setProperty(r,"innerHTML",""),this.renderer.appendChild(r,f),this.renderer.appendChild(r,A)}else{this.renderer.setProperty(r,"disabled",!1),this.renderer.removeStyle(r,"opacity"),this.renderer.removeStyle(r,"pointer-events"),this.renderer.removeStyle(r,"cursor");const f=r.getAttribute("data-original-content");f&&(this.renderer.setProperty(r,"innerHTML",f),this.renderer.removeAttribute(r,"data-original-content"))}}}return(m=v).\u0275fac=function(r){return new(r||m)(c.rXU(c.aKT),c.rXU(c.sFG))},m.\u0275dir=c.FsC({type:m,selectors:[["","appLoadingButton",""]],inputs:{isLoading:[0,"appLoadingButton","isLoading"]},standalone:!0,features:[c.OA$]}),v})()},1748:(G,D,i)=>{i.d(D,{z:()=>g});var c=i(3953);let g=(()=>{var m;class v{constructor(r,f){this.el=r,this.renderer=f}ngOnInit(){this.checkbox=this.el.nativeElement.querySelector("ion-checkbox"),this.renderer.listen(this.el.nativeElement,"click",r=>{r.target!==this.checkbox&&this.checkbox&&this.checkbox.click()})}}return(m=v).\u0275fac=function(r){return new(r||m)(c.rXU(c.aKT),c.rXU(c.sFG))},m.\u0275dir=c.FsC({type:m,selectors:[["","appToggleCheckbox",""]],standalone:!0}),v})()},6676:(G,D,i)=>{i.r(D),i.d(D,{PromotionCreatePageModule:()=>L});var c=i(177),g=i(9417),m=i(9465),v=i(5188),k=i(467),r=i(293),f=i(7221),A=i(8857),F=i(7376),e=i(3953),R=i(6039),Y=i(4501),t=i(8031),y=i(6552),p=i(8397),C=i(8129);const l=s=>({"crm-block-steps-step-disabled":s}),S=s=>({"crm-section-invisible":s}),a=[{path:"",component:(()=>{var s;class I{constructor(o,d,u,O,E,b){this.api=o,this.headerService=d,this.promotionTransformersService=u,this.utils=O,this.router=E,this.toastService=b,this.currentStep=0,this.loadingButton=!1}ngOnInit(){}ionViewWillEnter(){this.headerService.setConfig({title:"promotion_create"})}getData(){}setFormValues(){const o=this.promotionTransformersService.transformPromotionFormStepOne(this.promotion);this.stepOneForm.promotionStepOne=o,this.stepTwoForm.promotionStepTwo=this.promotion,this.promotionTransformersService.transformPromotionFormStepThree(this.promotion)}nextStep(){var o=this;return(0,k.A)(function*(){if(0===o.currentStep&&(o.promotion={...o.promotion,...o.stepOneForm.promotionStepOne}),1===o.currentStep){const d=o.promotionTransformersService.deleteAllPromotionPropertiesExceptFeatures(o.stepTwoForm.promotionStepTwo);o.promotion={...o.promotion,...d},o.stepThreeForm.disabled=!1,o.stepThreeForm.syncFiles()}2===o.currentStep&&(o.promotion={...o.promotion,title_es:o.stepThreeForm.promotionStepThree.title_es,title_en:o.stepThreeForm.promotionStepThree.title_en,title_de:o.stepThreeForm.promotionStepThree.title_de,title_fr:o.stepThreeForm.promotionStepThree.title_fr,title_ru:o.stepThreeForm.promotionStepThree.title_ru,description_es:o.stepThreeForm.promotionStepThree.description_es,description_en:o.stepThreeForm.promotionStepThree.description_en,description_de:o.stepThreeForm.promotionStepThree.description_de,description_fr:o.stepThreeForm.promotionStepThree.description_fr,description_ru:o.stepThreeForm.promotionStepThree.description_ru,promotionFiles:o.stepThreeForm.promotionStepThree.promotionFiles}),o.currentStep>=2&&(console.log("promotion",o.promotion),o.loadingButton=!0,yield o.createPromotion(),o.loadingButton=!1),o.currentStep<2&&o.currentStep++})()}prevStep(){this.currentStep--}createPromotion(){var o=this;return(0,k.A)(function*(){console.log("create promotion"),F.cloneDeep(o.promotion.promotionFiles),delete o.promotion.promotionBlocks,delete o.promotion.propertiesCount,delete o.promotion.checked,delete o.promotion.promotionFiles,o.promotion=o.utils.parseProperties(o.promotion),o.promotion.promotionPaymentInfoIsCompleted=!1;const u=yield o.api.createPromotion(o.promotion),O=u.success.data.id;if(!u.success)return console.error(u.error),void o.toastService.showToast({text:u.error.errorMessage,theme:"red",time:2e3});{var E,b,_,B;let W=[...F.cloneDeep(null===(E=o.stepThreeForm)||void 0===E||null===(E=E.fileUploaderManager)||void 0===E||null===(E=E.config)||void 0===E?void 0:E.files)||[],...F.cloneDeep(null===(b=o.stepThreeForm)||void 0===b||null===(b=b.planosFileUploadManagerComponent)||void 0===b||null===(b=b.config)||void 0===b?void 0:b.files)||[],...F.cloneDeep(null===(_=o.stepThreeForm)||void 0===_||null===(_=_.catalogsFileUploadManagerComponent)||void 0===_||null===(_=_.config)||void 0===_?void 0:_.files)||[],...F.cloneDeep(null===(B=o.stepThreeForm)||void 0===B||null===(B=B.videosFileUploadManagerComponent)||void 0===B||null===(B=B.config)||void 0===B?void 0:B.files)||[]];for(let n of W){if(null!=n&&n.new){var U;const P={promotionId:O,name:"",category:n.category,label:n.label,orderIndex:null==n?void 0:n.orderIndex},V=yield o.api.uploadFile(n.fileBlob),w=null==V||null===(U=V.success)||void 0===U||null===(U=U.data)||void 0===U?void 0:U.fileName;P.name=w,yield o.api.addPromotionFile(P)}if(null!=n&&n.deleted&&(yield o.api.removePromotionFileById(null==n?void 0:n.id)),null!=n&&n.moved&&(null==n||!n.deleted)&&(null==n||!n.new)){let P=F.cloneDeep(n);delete P.moved,delete P.fileBase64,delete P.fileBlob,delete P.new,delete P.deleted,delete P.size,delete P.type,yield o.api.editPromotionFile(P)}}}window.location.href="/promotions"})()}}return(s=I).\u0275fac=function(o){return new(o||s)(e.rXU(R.i),e.rXU(Y.d),e.rXU(t.J),e.rXU(y.T),e.rXU(v.Ix),e.rXU(p.f))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-promotion-create"]],viewQuery:function(o,d){if(1&o&&(e.GBs(r.N,5),e.GBs(f.T,5),e.GBs(A.f,5)),2&o){let u;e.mGM(u=e.lsd())&&(d.stepOneForm=u.first),e.mGM(u=e.lsd())&&(d.stepTwoForm=u.first),e.mGM(u=e.lsd())&&(d.stepThreeForm=u.first)}},decls:67,vars:16,consts:[["stepOneForm",""],["stepTwoForm",""],["stepThreeForm",""],[1,"crm-block-body"],[1,"crm-block-steps"],[1,"crm-block-steps-step"],[1,"crm-block-steps-step-left"],[1,"crm-block-steps-step-number"],[1,"crm-block-steps-step-right"],[1,"crm-block-steps-step-title"],[1,"crm-block-steps-step-subtitle"],[1,"crm-block-steps-step",3,"ngClass"],[1,"crm-block-body-white-content"],[1,"crm-section","crm-section-center-content",3,"ngClass"],[1,"crm-header-modal","crm-header-modal-padding","crm-header-modal-fixed-top"],[1,"crm-modal-header-title"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[1,"crm-button-secondary",3,"click"],[1,"crm-button",3,"click","appLoadingButton"]],template:function(o,d){if(1&o){const u=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),e.EFF(5," 1 "),e.k0s()(),e.j41(6,"div",8)(7,"div",9),e.EFF(8," Definir la promoci\xf3n "),e.k0s(),e.j41(9,"div",10),e.EFF(10," Establece la informaci\xf3n general de la promoci\xf3n "),e.k0s()()(),e.j41(11,"div",11)(12,"div",6)(13,"div",7),e.EFF(14," 2 "),e.k0s()(),e.j41(15,"div",8)(16,"div",9),e.EFF(17," Caracter\xedsticas "),e.k0s(),e.j41(18,"div",10),e.EFF(19," Selecciona las caracter\xedsticas de las propiedades "),e.k0s()()(),e.j41(20,"div",11)(21,"div",6)(22,"div",7),e.EFF(23," 3 "),e.k0s()(),e.j41(24,"div",8)(25,"div",9),e.EFF(26," Im\xe1genes y textos "),e.k0s(),e.j41(27,"div",10),e.EFF(28," Sube im\xe1genes y selecciona los textos "),e.k0s()()()(),e.j41(29,"div",12)(30,"div",13)(31,"div",14),e.nrm(32,"div",15),e.j41(33,"div",16)(34,"button",17),e.bIt("click",function(){return e.eBV(u),e.Njj(d.nextStep())}),e.EFF(35," Siguiente "),e.k0s()()(),e.nrm(36,"app-step-one-promotion-form",null,0)(38,"br")(39,"br")(40,"br"),e.k0s(),e.j41(41,"div",13)(42,"div",14),e.nrm(43,"div",15),e.j41(44,"div",16)(45,"button",18),e.bIt("click",function(){return e.eBV(u),e.Njj(d.prevStep())}),e.EFF(46," Atr\xe1s "),e.k0s(),e.j41(47,"button",17),e.bIt("click",function(){return e.eBV(u),e.Njj(d.nextStep())}),e.EFF(48," Siguiente "),e.k0s()()(),e.nrm(49,"app-step-two-promotion-form",null,1)(51,"br")(52,"br")(53,"br"),e.k0s(),e.j41(54,"div",13)(55,"div",14),e.nrm(56,"div",15),e.j41(57,"div",16)(58,"button",18),e.bIt("click",function(){return e.eBV(u),e.Njj(d.prevStep())}),e.EFF(59," Atr\xe1s "),e.k0s(),e.j41(60,"button",19),e.bIt("click",function(){return e.eBV(u),e.Njj(d.nextStep())}),e.EFF(61," Siguiente "),e.k0s()()(),e.nrm(62,"app-step-three-promotion-form",null,2)(64,"br")(65,"br")(66,"br"),e.k0s()()()}2&o&&(e.R7$(11),e.Y8G("ngClass",e.eq3(6,l,d.currentStep<1)),e.R7$(9),e.Y8G("ngClass",e.eq3(8,l,d.currentStep<2)),e.R7$(10),e.Y8G("ngClass",e.eq3(10,S,0!==d.currentStep)),e.R7$(11),e.Y8G("ngClass",e.eq3(12,S,1!==d.currentStep)),e.R7$(13),e.Y8G("ngClass",e.eq3(14,S,2!==d.currentStep)),e.R7$(6),e.Y8G("appLoadingButton",d.loadingButton))},dependencies:[c.YU,r.N,f.T,A.f,C.K]}),I})()}];let M=(()=>{var s;class I{}return(s=I).\u0275fac=function(o){return new(o||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[v.iI.forChild(a),v.iI]}),I})();var T=i(9083);let L=(()=>{var s;class I{}return(s=I).\u0275fac=function(o){return new(o||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[c.MD,g.YN,m.bv,M,T.E]}),I})()},8031:(G,D,i)=>{i.d(D,{J:()=>F});var c=i(467),g=i(7376),v=i(3953),k=i(5970),r=i(8397),f=i(6039),A=i(6552);let F=(()=>{var e;class R{constructor(t,y,p,C){this.popoversService=t,this.toastService=y,this.api=p,this.utils=C}transformPromotionFormStepOne(t){return{projectName:null==t?void 0:t.projectName,constructionType:null==t?void 0:t.constructionType,constructionSubType:null==t?void 0:t.constructionSubType,constructionStatus:null==t?void 0:t.constructionStatus,constructionYear:null==t?void 0:t.constructionYear,constructionStart:null==t?void 0:t.constructionStart,commercializationStart:null==t?void 0:t.commercializationStart,keyDeliveryDate:null==t?void 0:t.keyDeliveryDate,country:null==t?void 0:t.country,province:null==t?void 0:t.province,city:null==t?void 0:t.city,neighborhood:null==t?void 0:t.neighborhood,address:null==t?void 0:t.address,postalCode:null==t?void 0:t.postalCode,number:null==t?void 0:t.number,showAddressPublicly:null==t?void 0:t.showAddressPublicly,showGeoreferencePublicly:null==t?void 0:t.showGeoreferencePublicly,energyEfficiencyCertificate:null==t?void 0:t.energyEfficiencyCertificate,co2EmissionsCertificate:null==t?void 0:t.co2EmissionsCertificate,energyEfficiencyValue:null==t?void 0:t.energyEfficiencyValue,co2EmissionsValue:null==t?void 0:t.co2EmissionsValue}}transformPromotionFormStepThree(t){return{title_es:null==t?void 0:t.title_es,title_en:null==t?void 0:t.title_en,title_de:null==t?void 0:t.title_de,title_fr:null==t?void 0:t.title_fr,title_ru:null==t?void 0:t.title_ru,description_es:null==t?void 0:t.description_es,description_en:null==t?void 0:t.description_en,description_de:null==t?void 0:t.description_de,description_fr:null==t?void 0:t.description_fr,description_ru:null==t?void 0:t.description_ru,promotionFiles:null==t?void 0:t.promotionFiles}}deleteAllPromotionPropertiesExceptFeatures(t){const y=g.cloneDeep(t);for(const p in y)p.startsWith("f_")||p.startsWith("fcustom_")||delete y[p];return y}onDuplicateProperty(t,y){var p=this;return(0,c.A)(function*(){let C=null;const l=yield p.popoversService.onShowDuplicatePropertyPopover(t);var S,h,a,M,T;if(console.log("POPOVER RESULT",l),l&&(null!=l&&null!==(S=l.data)&&void 0!==S&&S.count&&(null==l||null===(h=l.data)||void 0===h?void 0:h.count)>0&&(null==l||null===(a=l.data)||void 0===a?void 0:a.count)<=25?C=null==l||null===(T=l.data)||void 0===T?void 0:T.count:(null==l||null===(M=l.data)||void 0===M?void 0:M.count)>25&&(yield p.toastService.showErrorToast("La cantidad de propiedades a duplicar debe ser mayor a 0 y menor o igual a 25"))),!C)return!1;for(let L=0;L<C;L++)console.log("DUPLICATING PROPERTY",L),yield p.duplicateProperty(y,L);return yield p.toastService.showSuccessToast("Propiedad duplicada exitosamente"),!0})()}duplicateProperty(t,y){var p=this;return(0,c.A)(function*(){var C,l,S,h;let a=g.cloneDeep(t);a=p.utils.parseProperties(a),a.promotionBlockId=t.promotionBlockId,a.promotionId=t.promotionId,a.reference=null!==(C=a)&&void 0!==C&&C.reference?`${null===(l=a)||void 0===l?void 0:l.reference} - Copia ${y+1}`:null,a.availabilityStatus=null;const M=g.cloneDeep((null===(S=a)||void 0===S?void 0:S.propertyFiles)||[]);delete a.id,delete a.propertyFiles,delete a.measurements_floors,delete a.byvaroId,delete a.updatedAt,delete a.createdAt;const T=yield p.api.createProperty(a);null==T||null===(h=T.success)||void 0===h||(h=h.data),console.log("LA PROPERTYYYYYYY",a),console.log("PROPERTY FILES",M)})()}}return(e=R).\u0275fac=function(t){return new(t||e)(v.KVO(k.m),v.KVO(r.f),v.KVO(f.i),v.KVO(A.T))},e.\u0275prov=v.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),R})()},1280:(G,D,i)=>{i.d(D,{B:()=>g,X:()=>c});const c={general:["general","airConditioning","heating"],urbanizacion:["urbanizacion"],cercania:["cercania"],caracteristicas:["caracteristicas"]},g={airConditioning:["AACentralizado","Split","PreInstalacion"],heating:["CentralConGasNatural","CentralConDiesel","CentralConElectricidad","CentralConSueloRadiante","SueloRadianteSoloBanos","CentralConAerotermia","IndividualBombaCalorFrio","IndividualGasPropanoButano"],general:["barbacoa","armariosEmpotrados","puertaBlindada","ascensor","panelesSolares","domotica","gymPrivado","jacuzziPrivado","saunaPrivada","alarma","persianasElectricas","dobleAcristalamiento"],urbanizacion:["Urbanizacion","Portero","UrbanizacionCerrada","Vigilancia24Horas","Gym","PistaDePadel","PistaDeTenis","RestauranteEnElRecinto","SalaDeEventos","Coworking","ZonasAjardinadas","ParqueInfantil","PiscinaInfantil","Hammam","Jacuzzi","Sauna"],cercania:["PrimeraLineaDePlaya","SegundaLineaDePlaya","CercaDeLaPlaya","PrimeraLineaDeGolf","SegundaLineaDeGolf","CercaDeGolf","CentroDeCiudad","CercaDelPuerto"],caracteristicas:["LicenciaTuristica","Balcon","JardinPrivado","Vestidor","Lavanderia","CasaDeInvitados","Chimenea","PistaDeTenisPrivado","PistaDePadelPrivado","Bodega","Despensa"]}}}]);