"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6231,3666],{6580:(T,C,g)=>{g.d(C,{k:()=>y});var o=g(3953);function e(d,f){if(1&d&&(o.j41(0,"div",15),o.EFF(1),o.k0s()),2&d){const _=o.XpG(2);o.R7$(),o.SpI(" ",null==_.listPaginationConfig?null:_.listPaginationConfig.checkedItems," seleccionado ")}}function I(d,f){if(1&d&&(o.j41(0,"div",14),o.DNE(1,e,2,1,"div",15),o.k0s()),2&d){const _=o.XpG();o.R7$(),o.vxM(null!=_.listPaginationConfig&&_.listPaginationConfig.checkedItems||0===(null==_.listPaginationConfig?null:_.listPaginationConfig.checkedItems)?1:-1)}}let y=(()=>{var d;class f{constructor(){this.listPaginationConfig={},this.goPreviousPage=new o.bkB,this.goNextPage=new o.bkB,this.sort=new o.bkB}ngOnInit(){}onGoPreviousPage(v){this.goPreviousPage.emit(v)}onGoNextPage(v){this.goNextPage.emit(v)}onSort(v){this.sort.emit(v)}}return(d=f).\u0275fac=function(v){return new(v||d)},d.\u0275cmp=o.VBU({type:d,selectors:[["app-list-pagination-selectors"]],inputs:{listPaginationConfig:"listPaginationConfig"},outputs:{goPreviousPage:"goPreviousPage",goNextPage:"goNextPage",sort:"sort"},decls:21,vars:6,consts:[[1,"crm-block-pagination-selectors"],[1,"crm-button-pagination"],[1,"crm-button-pagination-text"],[1,"crm-button-pagination-buttons"],[1,"crm-button-pagination-arrow","crm-button-icon-solo",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-button-pagination-number"],[1,"fas","fa-arrow-right"],[1,"crm-dropdown",3,"click"],[1,"crm-dropdown-text"],[1,"crm-dropdown-right"],[1,"crm-dropdown-value"],[1,"crm-dropdown-arrow"],[1,"fas","fa-chevron-down"],[1,"crm-input-checkbox"],[1,"crm-input-checkbox-pre-label"]],template:function(v,u){1&v&&(o.j41(0,"div",0)(1,"div",1)(2,"div",2),o.EFF(3),o.k0s(),o.j41(4,"div",3)(5,"button",4),o.bIt("click",function(P){return u.onGoPreviousPage(P)}),o.nrm(6,"i",5),o.k0s(),o.j41(7,"div",6),o.EFF(8),o.k0s(),o.j41(9,"button",4),o.bIt("click",function(P){return u.onGoNextPage(P)}),o.nrm(10,"i",7),o.k0s()(),o.j41(11,"div",8),o.bIt("click",function(P){return u.onSort(P)}),o.j41(12,"div",9),o.EFF(13," Ordenar por "),o.k0s(),o.j41(14,"div",10)(15,"div",11),o.EFF(16),o.k0s(),o.j41(17,"div",12),o.nrm(18,"i",13),o.k0s()()()(),o.j41(19,"div"),o.DNE(20,I,2,1,"div",14),o.k0s()()),2&v&&(o.R7$(3),o.E5c(" ",null==u.listPaginationConfig?null:u.listPaginationConfig.pageStartIndex," - ",null==u.listPaginationConfig?null:u.listPaginationConfig.pageEndIndex," de ",null==u.listPaginationConfig?null:u.listPaginationConfig.totalCount," "),o.R7$(5),o.SpI(" P\xe1g ",null==u.listPaginationConfig?null:u.listPaginationConfig.paginationPage," "),o.R7$(8),o.SpI(" ",null==u.listPaginationConfig?null:u.listPaginationConfig.sortField," "),o.R7$(4),o.vxM(null!=u.listPaginationConfig&&u.listPaginationConfig.showSelectItems?20:-1))}}),f})()},5603:(T,C,g)=>{g.d(C,{P:()=>y});var o=g(177),e=g(9417),I=g(3953);let y=(()=>{var d;class f{}return(d=f).\u0275fac=function(v){return new(v||d)},d.\u0275mod=I.$C({type:d}),d.\u0275inj=I.G2t({imports:[o.MD,e.YN]}),f})()},7944:(T,C,g)=>{g.d(C,{v:()=>l});var o=g(467),e=g(3953),I=g(9465),y=g(6039),d=g(8397);function f(a,p){if(1&a){const c=e.RV6();e.j41(0,"app-agencies-searchbar",20),e.bIt("textUpdated",function(i){e.eBV(c);const m=e.XpG();return e.Njj(m.onSearchTextUpdated(i))})("selectedAgency",function(i){e.eBV(c);const m=e.XpG();return e.Njj(m.onSelectAgency(i))}),e.k0s()}}function _(a,p){if(1&a&&(e.j41(0,"div",17)(1,"div",21)(2,"div",22),e.nrm(3,"img",23),e.k0s(),e.j41(4,"div",24)(5,"div",25),e.EFF(6),e.k0s(),e.j41(7,"div",26),e.EFF(8),e.k0s()()(),e.nrm(9,"div",27),e.k0s()),2&a){const c=e.XpG();e.R7$(6),e.SpI(" ",null==c.selectedAgency?null:c.selectedAgency.name," "),e.R7$(2),e.SpI(" ",null==c.selectedAgency?null:c.selectedAgency.email," ")}}function v(a,p){if(1&a){const c=e.RV6();e.j41(0,"app-card-promotion",30),e.bIt("togglePromotionCheckbox",function(){e.eBV(c);const i=e.XpG().$implicit,m=e.XpG(2);return e.Njj(m.togglePromotionCheckbox(i))}),e.k0s()}if(2&a){const c=e.XpG().$implicit,n=e.XpG(2);e.Y8G("isSmall",!0)("promotion",c)("hideCheckbox",(null==c?null:c.invitedApproved)||(null==c?null:c.invitedPending)||!c.checked&&(null==n.options?null:n.options.maxPromotionsSelected)&&n.selectedPromotions.length>=(null==n.options?null:n.options.maxPromotionsSelected))}}function u(a,p){if(1&a&&e.DNE(0,v,1,3,"app-card-promotion",29),2&a){const c=p.$implicit;e.vxM(null!=c&&c.invitedApproved?-1:0)}}function A(a,p){if(1&a){const c=e.RV6();e.j41(0,"app-card-promotion",30),e.bIt("togglePromotionCheckbox",function(){e.eBV(c);const i=e.XpG().$implicit,m=e.XpG(2);return e.Njj(m.togglePromotionCheckbox(i))}),e.k0s()}if(2&a){const c=e.XpG().$implicit;e.Y8G("isSmall",!0)("promotion",c)("hideCheckbox",(null==c?null:c.invitedApproved)||(null==c?null:c.invitedPending))}}function P(a,p){if(1&a&&e.DNE(0,A,1,3,"app-card-promotion",29),2&a){const c=p.$implicit;e.vxM(null!=c&&c.invitedApproved?0:-1)}}function t(a,p){if(1&a&&(e.j41(0,"div",28),e.EFF(1," \xbfA qu\xe9 promociones quieres invitar? "),e.k0s(),e.j41(2,"div",18),e.Z7z(3,u,1,1,null,null,e.fX1),e.k0s(),e.j41(5,"div",28),e.EFF(6," Promociones ya invitadas "),e.k0s(),e.j41(7,"div",18),e.Z7z(8,P,1,1,null,null,e.fX1),e.k0s()),2&a){const c=e.XpG();e.R7$(3),e.Dyx(c.promotions),e.R7$(5),e.Dyx(c.promotions)}}function s(a,p){1&a&&(e.j41(0,"div",18),e.nrm(1,"app-card-promotion",31)(2,"app-card-promotion",31)(3,"app-card-promotion",31),e.k0s()),2&a&&(e.R7$(),e.Y8G("isSmall",!0)("isSkeleton",!0),e.R7$(),e.Y8G("isSmall",!0)("isSkeleton",!0),e.R7$(),e.Y8G("isSmall",!0)("isSkeleton",!0))}function r(a,p){1&a&&(e.j41(0,"div",19),e.EFF(1," Selecciona una agencia antes de continuar "),e.k0s())}let l=(()=>{var a;class p{constructor(n,i,m){this.modalCtrl=n,this.api=i,this.toastService=m,this.promotions=[],this.selectedAgency=null,this.agencyFullData=null,this.selectedPromotions=[],this.isLoading=!1,this.searchEmail="",this.filters=null,this.sort=null,this.pagination={page:0,itemsPerPage:300}}ngOnInit(){var n=this;return(0,o.A)(function*(){n.agencyCardOpen&&(n.selectedAgency=n.agencyCardOpen),yield n.getData(),yield n.getAgency(),console.log("this.promotions",n.promotions)})()}getData(){var n=this;return(0,o.A)(function*(){n.isLoading=!0;const i=yield n.getPromotions();n.promotions=i,n.isLoading=!1})()}getPromotions(){var n=this;return(0,o.A)(function*(){var i;const m=yield n.api.getPromotions({promotionPaymentInfoIsCompleted:{equals:!0}},n.sort,n.pagination,{properties:{apply:!0,filter:null,onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},agencyInvitationToPromotions:{apply:!0,filter:null,onlyCount:!1}});return(null==m||null===(i=m.success)||void 0===i?void 0:i.data)||[]})()}getAgency(){var n=this;return(0,o.A)(function*(){var i,m,E;const b=(null===(i=n.agencyCardOpen)||void 0===i?void 0:i.id)||(null===(m=n.selectedAgency)||void 0===m?void 0:m.id);if(!b)return;const S=yield n.api.getAgency({id:{equals:b}},n.sort,n.pagination,{agencyInvitationToPromotions:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1}});[n.agencyFullData]=(null==S||null===(E=S.success)||void 0===E?void 0:E.data)||[],n.promotions=n.promotions.map(k=>{for(let h=0;h<n.agencyFullData.agencyInvitationToPromotions.length;h++){const M=n.agencyFullData.agencyInvitationToPromotions[h];if("pending"===M.status&&k.agencyInvitationToPromotions.find(D=>D.id===M.id)&&new Date(M.createdAt).getTime()+6048e5>(new Date).getTime())return{...k,invitedPending:!0}}for(let h=0;h<n.agencyFullData.promotions.length;h++)if(n.agencyFullData.promotions[h].id===k.id)return{...k,invitedApproved:!0};return k})})()}onSelectAgency(n){var i=this;return(0,o.A)(function*(){i.selectedAgency=n,i.selectedPromotions=[],i.promotions=yield i.getPromotions(),i.getAgency()})()}onSearchTextUpdated(n){this.searchEmail=n}togglePromotionCheckbox(n){this.selectedPromotions.find(i=>i.id===n.id)?(this.selectedPromotions=this.selectedPromotions.filter(i=>i.id!==n.id),this.promotions=this.promotions.map(i=>i.id===n.id?{...i,checked:!1}:i)):(this.selectedPromotions.push(n),this.promotions=this.promotions.map(i=>i.id===n.id?{...i,checked:!0}:i))}onInvite(){var n=this;return(0,o.A)(function*(){var i;if(!n.selectedPromotions||0===n.selectedPromotions.length)return void n.toastService.showToast({text:"No hay promociones seleccionadas",theme:"red",icon:"fas fa-exclamation-triangle",time:2e3});let m={type:"register",agencyEmail:n.searchEmail,agencyId:null,status:"pending"};if(console.log("this.selectedAgency",n.selectedAgency),null!==(i=n.selectedAgency)&&void 0!==i&&i.id)m.type="approve",m.agencyEmail=n.selectedAgency.email,m.agencyId=n.selectedAgency.id;else{var E;if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(n.searchEmail))return void n.toastService.showToast({text:"El email no es v\xe1lido",theme:"red",icon:"fas fa-exclamation-triangle",time:2e3});const D=yield n.api.existsUserWithEmail(n.searchEmail);if(null==D||null===(E=D.success)||void 0===E?void 0:E.data)return void n.toastService.showToast({text:"El email ya est\xe1 registrado",theme:"red",icon:"fas fa-exclamation-triangle",time:2e3})}const S=(yield n.api.createAgencyInvitationToPromotions(m)).success.data,k=n.selectedPromotions.map(M=>M.id);yield n.api.addPromotionsToAgencyInvitationToPromotions(k,S.id),n.toastService.showToast({text:"La agencia ha sido invitada",theme:"success",time:2e3}),n.onClose()})()}onClose(){this.modalCtrl.dismiss({reload:!0,selectedPromotions:this.selectedPromotions,selectedAgency:this.selectedAgency,searchEmail:this.searchEmail})}}return(a=p).\u0275fac=function(n){return new(n||a)(e.rXU(I.W3),e.rXU(y.i),e.rXU(d.f))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-invite-agency-modal"]],inputs:{agencyCardOpen:"agencyCardOpen",options:"options"},decls:26,vars:3,consts:[[1,"modal-box","modal-box-auto"],[1,"modal-body"],[1,"crm-header-icon"],[1,"crm-header-icon-left"],[1,"crm-square-icon"],[1,"fas","fa-envelope"],[1,"crm-header-icon-title"],[1,"crm-header-icon-right"],[1,"crm-button",3,"click"],[1,"crm-vertical-separator"],[1,"crm-button-icon-solo",3,"click"],[1,"fas","fa-close"],[1,"modal-body-content"],[1,"crm-section"],[1,"crm-section-title"],[1,"crm-section-light-text"],[3,"textUpdated","selectedAgency",4,"ngIf"],[1,"crm-item-associated-user"],[1,"crm-section-block-rows"],[1,"crm-text"],[3,"textUpdated","selectedAgency"],[1,"crm-item-associated-user-left"],[1,"crm-item-associated-user-left-image"],["src","assets/images/building.png","alt",""],[1,"crm-item-associated-user-left-info"],[1,"crm-item-associated-user-left-info-name"],[1,"crm-item-associated-user-left-info-email"],[1,"crm-item-associated-user-right"],[1,"crm-section-title","crm-section-margin-top"],[3,"isSmall","promotion","hideCheckbox"],[3,"togglePromotionCheckbox","isSmall","promotion","hideCheckbox"],[3,"isSmall","isSkeleton"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e.nrm(5,"i",5),e.k0s(),e.j41(6,"div",6),e.EFF(7," Invitar agencia "),e.k0s()(),e.j41(8,"div",7)(9,"button",8),e.bIt("click",function(){return i.onInvite()}),e.nrm(10,"i",5),e.EFF(11," Invitar "),e.k0s(),e.nrm(12,"div",9),e.j41(13,"button",10),e.bIt("click",function(){return i.onClose()}),e.nrm(14,"i",11),e.k0s()()(),e.j41(15,"div",12)(16,"div",13)(17,"div",14),e.EFF(18," Seleccionar agencia "),e.k0s(),e.j41(19,"div",15),e.EFF(20," Selecciona la agencia a la que quieres invitar a tus promociones "),e.k0s(),e.DNE(21,f,1,0,"app-agencies-searchbar",16)(22,_,10,2,"div",17)(23,t,10,0)(24,s,4,6,"div",18)(25,r,2,0,"div",19),e.k0s()()()()),2&n&&(e.R7$(21),e.Y8G("ngIf",!i.agencyCardOpen),e.R7$(),e.vxM(i.selectedAgency?22:-1),e.R7$(),e.vxM(i.selectedAgency?23:i.isLoading?24:25))}}),p})()},6552:(T,C,g)=>{g.d(C,{T:()=>v});var o=g(467),e=g(7376),y=g(6069),d=g(3953),f=g(5188),_=g(6039);let v=(()=>{var u;class A{constructor(t,s){this.router=t,this.api=s}parseBackendDateToFrontendDateInput(t){if(!t)return null;try{const s=new Date(t),r=s.getFullYear();return`${r}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}catch(s){return console.error("Invalid date format",s),null}}parseProperties(t){for(let r in t)t[r]instanceof Date?t[r]=t[r].toISOString():"string"==typeof t[r]&&t[r].match(/^\d{4}-\d{2}-\d{2}$/)&&(t[r]=new Date(t[r]).toISOString()),"true"===t[r]?t[r]=!0:"false"===t[r]&&(t[r]=!1);const s=e.cloneDeep(t);return delete s.id,s}parseNameToValue(t){return t.toLowerCase().replace(/ /g,"_")}groupPropertiesByPromotion(t,s){return t.map(l=>{const a=s.filter(p=>p.promotionId===l.id);return{...l,properties:a}})}setStepsCompleted(t,s){return t.steps=e.orderBy(t.steps,["order"],["asc"]),t.steps=t.steps.map(r=>(r.order<s.order&&(r.isCompleted=!0),r)),t}hexToRgba(t,s){if(!t)return"";let r,l,a;if(3===(t=t.replace("#","")).length)r=parseInt(t[0]+t[0],16),l=parseInt(t[1]+t[1],16),a=parseInt(t[2]+t[2],16);else{if(6!==t.length)return"";r=parseInt(t.substring(0,2),16),l=parseInt(t.substring(2,4),16),a=parseInt(t.substring(4,6),16)}return`rgba(${r}, ${l}, ${a}, ${s})`}getLanguageInfo(t){return y.e.find(r=>r.code===t)||{}}getCountryInfo(t){return y.X.find(r=>r.code===t)||{}}countAvailableProperties(t){return t&&0!==t.length?t.filter(s=>"available"===s.availabilityStatus).length:0}calculateRangeOfPropertiesPrices(t){if(!t||0===t.length)return{min:0,max:0};const s=t.map(r=>r.price);return{min:Math.min(...s),max:Math.max(...s)}}calculateRangeOfPropertiesRooms(t){if(!t||0===t.length)return{min:0,max:0};const s=t.map(r=>r.bedrooms);return{min:Math.min(...s),max:Math.max(...s)}}onRemoveAgencyAccessToPromotion(t){console.log("onRemoveAgencyAccessToPromotion",t)}redirectToPromoter(t){this.router.navigate([`/promoters/${t.id}`])}filterFilesByCategoryAndSort(t,s){return t&&0!==t.length?t.filter(r=>r.category===s).sort((r,l)=>{var a,p;return(null!==(a=null==r?void 0:r.orderIndex)&&void 0!==a?a:0)-(null!==(p=null==l?void 0:l.orderIndex)&&void 0!==p?p:0)}):[]}transformThousandSeparator(t){if(null==t||""===t)return"";let s;return s="string"==typeof t?parseFloat(t):t,isNaN(s)?"":s.toString().replace(/\.(?=\d+$)/,",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}detectIfPromotionIsCompleted(t){var s=this;return(0,o.A)(function*(){var r;if(!t)return!1;const l=null===(r=yield s.api.getPromotionById(t.id))||void 0===r||null===(r=r.success)||void 0===r?void 0:r.data;return((null==l?void 0:l.deliveryDateModalityByStatus)||(null==l?void 0:l.deliveryDateModalityByMonths))&&!(null==l||!l.sellCommissionPercentage)&&!(null==l||!l.methodToPayCommissions)&&!(null==l||!l.reservePayment)&&((null==l?void 0:l.registersWithPreRegister)||(null==l?void 0:l.registersWithoutPreRegister))})()}isImageFile(t){var s;const l=null===(s=t.split(".").pop())||void 0===s?void 0:s.toLowerCase();return!!l&&["png","jpg","jpeg","gif","bmp","webp","svg","tiff","tif","ico","heic","jfif"].includes(l)}}return(u=A).\u0275fac=function(t){return new(t||u)(d.KVO(f.Ix),d.KVO(_.i))},u.\u0275prov=d.jDH({token:u,factory:u.\u0275fac,providedIn:"root"}),A})()}}]);