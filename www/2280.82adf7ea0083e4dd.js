"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2280],{3274:(h,f,a)=>{a.d(f,{K:()=>d});var v=a(177),c=a(3953);let d=(()=>{var p;class s{}return(p=s).\u0275fac=function(l){return new(l||p)},p.\u0275mod=c.$C({type:p}),p.\u0275inj=c.G2t({imports:[v.MD]}),s})()},5603:(h,f,a)=>{a.d(f,{P:()=>p});var v=a(177),c=a(9417),d=a(3953);let p=(()=>{var s;class g{}return(s=g).\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.$C({type:s}),s.\u0275inj=d.G2t({imports:[v.MD,c.YN]}),g})()},3895:(h,f,a)=>{a.d(f,{b:()=>g});var v=a(177),c=a(9417),d=a(9465),p=a(4842),s=a(3953);let g=(()=>{var l;class t{}return(l=t).\u0275fac=function(M){return new(M||l)},l.\u0275mod=s.$C({type:l}),l.\u0275inj=s.G2t({imports:[v.MD,c.YN,d.bv,p.h]}),t})()},9066:(h,f,a)=>{a.d(f,{K:()=>p});var v=a(177),c=a(9465),d=a(3953);let p=(()=>{var s;class g{}return(s=g).\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.$C({type:s}),s.\u0275inj=d.G2t({imports:[v.MD,c.bv]}),g})()},2280:(h,f,a)=>{a.r(f),a.d(f,{SettingsPageModule:()=>V});var v=a(177),c=a(9417),d=a(9465),p=a(3895),s=a(5603),g=a(517),l=a(467),t=a(3953),E=a(6039),M=a(4501),A=a(5508),b=a(5970),F=a(1296),S=a(8397),j=a(1213),P=a(8129);function x(i,m){if(1&i){const r=t.RV6();t.j41(0,"div",14),t.bIt("click",function(){const o=t.eBV(r).$implicit,e=t.XpG();return t.Njj(e.onClickAutoLeadInboxEmailAccount(o))}),t.j41(1,"div",15)(2,"div",16),t.nrm(3,"div",17),t.j41(4,"div",18),t.EFF(5),t.k0s()()(),t.j41(6,"div",19)(7,"div",20),t.nrm(8,"i",21),t.k0s(),t.j41(9,"div",22),t.bIt("click",function(o){const e=t.eBV(r).$implicit,u=t.XpG();return t.Njj(u.deleteAutoLeadInboxEmailAccount(o,null==e?null:e.id))}),t.nrm(10,"i",23),t.k0s()()()}if(2&i){const r=m.$implicit;t.R7$(5),t.SpI(" ",null==r?null:r.email," ")}}function T(i,m){1&i&&(t.j41(0,"div",5),t.EFF(1," A\xfan no hay cuentas de correo Inbound "),t.k0s())}const I=i=>({"has-error":i});function D(i,m){if(1&i){const r=t.RV6();t.j41(0,"div",10),t.bIt("click",function(){const o=t.eBV(r).$implicit,e=t.XpG();return t.Njj(e.openImapAccountModal(o))}),t.j41(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14),t.EFF(5,"Email"),t.k0s(),t.j41(6,"div",15),t.EFF(7),t.k0s()(),t.j41(8,"div",13)(9,"div",14),t.EFF(10,"Host"),t.k0s(),t.j41(11,"div",15),t.EFF(12),t.k0s()(),t.j41(13,"div",13)(14,"div",14),t.EFF(15,"TLS"),t.k0s(),t.j41(16,"div",15)(17,"ion-checkbox",16),t.mxI("ngModelChange",function(o){const e=t.eBV(r).$implicit;return t.DH7(e.tls,o)||(e.tls=o),t.Njj(o)}),t.k0s()()(),t.j41(18,"div",13)(19,"div",14),t.EFF(20,"Port"),t.k0s(),t.j41(21,"div",15),t.EFF(22),t.k0s()()()(),t.j41(23,"div",17),t.bIt("click",function(o){const e=t.eBV(r).$implicit,u=t.XpG();return t.Njj(u.deleteImapAccount(o,e.id))}),t.nrm(24,"i",18),t.k0s()()}if(2&i){const r=m.$implicit;t.R7$(7),t.SpI(" ",r.email," "),t.R7$(5),t.SpI(" ",r.host," "),t.R7$(5),t.R50("ngModel",r.tls),t.R7$(5),t.SpI(" ",r.port," ")}}function y(i,m){1&i&&(t.j41(0,"div",19)(1,"p"),t.EFF(2,"No hay cuentas de correo configuradas."),t.k0s()())}function R(i,m){if(1&i){const r=t.RV6();t.j41(0,"button",20),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.addingImapConnection=!0)}),t.nrm(1,"i",21),t.EFF(2," A\xf1adir cuenta correo Imap "),t.k0s()}}function L(i,m){if(1&i){const r=t.RV6();t.j41(0,"form",22,0),t.bIt("ngSubmit",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.addImapConnection())}),t.j41(2,"div",23)(3,"div",24)(4,"div",25),t.nrm(5,"i",26),t.k0s(),t.j41(6,"div",27),t.EFF(7,"Integraci\xf3n del buz\xf3n"),t.k0s()()(),t.nrm(8,"br"),t.j41(9,"div",28)(10,"div",29),t.EFF(11,"E-mail"),t.k0s(),t.j41(12,"div",30)(13,"input",31),t.mxI("ngModelChange",function(o){t.eBV(r);const e=t.XpG();return t.DH7(e.imapConnection.email,o)||(e.imapConnection.email=o),t.Njj(o)}),t.k0s()()(),t.nrm(14,"br"),t.j41(15,"div",28)(16,"div",29),t.EFF(17,"Direcci\xf3n del servidor IMAP"),t.k0s(),t.j41(18,"div",30)(19,"input",32),t.mxI("ngModelChange",function(o){t.eBV(r);const e=t.XpG();return t.DH7(e.imapConnection.host,o)||(e.imapConnection.host=o),t.Njj(o)}),t.k0s()()(),t.nrm(20,"br"),t.j41(21,"div",28)(22,"div",29),t.EFF(23,"Puerto"),t.k0s(),t.j41(24,"div",30)(25,"input",33),t.mxI("ngModelChange",function(o){t.eBV(r);const e=t.XpG();return t.DH7(e.imapConnection.port,o)||(e.imapConnection.port=o),t.Njj(o)}),t.k0s()()(),t.nrm(26,"br"),t.j41(27,"div",34)(28,"div",35)(29,"div",36)(30,"ion-checkbox",37),t.mxI("ngModelChange",function(o){t.eBV(r);const e=t.XpG();return t.DH7(e.imapConnection.tls,o)||(e.imapConnection.tls=o),t.Njj(o)}),t.k0s(),t.j41(31,"div",38),t.EFF(32,"Usar SSL"),t.k0s()()()(),t.nrm(33,"br"),t.j41(34,"div",28)(35,"div",29),t.EFF(36,"Contrase\xf1a"),t.k0s(),t.j41(37,"div",30)(38,"input",39),t.mxI("ngModelChange",function(o){t.eBV(r);const e=t.XpG();return t.DH7(e.imapConnection.password,o)||(e.imapConnection.password=o),t.Njj(o)}),t.k0s()()(),t.nrm(39,"br"),t.j41(40,"div",40)(41,"button",41),t.nrm(42,"i",42),t.EFF(43," Guardar configuraci\xf3n "),t.k0s(),t.j41(44,"button",43),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.addingImapConnection=!1)}),t.EFF(45," Cancelar "),t.k0s()()()}if(2&i){const r=t.sdS(1),n=t.XpG();t.R7$(9),t.Y8G("ngClass",t.eq3(9,I,r.submitted&&!n.imapConnection.email)),t.R7$(4),t.R50("ngModel",n.imapConnection.email),t.R7$(2),t.Y8G("ngClass",t.eq3(11,I,r.submitted&&!n.imapConnection.host)),t.R7$(4),t.R50("ngModel",n.imapConnection.host),t.R7$(2),t.Y8G("ngClass",t.eq3(13,I,r.submitted&&!n.imapConnection.port)),t.R7$(4),t.R50("ngModel",n.imapConnection.port),t.R7$(5),t.R50("ngModel",n.imapConnection.tls),t.R7$(4),t.Y8G("ngClass",t.eq3(15,I,r.submitted&&!n.imapConnection.password)),t.R7$(4),t.R50("ngModel",n.imapConnection.password)}}const w=[{path:"",component:(()=>{var i;class m{constructor(n,o,e,u,C,_,U,X){this.api=n,this.headerService=o,this.route=e,this.modalsService=u,this.popoversService=C,this.tableService=_,this.toastService=U,this.byvaroState=X,this.autoLeadInboxEmailAccounts=[],this.newEmailAccount="",this.loadingButton=!1}ngOnInit(){this.getState()}getState(){return this.byvaroState.getState().subscribe(n=>{this.stateData=n})}ionViewWillEnter(){this.headerService.setConfig({title:"settings"}),this.getData()}getData(){var n=this;return(0,l.A)(function*(){yield n.api.createDefaultAutoLeadInboxEmailAccounts();const e=yield n.api.getAutoLeadInboxEmailAccounts(null,null,null);e.success?n.autoLeadInboxEmailAccounts=e.success.data:n.toastService.showErrorToast("Error getting data")})()}onClickAutoLeadInboxEmailAccount(n){var o=this;return(0,l.A)(function*(){const e=yield o.modalsService.onShowAutoLeadModal(n);console.log("Popover result:",e),o.getData()})()}createAutoLeadInboxEmailAccount(){var n=this;return(0,l.A)(function*(){if(!n.newEmailAccount)return void n.toastService.showErrorToast("Email is required");n.loadingButton=!0;const o=n.stateData.agency||n.stateData.promoter;n.newEmailAccount=n.newEmailAccount.trim(),n.newEmailAccount=n.newEmailAccount.toLowerCase(),n.newEmailAccount=n.newEmailAccount.replace(/[^a-zA-Z0-9]/g,"");const e="leads."+n.newEmailAccount+"."+o.byvaroId+"@leads.byvaro.com";if(!/^[a-zA-Z0-9]{4,20}$/.test(n.newEmailAccount))return n.toastService.showErrorToast("Email must be between 4 and 20 characters and only contain letters and numbers"),void(n.loadingButton=!1);const u=yield n.api.createAutoLeadInboxEmailAccounts({email:e});n.loadingButton=!1,u.success?(n.toastService.showSuccessToast("Email account created"),n.newEmailAccount="",n.getData()):n.toastService.showErrorToast("Error creating email account:"+u.error.errorMessage)})()}deleteAutoLeadInboxEmailAccount(n,o){var e=this;return(0,l.A)(function*(){n.stopPropagation(),n.preventDefault();const u=yield e.api.deleteAutoLeadInboxEmailAccountsById(o);u.success?(e.toastService.showSuccessToast("Email account deleted"),e.getData()):e.toastService.showErrorToast("Error deleting email account:"+u.error.errorMessage)})()}goToImapList(){window.location.href="/settings/imap-accounts"}}return(i=m).\u0275fac=function(n){return new(n||i)(t.rXU(E.i),t.rXU(M.d),t.rXU(g.nX),t.rXU(A.M),t.rXU(b.m),t.rXU(F.a),t.rXU(S.f),t.rXU(j.c))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-settings"]],decls:23,vars:6,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content"],[1,"crm-block-body",2,"padding","20px"],[1,"crm-section-smaller-title","crm-section-margin-top"],[1,"crm-item-associated-user",2,"width","400px","margin-top","10px","cursor","pointer"],[1,"crm-text"],[1,"crm-input",2,"width","400px"],[1,"crm-input-label"],[1,"crm-input-input"],["placeholder","introduce el nombre del correo",3,"ngModelChange","ngModel"],[1,"crm-input-input-symbol"],[1,"crm-buttons-group"],[1,"crm-button",3,"click","appLoadingButton"],[2,"padding","50px","cursor","pointer",3,"click"],[1,"crm-item-associated-user",2,"width","400px","margin-top","10px","cursor","pointer",3,"click"],[1,"crm-item-associated-user-left"],[1,"crm-item-associated-user-left-info"],[1,"crm-item-associated-user-left-info-name"],[1,"crm-item-associated-user-left-info-email"],[1,"crm-section-buttons-group"],[1,"crm-item-option-edit",2,"margin-right","5px"],[1,"fas","fa-edit"],[1,"crm-item-option-remove",3,"click"],[1,"fas","fa-trash"]],template:function(n,o){1&n&&(t.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3),t.EFF(4," Cuentas de correo Inbound "),t.k0s(),t.nrm(5,"br"),t.Z7z(6,x,11,1,"div",4,t.fX1),t.DNE(8,T,2,0,"div",5),t.nrm(9,"br"),t.j41(10,"div",6)(11,"div",7),t.EFF(12,"Nombre del correo"),t.k0s(),t.j41(13,"div",8)(14,"input",9),t.mxI("ngModelChange",function(u){return t.DH7(o.newEmailAccount,u)||(o.newEmailAccount=u),u}),t.k0s(),t.j41(15,"div",10),t.EFF(16),t.k0s()()(),t.nrm(17,"br"),t.j41(18,"div",11)(19,"button",12),t.bIt("click",function(){return o.createAutoLeadInboxEmailAccount()}),t.EFF(20," Crear cuenta de correo "),t.k0s()()(),t.j41(21,"a",13),t.bIt("click",function(){return o.goToImapList()}),t.EFF(22," Ver cuentas IMAP configuradas "),t.k0s()()()),2&n&&(t.Y8G("fullscreen",!0)("scrollY",!1),t.R7$(6),t.Dyx(o.autoLeadInboxEmailAccounts),t.R7$(2),t.vxM(0==o.autoLeadInboxEmailAccounts.length?8:-1),t.R7$(6),t.R50("ngModel",o.newEmailAccount),t.R7$(2),t.JRh("@leads.byvaro.com"),t.R7$(3),t.Y8G("appLoadingButton",o.loadingButton))},dependencies:[c.me,c.BC,c.vS,d.W9,P.K]}),m})()},{path:"imap-accounts",component:(()=>{var i;class m{constructor(n,o,e,u){this.api=n,this.toastService=o,this.popoversService=e,this.modalsService=u,this.imapConnection={email:"",password:"",host:"",port:993,tls:!0},this.imapAccounts=[],this.addingImapConnection=!1}ngOnInit(){this.getImapAccounts()}addImapConnection(){var n=this;return(0,l.A)(function*(){if(n.imapConnection.email&&n.imapConnection.password&&n.imapConnection.host&&n.imapConnection.port)try{yield n.api.addImapConnection(n.imapConnection),n.toastService.showSuccessToast("Buz\xf3n IMAP guardado correctamente."),n.imapConnection={email:"",password:"",host:"",port:993,tls:!0},n.addingImapConnection=!1,n.getImapAccounts()}catch(o){n.toastService.showErrorToast("Error al guardar el buz\xf3n IMAP."+(null==o?void 0:o.toString()))}else n.toastService.showErrorToast("Por favor, complete todos los campos obligatorios.")})()}getImapAccounts(){var n=this;return(0,l.A)(function*(){try{const o=yield n.api.getImapAccounts();console.log(o),n.imapAccounts=null!=o&&o.success?null==o?void 0:o.success.data:[]}catch(o){n.toastService.showErrorToast("Error al obtener las cuentas IMAP."+(null==o?void 0:o.toString()))}})()}deleteImapAccount(n,o){var e=this;return(0,l.A)(function*(){if(n.preventDefault(),n.stopPropagation(),"delete"===(yield e.popoversService.onShowMenuPopover(n,"delete")).data)try{const _=yield e.api.deleteImapAccount(o);var C;if(null==_||!_.success)return void e.toastService.showErrorToast("Error al eliminar el buz\xf3n IMAP."+(null==_||null===(C=_.error)||void 0===C?void 0:C.errorMessage));e.toastService.showSuccessToast("Buz\xf3n IMAP eliminado correctamente."),e.getImapAccounts()}catch(_){e.toastService.showErrorToast("Error al eliminar el buz\xf3n IMAP."+(null==_?void 0:_.toString()))}})()}openImapAccountModal(n){var o=this;return(0,l.A)(function*(){yield o.modalsService.onShowImapAccountModal(n)})()}}return(i=m).\u0275fac=function(n){return new(n||i)(t.rXU(E.i),t.rXU(S.f),t.rXU(b.m),t.rXU(A.M))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-imap-connections"]],decls:12,vars:6,consts:[["imapForm","ngForm"],[3,"fullscreen","scrollY"],[1,"crm-block-content"],[1,"crm-block-body",2,"padding","20px"],[1,"crm-title"],[2,"max-height","300px","overflow-y","auto"],["class","crm-item-operation",3,"click",4,"ngFor","ngForOf"],["class","crm-text","style","margin-top: 20px;",4,"ngIf"],["class","crm-button",3,"click",4,"ngIf"],["style","max-width: 500px;",3,"ngSubmit",4,"ngIf"],[1,"crm-item-operation",3,"click"],[1,"crm-item-operation-center"],[1,"crm-block-info-horizontal"],[1,"crm-info"],[1,"crm-info-title"],[1,"crm-info-content"],["name","tls","disabled","",3,"ngModelChange","ngModel"],[1,"crm-item-operation-right",2,"position","relative",3,"click"],[1,"fas","fa-ellipsis-v"],[1,"crm-text",2,"margin-top","20px"],[1,"crm-button",3,"click"],[1,"fas","fa-plus"],[2,"max-width","500px",3,"ngSubmit"],[1,"crm-header-icon",2,"margin-bottom","20px"],[1,"crm-header-icon-left"],[1,"crm-square-icon"],[1,"fas","fa-envelope"],[1,"crm-header-icon-title"],[1,"crm-input",3,"ngClass"],[1,"crm-input-label"],[1,"crm-input-input"],["type","email","name","email","placeholder","info@example.com","required","",3,"ngModelChange","ngModel"],["type","text","name","host","placeholder","imap.example.com","required","",3,"ngModelChange","ngModel"],["type","number","name","port","placeholder","993","required","",3,"ngModelChange","ngModel"],[1,"crm-input"],[1,"crm-input-checkboxes"],[1,"crm-input-checkbox"],["name","tls",3,"ngModelChange","ngModel"],[1,"crm-input-checkbox-label"],["type","password","name","password","placeholder","Contrase\xf1a","required","",3,"ngModelChange","ngModel"],[2,"margin-top","20px"],["type","submit",1,"crm-button","crm-button-success"],[1,"fas","fa-check"],[1,"crm-button","crm-button-secondary",2,"margin-top","10px",3,"click"]],template:function(n,o){1&n&&(t.j41(0,"ion-content",1)(1,"div",2)(2,"div",3)(3,"div",4),t.EFF(4,"Lista de cuentas de correo"),t.k0s(),t.nrm(5,"br"),t.j41(6,"div",5),t.DNE(7,D,25,4,"div",6)(8,y,3,0,"div",7),t.k0s(),t.nrm(9,"br"),t.DNE(10,R,3,0,"button",8)(11,L,46,17,"form",9),t.k0s()()()),2&n&&(t.Y8G("fullscreen",!0)("scrollY",!1),t.R7$(7),t.Y8G("ngForOf",o.imapAccounts),t.R7$(),t.Y8G("ngIf",0===o.imapAccounts.length),t.R7$(2),t.Y8G("ngIf",!o.addingImapConnection),t.R7$(),t.Y8G("ngIf",o.addingImapConnection))},dependencies:[v.YU,v.Sq,v.bT,c.qT,c.me,c.Q0,c.BC,c.cb,c.YS,c.vS,c.cV,d.eY,d.W9,d.hB]}),m})()}];let B=(()=>{var i;class m{}return(i=m).\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[g.iI.forChild(w),g.iI]}),m})();var G=a(3274),O=a(9066);let V=(()=>{var i;class m{}return(i=m).\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[v.MD,c.YN,d.bv,B,p.b,s.P,G.K,O.K]}),m})()}}]);