"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3732,3666,1285],{3274:(G,I,i)=>{i.d(I,{K:()=>C});var a=i(177),t=i(3953);let C=(()=>{var y;class v{}return(y=v).\u0275fac=function(e){return new(e||y)},y.\u0275mod=t.$C({type:y}),y.\u0275inj=t.G2t({imports:[a.MD]}),v})()},179:(G,I,i)=>{i.d(I,{Y:()=>f});var a=i(177),t=i(9417),C=i(9465),y=i(8147),v=i(3953);let f=(()=>{var e;class k{}return(e=k).\u0275fac=function(T){return new(T||e)},e.\u0275mod=v.$C({type:e}),e.\u0275inj=v.G2t({imports:[a.MD,t.YN,C.bv,y.h]}),k})()},6580:(G,I,i)=>{i.d(I,{k:()=>y});var a=i(3953);function t(v,f){if(1&v&&(a.j41(0,"div",15),a.EFF(1),a.k0s()),2&v){const e=a.XpG(2);a.R7$(),a.SpI(" ",null==e.listPaginationConfig?null:e.listPaginationConfig.checkedItems," seleccionado ")}}function C(v,f){if(1&v&&(a.j41(0,"div",14),a.DNE(1,t,2,1,"div",15),a.k0s()),2&v){const e=a.XpG();a.R7$(),a.vxM(null!=e.listPaginationConfig&&e.listPaginationConfig.checkedItems||0===(null==e.listPaginationConfig?null:e.listPaginationConfig.checkedItems)?1:-1)}}let y=(()=>{var v;class f{constructor(){this.listPaginationConfig={},this.goPreviousPage=new a.bkB,this.goNextPage=new a.bkB,this.sort=new a.bkB}ngOnInit(){}onGoPreviousPage(k){this.goPreviousPage.emit(k)}onGoNextPage(k){this.goNextPage.emit(k)}onSort(k){this.sort.emit(k)}}return(v=f).\u0275fac=function(k){return new(k||v)},v.\u0275cmp=a.VBU({type:v,selectors:[["app-list-pagination-selectors"]],inputs:{listPaginationConfig:"listPaginationConfig"},outputs:{goPreviousPage:"goPreviousPage",goNextPage:"goNextPage",sort:"sort"},decls:21,vars:6,consts:[[1,"crm-block-pagination-selectors"],[1,"crm-button-pagination"],[1,"crm-button-pagination-text"],[1,"crm-button-pagination-buttons"],[1,"crm-button-pagination-arrow","crm-button-icon-solo",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-button-pagination-number"],[1,"fas","fa-arrow-right"],[1,"crm-dropdown",3,"click"],[1,"crm-dropdown-text"],[1,"crm-dropdown-right"],[1,"crm-dropdown-value"],[1,"crm-dropdown-arrow"],[1,"fas","fa-chevron-down"],[1,"crm-input-checkbox"],[1,"crm-input-checkbox-pre-label"]],template:function(k,g){1&k&&(a.j41(0,"div",0)(1,"div",1)(2,"div",2),a.EFF(3),a.k0s(),a.j41(4,"div",3)(5,"button",4),a.bIt("click",function(A){return g.onGoPreviousPage(A)}),a.nrm(6,"i",5),a.k0s(),a.j41(7,"div",6),a.EFF(8),a.k0s(),a.j41(9,"button",4),a.bIt("click",function(A){return g.onGoNextPage(A)}),a.nrm(10,"i",7),a.k0s()(),a.j41(11,"div",8),a.bIt("click",function(A){return g.onSort(A)}),a.j41(12,"div",9),a.EFF(13," Ordenar por "),a.k0s(),a.j41(14,"div",10)(15,"div",11),a.EFF(16),a.k0s(),a.j41(17,"div",12),a.nrm(18,"i",13),a.k0s()()()(),a.j41(19,"div"),a.DNE(20,C,2,1,"div",14),a.k0s()()),2&k&&(a.R7$(3),a.E5c(" ",null==g.listPaginationConfig?null:g.listPaginationConfig.pageStartIndex," - ",null==g.listPaginationConfig?null:g.listPaginationConfig.pageEndIndex," de ",null==g.listPaginationConfig?null:g.listPaginationConfig.totalCount," "),a.R7$(5),a.SpI(" P\xe1g ",null==g.listPaginationConfig?null:g.listPaginationConfig.paginationPage," "),a.R7$(8),a.SpI(" ",null==g.listPaginationConfig?null:g.listPaginationConfig.sortField," "),a.R7$(4),a.vxM(null!=g.listPaginationConfig&&g.listPaginationConfig.showSelectItems?20:-1))}}),f})()},5603:(G,I,i)=>{i.d(I,{P:()=>y});var a=i(177),t=i(9417),C=i(3953);let y=(()=>{var v;class f{}return(v=f).\u0275fac=function(k){return new(k||v)},v.\u0275mod=C.$C({type:v}),v.\u0275inj=C.G2t({imports:[a.MD,t.YN]}),f})()},3675:(G,I,i)=>{i.d(I,{S:()=>v});var a=i(177),t=i(9465),C=i(9417),y=i(3953);let v=(()=>{var f;class e{}return(f=e).\u0275fac=function(g){return new(g||f)},f.\u0275mod=y.$C({type:f}),f.\u0275inj=y.G2t({imports:[a.MD,t.bv,C.YN]}),e})()},1129:(G,I,i)=>{i.d(I,{Z:()=>v});var a=i(3953),t=i(6069),C=i(1982);function y(f,e){if(1&f){const k=a.RV6();a.j41(0,"app-country-selector-popover",4),a.bIt("countrySelected",function(T){a.eBV(k);const A=a.XpG();return a.Njj(A.selectCountry(T))})("closePopover",function(){a.eBV(k);const T=a.XpG();return a.Njj(T.dropdownOpen=!1)}),a.k0s()}2&f&&a.Y8G("showCountryCode",!0)}let v=(()=>{var f;class e{constructor(){this.emitCountrySelected=new a.bkB,this.countries=t.X,this.selectedCountry=t.X[0],this.dropdownOpen=!1}ngOnChanges(){const g=this.extractCountryPhoneCodeFromPhoneNumber(this.selectedPhoneNumber);g!==this.extractCountryPhoneCodeFromPhoneNumber(this.selectedCountry.phoneCode)&&this.selectCountryByPhoneCode(g)}toggleDropdown(g){g.stopPropagation(),this.dropdownOpen=!this.dropdownOpen}selectCountry(g){g.event.stopPropagation(),this.selectedCountry=g.country,this.emitCountrySelected.emit(g.country),this.dropdownOpen=!1}selectCountryByPhoneCode(g){const T=this.countries.find(A=>A.phoneCode===g);T&&(this.selectedCountry=T,this.emitCountrySelected.emit(T))}extractCountryPhoneCodeFromPhoneNumber(g){return null==g?void 0:g.split(" ")[0]}}return(f=e).\u0275fac=function(g){return new(g||f)},f.\u0275cmp=a.VBU({type:f,selectors:[["app-flag-country-selector"]],inputs:{selectedPhoneNumber:"selectedPhoneNumber"},outputs:{emitCountrySelected:"emitCountrySelected"},features:[a.OA$],decls:5,vars:3,consts:[["tabindex","0",1,"flag-country-selector-container",3,"click"],[1,"selected-country"],[1,"fas","fa-caret-down","dropdown-arrow"],[3,"showCountryCode"],[3,"countrySelected","closePopover","showCountryCode"]],template:function(g,T){1&g&&(a.j41(0,"div",0),a.bIt("click",function(Y){return T.toggleDropdown(Y)}),a.j41(1,"div",1),a.nrm(2,"span")(3,"i",2),a.k0s(),a.DNE(4,y,1,1,"app-country-selector-popover",3),a.k0s()),2&g&&(a.R7$(2),a.HbH(null==T.selectedCountry?null:T.selectedCountry.flagClass),a.R7$(2),a.vxM(T.dropdownOpen?4:-1))},dependencies:[C.u],styles:[".flag-country-selector-container[_ngcontent-%COMP%]{position:relative;width:50px;cursor:pointer;color:#000}.selected-country[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:50px}.dropdown-arrow[_ngcontent-%COMP%]{margin-left:8px}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:200px;z-index:9999;background-color:#fff;border:1px solid #ccc;padding:8px 0;border-radius:12px;border:1px solid var(--crm-border-light-color);color:#000;max-height:150px;overflow-y:auto}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;display:inline-block;margin-right:8px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.flag-country-selector-container[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{color:#000}.selected-country[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;width:18px;height:18px}"]}),e})()},6812:(G,I,i)=>{i.d(I,{u:()=>v});var a=i(177),t=i(9417),C=i(7754),y=i(3953);let v=(()=>{var f;class e{}return(f=e).\u0275fac=function(g){return new(g||f)},f.\u0275mod=y.$C({type:f}),f.\u0275inj=y.G2t({imports:[a.MD,t.YN,C.X]}),e})()},9066:(G,I,i)=>{i.d(I,{K:()=>y});var a=i(177),t=i(9465),C=i(3953);let y=(()=>{var v;class f{}return(v=f).\u0275fac=function(k){return new(k||v)},v.\u0275mod=C.$C({type:v}),v.\u0275inj=C.G2t({imports:[a.MD,t.bv]}),f})()},68:(G,I,i)=>{i.d(I,{k:()=>y});var a=i(177),t=i(9417),C=i(3953);let y=(()=>{var v;class f{}return(v=f).\u0275fac=function(k){return new(k||v)},v.\u0275mod=C.$C({type:v}),v.\u0275inj=C.G2t({imports:[a.MD,t.YN]}),f})()},2306:(G,I,i)=>{i.d(I,{T:()=>y});var a=i(177),t=i(9417),C=i(3953);let y=(()=>{var v;class f{}return(v=f).\u0275fac=function(k){return new(k||v)},v.\u0275mod=C.$C({type:v}),v.\u0275inj=C.G2t({imports:[a.MD,t.YN]}),f})()},3732:(G,I,i)=>{i.d(I,{D:()=>z});var a=i(177),t=i(4716),C=i(9417),y=i(9465),v=i(7944),f=i(7991),e=i(3953);let k=(()=>{var l;class m{}return(l=m).\u0275fac=function(d){return new(d||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[a.MD,C.YN]}),m})();var g=i(8147),T=i(2652),A=i(6812);let Y=(()=>{var l;class m{}return(l=m).\u0275fac=function(d){return new(d||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[a.MD,C.YN]}),m})();var s=i(6279);let N=(()=>{var l;class m{}return(l=m).\u0275fac=function(d){return new(d||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[a.MD,C.YN,C.X1,y.bv,g.h,A.u,Y,s.F]}),m})();var R=i(2606),w=i(179),S=i(3675),K=i(1968),j=i(3895),D=i(9662);let L=(()=>{var l;class m{}return(l=m).\u0275fac=function(d){return new(d||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[a.MD,C.YN,C.X1,y.bv,T.T,s.F,D.Y,g.h]}),m})();var U=i(3274),P=i(2306),E=i(68),$=i(144),X=i(8433),ee=i(9066),te=i(7774),H=i(467),oe=i(6552),ne=i(5970),ie=i(6039),ae=i(8397),se=i(1129);const re=["fileUploaderManagerComponent"],Z=l=>({"crm-input-input-error":l}),Q=l=>({field:l}),ce=l=>({item:l});function de(l,m){1&l&&(e.j41(0,"div",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function ue(l,m){1&l&&(e.j41(0,"div",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function pe(l,m){1&l&&(e.j41(0,"div",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function me(l,m){1&l&&(e.j41(0,"div",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function _e(l,m){if(1&l){const h=e.RV6();e.j41(0,"div",15)(1,"div",26)(2,"div",27),e.nrm(3,"span"),e.k0s(),e.j41(4,"div",28),e.EFF(5),e.k0s()(),e.j41(6,"div",29),e.bIt("click",function(){const p=e.eBV(h).$implicit,x=e.XpG();return e.Njj(x.onRemoveLanguage(p))}),e.nrm(7,"i",30),e.k0s()()}if(2&l){let h,d;const p=m.$implicit,x=e.XpG();e.R7$(3),e.HbH(null==(h=x.getLanguageInfo(p))?null:h.flagClass),e.R7$(2),e.SpI(" ",null==(d=x.getLanguageInfo(p))?null:d.name," ")}}function ve(l,m){if(1&l&&(e.j41(0,"option",33),e.EFF(1),e.k0s()),2&l){const h=m.$implicit;e.Y8G("value",h.id),e.R7$(),e.JRh(h.name)}}function fe(l,m){if(1&l&&(e.j41(0,"div",31)(1,"select",32),e.Z7z(2,ve,2,2,"option",33,e.fX1),e.k0s()()),2&l){const h=e.XpG();e.R7$(2),e.Dyx(h.roles)}}function ge(l,m){1&l&&(e.j41(0,"div",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function Ce(l,m){if(1&l){const h=e.RV6();e.j41(0,"button",34),e.bIt("click",function(){e.eBV(h);const p=e.XpG();return e.Njj(p.changeUserInactiveState(!1))}),e.EFF(1,"Activar Usuario"),e.k0s()}}function he(l,m){if(1&l){const h=e.RV6();e.j41(0,"button",35),e.bIt("click",function(){e.eBV(h);const p=e.XpG();return e.Njj(p.changeUserInactiveState(!0))}),e.EFF(1,"Desactivar Usuario"),e.k0s()}}let be=(()=>{var l;class m{constructor(d,p,x,B,V){this.fb=d,this.utils=p,this.popoverService=x,this.api=B,this.toast=V,this.user={},this.onChange=new e.bkB,this.userCopy=null,this.files=[],this.photoEdited=!1,this.roles=[]}ngOnInit(){var d=this;return(0,H.A)(function*(){d.userCopy=JSON.parse(JSON.stringify(d.user)),d.initForm(),d.user?(d.populateForm(d.userCopy),d.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]},d.fileUploaderManager.createProfileFilePic(d.user)):d.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]};const p=yield d.api.getAccessRole();p.success?d.roles=p.success.data:d.toast.showErrorToast("Error al cargar los roles de acceso. "+p.error.errorMessage)})()}getLanguageInfo(d){return this.utils.getLanguageInfo(d)}onAddLanguage(d){var p=this;return(0,H.A)(function*(){var x,B;const V={languageSelector:!0,showCountryCode:!1,selectedCodes:null===(x=p.user)||void 0===x?void 0:x.languages},W=yield p.popoverService.onShowCountrySelectorPopover(d,V);var J,q;null!=W&&null!==(B=W.data)&&void 0!==B&&B.country&&(p.user=p.user||{},p.user.languages=(null===(J=p.user)||void 0===J?void 0:J.languages)||[],p.user.languages.push(null===(q=W.data)||void 0===q||null===(q=q.country)||void 0===q?void 0:q.code))})()}changeUserInactiveState(d){var p=this;return(0,H.A)(function*(){const x=yield p.api.updateUserById(p.user.id,{...p.user,inactive:d});x.success?(p.user.inactive=d,p.toast.showSuccessToast("Estado del usuario actualizado correctamente")):p.toast.showErrorToast("Ha ocurrido un error al actualizar el estado del usuario. "+x.error.errorMessage)})()}onRemoveLanguage(d){this.user.languages=this.user.languages.filter(p=>p!==d)}initForm(){this.userForm=this.fb.group({email:["",C.k0.required],name:["",C.k0.required],jobTitle:[""],phone:["+34 "],visibleForCollaborators:[],accessRoleId:["",C.k0.required]})}populateForm(d){var p,x,B,V,W,J;this.userForm.patchValue({email:null!==(p=null==d?void 0:d.email)&&void 0!==p?p:"",name:null!==(x=null==d?void 0:d.name)&&void 0!==x?x:"",jobTitle:null!==(B=null==d?void 0:d.jobTitle)&&void 0!==B?B:"",phone:null!==(V=null==d?void 0:d.phone)&&void 0!==V?V:"",visibleForCollaborators:null!==(W=null==d?void 0:d.visibleForCollaborators)&&void 0!==W&&W,accessRoleId:null!==(J=null==d?void 0:d.accessRoleId)&&void 0!==J?J:""}),this.userForm.get("email").disable()}onSelectCountry(d){this.userForm.get("phone").setValue((null==d?void 0:d.phoneCode)+" ")}isControlInvalid(d){const p=this.userForm.get(d);return!(!p||!p.invalid||!p.dirty&&!p.touched)}}return(l=m).\u0275fac=function(d){return new(d||l)(e.rXU(C.ok),e.rXU(oe.T),e.rXU(ne.m),e.rXU(ie.i),e.rXU(ae.f))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-user-form"]],viewQuery:function(d,p){if(1&d&&e.GBs(re,7),2&d){let x;e.mGM(x=e.lsd())&&(p.fileUploaderManager=x.first)}},inputs:{user:"user"},outputs:{onChange:"onChange"},decls:74,vars:75,consts:[["fileUploaderManagerComponent",""],[1,"crm-section",3,"formGroup"],[1,"crm-section-small-title"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","formControlName","email",3,"placeholder"],["class","crm-input-error",4,"ngIf"],["type","text","formControlName","name",3,"placeholder"],["type","text","formControlName","jobTitle",3,"placeholder"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected"],["type","text","formControlName","phone",3,"placeholder"],[1,"crm-input","crm-input-medium"],[1,"crm-section-items"],[1,"crm-item-option","crm-item-option-lang","edit"],["type","button",1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fas","fa-add"],["class","crm-input-input",4,"ngIf"],[1,"crm-input-checkboxes"],["appToggleCheckbox","",1,"crm-input-checkbox"],["formControlName","visibleForCollaborators"],[1,"crm-input-checkbox-label"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button-secondary","crm-button-secondary-red"],[1,"crm-input-error"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[1,"crm-item-option-label"],[1,"crm-item-option-remove",3,"click"],[1,"fas","fa-trash"],[1,"crm-input-input"],["placeholder","Seleccione","formControlName","accessRoleId"],[3,"value"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"crm-button-secondary","crm-button-secondary-red",3,"click"]],template:function(d,p){if(1&d){const x=e.RV6();e.j41(0,"form",1)(1,"div",2),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.nrm(4,"app-file-uploader-manager",null,0),e.j41(6,"div",3)(7,"div",4),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"div",5),e.nrm(11,"input",6),e.nI1(12,"translate"),e.nI1(13,"translate"),e.k0s(),e.DNE(14,de,3,3,"div",7),e.k0s(),e.j41(15,"div",3)(16,"div",4),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"div",5),e.nrm(20,"input",8),e.nI1(21,"translate"),e.nI1(22,"translate"),e.k0s(),e.DNE(23,ue,3,3,"div",7),e.k0s(),e.j41(24,"div",3)(25,"div",4),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.j41(28,"div",5),e.nrm(29,"input",9),e.nI1(30,"translate"),e.nI1(31,"translate"),e.k0s(),e.DNE(32,pe,3,3,"div",7),e.k0s(),e.j41(33,"div",3)(34,"div",4),e.EFF(35),e.nI1(36,"translate"),e.k0s(),e.j41(37,"div",10)(38,"div",5)(39,"app-flag-country-selector",11),e.bIt("emitCountrySelected",function(V){return e.eBV(x),e.Njj(p.onSelectCountry(V))}),e.k0s(),e.nrm(40,"input",12),e.nI1(41,"translate"),e.nI1(42,"translate"),e.k0s()(),e.DNE(43,me,3,3,"div",7),e.k0s(),e.j41(44,"div",13)(45,"div",4),e.EFF(46," Idiomas "),e.k0s(),e.j41(47,"div",14),e.Z7z(48,_e,8,3,"div",15,e.fX1),e.j41(50,"button",16),e.bIt("click",function(V){return e.eBV(x),e.Njj(p.onAddLanguage(V))}),e.nrm(51,"i",17),e.EFF(52),e.nI1(53,"translate"),e.nI1(54,"translate"),e.k0s(),e.nrm(55,"br"),e.j41(56,"div",3)(57,"div",4),e.EFF(58,"Seleccionar Rol"),e.k0s(),e.DNE(59,fe,4,0,"div",18),e.k0s(),e.DNE(60,ge,3,3,"div",7),e.nrm(61,"br"),e.j41(62,"div",3)(63,"div",4),e.EFF(64,"Mostrar usuario a colaboradores"),e.k0s(),e.j41(65,"div",19)(66,"div",20),e.nrm(67,"ion-checkbox",21),e.j41(68,"div",22),e.EFF(69,"Mostrar"),e.k0s()()()()(),e.nrm(70,"br")(71,"br"),e.DNE(72,Ce,2,0,"button",23)(73,he,2,0,"button",24),e.k0s()()}2&d&&(e.Y8G("formGroup",p.userForm),e.R7$(2),e.SpI(" ",e.bMT(3,22,"text.profile_pic")," "),e.R7$(6),e.SpI(" ",e.bMT(9,24,"text.email")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(57,Z,p.isControlInvalid("email"))),e.R7$(),e.Y8G("placeholder",e.i5U(13,28,"text.input_placeholder",e.eq3(59,Q,e.bMT(12,26,"text.email")))),e.R7$(3),e.Y8G("ngIf",p.isControlInvalid("email")),e.R7$(3),e.SpI(" ",e.bMT(18,31,"text.name")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(61,Z,p.isControlInvalid("name"))),e.R7$(),e.Y8G("placeholder",e.i5U(22,35,"text.input_placeholder",e.eq3(63,Q,e.bMT(21,33,"text.name")))),e.R7$(3),e.Y8G("ngIf",p.isControlInvalid("name")),e.R7$(3),e.SpI(" ",e.bMT(27,38,"text.job_title")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(65,Z,p.isControlInvalid("jobTitle"))),e.R7$(),e.Y8G("placeholder",e.i5U(31,42,"text.input_placeholder",e.eq3(67,Q,e.bMT(30,40,"text.job_title")))),e.R7$(3),e.Y8G("ngIf",p.isControlInvalid("jobTitle")),e.R7$(3),e.SpI(" ",e.bMT(36,45,"text.phone")," "),e.R7$(3),e.Y8G("ngClass",e.eq3(69,Z,p.isControlInvalid("phone"))),e.R7$(2),e.Y8G("placeholder",e.i5U(42,49,"text.input_placeholder",e.eq3(71,Q,e.bMT(41,47,"text.phone")))),e.R7$(3),e.Y8G("ngIf",p.isControlInvalid("phone")),e.R7$(5),e.Dyx(null==p.user?null:p.user.languages),e.R7$(4),e.SpI(" ",e.i5U(54,54,"text.add_item",e.eq3(73,ce,e.bMT(53,52,"text.language")))," "),e.R7$(7),e.Y8G("ngIf",p.roles),e.R7$(),e.Y8G("ngIf",p.isControlInvalid("visibleForCollaborators")),e.R7$(12),e.vxM(!0===(null==p.user?null:p.user.inactive)?72:73))},dependencies:[a.YU,a.bT,C.qT,C.xH,C.y7,C.me,C.wz,C.BC,C.cb,C.j4,C.JD,y.eY,y.hB,se.Z,s.F,g.D9]}),m})();var ye=i(8129),le=i(904),ke=i(8359),Pe=i(1413),Me=i(152),r=i(5558);let b=(()=>{var l;class m{constructor(d){this.api=d,this.searchTermSubject=new Pe.B,this.allAgencies=[],this.searchResults$=this.searchTermSubject.pipe((0,Me.B)(300),(0,r.n)(p=>this.performSearch(p)))}search(d){this.searchTermSubject.next(d)}performSearch(d){var p=this;return(0,H.A)(function*(){let x=[];if(d.includes("@")){const B=d.split("@")[1];let W;W=["gmail.com","yahoo.com","hotmail.com","outlook.com","icloud.com","aol.com","msn.com","live.com","mail.com","protonmail.com","zoho.com","gmx.com","yandex.com","ymail.com","rocketmail.com","fastmail.com","tutanota.com","hushmail.com","inbox.com","me.com","mac.com","live.co.uk","hotmail.co.uk","yahoo.co.uk","hotmail.fr","yahoo.fr","hotmail.de","yahoo.de","hotmail.it","yahoo.it","hotmail.es","yahoo.es","hotmail.uz","yahoo.uz","hotmail.mn"].includes(B)?yield p.api.getAgency({email:{equals:d}},null,{page:0,itemsPerPage:50}):yield p.api.getAgency({email:{contains:"@"+B}},null,{page:0,itemsPerPage:50}),x=W.success.data}return x})()}}return(l=m).\u0275fac=function(d){return new(d||l)(e.KVO(ie.i))},l.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"}),m})();function c(l,m){if(1&l){const h=e.RV6();e.j41(0,"div",8),e.bIt("click",function(p){const x=e.eBV(h).$implicit,B=e.XpG(2);return e.Njj(B.selectAgency(x,p))}),e.j41(1,"div",9)(2,"div",10),e.nrm(3,"img",11),e.k0s(),e.j41(4,"div",12)(5,"div",13),e.EFF(6),e.k0s(),e.j41(7,"div",14),e.EFF(8),e.k0s()()(),e.nrm(9,"div",15),e.k0s()}if(2&l){const h=m.$implicit;e.R7$(6),e.SpI(" ",null==h?null:h.name," "),e.R7$(2),e.SpI(" ",null==h?null:h.domain," ")}}function o(l,m){1&l&&(e.j41(0,"div",16),e.EFF(1," No hay resultados en Byvaro "),e.k0s())}function n(l,m){if(1&l){const h=e.RV6();e.j41(0,"div",8),e.bIt("click",function(p){e.eBV(h);const x=e.XpG(2);return e.Njj(x.selectAgency(null,p))}),e.j41(1,"div",9)(2,"div",10),e.nrm(3,"img",11),e.k0s(),e.j41(4,"div",12)(5,"div",13),e.EFF(6),e.k0s(),e.j41(7,"div",14),e.EFF(8," Esta agencia no est\xe1 registrada en Byvaro, haz clic para invitarla. "),e.k0s()()(),e.nrm(9,"div",15),e.k0s()}if(2&l){const h=e.XpG(2);e.R7$(6),e.SpI(" ",h.searchTerm," ")}}function u(l,m){if(1&l&&(e.j41(0,"div",5),e.Z7z(1,c,10,2,"div",6,e.fX1),e.DNE(3,o,2,0,"div",7)(4,n,10,1,"div",6),e.k0s()),2&l){const h=e.XpG();e.R7$(),e.Dyx(h.searchResults),e.R7$(2),e.Y8G("ngIf",0===h.searchResults.length&&!h.validEmail),e.R7$(),e.vxM(0===h.searchResults.length&&h.validEmail?4:-1)}}let _=(()=>{var l;class m{constructor(d,p){this.renderer=d,this.searchbarService=p,this.selectedAgency=new e.bkB,this.textUpdated=new e.bkB,this.searchTerm="",this.dropdownOpen=!1,this.searchResults=[],this.validEmail=!1,this.globalClickUnlistener=null,this.searchSubscription=new ke.yU}ngOnInit(){this.searchSubscription=this.searchbarService.searchResults$.subscribe(d=>{this.searchResults=d})}onInputClick(d){d.stopPropagation(),this.dropdownOpen||this.openDropdown()}onSearchTermChange(d){this.searchTerm=d,this.searchbarService.search(d),this.checkEmail(),this.textUpdated.emit(d)}checkEmail(){this.validEmail=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.searchTerm)}selectAgency(d,p){d||(d={name:this.searchTerm,email:"Esta agencia no est\xe1 registrada en Byvaro, se enviar\xe1 una invitaci\xf3n por e-mail."}),p.stopPropagation(),this.selectedAgency.emit({name:d.name,email:this.searchTerm,id:d.id}),this.closeDropdown()}openDropdown(){this.dropdownOpen=!0,this.attachDocumentClickListener()}closeDropdown(){this.dropdownOpen=!1,this.detachDocumentClickListener()}attachDocumentClickListener(){this.globalClickUnlistener=this.renderer.listen("document","click",d=>{d.target.closest(".agents-searchbar-container")||this.closeDropdown()})}detachDocumentClickListener(){this.globalClickUnlistener&&(this.globalClickUnlistener(),this.globalClickUnlistener=null)}ngOnDestroy(){this.detachDocumentClickListener(),this.searchSubscription.unsubscribe()}}return(l=m).\u0275fac=function(d){return new(d||l)(e.rXU(e.sFG),e.rXU(b))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-agencies-searchbar"]],outputs:{selectedAgency:"selectedAgency",textUpdated:"textUpdated"},decls:5,vars:2,consts:[[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar","crm-input-input-searchbar-square","agents-searchbar-container",3,"click"],[1,"fas","fa-search"],["type","text","placeholder","Email de la agencia",3,"ngModelChange","ngModel"],["class","dropdown-options",4,"ngIf"],[1,"dropdown-options"],[1,"crm-item-searchbar-agent-result"],["class","no-results",4,"ngIf"],[1,"crm-item-searchbar-agent-result",3,"click"],[1,"crm-item-searchbar-agent-result-left"],[1,"crm-item-searchbar-agent-result-left-image"],["src","assets/images/building.png","alt",""],[1,"crm-item-searchbar-agent-result-left-info"],[1,"crm-item-searchbar-agent-result-left-info-name"],[1,"crm-item-searchbar-agent-result-left-info-email"],[1,"crm-item-searchbar-agent-result-right"],[1,"no-results"]],template:function(d,p){1&d&&(e.j41(0,"div",0)(1,"div",1),e.bIt("click",function(B){return p.onInputClick(B)}),e.nrm(2,"i",2),e.j41(3,"input",3),e.mxI("ngModelChange",function(B){return e.DH7(p.searchTerm,B)||(p.searchTerm=B),B}),e.bIt("ngModelChange",function(B){return p.onSearchTermChange(B)}),e.k0s(),e.DNE(4,u,5,2,"div",4),e.k0s()()),2&d&&(e.R7$(3),e.R50("ngModel",p.searchTerm),e.R7$(),e.Y8G("ngIf",p.dropdownOpen))},dependencies:[a.bT,C.me,C.BC,C.vS],styles:[".agents-searchbar-container[_ngcontent-%COMP%]{position:relative;cursor:pointer}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;z-index:9999;background-color:#fff;padding:8px 0;border-radius:0 0 8px 8px;border:1px solid var(--crm-border-light-color);max-height:200px;overflow-y:auto;font-size:14px}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.no-results[_ngcontent-%COMP%]{padding:8px;color:#888}"]}),m})();var M=i(4821),O=i(4426),F=i(4558);let z=(()=>{var l;class m{}return(l=m).\u0275fac=function(d){return new(d||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[a.MD,C.YN,C.X1,y.bv,f.S,k,g.h,T.T,N,R.O,S.S,w.Y,j.b,L,U.K,P.T,E.k,A.u,s.F,X.x,ee.K,te.G,D.Y]}),m})();e.wjB(t.K,[a.bT,be,ye.K],[g.D9]),e.wjB(v.v,[a.bT,le.X,_],[]),e.wjB(K.r,[le.X,M.e,O.O],[g.D9,F.w]),e.wjB($.f,[X.x],[])},8433:(G,I,i)=>{i.d(I,{x:()=>j});var a=i(467),t=i(177),C=i(9417),y=i(9465),v=i(3895),f=i(5603),e=i(3953),k=i(5970),g=i(6039),T=i(1296),A=i(4501),Y=i(8397),s=i(345),N=i(9773),R=i(5188),w=i(6580),S=i(1880);const K=(D,L,U,P,E)=>({pageStartIndex:D,pageEndIndex:L,totalCount:U,paginationPage:P,sortField:E});let j=(()=>{var D;class L{constructor(P,E,$,X,ee,te,H,oe,ne){this.popoversService=P,this.api=E,this.tableService=$,this.headerService=X,this.toastService=ee,this.sanitizer=te,this.modalsService=H,this.router=oe,this.activatedRoute=ne,this.documents=[],this.allSystemOperationsCount=0,this.filters=null,this.sort={field:"createdAt",order:"desc"},this.pagination={page:0,itemsPerPage:50},this.agencyId=null,this.promotionId=null,this.documentsTableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"createdAt",label:"A\xf1adido en",size:"medium",type:"date"},{key:"title",label:"T\xedtulo",size:"large",type:"text"},{key:"fileName",label:"Nombre del archivo",size:"large",type:"text"},{key:"documentType",label:"Tipo de documento",size:"medium",type:"text"}],rows:[]}}ngOnInit(){this.getData()}ionViewWillEnter(){var P=this;return(0,a.A)(function*(){P.getData()})()}getData(){var P=this;return(0,a.A)(function*(){var E;let $;if($="operation"===P.options.father?yield P.api.getOperationDocuments(P.options.operationId):yield P.api.getContactOperationDocuments({contactId:P.options.contactId}),P.documents=null===(E=$)||void 0===E||null===(E=E.success)||void 0===E?void 0:E.data,P.documents){let X=P.tableService.convertDataToTableRows(P.documents,P.documentsTableConfig);P.documentsTableConfig.rows=X}})()}openCreateDocumentModal(){var P=this;return(0,a.A)(function*(){yield P.modalsService.onShowCreateOperationDocumentModal(P.options.operationId),P.getData()})()}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemOperationsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemOperationsCount)}}onSort(P){}onRowClicked(P){return(0,a.A)(function*(){})()}onTableButtonClick(P){return(0,a.A)(function*(){})()}}return(D=L).\u0275fac=function(P){return new(P||D)(e.rXU(k.m),e.rXU(g.i),e.rXU(T.a),e.rXU(A.d),e.rXU(Y.f),e.rXU(s.up),e.rXU(N.M),e.rXU(R.Ix),e.rXU(R.nX))},D.\u0275cmp=e.VBU({type:D,selectors:[["app-operation-documents"]],inputs:{options:"options"},standalone:!0,features:[e.aNF],decls:15,vars:8,consts:[[1,"crm-block-content"],[1,"crm-block-body",2,"padding","20px"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar documento"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[1,"fa","fa-plus"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[1,"crm-section"],[3,"actionButtonClick","rowClicked","table"]],template:function(P,E){1&P&&(e.j41(0,"div")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),e.nrm(6,"i",5)(7,"input",6),e.k0s()(),e.j41(8,"div",7)(9,"button",8),e.bIt("click",function(){return E.openCreateDocumentModal()}),e.nrm(10,"i",9),e.EFF(11," A\xf1adir Documento "),e.k0s()()(),e.j41(12,"app-list-pagination-selectors",10),e.bIt("goPreviousPage",function(){return E.onGoPreviousPage()})("goNextPage",function(){return E.onGoNextPage()})("sort",function(X){return E.onSort(X)}),e.k0s(),e.j41(13,"div",11)(14,"app-table",12),e.bIt("actionButtonClick",function(X){return E.onTableButtonClick(X)})("rowClicked",function(X){return E.onRowClicked(X)}),e.k0s()()()()()),2&P&&(e.R7$(12),e.Y8G("listPaginationConfig",e.s1E(2,K,E.updatePagination().startIndex,E.updatePagination().endIndex,E.allSystemOperationsCount,E.pagination.page+1,null!=E.sort&&E.sort.field?(null==E.sort?null:E.sort.field)+" "+(null==E.sort?null:E.sort.order):"Fecha de creaci\xf3n")),e.R7$(2),e.Y8G("table",E.documentsTableConfig))},dependencies:[t.MD,y.bv,C.YN,C.X1,f.P,w.k,v.b,S.O]}),L})()},7754:(G,I,i)=>{i.d(I,{X:()=>v});var a=i(177),t=i(9417),C=i(9465),y=i(3953);let v=(()=>{var f;class e{}return(f=e).\u0275fac=function(g){return new(g||f)},f.\u0275mod=y.$C({type:f}),f.\u0275inj=y.G2t({imports:[a.MD,t.YN,C.bv]}),e})()},7774:(G,I,i)=>{i.d(I,{G:()=>f});var a=i(177),t=i(9417),C=i(3895),y=i(9465),v=i(3953);let f=(()=>{var e;class k{}return(e=k).\u0275fac=function(T){return new(T||e)},e.\u0275mod=v.$C({type:e}),e.\u0275inj=v.G2t({imports:[a.MD,t.YN,C.b,y.bv,a.MD,t.YN]}),k})()},4426:(G,I,i)=>{i.d(I,{O:()=>Me});var a=i(467),t=i(3953),C=i(5824),y=i(7376),v=i(9465),f=i(600),e=i(177),k=i(9417),g=i(1748),T=i(4476);function A(r,b){if(1&r&&(t.j41(0,"div",12),t.nrm(1,"app-general-toast",13),t.k0s()),2&r){const c=t.XpG();t.R7$(),t.Y8G("options",c.toastConfig)}}function Y(r,b){if(1&r){const c=t.RV6();t.j41(0,"ion-checkbox",15),t.bIt("ngModelChange",function(){t.eBV(c);const n=t.XpG().$implicit,u=t.XpG();return t.Njj(u.onCheckboxChange(n))}),t.mxI("ngModelChange",function(n){t.eBV(c);const u=t.XpG().$implicit;return t.DH7(u.selected,n)||(u.selected=n),t.Njj(n)}),t.k0s(),t.j41(1,"div",16),t.EFF(2),t.k0s()}if(2&r){const c=t.XpG().$implicit,o=t.XpG();t.Y8G("id",c.label)("disabled",!c.selected&&o.selectionLimitReached),t.R50("ngModel",c.selected),t.R7$(),t.Y8G("id",c.label),t.R7$(),t.JRh(c.label)}}function s(r,b){if(1&r&&(t.j41(0,"div",14),t.DNE(1,Y,3,5),t.k0s()),2&r){const c=b.$implicit;t.R7$(),t.vxM(c.hidden?-1:1)}}let N=(()=>{var r;class b{constructor(o,n){this.modalCtrl=o,this.navParams=n,this.promotion=null,this.warning=!1,this.MAX_SELECTION=50,this.allColumns=[],this.selectedKeys=[],this.toastConfig={text:"Has alcanzado el l\xedmite de columnas seleccionadas. No puedes a\xf1adir m\xe1s.\n",theme:"orange",fullWidth:!0,showCloseButton:!1,smaller:!0},this.localColumns=[]}ngOnInit(){this.promotion=this.navParams.get("promotion")||null,this.allColumns=this.navParams.get("columns")||[],this.selectedKeys=this.navParams.get("selectedColumnKeys")||[],this.localColumns=this.allColumns.map(o=>({key:o.key,label:o.label,hidden:o.hideSelectColumnsList,selected:this.selectedKeys.includes(o.key)})),this.checkSelectionCount()}checkSelectionCount(){const o=this.localColumns.filter(n=>n.selected).length;this.warning=o>11}onCheckboxChange(o){o.selected&&this.selectedCount>this.MAX_SELECTION&&(o.selected=!1)}get selectedCount(){return this.localColumns.filter(o=>o.selected).length}get selectionLimitReached(){return this.selectedCount>=this.MAX_SELECTION}onCancel(){this.modalCtrl.dismiss(null,"cancel")}onSave(){const o=this.localColumns.filter(n=>n.selected).map(n=>n.key);console.log(o,"updatedSelectedKeys"),this.modalCtrl.dismiss(o,"save")}}return(r=b).\u0275fac=function(o){return new(o||r)(t.rXU(v.W3),t.rXU(f.y8))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-select-table-columns-modal"]],decls:15,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-times"],[1,"crm-button","crm-button-success",3,"click"],[1,"fa-solid","fa-check"],["class","crm-warning-message p-15","style","",4,"ngIf"],[1,"modal-body"],[1,"modal-body-content"],[1,"crm-section-inputs"],["class","crm-input-checkbox","appToggleCheckbox","","style","margin-bottom: 12px;",4,"ngFor","ngForOf"],[1,"crm-warning-message","p-15"],[3,"options"],["appToggleCheckbox","",1,"crm-input-checkbox",2,"margin-bottom","12px"],[3,"ngModelChange","id","disabled","ngModel"],[1,"crm-input-checkbox-label",3,"id"]],template:function(o,n){1&o&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," Seleccionar columnas "),t.k0s(),t.j41(3,"div",2)(4,"button",3),t.bIt("click",function(){return n.onCancel()}),t.nrm(5,"i",4),t.EFF(6," Cerrar "),t.k0s(),t.j41(7,"button",5),t.bIt("click",function(){return n.onSave()}),t.nrm(8,"i",6),t.EFF(9," Guardar "),t.k0s()()(),t.DNE(10,A,2,1,"div",7),t.j41(11,"div",8)(12,"div",9)(13,"div",10),t.DNE(14,s,2,1,"div",11),t.k0s()()()),2&o&&(t.R7$(10),t.Y8G("ngIf",n.selectionLimitReached),t.R7$(4),t.Y8G("ngForOf",n.localColumns))},dependencies:[e.Sq,e.bT,k.BC,k.vS,v.eY,v.hB,g.z,T.l],styles:[".modal-body[_ngcontent-%COMP%]{overflow-y:auto}"]}),b})();function R(r,b){if(1&r&&t.nrm(0,"img",0),2&r){const c=t.XpG();t.Y8G("src",c.icon,t.B4B)}}let w=(()=>{var r;class b{constructor(){this.className=""}ngOnInit(){}}return(r=b).\u0275fac=function(o){return new(o||r)},r.\u0275cmp=t.VBU({type:r,selectors:[["app-badge"]],inputs:{text:"text",icon:"icon",className:"className"},standalone:!0,features:[t.aNF],decls:3,vars:5,consts:[["alt","",1,"badge__icon",3,"src"]],template:function(o,n){1&o&&(t.j41(0,"div"),t.DNE(1,R,1,1,"img",0),t.EFF(2),t.k0s()),2&o&&(t.ZvI("badge ",n.className,""),t.R7$(),t.vxM(n.icon?1:-1),t.R7$(),t.SpI(" ",n.text,"\n"))}}),b})();function S(r,b){if(1&r&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&r){const c=t.XpG();t.R7$(),t.JRh(c.price)}}function K(r,b){if(1&r&&t.nrm(0,"app-badge",1),2&r){const c=t.XpG();t.Mz_("className","badge--",null==c.statusMap[c.status]?null:c.statusMap[c.status].key,""),t.FS9("text",null==c.statusMap[c.status]?null:c.statusMap[c.status].text),t.FS9("icon",null==c.statusMap[c.status]?null:c.statusMap[c.status].icon)}}function j(r,b){if(1&r&&t.EFF(0),2&r){const c=t.XpG();t.SpI(" ",c.status," ")}}let D=(()=>{var r;class b{constructor(o,n){this.price=o,this.status=n,this.statusMap={blocked:{key:"blocked",text:"Blocked",icon:"assets/icon/lock-icon.svg"},reserved:{key:"reserved",text:"Reserved",icon:"assets/icon/loading-icon-warn.svg"},sold:{key:"sold",text:"Sold",icon:""},retired:{key:"retired",text:"Retired",icon:"assets/icon/toggle-icon-left.svg"}}}ngOnInit(){}}return(r=b).\u0275fac=function(o){return new(o||r)(t.rXU("price"),t.rXU("status"))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-price-status-cell"]],standalone:!0,features:[t.aNF],decls:3,vars:1,consts:[[1,"col-medium","text-left"],[3,"className","text","icon"]],template:function(o,n){1&o&&t.DNE(0,S,2,1,"div",0)(1,K,1,4,"app-badge",1)(2,j,1,1),2&o&&t.vxM("available"===n.status?0:null!=n.statusMap[n.status]&&n.statusMap[n.status].key?1:2)},dependencies:[w]}),b})(),L=(()=>{var r;class b{constructor(o){this.status=o}ngOnInit(){this.status="available"===this.status?"success":this.status}}return(r=b).\u0275fac=function(o){return new(o||r)(t.rXU("status"))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-table-cell-actions"]],decls:3,vars:4,consts:[[1,"d-flex","justify-end","col-small","align-center"],[2,"padding","10px 5px"],["alt","",3,"src"]],template:function(o,n){1&o&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"img",2),t.k0s()()),2&o&&(t.R7$(),t.ZvI("table-row-background-",n.status," rowMenu-icon-wrapper"),t.R7$(),t.Y8G("src","assets/icon/more-vertical-icon.svg",t.B4B))}}),b})(),U=(()=>{var r;class b{constructor(o){this.onClick=o}ngOnInit(){}}return(r=b).\u0275fac=function(o){return new(o||r)(t.rXU("onClick"))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-table-header-cell-actions"]],decls:3,vars:1,consts:[[1,"d-flex","justify-end","col-small","align-center","pr-13",3,"click"],[1,"rowMenu-icon-wrapper",2,"padding","10px 5px","background","white"],["alt","",1,"cursor-pointer",3,"src"]],template:function(o,n){1&o&&(t.j41(0,"div",0),t.bIt("click",function(){return null==n.onClick?null:n.onClick()}),t.j41(1,"div",1),t.nrm(2,"img",2),t.k0s()()),2&o&&(t.R7$(2),t.Y8G("src","assets/icon/switch-horizontal-icon.svg",t.B4B))}}),b})();var P=i(1296),E=i(6039),$=i(1213),X=i(8397),ee=i(9773),te=i(6552),H=i(8031),oe=i(1880);const ne=["tableComponent"],ie=(r,b)=>({"border-bottom-unset":r,"border-radius-16":b});function ae(r,b){if(1&r&&(t.j41(0,"div",4),t.nrm(1,"app-general-toast",10),t.k0s()),2&r){const c=t.XpG(2);t.R7$(),t.Y8G("options",c.toastConfig)}}function se(r,b){if(1&r&&t.DNE(0,ae,2,1,"div",9),2&r){const c=t.XpG();t.Y8G("ngIf",!(null!=c.promotion&&c.promotion.promotionPaymentInfoIsCompleted))}}function re(r,b){if(1&r){const c=t.RV6();t.qex(0),t.j41(1,"div",16)(2,"div",17)(3,"input",18),t.mxI("ngModelChange",function(n){t.eBV(c);const u=t.XpG(2);return t.DH7(u.editedBlockName,n)||(u.editedBlockName=n),t.Njj(n)}),t.k0s()(),t.j41(4,"div",19)(5,"div",20)(6,"i",21),t.bIt("click",function(){t.eBV(c);const n=t.XpG(),u=n.$implicit,_=n.$index,M=t.XpG();return t.Njj(M.onSaveBlockTitle(u,_))}),t.k0s(),t.j41(7,"i",22),t.bIt("click",function(){t.eBV(c);const n=t.XpG(2);return t.Njj(n.onCancelBlockTitle())}),t.k0s()()()(),t.bVm()}if(2&r){const c=t.XpG(2);t.R7$(3),t.R50("ngModel",c.editedBlockName)}}function Z(r,b){if(1&r){const c=t.RV6();t.j41(0,"img",24),t.bIt("click",function(){t.eBV(c);const n=t.XpG(2),u=n.$implicit,_=n.$index,M=t.XpG();return t.Njj(M.onEditBlockTitle(u,_))}),t.k0s()}2&r&&t.Y8G("src","assets/icon/edit-icon.svg",t.B4B)}function Q(r,b){if(1&r&&(t.EFF(0),t.DNE(1,Z,1,1,"img",23)),2&r){const c=t.XpG().$implicit,o=t.XpG();t.SpI(" ",c.name||"Bloque "+c.index," "),t.R7$(),t.vxM("page"===o.context?1:-1)}}function ce(r,b){if(1&r){const c=t.RV6();t.qex(0),t.j41(1,"button",31),t.bIt("click",function(){t.eBV(c);const n=t.XpG(4).$index,u=t.XpG();return t.Njj(u.onSaveTable(n))}),t.nrm(2,"i",32),t.EFF(3," Guardar "),t.k0s(),t.bVm()}}function de(r,b){if(1&r){const c=t.RV6();t.j41(0,"button",31),t.bIt("click",function(){t.eBV(c);const n=t.XpG(5).$index,u=t.XpG();return t.Njj(u.onEditTable(n))}),t.nrm(1,"i",34),t.EFF(2," Edici\xf3n masiva "),t.k0s()}}function ue(r,b){if(1&r&&t.DNE(0,de,3,0,"button",33),2&r){const c=t.XpG(5);t.Y8G("ngIf","promoter"===(null==c.currentUser?null:c.currentUser.accountType))}}function pe(r,b){if(1&r&&t.DNE(0,ce,4,0,"ng-container",13)(1,ue,1,1,"ng-template",null,1,t.C5r),2&r){const c=t.sdS(2),o=t.XpG(3).$index,n=t.XpG();t.Y8G("ngIf",n.editingTableBlockIndex===o)("ngIfElse",c)}}function me(r,b){if(1&r){const c=t.RV6();t.j41(0,"button",31),t.bIt("click",function(n){t.eBV(c);const u=t.XpG(4);return t.Njj(u.onDuplicateProperty(n))}),t.nrm(1,"i",35),t.EFF(2," Duplicar propiedad "),t.k0s()}}function _e(r,b){if(1&r){const c=t.RV6();t.j41(0,"button",36),t.bIt("click",function(){t.eBV(c);const n=t.XpG(3).$implicit,u=t.XpG();return t.Njj(u.onAddProperty(n))}),t.nrm(1,"i",37),t.EFF(2," A\xf1adir propiedad "),t.k0s()}}function ve(r,b){if(1&r){const c=t.RV6();t.DNE(0,pe,3,2)(1,me,3,0,"button",28)(2,_e,3,0,"button",29),t.j41(3,"div",26)(4,"img",30),t.bIt("click",function(){t.eBV(c);const n=t.XpG(2).$implicit,u=t.XpG();return t.Njj(u.onDeleteBlock(n))}),t.k0s()()}if(2&r){const c=t.XpG(2),o=c.$implicit,n=c.$index,u=t.XpG();t.vxM(null!=o&&null!=o.tableConfig&&null!=o.tableConfig.rows&&o.tableConfig.rows.length?0:-1),t.R7$(),t.vxM(u.showDuplicateButtonBlockIndex.includes(n)&&-1===u.editingTableBlockIndex?1:-1),t.R7$(),t.vxM(u.editingTableBlockIndex!==n?2:-1),t.R7$(2),t.Y8G("src","assets/icon/trash-icon.svg",t.B4B)}}function fe(r,b){if(1&r){const c=t.RV6();t.j41(0,"img",39),t.bIt("click",function(){t.eBV(c);const n=t.XpG(3).$index,u=t.XpG();return t.Njj(u.onToggleBlock(n))}),t.k0s()}2&r&&t.Y8G("src","assets/icon/chevron-up-icon.svg",t.B4B)}function ge(r,b){if(1&r){const c=t.RV6();t.j41(0,"img",39),t.bIt("click",function(){t.eBV(c);const n=t.XpG(3).$index,u=t.XpG();return t.Njj(u.onToggleBlock(n))}),t.k0s()}2&r&&t.Y8G("src","assets/icon/chevron-down-icon.svg",t.B4B)}function Ce(r,b){if(1&r&&(t.j41(0,"div",27),t.DNE(1,fe,1,1,"img",38)(2,ge,1,1,"img",38),t.k0s()),2&r){const c=t.XpG(2).$implicit;t.R7$(),t.vxM(c.isOpen?1:2)}}function he(r,b){if(1&r&&(t.j41(0,"div",25),t.DNE(1,ve,5,4,"div",26)(2,Ce,3,1,"div",27),t.k0s()),2&r){const c=t.XpG().$implicit,o=t.XpG();t.R7$(),t.vxM("page"===o.context?1:-1),t.R7$(),t.vxM(null!=c&&null!=c.tableConfig&&null!=c.tableConfig.rows&&c.tableConfig.rows.length?2:-1)}}function be(r,b){if(1&r){const c=t.RV6();t.j41(0,"app-table",40,2),t.bIt("columnClick",function(n){t.eBV(c);const u=t.XpG().$implicit,_=t.XpG();return t.Njj(_.onColumnClicked(n,u))})("rowClicked",function(n){t.eBV(c);const u=t.XpG(2);return t.Njj(u.onRowClicked(n))})("clickGlobalCheckbox",function(n){t.eBV(c);const u=t.XpG(2);return t.Njj(u.onClickGlobalCheckbox(n))})("rowCheckboxClicked",function(n){t.eBV(c);const u=t.XpG().$index,_=t.XpG();return t.Njj(_.onRowChecked(n,u))}),t.k0s()}if(2&r){const c=t.XpG().$implicit;t.Y8G("table",null==c?null:c.tableConfig)}}function ye(r,b){if(1&r&&(t.j41(0,"div",6)(1,"div",11)(2,"div",12),t.DNE(3,re,8,1,"ng-container",13)(4,Q,2,2,"ng-template",null,0,t.C5r),t.k0s(),t.DNE(6,he,3,2,"div",14),t.k0s(),t.DNE(7,be,2,1,"app-table",15),t.k0s()),2&r){const c=b.$implicit,o=b.$index,n=t.sdS(5),u=t.XpG();t.R7$(),t.Y8G("ngClass",t.l_i(5,ie,c.isOpen,!c.isOpen)),t.R7$(2),t.Y8G("ngIf",u.editingBlockTitleIndex===o)("ngIfElse",n),t.R7$(3),t.Y8G("ngIf","promoter"===(null==u.currentUser?null:u.currentUser.accountType)),t.R7$(),t.vxM(c.isOpen?7:-1)}}function le(r,b){1&r&&(t.j41(0,"div",7)(1,"div",41),t.EFF(2," A\xfan no hay bloques "),t.k0s()())}function ke(r,b){if(1&r){const c=t.RV6();t.j41(0,"button",43),t.bIt("click",function(){t.eBV(c);const n=t.XpG(2);return t.Njj(n.onAddBlock())}),t.nrm(1,"i",37),t.EFF(2," A\xf1adir bloque "),t.k0s()}}function Pe(r,b){if(1&r&&(t.j41(0,"div",8),t.DNE(1,ke,3,0,"button",42),t.k0s()),2&r){const c=t.XpG();t.R7$(),t.Y8G("ngIf","promoter"===(null==c.currentUser?null:c.currentUser.accountType))}}let Me=(()=>{var r;class b{constructor(o,n,u,_,M,O,F,z){this.modalCtrl=o,this.tableService=n,this.api=u,this.state=_,this.toastService=M,this.modalsService=O,this.utils=F,this.promotionService=z,this.context="page",this.reloadPromotion=new t.bkB,this.sortBlock=new t.bkB,this.rowCheckboxClicked=new t.bkB,this.clickGlobalCheckbox=new t.bkB,this.loadingBlocks=!1,this.blocks=[],this.toastConfig={text:"Por favor, rellena todos los campos obligatorios de la promoci\xf3n",theme:"orange",fullWidth:!0,showCloseButton:!1,smaller:!0},this.allColumnsKeysSelected=["externalReference","reference","promotionType","floor","bedrooms","bathrooms","totalMeasures_squareMetersBuilt","totalMeasures_squareMetersUseful","f_pool_comunitaria","planos","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!0,editCellsMode:!1,columns:[{key:"reference",label:"Id",size:"small",editMode:{inputType:"text"}},{key:"externalReference",label:"Ref",size:"medium",editMode:{inputType:"text"}},{key:"promotionType",label:"Subtipo",size:"medium",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"villa",value:"Villa",selected:!1},{key:"country_house",value:"Finca",selected:!1},{key:"chalet",value:"Chalet",selected:!1},{key:"apartment_flat",value:"Piso / Apartamento",selected:!1},{key:"duplex",value:"D\xfaplex",selected:!1},{key:"triplex",value:"Triplex",selected:!1},{key:"ground_floor_apartment",value:"Apto planta baja",selected:!1},{key:"penthouse",value:"\xc1tico",selected:!1},{key:"penthouse_duplex",value:"\xc1tico d\xfaplex",selected:!1},{key:"studio",value:"Estudio",selected:!1},{key:"commercial_space",value:"Local comercial",selected:!1}]}},{key:"floor",label:"Planta",size:"small",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersBuilt",label:"M2 constr.",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersUseful",label:"M2 \xfatiles",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"m2constr",label:"M2 constr. (sin incluir terrazas)",size:"small",extraString:" m\xb2",fn:l=>{let p=(l.totalMeasures_squareMetersBuilt||0)-((l.totalMeasures_squareMetersCoveredTerraces||0)+(l.totalMeasures_squareMetersUncoveredTerraces||0));return p<0&&(p=0),p}},{key:"totalMeasures_squareMetersTerraces",label:"M2 Terrazas",size:"small",extraString:" m\xb2",fn:l=>l.totalMeasures_squareMetersCoveredTerraces+l.totalMeasures_squareMetersUncoveredTerraces},{key:"totalMeasures_squareMetersPatch",label:"Parcela",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"bedrooms",label:"Dorm.",size:"small",editMode:{inputType:"number"}},{key:"bathrooms",label:"Ba\xf1os",size:"small",editMode:{inputType:"number"}},{key:"f_pool_comunitaria",label:"Piscina",size:"medium",fn:l=>l.f_pool_comunitaria?"Comunitaria":l.f_pool_privada?"Privada":"No",editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"comunitaria",value:"Comunitaria",selected:!1},{key:"privada",value:"Privada",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_trastero",label:"Trastero",size:"medium",fn:l=>l.fcustom_trastero?l.fcustom_trasteroPrice?this.utils.transformThousandSeparator(l.fcustom_trasteroPrice)+" \u20ac":l.fcustom_trasteroIncludedInPrice?"Incluido":"S\xed":"No",editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"S\xed",value:"S\xed",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_parking",label:"Parking",size:"medium",fn:l=>{let m="";return m=l.fcustom_parking?"S\xed":"No",l.fcustom_parkingPrice&&(m=this.utils.transformThousandSeparator(l.fcustom_parkingPrice)+" \u20ac"),l.fcustom_parkingIncludedInPrice&&(m="Incluido"),null!=l&&l.fcustom_parkingComunitario&&(m+=" (Comunitario)"),m},editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"S\xed",value:"S\xed",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"solarium",label:"Solarium",size:"small",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"yes",value:"S\xed",selected:!1},{key:"no",value:"No",selected:!1}]},fn:l=>l.fcustom_solarium?"S\xed":"No"},{key:"availabilityStatus",label:"Estado",size:"medium",translate:!0,showOnlyEditMode:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"available",value:"Disponible",selected:!1},{key:"sold",value:"Vendido",selected:!1},{key:"reserved",value:"Reservado",selected:!1},{key:"blocked",value:"Bloqueado",selected:!1},{key:"retired",value:"Retirado",selected:!1}]}},{key:"deliveryDate",label:"Fecha de Entrega",size:"medium",editMode:{inputType:"date"},fn:l=>null!=l&&l.deliveryDate?new Date(null==l?void 0:l.deliveryDate).toLocaleDateString("es-ES"):null},{key:"status",label:"Estado de obra",size:"medium",type:"text",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"proyecto-sin-licencia",value:"Proyecto sin licencia",selected:!1},{key:"proyecto-con-licencia",value:"Proyecto con licencia",selected:!1},{key:"fase-excavacion",value:"En fase de excavaci\xf3n",selected:!1},{key:"cimentacion-completada",value:"Cimentaci\xf3n completada",selected:!1},{key:"estructura-construccion",value:"Estructura en construcci\xf3n",selected:!1},{key:"cerramiento-completado",value:"Cerramiento completado",selected:!1},{key:"instalaciones-proceso",value:"Instalaciones en proceso",selected:!1},{key:"acabados-interiores",value:"Acabados interiores",selected:!1},{key:"obra-finalizada",value:"Obra finalizada",selected:!1}]}},{key:"catalog",label:"Cat\xe1logo",size:"small",type:"file",fn:l=>{var m;return null==l||null===(m=l.propertyFiles)||void 0===m||null===(m=m.find(h=>"catalog"===h.category))||void 0===m?void 0:m.url}},{key:"planos",label:"Plano",size:"small",type:"file",fn:l=>{var m;return null==l||null===(m=l.propertyFiles)||void 0===m||null===(m=m.find(h=>"plan"===h.category))||void 0===m?void 0:m.url}},{key:"price",label:"Precio",size:"medium",fn:l=>{let m=null==l?void 0:l.price;return m&&(m=this.utils.transformThousandSeparator(m)),m+" \u20ac"},editMode:{inputType:"number",parseAsAPrice:!0}},{key:"rowMenu",label:"rowMenu",size:"small",hideSelectColumnsList:!0,customCssClass:"sticky-last-column",type:"component"}],rows:[]},this.checkedRows=[],this.editingTableBlockIndex=-1,this.showDuplicateButtonBlockIndex=[],this.editingBlockTitleIndex=-1,this.editedBlockName=""}ngOnInit(){console.log(676767676,this.promotion,"this.promotion"),this.getState()}ngOnChanges(){this.getData()}ionViewWillEnter(){this.reloadPromotion.emit()}getState(){this.state.getState().subscribe(o=>{this.currentUser=o.user})}getData(){var o=this;return(0,a.A)(function*(){var n,u;o.showDuplicateButtonBlockIndex=[],o.checkedRows=[],o.allColumnsKeysSelected=(null===(n=o.promotion)||void 0===n?void 0:n.tableColumnsKeysSelected)||o.allColumnsKeysSelected,o.blocks=(null===(u=o.promotion)||void 0===u?void 0:u.promotionBlocks)||[];for(let _=0;_<o.blocks.length;_++)o.blocks[_].isOpen=!0,o.blocks[_].properties&&0!==o.blocks[_].properties.length&&(o.blocks[_].tableConfig=y.cloneDeep(o.tableConfig),o.allColumnsKeysSelected.includes("rowMenu")||o.allColumnsKeysSelected.push("rowMenu"),o.blocks[_].tableConfig.columns=o.blocks[_].tableConfig.columns.map(M=>(M.show=!!o.allColumnsKeysSelected.includes(M.key),M)),o.blocks[_].tableConfig.rows=o.tableService.convertDataToTableRows(y.cloneDeep(o.blocks[_].properties),y.cloneDeep(o.blocks[_].tableConfig)),"modal"===o.context&&o.blocks[_].tableConfig.rows.forEach(M=>{let O=o.promotion.propertiesTable.rows.find(F=>F.rowId===M.rowId);O&&(M.checked=O.checked)}),o.blocks[_].tableConfig.rows=o.customizeRowsWithComponents(o.blocks[_].tableConfig.rows),o.blocks[_].tableConfig.rows=o.addBackgroundColorsToTableRows(o.blocks[_].tableConfig.rows),"page"===o.context&&o.blocks[_].tableConfig.columns.forEach((M,O)=>{if("rowMenu"===M.key){let F={...M};F.component=U,F.componentInputs={onClick:()=>{o.onEditColumns()}},o.blocks[_].tableConfig.columns[O]=F}}));"modal"===o.context&&(o.blocks=o.blocks.filter(_=>_.properties.length))})()}customizeRowsWithComponents(o){return o.map(n=>(n.cells.rowMenu.type="component",n.cells.rowMenu.component=L,n.cells.rowMenu.componentInputs={status:n.cells.availabilityStatus.value},n.cells.price.type="component",n.cells.price.component=D,n.cells.price.componentInputs={status:n.cells.availabilityStatus.value,price:n.cells.price.value},"available"===n.cells.availabilityStatus.value&&(n.checkboxCssClass="border-black"),n))}addBackgroundColorsToTableRows(o){for(let n=0;n<o.length;n++)switch(o[n].rawObject.availabilityStatus){case"available":o[n].style={backgroundColor:"success"};break;case"sold":o[n].style={backgroundColor:"sold"};break;case"reserved":o[n].style={backgroundColor:"reserved"};break;case"blocked":default:o[n].style={backgroundColor:"blocked"};break;case"retired":o[n].style={backgroundColor:"retired"}}return o}onAddProperty(o){var n=this;return(0,a.A)(function*(){const u=yield n.modalCtrl.create({component:C.E,componentProps:{block:o,promotion:n.promotion},cssClass:"modal-create-property"});yield u.present();const{data:_}=yield u.onWillDismiss();_&&(n.reloadPromotion.emit(),n.toastService.showSuccessToast("Propiedad a\xf1adida correctamente"))})()}onAddBlock(){var o=this;return(0,a.A)(function*(){let n={index:o.blocks.length+1,promotionId:o.promotion.id};n=(yield o.api.addBlock(n)).success.data,o.blocks.push(n)})()}onToggleBlock(o){this.blocks[o].isOpen=!this.blocks[o].isOpen}onDeleteBlock(o){var n=this;return(0,a.A)(function*(){if(o.properties.length>0)return void n.toastService.showErrorToast("No se puede eliminar un bloque que tiene propiedades");const u=yield n.modalsService.openConfirmationModal({title:"Eliminar fase",message:"\xbfEst\xe1s seguro de que quieres eliminar esta fase?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]});"delete"===(null==u?void 0:u.data)&&(yield n.api.deleteBlock(o.id),n.blocks=n.blocks.filter(M=>M.id!==o.id))})()}onClickGlobalCheckbox(o){"modal"===this.context&&this.clickGlobalCheckbox.emit(o)}onRowClicked(o){var n=this;return(0,a.A)(function*(){const u=yield n.modalCtrl.create({component:C.E,componentProps:{property:o.rawObject,promotion:n.promotion},cssClass:"modal-create-property"});yield u.present();const{data:_}=yield u.onWillDismiss();_?(console.log("HOLA2"),n.reloadPromotion.emit()):(console.log("HOLA"),n.reloadPromotion.emit())})()}onColumnClicked(o,n){var u=this;return(0,a.A)(function*(){u.sortBlock.emit({block:n,sort:{field:o.column.key,order:o.order}})})()}updateEditedRowsFromTable(o){var n=this;return(0,a.A)(function*(){const _=JSON.parse(JSON.stringify(o.table.rows)).filter(M=>M.hasBeenEdited);for(const M of _){const O=n.buildPropertyValuesToUpdate(M);null==O||delete O.catalog,null==O||delete O.planos,yield n.api.updatePropertyById(M.rawObject.id,O)}_.length>0&&(n.toastService.showSuccessToast("Propiedades actualizadas correctamente"),n.reloadPromotion.emit())})()}buildPropertyValuesToUpdate(o){const n={};return Object.entries(o.cells).forEach(([u,_])=>{var M;if(!_.hasBeenEdited)return;const O=this.tableConfig.columns.find(F=>F.key===u);"f_pool_comunitaria"===u?(n.f_pool_comunitaria="Comunitaria"===_.value,n.f_pool_privada="Privada"===_.value,"No"===_.value&&(n.f_pool_comunitaria=!1,n.f_pool_privada=!1)):n[u]=u.startsWith("fcustom_")?"S\xed"===_.value:"price"===u?parseFloat(_.value):_.value,"date"===(null==O||null===(M=O.editMode)||void 0===M?void 0:M.inputType)&&(n[u]=new Date(_.value).toISOString())}),n}onEditTable(o){const n=this.tableComponents.toArray();if(-1!==this.editingTableBlockIndex&&this.editingTableBlockIndex!==o){const _=n[this.editingTableBlockIndex];null!=_&&_.editCellsMode&&(console.log("HACE UN TOGGLE"),_.resetAndCloseTableEditCellsMode())}const u=n[o];u?(u.enableTableEditCellsMode(),this.editingTableBlockIndex=u.editCellsMode?o:-1):console.warn("Table not found for block index:",o)}onSaveTable(o){var n=this;return(0,a.A)(function*(){const _=n.tableComponents.toArray()[o];_?_.editCellsMode&&(yield n.updateEditedRowsFromTable(_),_.resetAndCloseTableEditCellsMode(),n.editingTableBlockIndex=-1):console.warn("Table not found for block index:",o)})()}onEditColumns(){var o=this;return(0,a.A)(function*(){const n=yield o.modalCtrl.create({component:N,componentProps:{promotion:o.promotion,columns:o.tableConfig.columns,selectedColumnKeys:o.allColumnsKeysSelected},cssClass:"modal-edit-table-columns"});yield n.present();const{data:u,role:_}=yield n.onWillDismiss();if("save"===_&&u){const M=u;o.allColumnsKeysSelected=M,o.blocks.forEach(F=>{var z;null!=F&&null!==(z=F.tableConfig)&&void 0!==z&&z.columns&&F.tableConfig.columns.forEach(l=>{l.show=M.includes(l.key)})}),yield o.api.updatePromotionById(o.promotion.id,{tableColumnsKeysSelected:o.allColumnsKeysSelected})}})()}onRowChecked(o,n){var u=this;return(0,a.A)(function*(){const _=u.blocks[n].tableConfig.rows[o],M=u.checkedRows.findIndex(F=>F.rawObject.id===_.rawObject.id);-1!==M?u.checkedRows.splice(M,1):(u.checkedRows=u.checkedRows.filter(F=>u.blocks.findIndex(l=>{var m;return null===(m=l.properties)||void 0===m?void 0:m.some(h=>h.id===F.rawObject.id)})!==n),u.checkedRows.push(_));const O=u.checkedRows.filter(F=>u.blocks.findIndex(l=>{var m;return null===(m=l.properties)||void 0===m?void 0:m.some(h=>h.id===F.rawObject.id)})===n).length;Array.isArray(u.showDuplicateButtonBlockIndex)||(u.showDuplicateButtonBlockIndex=[]),1===O?u.showDuplicateButtonBlockIndex.includes(n)||u.showDuplicateButtonBlockIndex.push(n):u.showDuplicateButtonBlockIndex=u.showDuplicateButtonBlockIndex.filter(F=>F!==n),u.rowCheckboxClicked.emit({rowIndex:o,blockIndex:n})})()}onDuplicateProperty(o){var n=this;return(0,a.A)(function*(){const _=n.checkedRows[0].rawObject;(yield n.promotionService.onDuplicateProperty(o,_))&&n.reloadPromotion.emit()})()}onEditBlockTitle(o,n){this.editingBlockTitleIndex=n,this.editedBlockName=o.name||"Bloque "+o.index}onSaveBlockTitle(o,n){var u=this;return(0,a.A)(function*(){o.name=u.editedBlockName;const _=yield u.api.editBlock(o);_&&_.success?u.toastService.showSuccessToast("Nombre del bloque actualizado correctamente"):u.toastService.showErrorToast("Error al actualizar el nombre del bloque"),u.editingBlockTitleIndex=-1})()}onCancelBlockTitle(){this.editingBlockTitleIndex=-1}}return(r=b).\u0275fac=function(o){return new(o||r)(t.rXU(v.W3),t.rXU(P.a),t.rXU(E.i),t.rXU($.c),t.rXU(X.f),t.rXU(ee.M),t.rXU(te.T),t.rXU(H.J))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-promotion-details-availability"]],viewQuery:function(o,n){if(1&o&&t.GBs(ne,5),2&o){let u;t.mGM(u=t.lsd())&&(n.tableComponents=u)}},inputs:{promotion:"promotion",context:"context"},outputs:{reloadPromotion:"reloadPromotion",sortBlock:"sortBlock",rowCheckboxClicked:"rowCheckboxClicked",clickGlobalCheckbox:"clickGlobalCheckbox"},features:[t.OA$],decls:7,vars:3,consts:[["viewMode",""],["notEditingBlock",""],["tableComponent",""],[1,"crm-section"],[1,"crm-section",2,"margin-bottom","16px","width","100%"],[1,"",2,"border-radius","16px","padding","24px","background","white"],[2,"margin-bottom","40px"],[1,"crm-header-modal","crm-header-modal-empty"],[1,"d-flex","justify-center"],["style","margin-bottom: 16px; width: 100%;","class","crm-section",4,"ngIf"],[3,"options"],[1,"crm-header-modal","crm-header-modal-empty",2,"padding","24px 16px","border","1px solid #E0E0E0","border-top-right-radius","16px","border-top-left-radius","16px",3,"ngClass"],[1,"crm-section-title"],[4,"ngIf","ngIfElse"],["class","crm-buttons-group",4,"ngIf"],[3,"table"],[1,"crm-input-input-and-icon"],[1,"crm-input-input"],["type","text","placeholder","Nombre del bloque",3,"ngModelChange","ngModel"],[1,"crm-input-input-and-icon-right"],[1,"title-edit-icons"],[1,"fa-solid","fa-check",3,"click"],[1,"fa-solid","fa-times",3,"click"],["alt","",1,"cursor-pointer",2,"margin-left","8px",3,"src"],["alt","",1,"cursor-pointer",2,"margin-left","8px",3,"click","src"],[1,"crm-buttons-group"],[1,"crm-trash-btn"],[1,"cursor-pointer"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button"],["alt","",3,"click","src"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-save"],["class","crm-button-secondary crm-button-secondary-primary",3,"click",4,"ngIf"],[1,"fa-solid","fa-pencil"],[1,"fa-solid","fa-copy"],[1,"crm-button",3,"click"],[1,"fa-solid","fa-plus"],["alt","",1,"mb-4",3,"src"],["alt","",1,"mb-4",3,"click","src"],[3,"columnClick","rowClicked","clickGlobalCheckbox","rowCheckboxClicked","table"],[1,"crm-text"],["class","crm-button crm-button-outline-primary",3,"click",4,"ngIf"],[1,"crm-button","crm-button-outline-primary",3,"click"]],template:function(o,n){1&o&&(t.j41(0,"div",3),t.DNE(1,se,1,1,"div",4),t.j41(2,"div",5),t.Z7z(3,ye,8,8,"div",6,t.fX1),t.DNE(5,le,3,0,"div",7)(6,Pe,2,1,"div",8),t.k0s()()),2&o&&(t.R7$(),t.vxM("page"===n.context?1:-1),t.R7$(2),t.Dyx(n.blocks),t.R7$(2),t.vxM(0===n.blocks.length?5:-1),t.R7$(),t.vxM("page"===n.context?6:-1))},dependencies:[e.YU,e.bT,k.me,k.BC,k.vS,oe.O,T.l],styles:[".title-edit-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;color:var(--crm-red-color)}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:first-child{color:var(--crm-success-color)}"]}),b})()},8031:(G,I,i)=>{i.d(I,{J:()=>g});var a=i(467),t=i(7376),y=i(3953),v=i(5970),f=i(8397),e=i(6039),k=i(6552);let g=(()=>{var T;class A{constructor(s,N,R,w){this.popoversService=s,this.toastService=N,this.api=R,this.utils=w}transformPromotionFormStepOne(s){return{projectName:null==s?void 0:s.projectName,constructionType:null==s?void 0:s.constructionType,constructionSubType:null==s?void 0:s.constructionSubType,constructionStatus:null==s?void 0:s.constructionStatus,constructionYear:null==s?void 0:s.constructionYear,constructionStart:null==s?void 0:s.constructionStart,commercializationStart:null==s?void 0:s.commercializationStart,keyDeliveryDate:null==s?void 0:s.keyDeliveryDate,country:null==s?void 0:s.country,province:null==s?void 0:s.province,city:null==s?void 0:s.city,neighborhood:null==s?void 0:s.neighborhood,address:null==s?void 0:s.address,postalCode:null==s?void 0:s.postalCode,number:null==s?void 0:s.number,showAddressPublicly:null==s?void 0:s.showAddressPublicly,showGeoreferencePublicly:null==s?void 0:s.showGeoreferencePublicly,energyEfficiencyCertificate:null==s?void 0:s.energyEfficiencyCertificate,co2EmissionsCertificate:null==s?void 0:s.co2EmissionsCertificate,energyEfficiencyValue:null==s?void 0:s.energyEfficiencyValue,co2EmissionsValue:null==s?void 0:s.co2EmissionsValue}}transformPromotionFormStepThree(s){return{title_es:null==s?void 0:s.title_es,title_en:null==s?void 0:s.title_en,title_de:null==s?void 0:s.title_de,title_fr:null==s?void 0:s.title_fr,title_ru:null==s?void 0:s.title_ru,description_es:null==s?void 0:s.description_es,description_en:null==s?void 0:s.description_en,description_de:null==s?void 0:s.description_de,description_fr:null==s?void 0:s.description_fr,description_ru:null==s?void 0:s.description_ru,promotionFiles:null==s?void 0:s.promotionFiles}}deleteAllPromotionPropertiesExceptFeatures(s){const N=t.cloneDeep(s);for(const R in N)R.startsWith("f_")||R.startsWith("fcustom_")||delete N[R];return N}onDuplicateProperty(s,N){var R=this;return(0,a.A)(function*(){let w=null;const S=yield R.popoversService.onShowDuplicatePropertyPopover(s);var K,j,D,L,U;if(console.log("POPOVER RESULT",S),S&&(null!=S&&null!==(K=S.data)&&void 0!==K&&K.count&&(null==S||null===(j=S.data)||void 0===j?void 0:j.count)>0&&(null==S||null===(D=S.data)||void 0===D?void 0:D.count)<=25?w=null==S||null===(U=S.data)||void 0===U?void 0:U.count:(null==S||null===(L=S.data)||void 0===L?void 0:L.count)>25&&(yield R.toastService.showErrorToast("La cantidad de propiedades a duplicar debe ser mayor a 0 y menor o igual a 25"))),!w)return!1;for(let P=0;P<w;P++)console.log("DUPLICATING PROPERTY",P),yield R.duplicateProperty(N,P);return yield R.toastService.showSuccessToast("Propiedad duplicada exitosamente"),!0})()}duplicateProperty(s,N){var R=this;return(0,a.A)(function*(){var w,S,K,j;let D=t.cloneDeep(s);D=R.utils.parseProperties(D),D.promotionBlockId=s.promotionBlockId,D.promotionId=s.promotionId,D.reference=null!==(w=D)&&void 0!==w&&w.reference?`${null===(S=D)||void 0===S?void 0:S.reference} - Copia ${N+1}`:null,D.availabilityStatus=null;const L=t.cloneDeep((null===(K=D)||void 0===K?void 0:K.propertyFiles)||[]);delete D.id,delete D.propertyFiles,delete D.measurements_floors,delete D.byvaroId,delete D.updatedAt,delete D.createdAt;const U=yield R.api.createProperty(D);null==U||null===(j=U.success)||void 0===j||(j=j.data),console.log("LA PROPERTYYYYYYY",D),console.log("PROPERTY FILES",L)})()}}return(T=A).\u0275fac=function(s){return new(s||T)(y.KVO(v.m),y.KVO(f.f),y.KVO(e.i),y.KVO(k.T))},T.\u0275prov=y.jDH({token:T,factory:T.\u0275fac,providedIn:"root"}),A})()}}]);