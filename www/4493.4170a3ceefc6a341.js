"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4493],{4954:(L,T,u)=>{u.d(T,{R:()=>r});var n=u(3953),k=u(8359),v=u(467),C=u(1413),w=u(152),l=u(5558),g=u(6039);let S=(()=>{var s;class p{constructor(o){this.api=o,this.searchTermSubject=new C.B,this.searchResults$=this.searchTermSubject.pipe((0,w.B)(300),(0,l.n)(c=>this.performSearch(c)))}search(o){this.searchTermSubject.next(o)}performSearch(o){var c=this;return(0,v.A)(function*(){var h;o=(o=o.trim()).toLowerCase();const m=yield c.api.getUser({OR:[{name:{contains:o,mode:"insensitive"}},{email:{contains:o,mode:"insensitive"}}]},null,{page:0,itemsPerPage:10});return(null==m||null===(h=m.success)||void 0===h?void 0:h.data)||[]})()}}return(s=p).\u0275fac=function(o){return new(o||s)(n.KVO(g.i))},s.\u0275prov=n.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),p})();var b=u(177),A=u(9417);const _=["wrapper"];function e(s,p){if(1&s){const d=n.RV6();n.j41(0,"div",9),n.bIt("click",function(c){const h=n.eBV(d).$implicit,m=n.XpG(2);return n.Njj(m.onUserSelect(h,c))}),n.j41(1,"div",10)(2,"div",11),n.nrm(3,"img",12),n.k0s(),n.j41(4,"div",13)(5,"div",14),n.EFF(6),n.k0s(),n.j41(7,"div",15),n.EFF(8),n.k0s()()(),n.nrm(9,"div",16),n.k0s()}if(2&s){const d=p.$implicit;n.R7$(3),n.Y8G("src",null==d?null:d.photoUrl,n.B4B),n.R7$(3),n.SpI(" ",null==d?null:d.name," "),n.R7$(2),n.SpI(" ",null==d?null:d.email," ")}}function i(s,p){1&s&&(n.j41(0,"div",17),n.EFF(1," No hay resultados "),n.k0s())}function t(s,p){if(1&s&&(n.j41(0,"div",6),n.Z7z(1,e,10,3,"div",7,n.fX1),n.DNE(3,i,2,0,"div",8),n.k0s()),2&s){const d=n.XpG();n.R7$(),n.Dyx(d.searchResults),n.R7$(2),n.Y8G("ngIf",0===d.searchResults.length)}}let r=(()=>{var s;class p{constructor(o,c){this.renderer=o,this.searchbarService=c,this.userSelected=new n.bkB,this.clickOutSide=new n.bkB,this.searchTerm="",this.dropdownOpen=!1,this.searchResults=[],this.clicked=!1,this.globalClickUnlistener=null,this.documentClickListenerCleanup=null,this.searchSubscription=new k.yU}ngOnInit(){this.searchSubscription=this.searchbarService.searchResults$.subscribe(o=>{this.searchResults=o})}ngAfterViewInit(){this.documentClickListenerCleanup=this.renderer.listen("document","click",o=>{!this.wrapperRef.nativeElement.contains(o.target)&&this.clicked&&this.clickOutSide.emit(),this.clicked=!0})}onInputClick(o){o.stopPropagation(),this.dropdownOpen||this.openDropdown()}onSearchTermChange(o){this.searchTerm=o,this.searchbarService.search(o)}onUserSelect(o,c){c.stopPropagation(),this.closeDropdown(),this.userSelected.emit(o)}openDropdown(){this.dropdownOpen=!0,this.attachDocumentClickListener()}closeDropdown(){this.dropdownOpen=!1,this.detachDocumentClickListener()}attachDocumentClickListener(){this.globalClickUnlistener=this.renderer.listen("document","click",o=>{o.target.closest(".agents-searchbar-container")||(this.closeDropdown(),this.clickOutSide.emit())})}detachDocumentClickListener(){this.globalClickUnlistener&&(this.globalClickUnlistener(),this.globalClickUnlistener=null)}ngOnDestroy(){this.detachDocumentClickListener(),this.searchSubscription.unsubscribe(),this.documentClickListenerCleanup&&(this.documentClickListenerCleanup(),this.documentClickListenerCleanup=null)}}return(s=p).\u0275fac=function(o){return new(o||s)(n.rXU(n.sFG),n.rXU(S))},s.\u0275cmp=n.VBU({type:s,selectors:[["app-agents-searchbar"]],viewQuery:function(o,c){if(1&o&&n.GBs(_,5),2&o){let h;n.mGM(h=n.lsd())&&(c.wrapperRef=h.first)}},outputs:{userSelected:"userSelected",clickOutSide:"clickOutSide"},decls:6,vars:2,consts:[["wrapper",""],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar","crm-input-input-searchbar-square","agents-searchbar-container",3,"click"],[1,"fas","fa-search"],["type","text","placeholder","Nombre",3,"ngModelChange","ngModel"],["class","dropdown-options",4,"ngIf"],[1,"dropdown-options"],[1,"crm-item-searchbar-agent-result"],["class","no-results",4,"ngIf"],[1,"crm-item-searchbar-agent-result",3,"click"],[1,"crm-item-searchbar-agent-result-left"],[1,"crm-item-searchbar-agent-result-left-image"],["alt","",3,"src"],[1,"crm-item-searchbar-agent-result-left-info"],[1,"crm-item-searchbar-agent-result-left-info-name"],[1,"crm-item-searchbar-agent-result-left-info-email"],[1,"crm-item-searchbar-agent-result-right"],[1,"no-results"]],template:function(o,c){if(1&o){const h=n.RV6();n.j41(0,"div",1)(1,"div",2,0),n.bIt("click",function(y){return n.eBV(h),n.Njj(c.onInputClick(y))}),n.nrm(3,"i",3),n.j41(4,"input",4),n.mxI("ngModelChange",function(y){return n.eBV(h),n.DH7(c.searchTerm,y)||(c.searchTerm=y),n.Njj(y)}),n.bIt("ngModelChange",function(y){return n.eBV(h),n.Njj(c.onSearchTermChange(y))}),n.k0s(),n.DNE(5,t,4,1,"div",5),n.k0s()()}2&o&&(n.R7$(4),n.R50("ngModel",c.searchTerm),n.R7$(),n.Y8G("ngIf",c.dropdownOpen))},dependencies:[b.bT,A.me,A.BC,A.vS],styles:[".agents-searchbar-container[_ngcontent-%COMP%]{position:relative;cursor:pointer}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;z-index:9999;background-color:#fff;padding:8px 0;border-radius:8px;border:1px solid var(--crm-border-light-color);max-height:200px;overflow-y:auto;font-size:14px}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.no-results[_ngcontent-%COMP%]{padding:8px;color:#888}"]}),p})()},8129:(L,T,u)=>{u.d(T,{K:()=>k});var n=u(3953);let k=(()=>{var v;class C{constructor(l,g){this.el=l,this.renderer=g,this.isLoading=!1}ngOnChanges(l){"isLoading"in l&&this.updateButtonState()}updateButtonState(){const l=this.el.nativeElement;if(this.isLoading){l.getAttribute("data-original-content")||this.renderer.setAttribute(l,"data-original-content",l.innerHTML),this.renderer.setProperty(l,"disabled",!0),this.renderer.setStyle(l,"opacity","0.6"),this.renderer.setStyle(l,"pointer-events","none"),this.renderer.setStyle(l,"cursor","not-allowed");const g=this.renderer.createElement("ion-spinner"),S=this.renderer.createText(" Cargando...");this.renderer.setProperty(l,"innerHTML",""),this.renderer.appendChild(l,g),this.renderer.appendChild(l,S)}else{this.renderer.setProperty(l,"disabled",!1),this.renderer.removeStyle(l,"opacity"),this.renderer.removeStyle(l,"pointer-events"),this.renderer.removeStyle(l,"cursor");const g=l.getAttribute("data-original-content");g&&(this.renderer.setProperty(l,"innerHTML",g),this.renderer.removeAttribute(l,"data-original-content"))}}}return(v=C).\u0275fac=function(l){return new(l||v)(n.rXU(n.aKT),n.rXU(n.sFG))},v.\u0275dir=n.FsC({type:v,selectors:[["","appLoadingButton",""]],inputs:{isLoading:[0,"appLoadingButton","isLoading"]},standalone:!0,features:[n.OA$]}),C})()},9333:(L,T,u)=>{u.d(T,{F:()=>S});var n=u(467);const k=[{id:"1",name:"Juan P\xe9rez",emails:["juan.perez@example.com"],phones:["+34 600 123 456"],address:"Calle Mayor 123, 28013 Madrid, Espa\xf1a",reference:"Ref001",origin:"Idealista",photoUrl:"https://randomuser.me/api/portraits/men/1.jpg",photoName:"juan_perez.jpg",createdAt:new Date("2024-01-15T10:00:00"),updatedAt:new Date("2024-04-20T15:30:00"),tags:[{id:"tag1",value:"Interested",text:"Interested in product"},{id:"tag2",value:"Follow-Up",text:"Requires follow-up"}]},{id:"2",name:"Mar\xeda L\xf3pez",emails:["maria.lopez@example.com"],phones:["+34 600 789 012"],address:"Avenida de la Constituci\xf3n 45, 41004 Sevilla, Espa\xf1a",reference:"Ref002",origin:"Fotocasa",photoUrl:"https://randomuser.me/api/portraits/women/2.jpg",photoName:"maria_lopez.png",createdAt:new Date("2023-11-10T09:30:00"),updatedAt:new Date("2024-03-18T11:45:00"),tags:[{id:"tag3",value:"VIP",text:"VIP customer"}]},{id:"3",name:"Carlos Garc\xeda",emails:["carlos.garcia@example.com","cgarcia@personalmail.com"],phones:["+34 600 345 678"],address:"Calle de la Luna 78, 08002 Barcelona, Espa\xf1a",reference:"Ref003",origin:"Manual",photoUrl:"https://randomuser.me/api/portraits/men/3.jpg",photoName:"carlos_garcia.jpg",createdAt:new Date("2024-02-05T14:20:00"),updatedAt:new Date("2024-05-10T16:00:00"),tags:[{id:"tag4",value:"Needs Info",text:"Needs more information"},{id:"tag5",value:"Interested",text:"Interested in product"}]},{id:"4",name:"Luc\xeda Fern\xe1ndez",emails:["lucia.fernandez@example.com"],phones:["+34 600 901 234","+34 600 567 890"],address:"Paseo de Gracia 256, 08007 Barcelona, Espa\xf1a",reference:"Ref004",origin:"Habitaclia",photoUrl:"https://randomuser.me/api/portraits/women/4.jpg",photoName:"lucia_fernandez.png",createdAt:new Date("2023-12-22T08:15:00"),updatedAt:new Date("2024-06-25T13:50:00"),tags:[{id:"tag6",value:"Repeat Client",text:"Repeat client"}]},{id:"5",name:"Pedro Mart\xednez",emails:["pedro.martinez@example.com"],phones:["+34 600 234 567"],address:"Calle de Alcal\xe1 89, 28014 Madrid, Espa\xf1a",reference:"Ref005",origin:"Idealista",photoUrl:"https://randomuser.me/api/portraits/men/5.jpg",photoName:"pedro_martinez.jpg",createdAt:new Date("2024-03-12T12:00:00"),updatedAt:new Date("2024-07-30T10:25:00"),tags:[{id:"tag7",value:"New",text:"New contact"},{id:"tag8",value:"Potential",text:"Potential client"}]},{id:"6",name:"Ana Torres",emails:["ana.torres@example.com"],phones:["+34 600 678 901"],address:"Gran V\xeda 45, 28013 Madrid, Espa\xf1a",reference:"Ref006",origin:"Manual",photoUrl:"https://randomuser.me/api/portraits/women/6.jpg",photoName:"ana_torres.jpg",createdAt:new Date("2024-04-01T11:00:00"),updatedAt:new Date("2024-08-15T14:30:00"),tags:[{id:"tag9",value:"VIP",text:"VIP customer"},{id:"tag10",value:"Loyal",text:"Loyal customer"}]}];var v=u(7376),C=u(3953),w=u(8397),l=u(6039),g=u(6552);let S=(()=>{var b;class A{constructor(e,i,t){this.toastService=e,this.api=i,this.utils=t,this.mockContacts=k,this.possibleValues={contactType:["potential_client","client"],origin:["Idealista","Fotocasa","Manual","Habitaclia"],nationality:["spain","france","germany"],gender:["male","female","other"]}}getContacts(e,i,t,r){var s=this;return(0,n.A)(function*(){const p=yield s.api.getContacts(e,i||{field:"createdAt",order:"desc"},t||{page:0,itemsPerPage:50},r||{tag:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1},contactsRelated:{apply:!0,filter:{},onlyCount:!1},contactsRelation:{apply:!0,filter:{},onlyCount:!1},responsableUsers:{apply:!0,filter:{},onlyCount:!1}});return console.log("ELS CONTACTS",p),p.success})()}createOrUpdateContactFromForm(e,i){var t=this;return(0,n.A)(function*(){try{const m=e.contactForm;if(m.markAllAsTouched(),m.valid){var r,s,p,d;let y=v.cloneDeep(m.value),f=t.buildContactFromForm(y);if(f=yield e.fileUploaderManager.processProfilePic(f),f=t.utils.parseProperties(f),f.languages=(null==e||null===(r=e.contact)||void 0===r?void 0:r.languages)||[],f.nationality=(null==e||null===(s=e.contact)||void 0===s?void 0:s.nationality)||null,console.log("EL CONTACT",v.cloneDeep(f)),i)yield t.api.updateContactById(i,f);else{var o;const a=yield t.api.createContact(f);i=null==a||null===(o=a.success)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.id}const x=(null==e||null===(p=e.contact)||void 0===p?void 0:p.responsableUsers)||[];for(let a of x)null!=a&&a.removed&&(yield t.api.removeUserFromContact(i,a.id)),null!=a&&a.new&&(yield t.api.addUserToContact(i,a.id));const R=(null==e||null===(d=e.contact)||void 0===d?void 0:d.contactsRelation)||[];for(let a of R){var c,h;if(console.log("LA CONTACT RELATION",a),null!=a&&a.removed)yield t.api.removeContactRelation(i,null==a||null===(c=a.contactRelated)||void 0===c?void 0:c.id);if(null!=a&&a.new)yield t.api.addContactRelation(i,null==a||null===(h=a.contactRelated)||void 0===h?void 0:h.id,null==a?void 0:a.relationType);null!=a&&a.edited&&(yield t.api.editContactRelation(null==a?void 0:a.id,null==a?void 0:a.relationType))}return t.toastService.showToast({text:"Contacto guardado correctamente",time:2e3,theme:"success"}),!0}return t.toastService.showToast({text:"Por favor, rellene todos los campos correctamente",time:3e3,theme:"red"}),!1}catch(m){return console.error(m),!1}})()}deleteContact(e){var i=this;return(0,n.A)(function*(){yield i.api.deleteContactById(e),yield i.toastService.showToast({text:"Contacto eliminado correctamente",theme:"success",time:3e3}),i.getContacts()})()}getContactById(e){var i=this;return(0,n.A)(function*(){var t;let r=null===(t=yield i.api.getContactById(e))||void 0===t||null===(t=t.success)||void 0===t?void 0:t.data;return r||i.toastService.showToast({text:"No existe ning\xfan contacto con ese ID",icon:"fas fa-exclamation-triangle",theme:"red",time:3e3}),r})()}removeAllContactTags(e){var i=this;return(0,n.A)(function*(){return yield i.api.removeAllContactTags(e)})()}updateContactsTags(e,i){var t=this;return(0,n.A)(function*(){for(let r of e){yield t.removeAllContactTags(r.id);for(let s of i)yield t.api.addTagToContact(r.id,s.id)}})()}buildContactFromForm(e){const i={id:"",name:e.name,contactType:e.contactType,dniPassport:e.dniPassport,nationality:e.nationality,origin:e.origin,birthdate:e.birthdate,gender:e.gender,alias:e.alias,address:e.address,phones:e.contactPhones.map(t=>t.phoneNumber),emails:e.contactEmails.map(t=>t.emailAddress),urlFacebook:e.urlFacebook,urlInstagram:e.urlInstagram,urlLinkedIn:e.urlLinkedIn,photoName:e.photoName,photoUrl:e.photoUrl,reference:e.reference};return i.phones=i.phones.filter(t=>t),i.emails=i.emails.filter(t=>t),i}replaceContactsTags(e,i){return e=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(i)),e.map(t=>i.find(s=>s.id===t.id)||t)}createJoinTablesForTags(e){let i={};if(e.tags&&e.tags.length>0){const t=e.tags.map(r=>r.id).filter(r=>void 0!==r);t.length>0&&(i.tag={apply:!0,filter:{id:{in:t}},onlyCount:!1})}return i}transformFilterDataToFilterI(e,i=""){const t={};if(null!=e&&e.name&&(t.name={contains:e.name,mode:"insensitive"}),null!=e&&e.dniPassport&&(t.dniPassport={contains:e.dniPassport,mode:"insensitive"}),null!=e&&e.alias&&(t.alias={contains:e.alias,mode:"insensitive"}),null!=e&&e.address&&(t.address={contains:e.address,mode:"insensitive"}),null!=e&&e.urlFacebook&&(t.urlFacebook={contains:e.urlFacebook,mode:"insensitive"}),null!=e&&e.urlInstagram&&(t.urlInstagram={contains:e.urlInstagram,mode:"insensitive"}),null!=e&&e.urlLinkedIn&&(t.urlLinkedIn={contains:e.urlLinkedIn,mode:"insensitive"}),null!=e&&e.emailAddress&&(t.emails={has:e.emailAddress}),null!=e&&e.phoneNumber&&(t.phones={has:e.phoneNumber}),null!=e&&e.contactType&&e.contactType.length>0){const r=e.contactType.filter(s=>this.possibleValues.contactType.includes(s));r.length>0&&(t.contactType={in:r})}if(null!=e&&e.origin&&e.origin.length>0){const r=e.origin.filter(s=>this.possibleValues.origin.includes(s));r.length>0&&(t.origin={in:r})}if(null!=e&&e.nationality&&e.nationality.length>0){const r=e.nationality.filter(s=>this.possibleValues.nationality.includes(s));r.length>0&&(t.nationality={in:r})}if(null!=e&&e.gender&&e.gender.length>0){const r=e.gender.filter(s=>this.possibleValues.gender.includes(s));r.length>0&&(t.gender={in:r})}if((null!=e&&e.birthdateFrom||null!=e&&e.birthdateTo)&&(t.birthdate={},e.birthdateFrom&&(t.birthdate.gte=new Date(e.birthdateFrom)),e.birthdateTo&&(t.birthdate.lte=new Date(e.birthdateTo))),(null!=e&&e.createdAtFrom||null!=e&&e.createdAtTo)&&(t.createdAt={},e.createdAtFrom&&(t.createdAt.gte=new Date(e.createdAtFrom)),e.createdAtTo&&(t.createdAt.lte=new Date(e.createdAtTo))),null!=e&&e.associatedUser&&(t.associatedUser={name:{contains:e.associatedUser,mode:"insensitive"}}),i&&""!==i.trim()){const r=this.possibleValues.contactType.filter(d=>d.toLowerCase().includes(i.toLowerCase())),s=this.possibleValues.origin.filter(d=>d.toLowerCase().includes(i.toLowerCase())),p={OR:[{name:{contains:i,mode:"insensitive"}},{dniPassport:{contains:i,mode:"insensitive"}},{alias:{contains:i,mode:"insensitive"}},{address:{contains:i,mode:"insensitive"}},{urlFacebook:{contains:i,mode:"insensitive"}},{urlInstagram:{contains:i,mode:"insensitive"}},{urlLinkedIn:{contains:i,mode:"insensitive"}},{nationality:{contains:i,mode:"insensitive"}},{gender:{contains:i,mode:"insensitive"}},{emails:{has:i}},{phones:{has:i}},...r.length>0?[{contactType:{in:r}}]:[],...s.length>0?[{origin:{in:s}}]:[]]};return Object.keys(t).length>0?{AND:[t,p]}:p}return t}}return(b=A).\u0275fac=function(e){return new(e||b)(C.KVO(w.f),C.KVO(l.i),C.KVO(g.T))},b.\u0275prov=C.jDH({token:b,factory:b.\u0275fac,providedIn:"root"}),A})()},8392:(L,T,u)=>{u.d(T,{R:()=>n});const n={contactType:[{value:"client",label:"Cliente"},{value:"potential_client",label:"Cliente potencial"},{value:"owner",label:"Propietario"},{value:"external_broker",label:"Broker externo"},{value:"referred",label:"Referido"},{value:"investor",label:"Inversor"}],origin:[{value:"",label:""},{value:"a_place_in_the_sun",label:"A Place in the Sun"},{value:"facebook_ads",label:"Facebook Ads"},{value:"fotocasa",label:"Fotocasa"},{value:"google_ads",label:"Google Ads"},{value:"green_acres",label:"Green-Acres"},{value:"habitaclia",label:"Habitaclia"},{value:"james_edition",label:"JamesEdition"},{value:"immobilienscout24",label:"ImmobilienScout24"},{value:"immonet",label:"Immonet"},{value:"immowelt",label:"ImmoWelt"},{value:"idealista",label:"Idealista"},{value:"instagram_ads",label:"Instagram Ads"},{value:"kyero",label:"Kyero"},{value:"linkedin_ads",label:"LinkedIn Ads"},{value:"list_globally",label:"ListGlobally"},{value:"luxury_estate",label:"LuxuryEstate"},{value:"newsletter",label:"Newsletter"},{value:"network_de_agentes_o_brokers",label:"Network de agentes o brokers"},{value:"networking_en_eventos",label:"Networking en eventos"},{value:"pisos_com",label:"Pisos.com"},{value:"prop_go_luxury",label:"PropGoLuxury"},{value:"referido_por_redes_sociales",label:"Referido por redes sociales"},{value:"recomendacion_de_cliente",label:"Recomendaci\xf3n de cliente"},{value:"recomendacion_interna",label:"Recomendaci\xf3n interna (de otros departamentos o contactos)"},{value:"rightmove",label:"Rightmove"},{value:"think_spain",label:"ThinkSpain"},{value:"visitas_presenciales_en_ferias_internacionales",label:"Visitas presenciales en ferias internacionales"},{value:"web_propio",label:"Web propio"},{value:"yaencontre",label:"Yaencontre"},{value:"youtube_ads",label:"YouTube Ads"},{value:"zoopla",label:"Zoopla"},{value:"",label:""}]}}}]);