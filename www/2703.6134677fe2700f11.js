"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2703],{9604:(P,F,d)=>{d.d(F,{b:()=>W});var u=d(467),g=d(7376),o=d(3953),f=d(6039);let y=(()=>{var l;class p{constructor(e){this.api=e}createPromoterFolder(e){var t=this;return(0,u.A)(function*(){const r=[],i={type:"documents_folder",name:"Documentos",parent:e};return r.push(t.createDirectoryItem({type:"promotions_folder",name:"Promociones",parent:e})),r.push(t.createDirectoryItem(i)),r})()}createAgencyFolder(e){var t=this;return(0,u.A)(function*(){const r=[];return r.push(t.createDirectoryItem({type:"documents_folder",name:"Documentos",parent:e})),r})()}createPromotionsFolder(e){var t=this;return(0,u.A)(function*(){const r=[];console.log("promoter",e);const i=(yield t.api.getPromotions({promoterId:{equals:null==e?void 0:e.id}},null,{itemsPerPage:100,page:0})).success.data;for(const a of i)r.push(t.createDirectoryItem({type:"promotion_folder",name:null==a?void 0:a.projectName,parent:a}));return r})()}createPromotionFolder(e){var t=this;return(0,u.A)(function*(){const r=[],i=(yield t.api.getPromotionFullDataById(null==e?void 0:e.id)).success.data,c={type:"promotion_planos_folder",name:"Planos",parent:i},v={type:"promotion_photos_folder",name:"Fotos",parent:i},h={type:"promotion_catalog_folder",name:"Cat\xe1logos",parent:i},D={type:"documents_folder",name:"Documentos",parent:i};return r.push(t.createDirectoryItem({type:"properties_folder",name:"Unidades",parent:i})),r.push(t.createDirectoryItem(c)),r.push(t.createDirectoryItem(v)),r.push(t.createDirectoryItem(h)),r.push(t.createDirectoryItem(D)),r})()}createPropertiesFolder(e){var t=this;return(0,u.A)(function*(){const r=[],i=(yield t.api.getProperty({promotionId:{equals:null==e?void 0:e.id}},null,{itemsPerPage:100,page:0})).success.data;for(const a of i)r.push(t.createDirectoryItem({type:"property_folder",name:null==a?void 0:a.title,parent:a}));return r})()}createPropertyFolder(e){var t=this;return(0,u.A)(function*(){const r=[],i={type:"property_photos_folder",name:"Fotos",parent:e};return r.push(t.createDirectoryItem({type:"property_plans_folder",name:"Planos",parent:e})),r.push(t.createDirectoryItem(i)),r})()}createPropertyPlansFolder(e){var t=this;return(0,u.A)(function*(){const r=[],n=[];for(const i of n)r.push(t.createDirectoryItem(i));return r})()}createPropertyPhotosFolder(e){var t=this;return(0,u.A)(function*(){const r=[],n=yield t.api.getProperty({id:{equals:null==e?void 0:e.id}},null,null,{propertyFile:{apply:!0,onlyCount:!1,filter:null}}),[i]=n.success.data,a=i.propertyFiles;for(const c of a)r.push(t.createDirectoryItem(c));return r})()}createPromotionPlansFolder(e){var t=this;return(0,u.A)(function*(){const r=[],n=[];for(const i of n)r.push(t.createDirectoryItem(i));return r})()}createPromotionPhotosFolder(e){var t=this;return(0,u.A)(function*(){const r=[],n=yield t.api.getPromotions({id:{equals:null==e?void 0:e.id}},null,null,{promotionFiles:{apply:!0,onlyCount:!1,filter:null}}),[i]=n.success.data,a=null==i?void 0:i.promotionFiles;for(const c of a)r.push(t.createDirectoryItem(c));return r})()}createPromotionCatalogFolder(e){var t=this;return(0,u.A)(function*(){const r=[],n=[];for(const i of n)r.push(t.createDirectoryItem(i));return r})()}createDirectoryItem(e){const r={type:null!=e&&e.url?"file":"folder",subtype:this.getSubtype(e),object:e,url:null==e?void 0:e.url},n=this.getItemNameAndSubtitle(e);return r.name=n.name,r.subtitle=n.subtitle,r}getSubtype(e){if(null!=e&&e.url){var t;let r=this.getFileExtension((null==e?void 0:e.label)||(null==e?void 0:e.name));return r=null===(t=r)||void 0===t?void 0:t.toLowerCase().trim(),["pdf"].includes(r)?"pdf":["jpg","jpeg","png","gif","webp","heic","heif","bmp","tiff","svg","ico","jfif","raw","indd","ai","eps"].includes(r)?"img":"other-file"}return"folder"}getFileExtension(e){const r=e.split("?")[0].split(".").pop();return r.includes("/")?null:r}getItemNameAndSubtitle(e){var t,r;let n={name:(null==e?void 0:e.label)||(null==e?void 0:e.name),subtitle:""};switch(null==e?void 0:e.type){case"promotion_folder":n.subtitle="Promoci\xf3n",n.name=null==e||null===(t=e.parent)||void 0===t?void 0:t.projectName;break;case"properties_folder":case"property_plans_folder":case"property_photos_folder":case"promotion_planos_folder":case"promotion_photos_folder":case"promotion_catalog_folder":break;case"property_folder":n.subtitle="Propiedad",n.name=null==e||null===(r=e.parent)||void 0===r?void 0:r.reference}return n}}return(l=p).\u0275fac=function(e){return new(e||l)(o.KVO(f.i))},l.\u0275prov=o.jDH({token:l,factory:l.\u0275fac,providedIn:"root"}),p})(),E=(()=>{var l;class p{constructor(e,t){this.fileExplorerDirectoryBuilderService=e,this.api=t}createFileExplorerDirectory(e){var t=this;return(0,u.A)(function*(){const r={};return r.object=e,r.items=yield t.createDirectoryItems(e),r})()}createDirectoryItems(e){var t=this;return(0,u.A)(function*(){const r=[];switch(null==e?void 0:e.type){case"promoter_folder":const n=yield t.fileExplorerDirectoryBuilderService.createPromoterFolder(e.parent);r.push(...n);break;case"agency_folder":const i=yield t.fileExplorerDirectoryBuilderService.createAgencyFolder(e.parent);r.push(...i);break;case"documents_folder":break;case"promotions_folder":const a=yield t.fileExplorerDirectoryBuilderService.createPromotionsFolder(e.parent);r.push(...a);break;case"promotion_folder":const c=yield t.fileExplorerDirectoryBuilderService.createPromotionFolder(e.parent);r.push(...c);break;case"properties_folder":const v=yield t.fileExplorerDirectoryBuilderService.createPropertiesFolder(e.parent);r.push(...v);break;case"property_folder":const h=yield t.fileExplorerDirectoryBuilderService.createPropertyFolder(e.parent);r.push(...h);break;case"property_plans_folder":const D=yield t.fileExplorerDirectoryBuilderService.createPropertyPlansFolder(e.parent);r.push(...D);break;case"property_photos_folder":const K=yield t.fileExplorerDirectoryBuilderService.createPropertyPhotosFolder(e.parent);r.push(...K);break;case"promotion_planos_folder":const L=yield t.fileExplorerDirectoryBuilderService.createPromotionPlansFolder(e.parent);r.push(...L);break;case"promotion_photos_folder":const z=yield t.fileExplorerDirectoryBuilderService.createPromotionPhotosFolder(e.parent);r.push(...z);break;case"promotion_catalog_folder":const H=yield t.fileExplorerDirectoryBuilderService.createPromotionCatalogFolder(e.parent);r.push(...H)}return r})()}}return(l=p).\u0275fac=function(e){return new(e||l)(o.KVO(y),o.KVO(f.i))},l.\u0275prov=o.jDH({token:l,factory:l.\u0275fac,providedIn:"root"}),p})();var m=d(5952),_=d(5970),x=d(5188),C=d(6552),I=d(177),k=d(6279),S=d(8147);const b=["fileUploaderManagerComponent"],B=l=>({"crm-block-breadcrumbs-item-separator":l});function A(l,p){1&l&&(o.j41(0,"div",7)(1,"div",15),o.EFF(2," / "),o.k0s()())}function M(l,p){if(1&l){const s=o.RV6();o.DNE(0,A,3,0,"div",7),o.j41(1,"div",13),o.bIt("click",function(){o.eBV(s);const t=o.XpG().$implicit,r=o.XpG();return o.Njj(r.onClickNavigation(t))}),o.j41(2,"div",14),o.EFF(3),o.k0s()()}if(2&l){const s=o.XpG(),e=s.$implicit,t=s.$index,r=o.XpG();o.vxM(t>0?0:-1),o.R7$(2),o.Y8G("ngClass",o.eq3(3,B,t>0)),o.R7$(),o.SpI(" ",r.getFolderName(e)," ")}}function O(l,p){if(1&l&&o.DNE(0,M,4,5,"div",7),2&l){const s=p.$implicit,e=o.XpG();o.vxM(e.getFolderName(s)?0:-1)}}function T(l,p){if(1&l){const s=o.RV6();o.j41(0,"button",16),o.bIt("click",function(){o.eBV(s);const t=o.XpG();return o.Njj(t.onSaveFiles())}),o.nrm(1,"i",17),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&l&&(o.R7$(2),o.SpI(" ",o.bMT(3,1,"buttons.upload_file")," "))}function N(l,p){1&l&&o.nrm(0,"img",21)}function U(l,p){1&l&&o.nrm(0,"img",22)}function R(l,p){1&l&&o.nrm(0,"img",23)}function G(l,p){}function X(l,p){if(1&l&&(o.j41(0,"div",24),o.EFF(1),o.k0s()),2&l){const s=o.XpG(2).$implicit;o.R7$(),o.SpI(" ",null==s?null:s.subtitle," ")}}function w(l,p){if(1&l){const s=o.RV6();o.j41(0,"div",19),o.bIt("click",function(){o.eBV(s);const t=o.XpG().$implicit,r=o.XpG();return o.Njj(r.onItemClick(t))}),o.j41(1,"div",20),o.DNE(2,N,1,0,"img",21)(3,U,1,0,"img",22)(4,R,1,0,"img",23)(5,G,0,0),o.k0s(),o.DNE(6,X,2,1,"div",24),o.j41(7,"div",25),o.EFF(8),o.k0s()()}if(2&l){const s=o.XpG().$implicit;o.R7$(2),o.vxM("folder"===(null==s?null:s.subtype)?2:"pdf"===(null==s?null:s.subtype)?3:"other-file"===(null==s?null:s.subtype)?4:5),o.R7$(4),o.vxM(null!=s&&s.subtitle?6:-1),o.R7$(2),o.SpI(" ",null==s?null:s.name," ")}}function V(l,p){if(1&l&&o.DNE(0,w,9,3,"div",18),2&l){const s=p.$implicit;o.vxM("img"!==(null==s?null:s.subtype)?0:-1)}}function $(l,p){1&l&&o.EFF(0," No hay archivos ")}let W=(()=>{var l;class p{constructor(e,t,r,n,i,a){this.fileExplorerService=e,this.modalsService=t,this.popoversService=r,this.router=n,this.utils=i,this.api=a,this.options={type:"promoterFolder"},this.history=[],this.navigation=[],this.testClass="d-none",this.propertyId=null,this.showSaveFilesBtn=!1}ngAfterViewInit(){}ngOnChanges(){this.directoryBaseElement&&(console.log("directoryBaseElement",this.directoryBaseElement),this.navigation=[],this.navigation.push(this.directoryBaseElement),this.buildDirectory())}getFolderName(e){var t,r,n,i;return null!=e&&e.name?e.name:null!=e&&null!==(t=e.parent)&&void 0!==t&&t.reference?null==e||null===(n=e.parent)||void 0===n?void 0:n.reference:null!=e&&null!==(r=e.parent)&&void 0!==r&&r.projectName?null==e||null===(i=e.parent)||void 0===i?void 0:i.projectName:""}onItemMenuClick(e){var t=this;return(0,u.A)(function*(){e.stopPropagation(),e.preventDefault();yield t.popoversService.onShowMenuPopover(e,"file-explorer-item-options")})()}onUploadFiles(){var e=this;return(0,u.A)(function*(){const t=yield e.modalsService.onShowUploadFilesModal();t.data&&console.log("Archivos a subir",t.data)})()}onItemClick(e){var t,r;"Documentos"!==e.name?("folder"===e.type&&this.buildDirectory(null==e?void 0:e.object),"file"===e.type&&window.open(e.url,"_blank")):this.router.navigate(["/documents"],{queryParams:{agencyId:"agencyFolder"===this.options.type?null===(t=this.directoryBaseElement)||void 0===t||null===(t=t.parent)||void 0===t?void 0:t.id:void 0,promotionId:"promotion_folder"===this.directoryBaseElement.type?null===(r=this.directoryBaseElement)||void 0===r||null===(r=r.parent)||void 0===r?void 0:r.id:void 0}})}onClickNavigation(e){this.testClass="d-none";const t=this.navigation.findIndex(r=>r===e);this.navigation=this.navigation.slice(0,t+1),this.buildDirectory(e,!0)}onGoRoot(){this.buildDirectory(this.directoryBaseElement,!0)}onGoBack(){this.navigation.length>1&&(this.navigation.pop(),this.buildDirectory(this.navigation[this.navigation.length-1],!0))}buildDirectory(e,t){var r=this;return(0,u.A)(function*(){var n,i;r.showSaveFilesBtn=!1,r.directory=yield r.fileExplorerService.createFileExplorerDirectory(e||r.directoryBaseElement),t||r.navigation.push(e);let a=[];null!==(n=r.directory)&&void 0!==n&&null!==(n=n.object)&&void 0!==n&&null!==(n=n.parent)&&void 0!==n&&n.id&&(r.propertyId=r.directory.object.parent.id),null===(i=r.directory)||void 0===i||i.items.forEach(c=>{a.push(c.object)}),"property_photos_folder"===(null==e?void 0:e.type)&&(r.showSaveFilesBtn=!0,r.testClass="d-block",setTimeout(()=>{r.fileUploaderManager.config={multiple:!0,size:"medium",showRemove:!0,showName:!0,rounded:!1,allowUpload:!0,accept:"image/*",showStar:!1,files:[],openUrlOnClick:!0,filesCategory:"images",files:r.utils.filterFilesByCategoryAndSort(a,"images")}},100)),console.log("directory",r.directory)})()}onSaveFiles(){var e=this;return(0,u.A)(function*(){var t;let r=null===(t=e.fileUploaderManager)||void 0===t||null===(t=t.config)||void 0===t?void 0:t.files;for(let i of r){if(null!=i&&i.new){var n;const a={propertyId:e.propertyId,name:"",category:i.category,label:i.label,orderIndex:null==i?void 0:i.orderIndex},c=yield e.api.uploadFile(i.fileBlob),v=null==c||null===(n=c.success)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.fileName;a.name=v,yield e.api.addPropertyFile(a)}if(null!=i&&i.deleted&&(yield e.api.deletePropertyFileById(null==i?void 0:i.id)),null!=i&&i.moved&&(null==i||!i.deleted)&&(null==i||!i.new)){let a=g.cloneDeep(i);delete a.moved,delete a.fileBase64,delete a.fileBlob,delete a.new,delete a.deleted,delete a.size,delete a.type,yield e.api.editPropertyFile(a)}}})()}}return(l=p).\u0275fac=function(e){return new(e||l)(o.rXU(E),o.rXU(m.M),o.rXU(_.m),o.rXU(x.Ix),o.rXU(C.T),o.rXU(f.i))},l.\u0275cmp=o.VBU({type:l,selectors:[["app-file-explorer"]],viewQuery:function(e,t){if(1&e&&o.GBs(b,7),2&e){let r;o.mGM(r=o.lsd())&&(t.fileUploaderManager=r.first)}},inputs:{directoryBaseElement:"directoryBaseElement",options:"options"},features:[o.OA$],decls:21,vars:5,consts:[["fileUploaderManagerComponent",""],[1,"crm-section"],[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-buttons-group"],[1,"crm-button-icon-solo",3,"click"],[1,"fa","fa-arrow-left"],[1,"crm-block-breadcrumbs"],[1,"crm-block-breadcrumbs-item"],[1,"crm-block-breadcrumbs-item-icon"],[1,"fas","fa-folder"],[1,"crm-button"],[1,"crm-section-margin-top"],[1,"crm-section-files"],[1,"crm-block-breadcrumbs-item",3,"click"],[1,"crm-block-breadcrumbs-item-text",3,"ngClass"],[1,"crm-block-breadcrumbs-item-text","crm-block-breadcrumbs-item-separator"],[1,"crm-button",3,"click"],[1,"fa","fa-upload"],[1,"crm-directory-item"],[1,"crm-directory-item",3,"click"],[1,"crm-directory-item-icon"],["src","assets/images/folder.png"],["src","assets/images/pdf1.png"],["src","assets/images/doc.png"],[1,"crm-directory-item-subtitle"],[1,"crm-directory-item-title"]],template:function(e,t){if(1&e){const r=o.RV6();o.j41(0,"div",1)(1,"div",2)(2,"div")(3,"div",3)(4,"button",4),o.bIt("click",function(){return o.eBV(r),o.Njj(t.onGoBack())}),o.nrm(5,"i",5),o.k0s(),o.j41(6,"div",6)(7,"div",7)(8,"div",8),o.nrm(9,"i",9),o.k0s()(),o.Z7z(10,O,1,1,null,null,o.fX1),o.k0s()()(),o.j41(12,"div",3),o.DNE(13,T,4,3,"button",10),o.k0s()(),o.j41(14,"div"),o.nrm(15,"app-file-uploader-manager",11,0),o.k0s(),o.j41(17,"div",12),o.Z7z(18,V,1,1,null,null,o.fX1),o.DNE(20,$,1,0),o.k0s()()}2&e&&(o.R7$(10),o.Dyx(t.navigation),o.R7$(3),o.vxM(null!=t.directory&&null!=t.directory.items&&t.directory.items.length&&t.showSaveFilesBtn?13:-1),o.R7$(),o.HbH(t.testClass),o.R7$(4),o.Dyx(null==t.directory?null:t.directory.items),o.R7$(2),o.vxM(0===(null==t.directory||null==t.directory.items?null:t.directory.items.length)?20:-1))},dependencies:[I.YU,k.F,S.D9]}),p})()},8284:(P,F,d)=>{d.d(F,{o:()=>E});var u=d(177),g=d(9417),o=d(8147),f=d(6279),y=d(3953);let E=(()=>{var m;class _{}return(m=_).\u0275fac=function(C){return new(C||m)},m.\u0275mod=y.$C({type:m}),m.\u0275inj=y.G2t({imports:[u.MD,g.YN,o.h,f.F]}),_})()}}]);