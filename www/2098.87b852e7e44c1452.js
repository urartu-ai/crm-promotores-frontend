"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2098],{1129:(T,j,p)=>{p.d(j,{Z:()=>f});var d=p(3953),s=p(6069),g=p(1982);function C(e,F){if(1&e){const b=d.RV6();d.j41(0,"app-country-selector-popover",4),d.bIt("countrySelected",function(k){d.eBV(b);const E=d.XpG();return d.Njj(E.selectCountry(k))})("closePopover",function(){d.eBV(b);const k=d.XpG();return d.Njj(k.dropdownOpen=!1)}),d.k0s()}2&e&&d.Y8G("showCountryCode",!0)}let f=(()=>{var e;class F{constructor(){this.emitCountrySelected=new d.bkB,this.countries=s.X,this.selectedCountry=s.X[0],this.dropdownOpen=!1}ngOnChanges(){const _=this.extractCountryPhoneCodeFromPhoneNumber(this.selectedPhoneNumber);_!==this.extractCountryPhoneCodeFromPhoneNumber(this.selectedCountry.phoneCode)&&this.selectCountryByPhoneCode(_)}toggleDropdown(_){_.stopPropagation(),this.dropdownOpen=!this.dropdownOpen}selectCountry(_){_.event.stopPropagation(),this.selectedCountry=_.country,this.emitCountrySelected.emit(_.country),this.dropdownOpen=!1}selectCountryByPhoneCode(_){const k=this.countries.find(E=>E.phoneCode===_);k&&(this.selectedCountry=k,this.emitCountrySelected.emit(k))}extractCountryPhoneCodeFromPhoneNumber(_){return null==_?void 0:_.split(" ")[0]}}return(e=F).\u0275fac=function(_){return new(_||e)},e.\u0275cmp=d.VBU({type:e,selectors:[["app-flag-country-selector"]],inputs:{selectedPhoneNumber:"selectedPhoneNumber"},outputs:{emitCountrySelected:"emitCountrySelected"},features:[d.OA$],decls:5,vars:3,consts:[["tabindex","0",1,"flag-country-selector-container",3,"click"],[1,"selected-country"],[1,"fas","fa-caret-down","dropdown-arrow"],[3,"showCountryCode"],[3,"countrySelected","closePopover","showCountryCode"]],template:function(_,k){1&_&&(d.j41(0,"div",0),d.bIt("click",function(R){return k.toggleDropdown(R)}),d.j41(1,"div",1),d.nrm(2,"span")(3,"i",2),d.k0s(),d.DNE(4,C,1,1,"app-country-selector-popover",3),d.k0s()),2&_&&(d.R7$(2),d.HbH(null==k.selectedCountry?null:k.selectedCountry.flagClass),d.R7$(2),d.vxM(k.dropdownOpen?4:-1))},dependencies:[g.u],styles:[".flag-country-selector-container[_ngcontent-%COMP%]{position:relative;width:50px;cursor:pointer;color:#000}.selected-country[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:50px}.dropdown-arrow[_ngcontent-%COMP%]{margin-left:8px}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:200px;z-index:9999;background-color:#fff;border:1px solid #ccc;padding:8px 0;border-radius:12px;border:1px solid var(--crm-border-light-color);color:#000;max-height:150px;overflow-y:auto}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;display:inline-block;margin-right:8px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.flag-country-selector-container[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{color:#000}.selected-country[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;width:18px;height:18px}"]}),F})()},6812:(T,j,p)=>{p.d(j,{u:()=>f});var d=p(177),s=p(9417),g=p(7754),C=p(3953);let f=(()=>{var e;class F{}return(e=F).\u0275fac=function(_){return new(_||e)},e.\u0275mod=C.$C({type:e}),e.\u0275inj=C.G2t({imports:[d.MD,s.YN,g.X]}),F})()},7754:(T,j,p)=>{p.d(j,{X:()=>f});var d=p(177),s=p(9417),g=p(9465),C=p(3953);let f=(()=>{var e;class F{}return(e=F).\u0275fac=function(_){return new(_||e)},e.\u0275mod=C.$C({type:e}),e.\u0275inj=C.G2t({imports:[d.MD,s.YN,g.bv]}),F})()},2098:(T,j,p)=>{p.r(j),p.d(j,{VentaOperationProcessPageModule:()=>tt});var d=p(177),s=p(9417),g=p(9465),C=p(5188),f=p(467),e=p(3953),F=p(6039),b=p(8397);function _(i,c){if(1&i){const a=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,o=e.XpG();return e.Njj(o.onSelectPromotion(t))}),e.EFF(1," Seleccionada "),e.k0s()}}function k(i,c){if(1&i){const a=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,o=e.XpG();return e.Njj(o.onSelectPromotion(t))}),e.EFF(1," Seleccionar "),e.k0s()}}function E(i,c){if(1&i&&(e.j41(0,"div",14)(1,"div",15),e.EFF(2),e.k0s(),e.j41(3,"div",16),e.EFF(4),e.k0s(),e.j41(5,"div",17),e.DNE(6,_,2,0,"button",18)(7,k,2,0,"button",19),e.k0s()()),2&i){const a=c.$implicit,n=e.XpG();e.R7$(2),e.SpI(" ",a.projectName," "),e.R7$(2),e.Lme(" ",a.availableProperties.length," / ",a.properties.length," "),e.R7$(2),e.vxM((null==n.selectedPromotion?null:n.selectedPromotion.id)===a.id?6:7)}}let R=(()=>{var i;class c{constructor(n){this.api=n,this.selectPromotion=new e.bkB,this.promotions=[],this.selectedPromotion=null,this.searchTerm=""}ngOnInit(){this.getAllPromotions()}getAllPromotions(){var n=this;return(0,f.A)(function*(){try{const t={page:0,itemsPerPage:500},o=yield n.api.getPromotions({},null,t,{properties:{apply:!0,filter:null,onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},promoter:{apply:!0,filter:null,onlyCount:!1}});null!=o&&o.success?(n.promotions=o.success.data,n.promotions.forEach(r=>{var l;r.availableProperties=null===(l=r.properties)||void 0===l?void 0:l.filter(u=>"available"===u.availabilityStatus)}),console.log("All Promotions:",n.promotions)):console.error("Error fetching promotions:",null==o?void 0:o.error)}catch(t){console.error("Error in getAllPromotions:",t)}})()}get filteredPromotions(){return this.searchTerm?this.promotions.filter(n=>{var t;return null===(t=n.projectName)||void 0===t?void 0:t.toLowerCase().includes(this.searchTerm.toLowerCase())}):this.promotions}onSelectPromotion(n){this.selectPromotion.emit(n),this.selectedPromotion=n}}return(i=c).\u0275fac=function(n){return new(n||i)(e.rXU(F.i))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-promotion"]],outputs:{selectPromotion:"selectPromotion"},decls:19,vars:3,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","300px","margin-bottom","16px"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar promoci\xf3n...",3,"ngModelChange","ngModel"],[1,"promotions-table"],[1,"promotions-table-header"],[1,"promotions-table-header-title"],[1,"promotions-table-header-availability"],[1,"promotions-table-header-actions"],["class","promotions-table-row",4,"ngFor","ngForOf"],[1,"promotions-table-footer"],[1,"promotions-table-row"],[1,"promotions-table-row-title"],[1,"promotions-table-row-availability"],[1,"promotions-table-row-actions"],["disabled","",1,"crm-button"],[1,"crm-button"],["disabled","",1,"crm-button",3,"click"],[1,"crm-button",3,"click"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2," 1. Promoci\xf3n "),e.k0s(),e.j41(3,"div",2)(4,"div",3)(5,"div",4),e.nrm(6,"i",5),e.j41(7,"input",6),e.mxI("ngModelChange",function(r){return e.DH7(t.searchTerm,r)||(t.searchTerm=r),r}),e.k0s()()(),e.j41(8,"div",7)(9,"div",8)(10,"div",9),e.EFF(11,"Promoci\xf3n"),e.k0s(),e.j41(12,"div",10),e.EFF(13,"Viviendas disponibles"),e.k0s(),e.j41(14,"div",11),e.EFF(15,"Acciones"),e.k0s()(),e.DNE(16,E,8,4,"div",12),e.k0s(),e.j41(17,"div",13),e.EFF(18),e.k0s()()()),2&n&&(e.R7$(7),e.R50("ngModel",t.searchTerm),e.R7$(9),e.Y8G("ngForOf",t.filteredPromotions),e.R7$(2),e.SpI(" Total promociones: ",t.filteredPromotions.length," "))},dependencies:[d.Sq,s.me,s.BC,s.vS]}),c})();var G=p(7376),q=p(1296),U=p(6552),K=p(1880);function L(i,c){if(1&i){const a=e.RV6();e.qex(0),e.j41(1,"div",4),e.EFF(2),e.k0s(),e.j41(3,"app-table",5),e.bIt("rowClicked",function(t){e.eBV(a);const o=e.XpG();return e.Njj(o.onRowClicked(t))}),e.k0s(),e.nrm(4,"div",6),e.bVm()}if(2&i){const a=c.$implicit,n=c.index;e.R7$(2),e.SpI(" ",a.name||"Bloque "+(a.index||n+1)," "),e.R7$(),e.Y8G("table",a.tableConfig)}}let J=(()=>{var i;class c{constructor(n,t,o){this.tableService=n,this.utils=t,this.toastService=o,this.selectProperty=new e.bkB,this.blocks=[],this.allColumnsKeysSelected=["externalReference","reference","m2useful","m2total","terrace","plot","bedrooms","bathrooms","pool","storage","parking","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!1,editCellsMode:!1,columns:[{key:"externalReference",label:"Ref. externa",size:"medium",editMode:{inputType:"text"}},{key:"reference",label:"Identificador",size:"medium",editMode:{inputType:"text"}},{key:"m2useful",label:"M2 \xfatiles",size:"small",extraString:" m\xb2",fn:r=>null!=r&&r.totalMeasures_squareMetersUseful?r.totalMeasures_squareMetersUseful+" m\xb2":""},{key:"m2total",label:"M2 total",size:"small",extraString:" m\xb2",fn:r=>null!=r&&r.totalMeasures_squareMetersBuilt?r.totalMeasures_squareMetersBuilt+" m\xb2":""},{key:"terrace",label:"Terraza",size:"small",fn:r=>{const m=(r.totalMeasures_squareMetersCoveredTerraces||0)+(r.totalMeasures_squareMetersUncoveredTerraces||0);return m?m+" m\xb2":""}},{key:"plot",label:"Parcela",size:"small",extraString:" m\xb2",fn:r=>null!=r&&r.totalMeasures_squareMetersPatch?r.totalMeasures_squareMetersPatch+" m\xb2":""},{key:"bedrooms",label:"Dorm.",size:"small"},{key:"bathrooms",label:"Ba\xf1os",size:"small"},{key:"pool",label:"Piscina",size:"small",fn:r=>r.f_pool_comunitaria?"Comunitaria":r.f_pool_privada?"Privada":"No"},{key:"storage",label:"Trastero",size:"small",fn:r=>r.fcustom_trastero?r.fcustom_trasteroPrice?this.utils.transformThousandSeparator(r.fcustom_trasteroPrice)+" \u20ac":r.fcustom_trasteroIncludedInPrice?"Incluido":"S\xed":"No"},{key:"parking",label:"Parking",size:"small",fn:r=>{let l=r.fcustom_parking?"S\xed":"No";return r.fcustom_parkingPrice&&(l=this.utils.transformThousandSeparator(r.fcustom_parkingPrice)+" \u20ac"),r.fcustom_parkingIncludedInPrice&&(l="Incluido"),r.fcustom_parkingComunitario&&(l+=" (Comunitario)"),l}},{key:"price",label:"Precio",size:"small",fn:r=>null!=r&&r.price?this.utils.transformThousandSeparator(r.price)+" \u20ac":""}],rows:[]}}ngOnInit(){}set selectedPromotion(n){this.promotion=n,this.getData()}getData(){var n;if(this.promotion){this.allColumnsKeysSelected=(null===(n=this.promotion)||void 0===n?void 0:n.tableColumnsKeysSelected)||this.allColumnsKeysSelected,this.blocks=this.promotion.promotionBlocks||[];for(let t=0;t<this.blocks.length;t++){const o=this.blocks[t];!o.properties||0===o.properties.length||(o.tableConfig=G.cloneDeep(this.tableConfig),o.tableConfig.rows=this.tableService.convertDataToTableRows(G.cloneDeep(o.properties),G.cloneDeep(o.tableConfig)),o.tableConfig.rows=this.addBackgroundColorsToTableRows(o.tableConfig.rows))}}}addBackgroundColorsToTableRows(n){for(let t=0;t<n.length;t++)switch(n[t].rawObject.availabilityStatus){case"available":n[t].style={backgroundColor:"success"};break;case"sold":n[t].style={backgroundColor:"red"};break;case"reserved":n[t].style={backgroundColor:"warning"};break;default:n[t].style={backgroundColor:"blocked"}}return n}onRowClicked(n){const t=n.rawObject;console.log("Row clicked, property:",t),this.selectProperty.emit(t)}}return(i=c).\u0275fac=function(n){return new(n||i)(e.rXU(q.a),e.rXU(U.T),e.rXU(b.f))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-property"]],outputs:{selectProperty:"selectProperty"},decls:5,vars:1,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[4,"ngFor","ngForOf"],[1,"block-title"],[2,"margin-bottom","16px",3,"rowClicked","table"],[2,"margin-bottom","16px"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2," 2. Vivienda principal "),e.k0s(),e.j41(3,"div",2),e.DNE(4,L,5,2,"ng-container",3),e.k0s()()),2&n&&(e.R7$(4),e.Y8G("ngForOf",t.blocks))},dependencies:[d.Sq,K.O],styles:[".block-title[_ngcontent-%COMP%]{margin-bottom:16px;font-size:14px;font-weight:500}"]}),c})();var z=p(4558);function H(i,c){if(1&i&&(e.j41(0,"option",21),e.EFF(1),e.k0s()),2&i){const a=c.$implicit;e.Y8G("value",a),e.R7$(),e.JRh(a)}}function Z(i,c){if(1&i){const a=e.RV6();e.j41(0,"div",22),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.editingPrice=!0)}),e.EFF(1),e.nI1(2,"thousandSeparator"),e.nrm(3,"i",23),e.k0s()}if(2&i){const a=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,a.priceSelected.priceWithoutIva)," \u20ac ")}}function Q(i,c){if(1&i){const a=e.RV6();e.j41(0,"div",24)(1,"input",25),e.mxI("ngModelChange",function(t){e.eBV(a);const o=e.XpG();return e.DH7(o.priceSelected.priceWithoutIva,t)||(o.priceSelected.priceWithoutIva=t),e.Njj(t)}),e.k0s(),e.j41(2,"i",26),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.onPriceConfirm())}),e.k0s()()}if(2&i){const a=e.XpG();e.R7$(),e.R50("ngModel",a.priceSelected.priceWithoutIva)}}let ee=(()=>{var i;class c{constructor(){this.selectPrice=new e.bkB,this.priceSelected={priceWithoutIva:0,priceWithIva:0,finalPrice:0,iva:10},this.taxRates=["0%","10%","21%"],this.selectedTaxRate="10%",this.editingPrice=!1}set selectedProperty(n){this.property=n,this.priceSelected.priceWithoutIva=(null==n?void 0:n.price)||0,this.updateCalculations()}ngOnInit(){this.updateCalculations()}onTaxRateChange(){this.updateCalculations()}onPriceConfirm(){this.updateCalculations(),this.editingPrice=!1}updateCalculations(){const n=parseFloat(this.selectedTaxRate);this.priceSelected.iva=isNaN(n)?0:n,this.priceSelected.priceWithIva=this.priceSelected.priceWithoutIva*(this.priceSelected.iva/100),this.priceSelected.finalPrice=this.priceSelected.priceWithoutIva+this.priceSelected.priceWithIva}goNextSection(){this.selectPrice.emit(this.priceSelected),console.log("Go to the next section...")}}return(i=c).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-price"]],outputs:{selectPrice:"selectPrice"},decls:48,vars:17,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","200px","margin-bottom","24px"],[1,"crm-input-label"],[1,"crm-input-input","crm-input-input-searchbar-square"],[3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"title",2,"margin-bottom","8px"],[1,"price-table-header",2,"padding","0px 16px"],[1,"price-table-header-cell"],[1,"price-table"],[1,"price-table-row"],[1,"price-table-cell"],[1,"price-table-cell","editable-cell"],["class","editable-price-display",3,"click",4,"ngIf"],["class","editable-price-edit",4,"ngIf"],[1,"price-table-footer"],[1,"price-table-footer-cell"],[1,"crm-block-buttons-right",2,"margin-top","16px"],[1,"crm-button",3,"click"],[3,"value"],[1,"editable-price-display",3,"click"],[1,"fas","fa-pencil",2,"color","rgb(130, 130, 130)"],[1,"editable-price-edit"],["type","number",3,"ngModelChange","ngModel"],[1,"fas","fa-check",2,"color","rgb(11, 169, 11)",3,"click"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2," 3. Por precio "),e.k0s(),e.j41(3,"div",2)(4,"div",3)(5,"div",4),e.EFF(6," Impuestos IVA/IT "),e.k0s(),e.j41(7,"div",5)(8,"select",6),e.mxI("ngModelChange",function(r){return e.DH7(t.selectedTaxRate,r)||(t.selectedTaxRate=r),r}),e.bIt("change",function(){return t.onTaxRateChange()}),e.DNE(9,H,2,2,"option",7),e.k0s()()(),e.j41(10,"div",8),e.EFF(11," Tabla de precios "),e.k0s(),e.j41(12,"div",9)(13,"div",10),e.EFF(14,"Vivienda"),e.k0s(),e.j41(15,"div",10),e.EFF(16,"Precio"),e.k0s(),e.j41(17,"div",10),e.EFF(18,"IVA/ITP"),e.k0s(),e.j41(19,"div",10),e.EFF(20,"PVP"),e.k0s()(),e.j41(21,"div",11)(22,"div",12)(23,"div",13),e.EFF(24," 1A "),e.k0s(),e.j41(25,"div",14),e.DNE(26,Z,4,3,"div",15)(27,Q,3,1,"div",16),e.k0s(),e.j41(28,"div",13),e.EFF(29),e.k0s(),e.j41(30,"div",13),e.EFF(31),e.nI1(32,"thousandSeparator"),e.k0s()(),e.j41(33,"div",17)(34,"div",18),e.EFF(35," Total "),e.k0s(),e.j41(36,"div",18),e.EFF(37),e.nI1(38,"thousandSeparator"),e.k0s(),e.j41(39,"div",18),e.EFF(40),e.nI1(41,"thousandSeparator"),e.k0s(),e.j41(42,"div",18),e.EFF(43),e.nI1(44,"thousandSeparator"),e.k0s()()(),e.j41(45,"div",19)(46,"button",20),e.bIt("click",function(){return t.goNextSection()}),e.EFF(47," Ir a la siguiente secci\xf3n "),e.k0s()()()()),2&n&&(e.R7$(8),e.R50("ngModel",t.selectedTaxRate),e.R7$(),e.Y8G("ngForOf",t.taxRates),e.R7$(17),e.Y8G("ngIf",!t.editingPrice),e.R7$(),e.Y8G("ngIf",t.editingPrice),e.R7$(2),e.SpI(" ",t.selectedTaxRate," "),e.R7$(2),e.SpI(" ",e.bMT(32,9,t.priceSelected.finalPrice)," \u20ac "),e.R7$(6),e.SpI(" ",e.bMT(38,11,t.priceSelected.priceWithoutIva)," \u20ac "),e.R7$(3),e.SpI(" ",e.bMT(41,13,t.priceSelected.priceWithIva)," \u20ac "),e.R7$(3),e.SpI(" ",e.bMT(44,15,t.priceSelected.finalPrice)," \u20ac "))},dependencies:[d.Sq,d.bT,s.xH,s.y7,s.me,s.Q0,s.wz,s.BC,s.vS,z.w],styles:[".venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .crm-input[_ngcontent-%COMP%]{margin-bottom:16px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]   .price-table-header-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]{border-radius:12px;padding:0 16px;background:#f9f9f9}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 0;border-bottom:1px solid var(--crm-border-light-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{font-weight:500;border:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-cell[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-cell[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]{display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:120px;background:#fff;outline:none;border:1px solid var(--crm-border-light-color);border-radius:8px;padding:4px 8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--crm-text-color);cursor:pointer}"]}),c})();const te=i=>({"text-error":i}),ne=i=>({"border-error":i});let oe=(()=>{var i;class c{constructor(){this.selectDocumentData=new e.bkB,this.reservationAmountError=!1,this.formData={contractType:"propio",signatureType:"papel",reservationAmount:null}}ngOnInit(){}onContinue(){console.log("Form data:",this.formData),this.reservationAmountError=!1,this.formData.reservationAmount?this.selectDocumentData.emit(this.formData):this.reservationAmountError=!0}}return(i=c).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-document"]],outputs:{selectDocumentData:"selectDocumentData"},decls:44,vars:9,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"margin-bottom","16px"],[1,"crm-text"],[3,"ngModelChange","ngModel"],[1,"crm-input-radio"],["value","byvaro"],[1,"crm-input-radio-label"],["value","propio"],[2,"border","none","border-bottom","1px solid #e5e5e5","margin","24px 0"],["value","electronica"],["value","papel"],[1,"title","mb8"],[1,"crm-text","small","light","mb16"],[1,"crm-input",2,"margin-bottom","24px","max-width","300px"],[1,"crm-input-label",3,"ngClass"],[1,"crm-input-input",3,"ngClass"],["type","number","placeholder","Por ejemplo 3000\u20ac",3,"ngModelChange","ngModel"],[1,"crm-block-buttons-right"],[1,"crm-button",3,"click"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2," 4. Documento de reserva "),e.k0s(),e.j41(3,"div",2)(4,"div",3)(5,"div",4),e.EFF(6," Redacci\xf3n del contrato: "),e.k0s(),e.j41(7,"ion-radio-group",5),e.mxI("ngModelChange",function(r){return e.DH7(t.formData.contractType,r)||(t.formData.contractType=r),r}),e.j41(8,"div",6),e.nrm(9,"ion-radio",7),e.j41(10,"div",8),e.EFF(11," Contrato redactado en Byvaro "),e.k0s()(),e.j41(12,"div",6),e.nrm(13,"ion-radio",9),e.j41(14,"div",8),e.EFF(15," Contrato propio "),e.k0s()()()(),e.nrm(16,"hr",10),e.j41(17,"div",3)(18,"div",4),e.EFF(19," T\xe9rminos y condiciones de la firma: "),e.k0s(),e.j41(20,"ion-radio-group",5),e.mxI("ngModelChange",function(r){return e.DH7(t.formData.signatureType,r)||(t.formData.signatureType=r),r}),e.j41(21,"div",6),e.nrm(22,"ion-radio",11),e.j41(23,"div",8),e.EFF(24," Firma electr\xf3nica "),e.k0s()(),e.j41(25,"div",6),e.nrm(26,"ion-radio",12),e.j41(27,"div",8),e.EFF(28," Firma en papel "),e.k0s()()()(),e.nrm(29,"hr",10),e.j41(30,"div",13),e.EFF(31," Cantidad que debe pagar el cliente para reservar: "),e.k0s(),e.j41(32,"div",14),e.EFF(33," Este campo puede heredar autom\xe1ticamente el valor definido en la configuraci\xf3n de la promoci\xf3n."),e.nrm(34,"br"),e.EFF(35," Por favor, rev\xedsalo antes de continuar. "),e.k0s(),e.j41(36,"div",15)(37,"div",16),e.EFF(38," Cantidad de reserva (\u20ac) "),e.k0s(),e.j41(39,"div",17)(40,"input",18),e.mxI("ngModelChange",function(r){return e.DH7(t.formData.reservationAmount,r)||(t.formData.reservationAmount=r),r}),e.k0s()()(),e.j41(41,"div",19)(42,"button",20),e.bIt("click",function(){return t.onContinue()}),e.EFF(43," Continuar la reserva "),e.k0s()()()()),2&n&&(e.R7$(7),e.R50("ngModel",t.formData.contractType),e.R7$(13),e.R50("ngModel",t.formData.signatureType),e.R7$(17),e.Y8G("ngClass",e.eq3(5,te,t.reservationAmountError)),e.R7$(2),e.Y8G("ngClass",e.eq3(7,ne,t.reservationAmountError)),e.R7$(),e.R50("ngModel",t.formData.reservationAmount))},dependencies:[d.YU,s.me,s.Q0,s.BC,s.vS,g.KO,g.f0,g.Je],styles:[".crm-text[_ngcontent-%COMP%]{font-style:normal;margin-bottom:8px}.crm-input-radio[_ngcontent-%COMP%]{margin-bottom:8px}ion-radio-group[_ngcontent-%COMP%]{display:flex;gap:16px}.mb8[_ngcontent-%COMP%]{margin-bottom:8px}.mb16[_ngcontent-%COMP%]{margin-bottom:16px}"]}),c})();var N=p(6906),ie=p(6968),re=p(1129);const I=i=>({"crm-input-input-error":i});function ae(i,c){1&i&&(e.j41(0,"div",39),e.EFF(1," Por favor, introduce un correo electr\xf3nico v\xe1lido "),e.k0s())}function le(i,c){if(1&i&&(e.j41(0,"option",42),e.EFF(1),e.k0s()),2&i){const a=c.$implicit;e.FS9("value",a.key),e.R7$(),e.JRh(a.label)}}function ce(i,c){if(1&i&&(e.j41(0,"div",8)(1,"div",3),e.EFF(2," Role "),e.k0s(),e.j41(3,"div",15)(4,"select",40)(5,"option",41),e.EFF(6,"Selecciona un origen"),e.k0s(),e.Z7z(7,le,2,2,"option",42,e.fX1),e.k0s()()()),2&i){const a=e.XpG();e.R7$(5),e.Y8G("value",null),e.R7$(2),e.Dyx(a.responsibilityOptions)}}function se(i,c){1&i&&(e.j41(0,"div",39),e.EFF(1," El nombre es requerido "),e.k0s())}function de(i,c){1&i&&(e.j41(0,"div",39),e.EFF(1," La fecha de nacimiento es requerida "),e.k0s())}function pe(i,c){1&i&&(e.j41(0,"div",39),e.EFF(1," Error "),e.k0s())}function ue(i,c){if(1&i&&(e.j41(0,"div",8)(1,"div",3),e.EFF(2," Nombre de la empresa "),e.k0s(),e.j41(3,"div",4),e.nrm(4,"input",43),e.k0s(),e.DNE(5,pe,2,0,"div",6),e.k0s()),2&i){const a=e.XpG();e.R7$(3),e.Y8G("ngClass",e.eq3(2,I,a.isControlInvalid("participationPercentage"))),e.R7$(2),e.Y8G("ngIf",a.isControlInvalid("participationPercentage"))}}function me(i,c){1&i&&(e.j41(0,"div",39),e.EFF(1," El DNI o Pasaporte es requerido "),e.k0s())}function _e(i,c){1&i&&(e.j41(0,"div",39),e.EFF(1," El n\xfamero de tel\xe9fono es requerido "),e.k0s())}function ve(i,c){1&i&&(e.j41(0,"div",10),e.nrm(1,"ion-radio",44),e.j41(2,"div",21),e.EFF(3," Gananciales "),e.k0s()(),e.j41(4,"div",22),e.nrm(5,"ion-radio",45),e.j41(6,"div",21),e.EFF(7," Separacion de bienes "),e.k0s()())}function ge(i,c){1&i&&(e.j41(0,"div",10),e.nrm(1,"ion-radio",46),e.j41(2,"div",21),e.EFF(3," Soltera "),e.k0s()(),e.j41(4,"div",22),e.nrm(5,"ion-radio",47),e.j41(6,"div",21),e.EFF(7," Separada "),e.k0s()(),e.j41(8,"div",22),e.nrm(9,"ion-radio",48),e.j41(10,"div",21),e.EFF(11," Divorciada "),e.k0s()(),e.j41(12,"div",22),e.nrm(13,"ion-radio",49),e.j41(14,"div",21),e.EFF(15," Viuda "),e.k0s()(),e.j41(16,"div",22),e.nrm(17,"ion-radio",50),e.j41(18,"div",21),e.EFF(19," Pareja de hecho "),e.k0s()())}let Ce=(()=>{var i;class c{constructor(){this.responsibilityOptions=N.Rl}ngOnInit(){}isControlInvalid(n){const t=this.form.get(n);return!(!t||!t.invalid||!t.dirty&&!t.touched)}onSelectCountry(n){}onNextStep(){}onChangeMaritalType(n){var t;null===(t=this.form.get("civilType"))||void 0===t||t.setValue(n)}}return(i=c).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-person-form"]],inputs:{form:"form",hasParentContact:"hasParentContact"},decls:96,vars:22,consts:[["addressInput",""],[3,"ngSubmit","formGroup"],[1,"crm-input",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","placeholder","Field","formControlName","email"],["class","crm-input-error",4,"ngIf"],[1,"crm-text","small","light","mb-15"],[1,"crm-input","mb-15"],["formControlName","gender",1,"d-flex","gap-16"],[1,"crm-input-radio"],["value","male"],[1,"crm-input-radio-label"],["value","female"],["type","text","placeholder","ex: Juan","formControlName","name"],[1,"crm-input-input"],["type","date","formControlName","birthDate"],[1,"crm-input",2,"margin-bottom","16px"],["type","text","formControlName","address","placeholder","Escribe la direcci\xf3n"],["formControlName","identityType",1,"gap-16"],["value","dni"],[1,"crm-input-radio-label","text-secondary"],[1,"crm-input-radio","mt-10"],["value","nif"],["value","nie"],["value","passport"],["value","identityCard"],[1,"crm-input-input","mt-10",3,"ngClass"],["type","text","placeholder","ex: 48500285A","formControlName","identityNumber"],[1,"crm-input"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected","selectedPhoneNumber"],["type","text","placeholder","N\xfamero de tel\xe9fono","formControlName","phoneNumber"],[1,"crm-text","small","light",2,"margin-bottom","8px"],["formControlName","civilType",1,"d-flex","gap-16"],[1,"crm-input-radio",3,"click"],["value","married"],["value","other"],["formControlName","civilStatus",1,"gap-16"],[1,"crm-input-error"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],["type","number","formControlName","participationPercentage","placeholder","%"],["value","communityProperty"],["value","separateProperty"],["value","single"],["value","separated"],["value","divorced"],["value","widowed"],["value","civilUnion"]],template:function(n,t){if(1&n){const o=e.RV6();e.j41(0,"form",1),e.bIt("ngSubmit",function(){return e.eBV(o),e.Njj(t.onNextStep())}),e.j41(1,"div",2)(2,"div",3),e.EFF(3," Correo electr\xf3nico "),e.k0s(),e.j41(4,"div",4),e.nrm(5,"input",5),e.k0s(),e.DNE(6,ae,2,0,"div",6),e.k0s(),e.j41(7,"div",7),e.EFF(8," Por favor, compruebe que la direcci\xf3n de correo electr\xf3nico ingresada es correcta. "),e.k0s(),e.DNE(9,ce,9,1,"div",8),e.j41(10,"div",8)(11,"ion-radio-group",9)(12,"div",10),e.nrm(13,"ion-radio",11),e.j41(14,"div",12),e.EFF(15," Don "),e.k0s()(),e.j41(16,"div",10),e.nrm(17,"ion-radio",13),e.j41(18,"div",12),e.EFF(19," Do\xf1a "),e.k0s()()()(),e.j41(20,"div",8)(21,"div",3),e.EFF(22," Nombre y apellidos "),e.k0s(),e.j41(23,"div",4),e.nrm(24,"input",14),e.k0s(),e.DNE(25,se,2,0,"div",6),e.k0s(),e.j41(26,"div",8)(27,"div",3),e.EFF(28," Fecha de nacimiento "),e.k0s(),e.j41(29,"div",15),e.nrm(30,"input",16),e.k0s(),e.DNE(31,de,2,0,"div",6),e.k0s(),e.DNE(32,ue,6,4,"div",8),e.j41(33,"div",17)(34,"div",3),e.EFF(35," Direcci\xf3n "),e.k0s(),e.j41(36,"div",15),e.nrm(37,"input",18,0),e.k0s()(),e.j41(39,"div",8)(40,"div",3),e.EFF(41," Identificaci\xf3n "),e.k0s(),e.j41(42,"ion-radio-group",19)(43,"div",10),e.nrm(44,"ion-radio",20),e.j41(45,"div",21),e.EFF(46," DNI "),e.k0s()(),e.j41(47,"div",22),e.nrm(48,"ion-radio",23),e.j41(49,"div",21),e.EFF(50," NIF "),e.k0s()(),e.j41(51,"div",22),e.nrm(52,"ion-radio",24),e.j41(53,"div",21),e.EFF(54," NIE "),e.k0s()(),e.j41(55,"div",22),e.nrm(56,"ion-radio",25),e.j41(57,"div",21),e.EFF(58," Pasaporte "),e.k0s()(),e.j41(59,"div",22),e.nrm(60,"ion-radio",26),e.j41(61,"div",21),e.EFF(62," Carta de identidad "),e.k0s()()(),e.j41(63,"div",27),e.nrm(64,"input",28),e.k0s(),e.DNE(65,me,2,0,"div",6),e.k0s(),e.j41(66,"div",29)(67,"div",3),e.EFF(68," Phone number "),e.k0s(),e.j41(69,"div",30)(70,"div",4)(71,"app-flag-country-selector",31),e.bIt("emitCountrySelected",function(l){return e.eBV(o),e.Njj(t.onSelectCountry(l))}),e.k0s(),e.nrm(72,"input",32),e.k0s()(),e.DNE(73,_e,2,0,"div",6),e.j41(74,"div",33),e.EFF(75," Por favor, compruebe que el n\xfamero de tel\xe9fono m\xf3vil ingresado es correcto. Ser\xe1 utilizado para la firma electr\xf3nica."),e.nrm(76,"br")(77,"br"),e.k0s()(),e.j41(78,"div",8)(79,"div",3),e.EFF(80," Estado civil "),e.k0s(),e.j41(81,"ion-radio-group",34)(82,"div",35),e.bIt("click",function(){return e.eBV(o),e.Njj(t.onChangeMaritalType("married"))}),e.nrm(83,"ion-radio",36),e.j41(84,"div",12),e.EFF(85," Casada "),e.k0s()(),e.j41(86,"div",35),e.bIt("click",function(){return e.eBV(o),e.Njj(t.onChangeMaritalType("other"))}),e.nrm(87,"ion-radio",37),e.j41(88,"div",12),e.EFF(89," Otro "),e.k0s()()()(),e.j41(90,"div",17)(91,"div",3),e.EFF(92," Precise "),e.k0s(),e.j41(93,"ion-radio-group",38),e.DNE(94,ve,8,0)(95,ge,20,0),e.k0s()()()}if(2&n){let o,r;e.Y8G("formGroup",t.form),e.R7$(4),e.Y8G("ngClass",e.eq3(14,I,t.isControlInvalid("email"))),e.R7$(2),e.Y8G("ngIf",t.isControlInvalid("email")),e.R7$(3),e.vxM(t.hasParentContact?9:-1),e.R7$(14),e.Y8G("ngClass",e.eq3(16,I,t.isControlInvalid("name"))),e.R7$(2),e.Y8G("ngIf",t.isControlInvalid("name")),e.R7$(6),e.Y8G("ngIf",t.isControlInvalid("birthDate")),e.R7$(),e.vxM(t.hasParentContact?-1:32),e.R7$(31),e.Y8G("ngClass",e.eq3(18,I,t.isControlInvalid("identityNumber"))),e.R7$(2),e.Y8G("ngIf",t.isControlInvalid("identityNumber")),e.R7$(5),e.Y8G("ngClass",e.eq3(20,I,t.isControlInvalid("phoneNumber"))),e.R7$(),e.Y8G("selectedPhoneNumber",null==(o=t.form.get("phoneNumber"))?null:o.value),e.R7$(2),e.Y8G("ngIf",t.isControlInvalid("phoneNumber")),e.R7$(21),e.vxM("married"===(null==(r=t.form.get("civilType"))?null:r.value)?94:95)}},dependencies:[d.YU,d.bT,s.qT,s.xH,s.y7,s.me,s.Q0,s.wz,s.BC,s.cb,g.KO,g.f0,g.Je,s.j4,s.JD,re.Z]}),c})();const fe=["addressInput"],W=i=>({"background-color":i}),D=i=>({"crm-input-input-error":i});function he(i,c){if(1&i&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&i){let a;const n=e.XpG(2).$implicit;e.R7$(),e.JRh(null==(a=n.get("name"))?null:a.value)}}function Pe(i,c){1&i&&e.nrm(0,"img",5),2&i&&e.Y8G("src","assets/icon/chevron-down-icon.svg",e.B4B)}function ye(i,c){1&i&&e.nrm(0,"img",5),2&i&&e.Y8G("src","assets/icon/chevron-up-icon.svg",e.B4B)}function be(i,c){if(1&i){const a=e.RV6();e.j41(0,"div"),e.nrm(1,"app-person-form",18),e.j41(2,"div",19)(3,"button",20),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG();return e.Njj(o.onSaveContact(t))}),e.EFF(4," Guardar "),e.k0s(),e.j41(5,"div",21)(6,"div",22)(7,"div",23),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG();return e.Njj(o.removePerson(t))}),e.nrm(8,"img",24),e.j41(9,"span",25),e.EFF(10,"Eliminar"),e.k0s()()()()()()}if(2&i){const a=e.XpG(2).index,n=e.XpG();e.R7$(),e.Y8G("hasParentContact",!1)("form",n.getContactForm(a)),e.R7$(7),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B)}}function Fe(i,c){if(1&i){const a=e.RV6();e.j41(0,"div",13)(1,"div",14)(2,"div"),e.EFF(3),e.k0s(),e.DNE(4,he,2,1,"div",15),e.k0s(),e.j41(5,"div",16),e.bIt("click",function(){e.eBV(a);const t=e.XpG().index,o=e.XpG();return e.Njj(o.togglePersonForm(t))}),e.DNE(6,Pe,1,1,"img",5)(7,ye,1,1,"img",5),e.k0s()(),e.DNE(8,be,11,3,"div",17)}if(2&i){let a,n,t;const o=e.XpG(),r=o.$implicit,l=o.index;e.R7$(3),e.SpI(" Comprador ",l+1,""),e.R7$(),e.vxM(null!=(a=r.get("showForm"))&&a.value?-1:4),e.R7$(2),e.vxM(null!=(n=r.get("showForm"))&&n.value?6:7),e.R7$(2),e.Y8G("ngIf",null==(t=r.get("showForm"))?null:t.value)}}function ke(i,c){if(1&i&&(e.j41(0,"option",46),e.EFF(1),e.k0s()),2&i){const a=c.$implicit;e.FS9("value",a.key),e.R7$(),e.JRh(a.label)}}function xe(i,c){if(1&i&&(e.j41(0,"div",41)(1,"div",42)(2,"div",30),e.EFF(3," Role "),e.k0s(),e.j41(4,"div",43)(5,"select",44)(6,"option",45),e.EFF(7,"Selecciona un origen"),e.k0s(),e.Z7z(8,ke,2,2,"option",46,e.fX1),e.k0s()()()()),2&i){const a=e.XpG().index,n=e.XpG(3).index,t=e.XpG();e.Y8G("formGroup",t.getCompanyPersonForm(n,a)),e.R7$(6),e.Y8G("value",null),e.R7$(2),e.Dyx(t.responsibilityOptions)}}function je(i,c){if(1&i&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&i){let a;const n=e.XpG(2).index,t=e.XpG(3).index,o=e.XpG();e.R7$(),e.JRh(null==(a=o.getCompanyPersonForm(t,n).get("name"))?null:a.value)}}function Se(i,c){if(1&i){const a=e.RV6();e.j41(0,"img",50),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG(3).index,r=e.XpG();return e.Njj(r.toggleCompanyPersonForm(o,t))}),e.k0s()}2&i&&e.Y8G("src","assets/icon/chevron-down-icon.svg",e.B4B)}function Me(i,c){if(1&i){const a=e.RV6();e.j41(0,"img",50),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG(3).index,r=e.XpG();return e.Njj(r.toggleCompanyPersonForm(o,t))}),e.k0s()}2&i&&e.Y8G("src","assets/icon/chevron-up-icon.svg",e.B4B)}function Oe(i,c){if(1&i){const a=e.RV6();e.nrm(0,"app-person-form",18),e.j41(1,"div",19)(2,"button",51),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG(3).index,r=e.XpG();return e.Njj(r.onSaveChildContact(o,t))}),e.EFF(3," Guardar "),e.k0s(),e.j41(4,"div",21)(5,"div",22)(6,"div",52),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG(3).index,r=e.XpG();return e.Njj(r.removePersonFromCompany(o,t))}),e.nrm(7,"img",53),e.j41(8,"span",25),e.EFF(9,"Eliminar"),e.k0s()()()()()}if(2&i){const a=e.XpG(2).index,n=e.XpG(3).index,t=e.XpG();e.Y8G("hasParentContact",!0)("form",t.getCompanyPersonForm(n,a)),e.R7$(7),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B)}}function Ee(i,c){if(1&i&&(e.j41(0,"div")(1,"div",47)(2,"div")(3,"div"),e.EFF(4),e.k0s(),e.DNE(5,je,2,1,"div",15),e.k0s(),e.j41(6,"div",48),e.DNE(7,Se,1,1,"img",49)(8,Me,1,1,"img",49),e.k0s()(),e.DNE(9,Oe,10,3),e.k0s()),2&i){let a,n,t,o;const r=e.XpG(),l=r.$implicit,u=r.index,m=e.XpG(3).index,v=e.XpG();e.R7$(4),e.JRh(v.responsibilityOptionsObj[null==(a=v.getCompanyPersonForm(m,u).get("role"))?null:a.value]),e.R7$(),e.vxM(null!=(n=l.get("showForm"))&&n.value?-1:5),e.R7$(2),e.vxM(null!=(t=l.get("showForm"))&&t.value?7:8),e.R7$(2),e.vxM(null!=(o=l.get("showForm"))&&o.value?9:-1)}}function Te(i,c){if(1&i&&(e.j41(0,"div")(1,"div",39),e.DNE(2,xe,10,2,"div",40)(3,Ee,10,4,"div",17),e.k0s()()),2&i){let a,n;const t=c.index,o=e.XpG(3).index,r=e.XpG();e.R7$(2),e.Y8G("ngIf",!(null!=(a=r.getCompanyPersonForm(o,t).get("role"))&&a.value)),e.R7$(),e.Y8G("ngIf",null==(n=r.getCompanyPersonForm(o,t).get("role"))?null:n.value)}}function Ie(i,c){if(1&i){const a=e.RV6();e.j41(0,"div")(1,"form",28)(2,"div",13)(3,"div",29)(4,"div",30),e.EFF(5," Nombre de la empresa "),e.k0s(),e.j41(6,"div",31),e.nrm(7,"input",32),e.k0s()(),e.j41(8,"div",33)(9,"div",30),e.EFF(10," Direcci\xf3n "),e.k0s(),e.j41(11,"div",31),e.nrm(12,"input",34),e.k0s()()(),e.j41(13,"div",13)(14,"div",29)(15,"div",30),e.EFF(16," CIF "),e.k0s(),e.j41(17,"div",31),e.nrm(18,"input",35),e.k0s()(),e.j41(19,"div",33)(20,"div",30),e.EFF(21," Porcentaje de participaci\xf3n "),e.k0s(),e.j41(22,"div",31),e.nrm(23,"input",36),e.k0s()()(),e.DNE(24,Te,4,2,"div",37),e.j41(25,"div",38)(26,"button",4),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG();return e.Njj(o.addPersonToCompany(t))}),e.nrm(27,"img",5),e.EFF(28," A\xf1adir persona responsable "),e.k0s()()()()}if(2&i){let a;const n=e.XpG(2).index,t=e.XpG();e.R7$(),e.Y8G("formGroup",t.getContactForm(n)),e.R7$(5),e.Y8G("ngClass",e.eq3(7,D,t.isControlInvalid(t.getContactForm(n),"name"))),e.R7$(5),e.Y8G("ngClass",e.eq3(9,D,t.isControlInvalid(t.getContactForm(n),"address"))),e.R7$(6),e.Y8G("ngClass",e.eq3(11,D,t.isControlInvalid(t.getContactForm(n),"identityNumber"))),e.R7$(5),e.Y8G("ngClass",e.eq3(13,D,t.isControlInvalid(t.getContactForm(n),"participationPercentage"))),e.R7$(2),e.Y8G("ngForOf",null==(a=t.getPersons(n))?null:a.controls),e.R7$(3),e.Y8G("src","assets/icon/plus-icon.svg",e.B4B)}}function Ve(i,c){if(1&i){const a=e.RV6();e.j41(0,"div",13)(1,"div",26),e.EFF(2),e.k0s(),e.j41(3,"div")(4,"img",27),e.bIt("click",function(){e.eBV(a);const t=e.XpG().index,o=e.XpG();return e.Njj(o.removeCompany(t))}),e.k0s()()(),e.DNE(5,Ie,29,15,"div",17)}if(2&i){let a;const n=e.XpG(),t=n.$implicit,o=n.index;e.R7$(2),e.SpI("Comprador ",o+1,""),e.R7$(2),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B),e.R7$(),e.Y8G("ngIf",null==(a=t.get("showForm"))?null:a.value)}}function De(i,c){if(1&i){const a=e.RV6();e.j41(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12),e.bIt("click",function(){const t=e.eBV(a).index,o=e.XpG();return e.Njj(o.onChangePersonType(t,"particular"))}),e.EFF(4," Personas f\xedsicas "),e.k0s(),e.j41(5,"div",12),e.bIt("click",function(){const t=e.eBV(a).index,o=e.XpG();return e.Njj(o.onChangePersonType(t,"empresa"))}),e.EFF(6," Persona jur\xeddica "),e.k0s()()(),e.DNE(7,Fe,9,4)(8,Ve,6,3),e.k0s()}if(2&i){let a,n,t;const o=c.$implicit;e.R7$(3),e.Y8G("ngStyle",e.eq3(3,W,"particular"===(null==(a=o.get("type"))?null:a.value)?"#ECF2FF":"")),e.R7$(2),e.Y8G("ngStyle",e.eq3(5,W,"empresa"===(null==(n=o.get("type"))?null:n.value)?"#ECF2FF":"")),e.R7$(2),e.vxM("particular"===(null==(t=o.get("type"))?null:t.value)?7:8)}}let Re=(()=>{var i;class c{constructor(n,t,o,r,l,u){this.fb=n,this.ngZone=t,this.api=o,this.utils=r,this.modalsService=l,this.toastService=u,this.selectContactData=new e.bkB,this.mapCenter={lat:40.416775,lng:-3.70379},this.mapZoom=6,this.markerPosition=this.mapCenter,this.mapOptions={disableDefaultUI:!1,styles:[{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]}]},this.markerOptions={draggable:!0},this.disabled=!0,this.showForms=[],this.FormGroup=s.gE,this.responsibilityOptions=N.Rl,this.responsibilityOptionsObj=N.qA;const m=this.createContactForm(!1,"particular");this.contactFormArray=this.fb.array([m])}ngOnInit(){}set contactData(n){this.contact=n,this.contact&&!this.contacts.length&&this.patchContactData(0,this.contact)}set operationData(n){this.operation=n}set reservedContacts(n){this.contacts=n;const t=this.extractRelatedContactIds(this.contacts);let o=0;this.contacts.forEach(r=>{r.type=r.contactType,t.includes(r.id)||(this.patchContactData(o,r,!1),o++)})}extractRelatedContactIds(n){const t=[];for(const o of n.filter(r=>"empresa"===r.contactType))for(const r of o.contactsRelation||[])t.push(r.contactRelatedId);return t}patchContactData(n,t,o=!1){var r,l;let u=this.utils.parseBackendDateToFrontendDateInput(null==t?void 0:t.birthdate),m={id:t.id||null,email:(null===(r=t.emails)||void 0===r?void 0:r[0])||"",name:t.name||"",birthDate:u||"",phoneNumber:(null===(l=t.phones)||void 0===l?void 0:l[0])||"+34 ",address:t.address||"",gender:t.gender||"male",type:t.type||"particular",role:"sole_administrator",identityType:t.typeOfIdentification,identityNumber:t.dniPassport,civilStatus:t.civilStatus,civilType:["communityProperty","separateProperty"].includes(t.civilStatus)?"married":"other",showForm:!0,uniqId:n},v=this.getContactForm(n);if(o){let P=this.createContactForm(o,"particular");P.patchValue(m),v.get("persons").push(P)}else{var x;null!==(x=this.operation)&&void 0!==x&&x.buyersContactsPercentages&&this.operation.buyersContactsPercentages[t.id]&&(m.participationPercentage=this.operation.buyersContactsPercentages[t.id].percentage),v||(v=this.createContactForm(o,m.type)),v.patchValue(m)}if(this.contactFormArray.setControl(n,v),"empresa"===t.type)for(const P of t.contactsRelation||[]){const y=this.contacts.find(h=>h.id===P.contactRelatedId);y&&this.patchContactData(n,y,!0)}}createContactForm(n=!1,t){var o,r;const l=this.fb.group({type:[t],showForm:[!0],name:[""],email:[""],phoneNumber:["+34 "],birthDate:[""],identityNumber:[""],identityType:["dni"],address:[""],role:[""],id:[null],parentContact:[null],gender:["male"],civilStatus:["communityProperty"],civilType:["married"],participationPercentage:["",[s.k0.min(1),s.k0.max(100)]],formId:[""],persons:this.fb.array([])});return this.applyConditionalValidators(n,l,t),null===(o=l.get("type"))||void 0===o||o.valueChanges.subscribe(u=>{this.applyConditionalValidators(n,l,u)}),null===(r=l.get("participationPercentage"))||void 0===r||r.valueChanges.subscribe(u=>{this.onParticipationPercentageChanged(u,l)}),l}onParticipationPercentageChanged(n,t){var o;let r=null===(o=t.get("formId"))||void 0===o?void 0:o.value;const u=100-this.contactFormArray.controls.reduce((P,y)=>{var h;return y.value.formId!==r?P+parseFloat((null===(h=y.get("participationPercentage"))||void 0===h?void 0:h.value)||"0"):P},0);var v;parseFloat(n||"0")>u&&(null===(v=t.get("participationPercentage"))||void 0===v||v.setValue(u,{emitEvent:!1}));const x=this.contactFormArray.controls.reduce((P,y)=>{var h;return P+parseFloat((null===(h=y.get("participationPercentage"))||void 0===h?void 0:h.value)||"0")},0);this.disabled=100!==x}applyConditionalValidators(n=!1,t,o){var r,l,u,m,v,x,P,y,h,S,M,O;if(null===(r=t.get("email"))||void 0===r||r.clearValidators(),null===(l=t.get("phoneNumber"))||void 0===l||l.clearValidators(),null===(u=t.get("birthDate"))||void 0===u||u.clearValidators(),null===(m=t.get("identityNumber"))||void 0===m||m.clearValidators(),null===(v=t.get("address"))||void 0===v||v.clearValidators(),"particular"!==o||n){if("particular"===o&&n){var w,B,A,X;null===(w=t.get("email"))||void 0===w||w.setValidators([s.k0.required,s.k0.email]),null===(B=t.get("phoneNumber"))||void 0===B||B.setValidators([s.k0.required]),null===(A=t.get("birthDate"))||void 0===A||A.setValidators([s.k0.required]),null===(X=t.get("identityNumber"))||void 0===X||X.setValidators([s.k0.required])}else if("empresa"===o){var $,Y;null===($=t.get("cif"))||void 0===$||$.setValidators([s.k0.required]),null===(Y=t.get("participationPercentage"))||void 0===Y||Y.setValidators([s.k0.required,s.k0.min(1),s.k0.max(100)])}}else null===(y=t.get("email"))||void 0===y||y.setValidators([s.k0.required,s.k0.email]),null===(h=t.get("phoneNumber"))||void 0===h||h.setValidators([s.k0.required]),null===(S=t.get("birthDate"))||void 0===S||S.setValidators([s.k0.required]),null===(M=t.get("identityNumber"))||void 0===M||M.setValidators([s.k0.required]),null===(O=t.get("participationPercentage"))||void 0===O||O.setValidators([s.k0.required,s.k0.min(1),s.k0.max(100)]);null===(x=t.get("name"))||void 0===x||x.setValidators([s.k0.required]),null===(P=t.get("identityNumber"))||void 0===P||P.setValidators([s.k0.required])}removeCompany(n){this.getPersons(n),this.contactFormArray.removeAt(n)}getContactForm(n){return this.contactFormArray.at(n)}getPersons(n){return this.getContactForm(n).get("persons")}getCompanyPersonForm(n,t){return this.getPersons(n).at(t)}addPersonToCompany(n){this.getPersons(n).push(this.createContactForm(!0,"particular"))}removePersonFromCompany(n,t){var o=this;return(0,f.A)(function*(){let r=o.getCompanyPersonForm(n,t),l=o.getContactForm(n);if(r.value.id&&l.value.id){const v=yield o.modalsService.openConfirmationModal({title:"Eliminar contactos",message:"\xbfEst\xe1s seguro de que deseas eliminar los contactos seleccionados?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]});var u,m;"delete"===(null==v?void 0:v.data)&&(o.getPersons(n).removeAt(t),yield o.api.unlinkReserveContactToOperation(null===(u=o.operation)||void 0===u?void 0:u.id,r.value.id),yield o.api.removeContactRelation(r.value.id,null===(m=l.value)||void 0===m?void 0:m.id))}else o.getPersons(n).removeAt(t)})()}toggleCompanyPersonForm(n,t){var o;const r=this.getCompanyPersonForm(n,t);r.patchValue({showForm:!(null!==(o=r.get("showForm"))&&void 0!==o&&o.value)})}toggleCompanyForm(n){var t;const o=this.getContactForm(n);o.patchValue({showForm:!(null!==(t=o.get("showForm"))&&void 0!==t&&t.value)})}addNewForm(){this.contactFormArray.push(this.createContactForm(!1,"particular"))}ngAfterViewInit(){this.addressInput&&(this.autocomplete=new google.maps.places.Autocomplete(this.addressInput.nativeElement,{types:["geocode"],componentRestrictions:{country:"es"}}),this.autocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{const t=this.autocomplete.getPlace();if(!t.geometry)return;this.mapCenter={lat:t.geometry.location.lat(),lng:t.geometry.location.lng()},this.markerPosition=this.mapCenter,this.mapZoom=17;const o=t.formatted_address||t.name||"";this.contactForm.patchValue({address:o}),this.addressInput.nativeElement.value=o})}))}isControlInvalid(n,t){const o=n.get(t);return!(!o||!o.invalid||!o.dirty&&!o.touched)}onSelectCountry(n){console.log("Selected country prefix:",n);const t=null==n?void 0:n.phoneCode,o=this.contactForm.get("phoneNumber");if(!o)return;const l=(o.value||"").split(" ");l.shift();const u=l.join(" ");o.setValue(`${t} ${u}`)}onAddressSelected(n){console.log("Address selected:",n),this.contactForm.patchValue({address:(null==n?void 0:n.formatted_address)||(null==n?void 0:n.address)||""})}getAddressFromCoordinates(n,t){(new google.maps.Geocoder).geocode({location:{lat:n,lng:t}},(r,l)=>{"OK"===l&&r&&r[0]&&this.ngZone.run(()=>{const u=r[0].formatted_address;this.contactForm.patchValue({address:u}),this.addressInput&&(this.addressInput.nativeElement.value=u),this.markerPosition={lat:n,lng:t}})})}onPrevStep(){console.log("Going to previous step...")}onNextStep(){var n=this;return(0,f.A)(function*(){n.contactFormArray.invalid?n.contactFormArray.markAllAsTouched():n.selectContactData.emit()})()}onChangePersonType(n,t){const o=this.createContactForm(!1,t),r=this.contactFormArray.at(n).value;if("empresa"===t){let l=this.createContactForm(!0,"particular");l.patchValue({id:r.id||null,name:r.name||"",email:r.email||"",address:r.address||"",birthDate:r.birthdate||"",phoneNumber:r.phoneNumber||"+34 ",gender:r.gender||"male",showForm:!0,identityNumber:r.identityNumber,identityType:r.identityType,civilStatus:r.civilStatus}),o.patchValue({name:"",identityNumber:"",showForm:!0,participationPercentage:r.participationPercentage,formId:r.formId||1}),o.get("persons").push(l)}else{let l=r;Array.isArray(r.persons)&&r.persons.length>0&&(l=r.persons[0]),o.patchValue({id:l.id||null,parentContact:r||null,name:l.name||"",participationPercentage:r.participationPercentage,email:l.email||"",address:l.address||"",birthDate:l.birthdate||"",phoneNumber:l.phoneNumber||"+34 ",gender:l.gender||"male",formId:r.formId||1,identityNumber:l.identityNumber,identityType:l.identityType,civilStatus:l.civilStatus})}this.contactFormArray.setControl(n,o)}togglePersonForm(n){var t;const o=this.getContactForm(n);o.patchValue({showForm:!(null!==(t=o.get("showForm"))&&void 0!==t&&t.value)})}removePerson(n){var t=this;return(0,f.A)(function*(){const o=t.getContactForm(n);if(o.value.id){const l=yield t.modalsService.openConfirmationModal({title:"Eliminar contactos",message:"\xbfEst\xe1s seguro de que deseas eliminar los contactos seleccionados?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]});var r;"delete"===(null==l?void 0:l.data)&&(yield t.api.unlinkReserveContactToOperation(null===(r=t.operation)||void 0===r?void 0:r.id,o.value.id))}t.contactFormArray.removeAt(n)})()}onSaveChildContact(n,t){var o=this;return(0,f.A)(function*(){var r,l;const u=o.getContactForm(n),m=o.getCompanyPersonForm(n,t);if(m.invalid)return void m.markAllAsTouched();let v=o.buildContactData(u.value),x=o.buildContactData(m.value),P=yield o.saveOrUpdateContact(m.value.id,x),y=yield o.saveOrUpdateContact(u.value.id,v),h=null==y||null===(r=y.success)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.id,S=null==P||null===(l=P.success)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.id;var M,O;m.value.id||(yield o.api.addReserveContactToOperation(null===(M=o.operation)||void 0===M?void 0:M.id,S)),u.value.id||(yield o.api.addReserveContactToOperation(null===(O=o.operation)||void 0===O?void 0:O.id,h)),yield o.updateBuyersContactsPercentages(h,u.value.participationPercentage),yield o.api.addContactRelation(h,S,m.value.role),o.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3})})()}onSaveContact(n){var t=this;return(0,f.A)(function*(){const o=t.getContactForm(n);if(o.invalid)o.markAllAsTouched();else if("particular"===o.value.type){var r,l;let P=t.buildContactData(o.value);var u,m,v;o.value.parentContact&&(yield t.api.unlinkReserveContactToOperation(null===(u=t.operation)||void 0===u?void 0:u.id,null===(m=o.value.parentContact)||void 0===m?void 0:m.id),o.value.id&&(yield t.api.removeContactRelation(o.value.id,null===(v=o.value.parentContact)||void 0===v?void 0:v.id)));let y=yield t.saveOrUpdateContact(o.value.id,P),h=null==y||null===(r=y.success)||void 0===r?void 0:r.data.id;yield t.api.addReserveContactToOperation(null===(l=t.operation)||void 0===l?void 0:l.id,h),yield t.updateBuyersContactsPercentages(h,o.value.participationPercentage),t.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3})}else if("empresa"===o.value.type){var x;let P={name:o.value.name,contactType:o.value.type,identityNumber:o.value.identityNumber,address:o.value.address},h=(yield t.saveOrUpdateContact(o.value.id,P)).success.data.id;yield t.api.addReserveContactToOperation(null===(x=t.operation)||void 0===x?void 0:x.id,h)}})()}saveOrUpdateContact(n,t){var o=this;return(0,f.A)(function*(){return n?yield o.api.updateContactById(n,t):yield o.api.createContact(t)})()}updateBuyersContactsPercentages(n,t){var o=this;return(0,f.A)(function*(){var r;let l=o.operation.buyersContactsPercentages;l?l[n]={percentage:t,order:1}:l={[n]:{percentage:t,order:1}},yield o.api.updateOperationById(null===(r=o.operation)||void 0===r?void 0:r.id,{buyersContactsPercentages:l})})()}buildContactData(n){if("particular"===n.type){const t=n.phoneNumber,o=n.email,r=[];t&&!r.includes(t)&&r.unshift(t);const l=[];return o&&!l.includes(o)&&l.unshift(o),{name:n.name,birthdate:new Date(n.birthDate),phones:r,emails:l,address:n.address,gender:n.gender,typeOfIdentification:n.identityType,dniPassport:n.identityNumber,contactType:n.type,civilStatus:n.civilStatus}}return{name:n.name,address:n.address,dniPassport:n.identityNumber,contactType:n.type}}}return(i=c).\u0275fac=function(n){return new(n||i)(e.rXU(s.ok),e.rXU(e.SKi),e.rXU(F.i),e.rXU(U.T),e.rXU(ie.M),e.rXU(b.f))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-contact-data"]],viewQuery:function(n,t){if(1&n&&e.GBs(fe,5),2&n){let o;e.mGM(o=e.lsd())&&(t.addressInput=o.first)}},inputs:{contact:"contact",operationId:"operationId",operation:"operation",contactData:"contactData",operationData:"operationData",reservedContacts:"reservedContacts"},outputs:{selectContactData:"selectContactData"},decls:12,vars:3,consts:[[1,"venta-component"],[1,"venta-component-body"],["class","content mt-15",4,"ngFor","ngForOf"],[1,"w-full"],["type","button",1,"crm-button-secondary","w-full","d-flex","justify-center","align-center",3,"click"],["alt","",1,"cursor-pointer",3,"src"],[1,"mt-10",2,"display","flex","gap","16px","justify-content","space-between"],["type","button",1,"crm-button-secondary","w-50p","d-block","text-center","border-primary",3,"click"],["type","submit",1,"crm-button","w-50p","d-block","text-center",3,"click","disabled"],[1,"content","mt-15"],[1,"",2,"border","1px solid #E0E0E0","width","100%","padding","6px","border-radius","20px","margin-bottom","16px"],[1,"d-flex","text-14"],[1,"cursor-pointer","w-50p","text-center",2,"padding","6px 10px","border-radius","20px",3,"click","ngStyle"],[1,"d-flex","justify-between"],[1,"title","mb-10"],[1,"text-14","text-secondary","font-weight-400"],[1,"cursor-pointer",3,"click"],[4,"ngIf"],[3,"hasParentContact","form"],[1,"mt-10",2,"gap","16px"],["type","submit",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"w-full","d-block","text-center","text-13","mt-15","text-secondary"],[1,"d-flex","justify-center","align-center"],[1,"d-flex","align-center","cursor-pointer",3,"click"],[2,"width","14px",3,"src"],[1,"ml-5"],[1,"title"],["alt","",1,"cursor-pointer",3,"click","src"],[3,"formGroup"],[1,"crm-input","w-50p",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","placeholder","Field","formControlName","name"],[1,"crm-input","w-50p","ml-10",2,"margin-bottom","8px"],["type","text","placeholder","Field","formControlName","address"],["type","text","placeholder","Field","formControlName","identityNumber"],["type","number","placeholder","%","formControlName","participationPercentage"],[4,"ngFor","ngForOf"],[1,"w-full","mt-20"],[1,"p-16","mt-10",2,"border","1px solid #EBEBEB","border-radius","12px"],["class","w-full  d-flex justify-between align-end",3,"formGroup",4,"ngIf"],[1,"w-full","d-flex","justify-between","align-end",3,"formGroup"],[1,"crm-input"],[1,"crm-input-input"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],[1,"d-flex","justify-between","mb-10"],[1,"d-flex","align-center"],["alt","",1,"cursor-pointer","ml-10",3,"src"],["alt","",1,"cursor-pointer","ml-10",3,"click","src"],["type","button",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"cursor-pointer","d-flex","align-center",3,"click"],[1,"cursor-pointer",2,"width","14px",3,"src"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,De,9,7,"div",2),e.j41(3,"div",3)(4,"button",4),e.bIt("click",function(){return t.addNewForm()}),e.nrm(5,"img",5),e.EFF(6," A\xf1adir otro comprador "),e.k0s()()(),e.j41(7,"div",6)(8,"button",7),e.bIt("click",function(){return t.onPrevStep()}),e.EFF(9," Anterior "),e.k0s(),e.j41(10,"button",8),e.bIt("click",function(){return t.onNextStep()}),e.EFF(11," Siguiente "),e.k0s()()()),2&n&&(e.R7$(2),e.Y8G("ngForOf",t.contactFormArray.controls),e.R7$(3),e.Y8G("src","assets/icon/user-plus-icon.svg",e.B4B),e.R7$(5),e.Y8G("disabled",t.disabled))},dependencies:[d.YU,d.Sq,d.bT,d.B3,s.qT,s.xH,s.y7,s.me,s.Q0,s.wz,s.BC,s.cb,s.j4,s.JD,Ce],styles:[".venta-component[_ngcontent-%COMP%]{max-width:500px}"]}),c})();const Ge=["selectPropertyComponent"],Ne=["selectPriceComponent"],V=i=>({"hidden-step":i}),we=(i,c)=>({"crm-steps-container-step-current":i,"crm-steps-container-step-inactive":c});function Be(i,c){1&i&&e.nrm(0,"i",24)}function Ae(i,c){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const a=e.XpG().index;e.R7$(),e.JRh(a+1)}}function Xe(i,c){1&i&&e.nrm(0,"div",25)}function $e(i,c){if(1&i&&(e.j41(0,"div",18)(1,"div",19),e.DNE(2,Be,1,0,"i",20)(3,Ae,2,1,"span",21),e.k0s(),e.j41(4,"div",22),e.EFF(5),e.k0s(),e.DNE(6,Xe,1,0,"div",23),e.k0s()),2&i){const a=c.$implicit,n=c.index,t=e.XpG();e.Y8G("ngClass",e.l_i(5,we,n==t.activeIndex,n>t.activeIndex)),e.R7$(2),e.Y8G("ngIf",n<t.activeIndex),e.R7$(),e.Y8G("ngIf",n>=t.activeIndex),e.R7$(2),e.SpI(" ",a," "),e.R7$(),e.Y8G("ngIf",n<t.steps.length-1)}}function Ye(i,c){if(1&i){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3," 1. Promoci\xf3n "),e.k0s(),e.j41(4,"div",31),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.changeStep(0))}),e.nrm(5,"i",32),e.k0s()(),e.j41(6,"div",33),e.EFF(7),e.k0s()()}if(2&i){const a=e.XpG(2);e.R7$(7),e.SpI(" ",null==a.data||null==a.data.promotion?null:a.data.promotion.projectName," ")}}function Ue(i,c){if(1&i){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3," 2. Vivienda principal "),e.k0s(),e.j41(4,"div",31),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.changeStep(1))}),e.nrm(5,"i",32),e.k0s()(),e.j41(6,"div",33),e.EFF(7),e.k0s()()}if(2&i){const a=e.XpG(2);e.R7$(7),e.SpI(" ",null==a.data||null==a.data.property?null:a.data.property.reference," ")}}function ze(i,c){if(1&i){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3," 3. Por precio "),e.k0s(),e.j41(4,"div",31),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.changeStep(2))}),e.nrm(5,"i",32),e.k0s()(),e.j41(6,"div",33),e.EFF(7),e.nI1(8,"thousandSeparator"),e.k0s()()}if(2&i){const a=e.XpG(2);e.R7$(7),e.SpI(" ",e.bMT(8,1,null==a.data||null==a.data.priceSelected?null:a.data.priceSelected.finalPrice)," \u20ac ")}}function We(i,c){if(1&i){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3," 4. Documento de reserva "),e.k0s(),e.j41(4,"div",31),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.changeStep(3))}),e.nrm(5,"i",32),e.k0s()(),e.j41(6,"div",33),e.EFF(7),e.k0s()()}if(2&i){const a=e.XpG(2);e.R7$(7),e.SpI(" ",null==a.data||null==a.data.documentData?null:a.data.documentData.contractType," ")}}function qe(i,c){if(1&i&&(e.j41(0,"div",26),e.DNE(1,Ye,8,1,"div",27)(2,Ue,8,1,"div",27)(3,ze,9,3,"div",27)(4,We,8,1,"div",27),e.k0s()),2&i){const a=e.XpG();e.R7$(),e.Y8G("ngIf",null==a.data?null:a.data.promotion),e.R7$(),e.Y8G("ngIf",null==a.data?null:a.data.property),e.R7$(),e.Y8G("ngIf",null==a.data||null==a.data.priceSelected?null:a.data.priceSelected.finalPrice),e.R7$(),e.Y8G("ngIf",null==a.data?null:a.data.documentData)}}const Ke=[{path:"",component:(()=>{var i;class c{constructor(n,t,o,r){this.api=n,this.route=t,this.toast=o,this.router=r,this.data={promotion:null,property:null,priceSelected:{priceWithoutIva:null,priceWithIva:null,finalPrice:null,iva:10},documentData:null},this.steps=["Promoci\xf3n","Vivienda principal","Por precio","Documento de reserva","Datos del cliente"],this.activeIndex=0,this.reservedContacts=[]}ngOnInit(){const n=this.route.snapshot.paramMap.get("operationId");n?this.api.getOperation({id:{equals:n}},null,null,{contact:{apply:!0,filter:null,onlyCount:!1},createdBy:{apply:!0,filter:null,onlyCount:!1},responsible:{apply:!0,filter:null,onlyCount:!1},mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1},selectedProperties:{apply:!0,filter:null,onlyCount:!1},notes:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1},operationRegisters:{apply:!0,filter:null,onlyCount:!1}}).then(t=>{t.success&&t.success.data&&t.success.data.length&&(this.operation=t.success.data[0],console.log("Retrieved operation:",this.operation),this.api.getOperationById(n).then(o=>{o.success&&o.success.data&&o.success.data.reserveContacts.length&&(this.reservedContacts=o.success.data.reserveContacts)}))}).catch(t=>{console.error("Error retrieving operation:",t)}):console.warn("No operationId parameter found in the URL.")}onSelectPromotion(n){var t=this;return(0,f.A)(function*(){var o;t.data.promotion=n,t.activeIndex=1;const r=yield t.api.getPromotionFullDataById(t.data.promotion.id);t.data.promotion=null==r||null===(o=r.success)||void 0===o?void 0:o.data,t.selectPropertyComponent.selectedPromotion=t.data.promotion})()}onSelectProperty(n){var t=this;return(0,f.A)(function*(){t.data.property=n,t.selectPriceComponent.selectedProperty=n,t.activeIndex=2})()}onSelectPrice(n){this.data.priceSelected=n,this.activeIndex=3}onSelectDocumentData(n){this.data.documentData=n,this.activeIndex=4}onSelectContactData(){console.log("Contact data selected:",this.data.documentData),this.finishFlow()}finishFlow(){var n=this;return(0,f.A)(function*(){const t={propertyId:n.data.property.id,operationId:n.operation.id,priceSelected:n.data.priceSelected,documentData:n.data.documentData};(yield n.api.reserveProperty(t)).success?(n.toast.showSuccessToast("Reserva realizada correctamente"),n.router.navigate(["/contacts",n.operation.contactId,"operations",n.operation.id])):n.toast.showErrorToast("Error al realizar la reserva")})()}changeStep(n){this.activeIndex=n,0===n&&(this.data.property=null,this.data.priceSelected=null,this.data.documentData=null,this.selectPropertyComponent.selectedPromotion=null),1===n&&(this.data.priceSelected=null,this.data.documentData=null,this.selectPriceComponent.selectedProperty=null),console.log("DATAAAA",this.data)}}return(i=c).\u0275fac=function(n){return new(n||i)(e.rXU(F.i),e.rXU(C.nX),e.rXU(b.f),e.rXU(C.Ix))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-operation-process"]],viewQuery:function(n,t){if(1&n&&(e.GBs(Ge,7),e.GBs(Ne,7)),2&n){let o;e.mGM(o=e.lsd())&&(t.selectPropertyComponent=o.first),e.mGM(o=e.lsd())&&(t.selectPriceComponent=o.first)}},decls:22,vars:21,consts:[["selectPropertyComponent",""],["selectPriceComponent",""],["selectClientComponent",""],[3,"fullscreen"],[1,"crm-block-content"],[1,"crm-block-body"],[1,"crm-block-body-blue-content"],[1,"crm-steps-container"],["class","crm-steps-container-step",3,"ngClass",4,"ngFor","ngForOf"],[1,"venta-body"],[1,"venta-body-component"],[3,"ngClass"],[3,"selectPromotion"],[3,"selectProperty"],[3,"selectPrice"],[3,"selectDocumentData"],[3,"selectContactData","contactData","reservedContacts","operationData"],["class","steps-cards-body",4,"ngIf"],[1,"crm-steps-container-step",3,"ngClass"],[1,"crm-steps-container-step-circle"],["class","fa fa-check",4,"ngIf"],[4,"ngIf"],[1,"crm-steps-container-step-label"],["class","crm-steps-container-step-separator",4,"ngIf"],[1,"fa","fa-check"],[1,"crm-steps-container-step-separator"],[1,"steps-cards-body"],["class","steps-cards-body-card",4,"ngIf"],[1,"steps-cards-body-card"],[1,"steps-cards-body-card-header"],[1,"steps-cards-body-card-header-title"],[1,"steps-cards-body-card-header-icon",3,"click"],[1,"fa-solid","fa-pencil"],[1,"steps-cards-body-card-text"]],template:function(n,t){if(1&n){const o=e.RV6();e.j41(0,"ion-content",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),e.DNE(5,$e,7,8,"div",8),e.k0s(),e.j41(6,"div",9)(7,"div",10)(8,"div",11)(9,"app-venta-select-promotion",12),e.bIt("selectPromotion",function(l){return e.eBV(o),e.Njj(t.onSelectPromotion(l))}),e.k0s()(),e.j41(10,"div",11)(11,"app-venta-select-property",13,0),e.bIt("selectProperty",function(l){return e.eBV(o),e.Njj(t.onSelectProperty(l))}),e.k0s()(),e.j41(13,"div",11)(14,"app-venta-select-price",14,1),e.bIt("selectPrice",function(l){return e.eBV(o),e.Njj(t.onSelectPrice(l))}),e.k0s()(),e.j41(16,"div",11)(17,"app-venta-select-document",15,2),e.bIt("selectDocumentData",function(l){return e.eBV(o),e.Njj(t.onSelectDocumentData(l))}),e.k0s()(),e.j41(19,"div",11)(20,"app-venta-select-contact-data",16),e.bIt("selectContactData",function(){return e.eBV(o),e.Njj(t.onSelectContactData())}),e.k0s()()(),e.DNE(21,qe,5,4,"div",17),e.k0s()()()()()}2&n&&(e.Y8G("fullscreen",!0),e.R7$(5),e.Y8G("ngForOf",t.steps),e.R7$(3),e.Y8G("ngClass",e.eq3(11,V,0!==t.activeIndex)),e.R7$(2),e.Y8G("ngClass",e.eq3(13,V,1!==t.activeIndex)),e.R7$(3),e.Y8G("ngClass",e.eq3(15,V,2!==t.activeIndex)),e.R7$(3),e.Y8G("ngClass",e.eq3(17,V,3!==t.activeIndex)),e.R7$(3),e.Y8G("ngClass",e.eq3(19,V,4!==t.activeIndex)),e.R7$(),e.Y8G("contactData",null==t.operation?null:t.operation.contact)("reservedContacts",t.reservedContacts)("operationData",t.operation),e.R7$(),e.Y8G("ngIf",null==t.data?null:t.data.promotion))},dependencies:[d.YU,d.Sq,d.bT,g.W9,R,J,ee,oe,Re,z.w],styles:[".crm-steps-container[_ngcontent-%COMP%], .crm-steps-container-step[_ngcontent-%COMP%]{display:flex;align-items:center}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#3a50e4;border:1px solid #3A50E4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#3a50e4}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#a8a8a8;border:1px solid rgb(168,168,168)}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#a8a8a8}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#a8a8a8}.crm-steps-container-step-circle[_ngcontent-%COMP%]{width:21px;min-width:21px;height:21px;min-height:21px;border-radius:50%;background:#3a50e4;color:#fff;display:flex;justify-content:center;align-items:center;font-weight:700;font-size:12px;margin-right:8px}.crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4;font-weight:500;margin-right:16px;font-size:13px}.crm-steps-container-step-separator[_ngcontent-%COMP%]{width:20px;height:1px;background:#3a50e4;margin-right:16px}.hidden-step[_ngcontent-%COMP%]{height:0;overflow:hidden;opacity:0;position:absolute;width:0;visibility:hidden}.steps-cards-body[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:16px}.steps-cards-body-card[_ngcontent-%COMP%]{border:1px solid var(--crm-border-light-color);border-radius:6px;padding:12px}.steps-cards-body-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--crm-border-light-color);padding-bottom:16px}.steps-cards-body-card-header-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:var(--crm-text-color)}.steps-cards-body-card-header-icon[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;color:var(--crm-text-color)}.steps-cards-body-card-text[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color);padding-top:16px}.venta-body[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px}.venta-body[_ngcontent-%COMP%]   .steps-cards-body[_ngcontent-%COMP%]{min-width:300px;width:300px;flex-shrink:0}.venta-body-component[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;overflow-y:auto}"]}),c})()}];let Le=(()=>{var i;class c{}return(i=c).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[C.iI.forChild(Ke),C.iI]}),c})();var Je=p(3895),He=p(9662),Ze=p(6812),Qe=p(969),et=p(8147);let tt=(()=>{var i;class c{}return(i=c).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[d.MD,s.YN,g.bv,s.X1,Le,Je.b,He.Y,Ze.u,Qe.rJ,et.h]}),c})()},9662:(T,j,p)=>{p.d(j,{Y:()=>g});var d=p(177),s=p(3953);let g=(()=>{var C;class f{}return(C=f).\u0275fac=function(F){return new(F||C)},C.\u0275mod=s.$C({type:C}),C.\u0275inj=s.G2t({imports:[d.MD]}),f})()},4558:(T,j,p)=>{p.d(j,{w:()=>s});var d=p(3953);let s=(()=>{var g;class C{transform(e,...F){if(null==e||""===e)return"";let b;return b="string"==typeof e?parseFloat(e):e,isNaN(b)?"":b.toString().replace(/\.(?=\d+$)/,",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}}return(g=C).\u0275fac=function(e){return new(e||g)},g.\u0275pipe=d.EJ8({name:"thousandSeparator",type:g,pure:!0}),C})()}}]);