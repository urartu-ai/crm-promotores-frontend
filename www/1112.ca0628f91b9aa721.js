"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1112],{1112:(Q,E,d)=>{d.r(E),d.d(E,{CalendarScreenPageModule:()=>Z});var C=d(177),D=d(9417),w=d(9465),x=d(5188),M=d(467),p=d(9703);const i=void 0,k=["es",[["a.\xa0m.","p.\xa0m."],i,i],i,[["D","L","M","X","J","V","S"],["dom","lun","mar","mi\xe9","jue","vie","s\xe1b"],["domingo","lunes","martes","mi\xe9rcoles","jueves","viernes","s\xe1bado"],["DO","LU","MA","MI","JU","VI","SA"]],i,[["E","F","M","A","M","J","J","A","S","O","N","D"],["ene","feb","mar","abr","may","jun","jul","ago","sept","oct","nov","dic"],["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]],i,[["a. C.","d. C."],i,["antes de Cristo","despu\xe9s de Cristo"]],1,[6,0],["d/M/yy","d MMM y","d 'de' MMMM 'de' y","EEEE, d 'de' MMMM 'de' y"],["H:mm","H:mm:ss","H:mm:ss z","H:mm:ss (zzzz)"],["{1}, {0}",i,i,i],[",",".",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0\xa0%","#,##0.00\xa0\xa4","#E0"],"EUR","\u20ac","euro",{AUD:[i,"$"],BRL:[i,"R$"],BYN:[i,"\u0440."],CAD:[i,"$"],CNY:[i,"\xa5"],EGP:[],ESP:["\u20a7"],GBP:[i,"\xa3"],HKD:[i,"$"],ILS:[i,"\u20aa"],INR:[i,"\u20b9"],JPY:[i,"\xa5"],KRW:[i,"\u20a9"],MXN:[i,"$"],NZD:[i,"$"],PHP:[i,"\u20b1"],RON:[i,"L"],THB:["\u0e3f"],TWD:[i,"NT$"],USD:["US$","$"],XAF:[],XCD:[i,"$"],XOF:[]},"ltr",function S(n){const r=n,a=Math.floor(Math.abs(n)),t=n.toString().replace(/^[^.]*\.?/,"").length,o=parseInt(n.toString().replace(/^[^e]*(e([-+]?\d+))?/,"$2"))||0;return 1===r?1:0===o&&0!==a&&a%1e6==0&&0===t||!(o>=0&&o<=5)?4:5}];var e=d(3953),O=d(4501),F=d(6039),I=d(1213),N=d(133),j=d(8397);const R=(n,r)=>[n,r];function V(n,r){1&n&&(e.qex(0),e.EFF(1,"Mes anterior"),e.bVm())}function B(n,r){1&n&&e.EFF(0,"Semana anterior")}function T(n,r){if(1&n){const a=e.RV6();e.j41(0,"ion-button",17),e.bIt("click",function(){const o=e.eBV(a).$implicit,l=e.XpG(2);return e.Njj(l.setView(o))}),e.EFF(1),e.k0s()}if(2&n){const a=r.$implicit,t=e.XpG(2);e.Y8G("fill",t.view===a?"solid":"outline"),e.R7$(),e.SpI(" ",a===t.CalendarView.Month?"Mes":"Semana"," ")}}function G(n,r){1&n&&(e.qex(0),e.EFF(1,"Mes siguiente"),e.bVm())}function X(n,r){1&n&&e.EFF(0,"Semana siguiente")}function H(n,r){if(1&n){const a=e.RV6();e.j41(0,"mwl-calendar-month-view",18),e.bIt("dayClicked",function(o){e.eBV(a);const l=e.XpG(2);return e.Njj(l.dayClicked(o.day))}),e.k0s()}if(2&n){const a=e.XpG(2);e.Y8G("viewDate",a.viewDate)("locale",a.locale)("events",a.events)}}function U(n,r){if(1&n&&e.nrm(0,"mwl-calendar-week-view",19),2&n){const a=e.XpG(2);e.Y8G("viewDate",a.viewDate)("locale",a.locale)("events",a.events)}}function Y(n,r){1&n&&e.EFF(0," Viene de un registro ")}function A(n,r){if(1&n){const a=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){e.eBV(a);const o=e.XpG().$implicit,l=e.XpG(3);return e.Njj(l.onHandleVisit(o.meta.visit))}),e.EFF(1," Gestionar "),e.k0s()}}function z(n,r){if(1&n&&(e.j41(0,"ion-item")(1,"ion-label")(2,"strong"),e.EFF(3),e.k0s(),e.nrm(4,"br"),e.EFF(5),e.nrm(6,"br"),e.EFF(7),e.nrm(8,"br"),e.EFF(9),e.nI1(10,"date"),e.nrm(11,"br"),e.EFF(12),e.nrm(13,"br"),e.EFF(14),e.nrm(15,"br"),e.DNE(16,Y,1,0)(17,A,2,0,"button",22),e.k0s()()),2&n){const a=r.$implicit,t=e.XpG(3);e.R7$(3),e.SpI("Contacto: ",a.meta.contactName,""),e.R7$(2),e.SpI(" Promotora: ",a.meta.promoterName,""),e.R7$(2),e.SpI(" Propiedad: ",a.meta.propertyName,""),e.R7$(2),e.SpI(" Hora: ",e.i5U(10,7,a.start,"HH:mm"),""),e.R7$(3),e.SpI(" Notas: ",a.meta.notes,""),e.R7$(2),e.SpI(" Estado: ",a.meta.status,""),e.R7$(2),e.vxM(a.meta.visit.operationRegisterId?16:null!=a&&null!=a.meta&&null!=a.meta.visit&&a.meta.visit.operationRegisterId||"pending"!==a.meta.status&&a.meta.status||"promoter"!==t.currentUser.accountType?-1:17)}}function $(n,r){if(1&n&&(e.j41(0,"div",20)(1,"h3"),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.j41(4,"ion-list"),e.DNE(5,z,18,10,"ion-item",21),e.k0s()()),2&n){const a=e.XpG(2);e.R7$(2),e.SpI(" Visitas de ",e.ii3(3,2,a.selectedDay.date,"longDate","","es")," "),e.R7$(3),e.Y8G("ngForOf",a.selectedDay.events)}}function J(n,r){if(1&n){const a=e.RV6();e.j41(0,"div",5)(1,"div",6)(2,"button",7),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.prev())}),e.nrm(3,"i",8),e.DNE(4,V,2,0,"ng-container",9)(5,B,1,0,"ng-template",null,0,e.C5r),e.k0s(),e.j41(7,"div",10),e.DNE(8,T,2,2,"ion-button",11),e.k0s(),e.j41(9,"button",7),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.next())}),e.DNE(10,G,2,0,"ng-container",9)(11,X,1,0,"ng-template",null,1,e.C5r),e.nrm(13,"i",12),e.k0s()(),e.j41(14,"div",13),e.DNE(15,H,1,3,"mwl-calendar-month-view",14)(16,U,1,3,"mwl-calendar-week-view",15),e.k0s(),e.DNE(17,$,6,7,"div",16),e.k0s()}if(2&n){const a=e.sdS(6),t=e.sdS(12),o=e.XpG();e.R7$(4),e.Y8G("ngIf",o.view===o.CalendarView.Month)("ngIfElse",a),e.R7$(4),e.Y8G("ngForOf",e.l_i(8,R,o.CalendarView.Month,o.CalendarView.Week)),e.R7$(2),e.Y8G("ngIf",o.view===o.CalendarView.Month)("ngIfElse",t),e.R7$(5),e.Y8G("ngIf",o.view===o.CalendarView.Month),e.R7$(),e.Y8G("ngIf",o.view===o.CalendarView.Week),e.R7$(),e.Y8G("ngIf",o.selectedDay)}}(0,C.EO)(k);const W=[{path:"",component:(()=>{var n;class r{constructor(t,o,l,s,u){this.headerService=t,this.api=o,this.byvaroState=l,this.modalsService=s,this.toastService=u,this.view=p.St.Month,this.CalendarView=p.St,this.viewDate=new Date,this.locale="es",this.rawEvents=[],this.events=[],this.selectedDay=null,this.loading=!0}ngOnInit(){var t=this;return(0,M.A)(function*(){t.headerService.setConfig({title:"calendar"}),t.byvaroState.getState().subscribe(function(){var o=(0,M.A)(function*(l){null!=l&&l.user&&(t.currentUser=l.user,console.log("currentUser",t.currentUser),yield t.getData())});return function(l){return o.apply(this,arguments)}}())})()}ionViewWillEnter(){this.currentUser&&this.getData()}getData(){var t=this;return(0,M.A)(function*(){var o,l;t.loading=!0,t.selectedDay=null;const s={date:{gte:new Date((new Date).getFullYear(),(new Date).getMonth(),1),lte:new Date((new Date).getFullYear(),(new Date).getMonth()+1,1)}},v=yield t.api.getVisit(s,{field:"date",order:"asc"},{page:0,itemsPerPage:1e3});t.rawEvents=null==v||null===(o=v.success)||void 0===o?void 0:o.data,console.log("events",null==v||null===(l=v.success)||void 0===l?void 0:l.data),t.events=t.rawEvents.map(c=>{var _,h,f,b;return{start:c.date,end:c.notes&&c.notes.includes("D\xeda")?void 0:new Date(new Date(c.date).getTime()+36e5),title:c.notes,allDay:c.notes.includes("D\xeda"),color:t.getEventColor(c.status),meta:{id:c.id,notes:c.notes,contactName:null===(_=c.contact)||void 0===_?void 0:_.name,promoterName:(null===(h=c.promoter)||void 0===h?void 0:h.name)||(null===(f=c.agency)||void 0===f?void 0:f.name),propertyName:null===(b=c.property)||void 0===b?void 0:b.reference,status:c.status,visit:c}}}),t.loading=!1})()}getEventColor(t){switch(t){case"accepted":return{primary:"#3A50E4",secondary:"#EBEBEB"};case"pending":return{primary:"#FFC107",secondary:"#FFECB3"};case"rejected":return{primary:"#F44336",secondary:"#FFCDD2"};default:return{primary:"#9E9E9E",secondary:"#E0E0E0"}}}onHandleVisit(t){var o=this;return(0,M.A)(function*(){var l;console.log("onHandleVisit",t);const s=yield o.modalsService.onShowAcceptRegisterModal(null,t);if(null!=s&&null!==(l=s.data)&&void 0!==l&&l.confirmed){var u;if(null!=s&&null!==(u=s.data)&&void 0!==u&&null!==(u=u.data)&&void 0!==u&&u.confirmVisit){var m,v,c,_;const y={status:"accepted",notes:(null==s||null===(m=s.data)||void 0===m||null===(m=m.data)||void 0===m?void 0:m.notes)||t.notes};"promoter"===(null===(v=o.currentUser)||void 0===v?void 0:v.accountType)?y.promoterResponsableUserId=o.currentUser.id:"agency"===(null===(c=o.currentUser)||void 0===c?void 0:c.accountType)&&(y.responsableUserId=o.currentUser.id);const g=yield o.api.updateVisitById(t.id,y);var h;if(null!=g&&null!==(_=g.error)&&void 0!==_&&_.errorMessage)return o.toastService.showErrorToast("Error al aceptar la visita. "+(null==g||null===(h=g.error)||void 0===h?void 0:h.errorMessage)),null}else{var f,b;const y={status:"rejected",notes:(null==s||null===(f=s.data)||void 0===f||null===(f=f.data)||void 0===f?void 0:f.notes)||t.notes},g=yield o.api.updateVisitById(t.id,y);var P;if(null!=g&&null!==(b=g.error)&&void 0!==b&&b.errorMessage)return o.toastService.showErrorToast("Error al aceptar la visita. "+(null==g||null===(P=g.error)||void 0===P?void 0:P.errorMessage)),null}o.getData()}})()}dayClicked(t){this.selectedDay=this.selectedDay&&this.selectedDay.date.getTime()===t.date.getTime()?null:t}setView(t){this.view=t}prev(){this.changeDate(-1)}next(){this.changeDate(1)}changeDate(t){this.viewDate=this.view===p.St.Month?new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()+t,1):new Date(this.viewDate.setDate(this.viewDate.getDate()+7*t))}}return(n=r).\u0275fac=function(t){return new(t||n)(e.rXU(O.d),e.rXU(F.i),e.rXU(I.c),e.rXU(N.M),e.rXU(j.f))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-calendar-screen"]],decls:3,vars:3,consts:[["weekPrev",""],["weekNext",""],[3,"fullscreen","scrollY"],[1,"crm-block-content"],["class","crm-block-body-blue-content",4,"ngIf"],[1,"crm-block-body-blue-content"],[1,"toolbar"],["ion-button","",1,"nav-btn",3,"click"],[1,"fas","fa-chevron-left"],[4,"ngIf","ngIfElse"],[1,"view-toggle"],[3,"fill","click",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-right"],[1,"calendar-container"],[3,"viewDate","locale","events","dayClicked",4,"ngIf"],[3,"viewDate","locale","events",4,"ngIf"],["class","event-dropdown",4,"ngIf"],[3,"click","fill"],[3,"dayClicked","viewDate","locale","events"],[3,"viewDate","locale","events"],[1,"event-dropdown"],[4,"ngFor","ngForOf"],[1,"crm-button","crm-button-warning",2,"margin-top","16px","min-width","90px","justify-content","center"],[1,"crm-button","crm-button-warning",2,"margin-top","16px","min-width","90px","justify-content","center",3,"click"]],template:function(t,o){1&t&&(e.j41(0,"ion-content",2)(1,"div",3),e.DNE(2,J,18,11,"div",4),e.k0s()()),2&t&&(e.Y8G("fullscreen",!0)("scrollY",!0),e.R7$(2),e.Y8G("ngIf",!o.loading))},dependencies:[C.Sq,C.bT,w.Jm,w.W9,w.uz,w.he,w.nf,p.jD,p.tG,C.vh],styles:['@charset "UTF-8";[_nghost-%COMP%]     .cal-month-view{padding:0}[_nghost-%COMP%]     .cal-month-view .cal-header .cal-cell{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:14px;color:#333;border:1px solid #EBEBEB;padding:8px;background:#fff;text-align:left;font-weight:400;text-transform:uppercase}[_nghost-%COMP%]     .cal-month-view .cal-header .cal-cell:hover{background:#fff}[_nghost-%COMP%]     .cal-month-view .cal-day-number{float:left;margin:12px 0 0 12px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;color:#333;font-size:18px;opacity:1}[_nghost-%COMP%]     .cal-month-view .cal-day-badge{display:none}[_nghost-%COMP%]     .cal-month-view .cal-day-cell.cal-weekend .cal-day-number{color:#bbb}[_nghost-%COMP%]     .cal-month-view .cal-day-cell.cal-today{background-color:#fff;border-radius:6px;box-shadow:0 0 0 2px #3a50e4;border:none}[_nghost-%COMP%]     .cal-month-view .cal-day-cell.cal-today .cal-day-number{color:#3a50e4;font-size:18px;font-weight:700}[_nghost-%COMP%]     .cal-month-view .cal-day-cell.cal-today .ds-calendar-cell-title{color:#3a50e4;font-weight:700}[_nghost-%COMP%]     .cal-month-view .cal-cell-top{min-height:auto;max-height:auto}[_nghost-%COMP%]     .cal-week-view{padding:0}[_nghost-%COMP%]     .cal-week-view .cal-header .cal-cell{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:14px;color:#333;border-bottom:1px solid #EBEBEB;border-right:1px solid #EBEBEB;padding:8px;background:#fff;text-transform:uppercase;font-weight:400;text-align:left}[_nghost-%COMP%]     .cal-week-view .cal-header .cal-cell:hover{background:#fff}[_nghost-%COMP%]     .cal-week-view .cal-header .cal-cell:last-child{border-right:none}[_nghost-%COMP%]     .cal-week-view .cal-time-label{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;color:#333;padding:4px 8px;border-right:1px solid #EBEBEB;background:#fff}[_nghost-%COMP%]     .cal-week-view .cal-time-segment{border-top:1px solid #EBEBEB}[_nghost-%COMP%]     .cal-week-view .cal-body .cal-day-column{border-right:1px solid #EBEBEB}[_nghost-%COMP%]     .cal-week-view .cal-body .cal-day-column:last-child{border-right:none}[_nghost-%COMP%]     .cal-week-view .cal-day-column.cal-today{background-color:#fff;box-shadow:inset 0 0 0 2px #3a50e4}.crm-block-body-blue-content[_ngcontent-%COMP%]{height:100%}.crm-block-body-blue-content[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.5rem 1rem;background-color:#3a50e4;border-radius:8px;box-shadow:0 2px 4px #0000001a}.crm-block-body-blue-content[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .nav-btn[_ngcontent-%COMP%]{--box-shadow: none;--border: none;font-size:14px;color:#fff;padding:.25rem .5rem;background:transparent;display:flex;align-items:center;justify-content:center;gap:16px;font-weight:700}.crm-block-body-blue-content[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .nav-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;color:#fff}.crm-block-body-blue-content[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]{display:flex}.crm-block-body-blue-content[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0 .25rem;--background-focused: rgba(255, 255, 255, .2);font-size:.9rem;text-transform:uppercase;font-weight:600}.crm-block-body-blue-content[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]   ion-button[fill=outline][_ngcontent-%COMP%]{--border-color: #ffffff;--color: #ffffff}.crm-block-body-blue-content[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]   ion-button[fill=solid][_ngcontent-%COMP%]{--background: #ffffff;--color: #3A50E4}']}),r})()}];let L=(()=>{var n;class r{}return(n=r).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[x.iI.forChild(W),x.iI]}),r})();var K=d(1163);let Z=(()=>{var n;class r{}return(n=r).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[C.MD,D.YN,w.bv,L,p.rO.forRoot({provide:p.MJ,useFactory:K.a})]}),r})()}}]);