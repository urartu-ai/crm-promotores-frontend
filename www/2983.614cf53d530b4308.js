"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2983],{2983:(cn,A,p)=>{p.r(A),p.d(A,{PromotionDetailsPageModule:()=>an});var y=p(177),_=p(9417),f=p(9465),x=p(517),C=p(467),o=p(3953),R=p(6039),lo=p(4501),E=p(8397),G=p(6552),B=p(1213),Y=p(8374),$=p(2606),co=p(8564),mo=p(9604),po=p(4821),U=p(5824),b=p(7376),uo=p(8880),O=p(1748),X=p(4476);function _o(i,a){if(1&i&&(o.j41(0,"div",12),o.nrm(1,"app-general-toast",13),o.k0s()),2&i){const e=o.XpG();o.R7$(),o.Y8G("options",e.toastConfig)}}function go(i,a){if(1&i){const e=o.RV6();o.j41(0,"ion-checkbox",15),o.bIt("ngModelChange",function(){o.eBV(e);const t=o.XpG().$implicit,s=o.XpG();return o.Njj(s.onCheckboxChange(t))}),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG().$implicit;return o.DH7(s.selected,t)||(s.selected=t),o.Njj(t)}),o.k0s(),o.j41(1,"div",16),o.EFF(2),o.k0s()}if(2&i){const e=o.XpG().$implicit,n=o.XpG();o.Y8G("id",e.label)("disabled",!e.selected&&n.selectionLimitReached),o.R50("ngModel",e.selected),o.R7$(),o.Y8G("id",e.label),o.R7$(),o.JRh(e.label)}}function vo(i,a){if(1&i&&(o.j41(0,"div",14),o.DNE(1,go,3,5),o.k0s()),2&i){const e=a.$implicit;o.R7$(),o.vxM(e.hidden?-1:1)}}let yo=(()=>{var i;class a{constructor(n,t){this.modalCtrl=n,this.navParams=t,this.promotion=null,this.warning=!1,this.MAX_SELECTION=11,this.allColumns=[],this.selectedKeys=[],this.toastConfig={text:"Has alcanzado el l\xedmite de columnas seleccionadas. No puedes a\xf1adir m\xe1s.\n",theme:"orange",fullWidth:!0,showCloseButton:!1,smaller:!0},this.localColumns=[]}ngOnInit(){this.promotion=this.navParams.get("promotion")||null,this.allColumns=this.navParams.get("columns")||[],this.selectedKeys=this.navParams.get("selectedColumnKeys")||[],this.localColumns=this.allColumns.map(n=>({key:n.key,label:n.label,hidden:n.hideSelectColumnsList,selected:this.selectedKeys.includes(n.key)})),this.checkSelectionCount()}checkSelectionCount(){const n=this.localColumns.filter(t=>t.selected).length;this.warning=n>11}onCheckboxChange(n){n.selected&&this.selectedCount>this.MAX_SELECTION&&(n.selected=!1)}get selectedCount(){return this.localColumns.filter(n=>n.selected).length}get selectionLimitReached(){return this.selectedCount>=this.MAX_SELECTION}onCancel(){this.modalCtrl.dismiss(null,"cancel")}onSave(){const n=this.localColumns.filter(t=>t.selected).map(t=>t.key);console.log(n,"updatedSelectedKeys"),this.modalCtrl.dismiss(n,"save")}}return(i=a).\u0275fac=function(n){return new(n||i)(o.rXU(f.W3),o.rXU(uo.y8))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-select-table-columns-modal"]],decls:15,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-times"],[1,"crm-button","crm-button-success",3,"click"],[1,"fa-solid","fa-check"],["class","crm-warning-message p-15","style","",4,"ngIf"],[1,"modal-body"],[1,"modal-body-content"],[1,"crm-section-inputs"],["class","crm-input-checkbox","appToggleCheckbox","","style","margin-bottom: 12px;",4,"ngFor","ngForOf"],[1,"crm-warning-message","p-15"],[3,"options"],["appToggleCheckbox","",1,"crm-input-checkbox",2,"margin-bottom","12px"],[3,"ngModelChange","id","disabled","ngModel"],[1,"crm-input-checkbox-label",3,"id"]],template:function(n,t){1&n&&(o.j41(0,"div",0)(1,"div",1),o.EFF(2," Seleccionar columnas "),o.k0s(),o.j41(3,"div",2)(4,"button",3),o.bIt("click",function(){return t.onCancel()}),o.nrm(5,"i",4),o.EFF(6," Cerrar "),o.k0s(),o.j41(7,"button",5),o.bIt("click",function(){return t.onSave()}),o.nrm(8,"i",6),o.EFF(9," Guardar "),o.k0s()()(),o.DNE(10,_o,2,1,"div",7),o.j41(11,"div",8)(12,"div",9)(13,"div",10),o.DNE(14,vo,2,1,"div",11),o.k0s()()()),2&n&&(o.R7$(10),o.Y8G("ngIf",t.selectionLimitReached),o.R7$(4),o.Y8G("ngForOf",t.localColumns))},dependencies:[y.Sq,y.bT,_.BC,_.vS,f.eY,f.hB,O.z,X.l],styles:[".modal-body[_ngcontent-%COMP%]{overflow-y:auto}"]}),a})();function fo(i,a){if(1&i&&o.nrm(0,"img",0),2&i){const e=o.XpG();o.Y8G("src",e.icon,o.B4B)}}let Co=(()=>{var i;class a{constructor(){this.className=""}ngOnInit(){}}return(i=a).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=o.VBU({type:i,selectors:[["app-badge"]],inputs:{text:"text",icon:"icon",className:"className"},standalone:!0,features:[o.aNF],decls:3,vars:5,consts:[["alt","",1,"badge__icon",3,"src"]],template:function(n,t){1&n&&(o.j41(0,"div"),o.DNE(1,fo,1,1,"img",0),o.EFF(2),o.k0s()),2&n&&(o.ZvI("badge ",t.className,""),o.R7$(),o.vxM(t.icon?1:-1),o.R7$(),o.SpI(" ",t.text,"\n"))}}),a})();function bo(i,a){if(1&i&&(o.j41(0,"div",0),o.EFF(1),o.k0s()),2&i){const e=o.XpG();o.R7$(),o.JRh(e.price)}}function ho(i,a){if(1&i&&o.nrm(0,"app-badge",1),2&i){const e=o.XpG();o.Mz_("className","badge--",e.statusMap[e.status].key,""),o.FS9("text",e.statusMap[e.status].text),o.FS9("icon",e.statusMap[e.status].icon)}}let Po=(()=>{var i;class a{constructor(n,t){this.price=n,this.status=t,this.statusMap={blocked:{key:"blocked",text:"Blocked",icon:"assets/icon/lock-icon.svg"},reserved:{key:"reserved",text:"Reserved",icon:"assets/icon/loading-icon-warn.svg"},sold:{key:"sold",text:"Sold",icon:""},retired:{key:"retired",text:"Retired",icon:"assets/icon/toggle-icon-left.svg"}}}ngOnInit(){}}return(i=a).\u0275fac=function(n){return new(n||i)(o.rXU("price"),o.rXU("status"))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-price-status-cell"]],standalone:!0,features:[o.aNF],decls:2,vars:1,consts:[[1,"col-medium","text-center"],[3,"className","text","icon"]],template:function(n,t){1&n&&o.DNE(0,bo,2,1,"div",0)(1,ho,1,4,"app-badge",1),2&n&&o.vxM("available"===t.status?0:1)},dependencies:[Co]}),a})(),Do=(()=>{var i;class a{constructor(n){this.status=n}ngOnInit(){this.status="available"===this.status?"success":this.status}}return(i=a).\u0275fac=function(n){return new(n||i)(o.rXU("status"))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-table-cell-actions"]],decls:3,vars:4,consts:[[1,"d-flex","justify-end","col-small","align-center"],[2,"padding","10px 5px"],["alt","",3,"src"]],template:function(n,t){1&n&&(o.j41(0,"div",0)(1,"div",1),o.nrm(2,"img",2),o.k0s()()),2&n&&(o.R7$(),o.ZvI("table-row-background-",t.status," rowMenu-icon-wrapper"),o.R7$(),o.Y8G("src","assets/icon/more-vertical-icon.svg",o.B4B))}}),a})(),ko=(()=>{var i;class a{constructor(n){this.onClick=n}ngOnInit(){}}return(i=a).\u0275fac=function(n){return new(n||i)(o.rXU("onClick"))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-table-header-cell-actions"]],decls:3,vars:1,consts:[[1,"d-flex","justify-end","col-small","align-center","pr-15",3,"click"],[1,"rowMenu-icon-wrapper",2,"padding","10px 5px"],["alt","",1,"cursor-pointer",3,"src"]],template:function(n,t){1&n&&(o.j41(0,"div",0),o.bIt("click",function(){return null==t.onClick?null:t.onClick()}),o.j41(1,"div",1),o.nrm(2,"img",2),o.k0s()()),2&n&&(o.R7$(2),o.Y8G("src","assets/icon/switch-horizontal-icon.svg",o.B4B))}}),a})();var Fo=p(1296),L=p(8031),xo=p(1880);const Mo=["tableComponent"],Io=(i,a)=>({"border-bottom-unset":i,"border-radius-16":a});function To(i,a){if(1&i&&(o.j41(0,"div",10),o.nrm(1,"app-general-toast",11),o.k0s()),2&i){const e=o.XpG();o.R7$(),o.Y8G("options",e.toastConfig)}}function jo(i,a){if(1&i){const e=o.RV6();o.qex(0),o.j41(1,"div",17)(2,"div",18)(3,"input",19),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.editedBlockName,t)||(s.editedBlockName=t),o.Njj(t)}),o.k0s()(),o.j41(4,"div",20)(5,"div",21)(6,"i",22),o.bIt("click",function(){o.eBV(e);const t=o.XpG(),s=t.$implicit,r=t.$index,c=o.XpG();return o.Njj(c.onSaveBlockTitle(s,r))}),o.k0s(),o.j41(7,"i",23),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onCancelBlockTitle())}),o.k0s()()()(),o.bVm()}if(2&i){const e=o.XpG(2);o.R7$(3),o.R50("ngModel",e.editedBlockName)}}function Ro(i,a){if(1&i){const e=o.RV6();o.EFF(0),o.j41(1,"img",24),o.bIt("click",function(){o.eBV(e);const t=o.XpG(),s=t.$implicit,r=t.$index,c=o.XpG();return o.Njj(c.onEditBlockTitle(s,r))}),o.k0s()}if(2&i){const e=o.XpG().$implicit;o.SpI(" ",e.name||"Bloque "+e.index," "),o.R7$(),o.Y8G("src","assets/icon/edit-icon.svg",o.B4B)}}function Eo(i,a){if(1&i){const e=o.RV6();o.qex(0),o.j41(1,"button",32),o.bIt("click",function(){o.eBV(e);const t=o.XpG(3).$index,s=o.XpG();return o.Njj(s.onSaveTable(t))}),o.nrm(2,"i",33),o.EFF(3," Guardar "),o.k0s(),o.bVm()}}function Go(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",32),o.bIt("click",function(){o.eBV(e);const t=o.XpG(4).$index,s=o.XpG();return o.Njj(s.onEditTable(t))}),o.nrm(1,"i",35),o.EFF(2," Edici\xf3n masiva "),o.k0s()}}function Bo(i,a){if(1&i&&o.DNE(0,Go,3,0,"button",34),2&i){const e=o.XpG(4);o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function So(i,a){if(1&i&&o.DNE(0,Eo,4,0,"ng-container",14)(1,Bo,1,1,"ng-template",null,1,o.C5r),2&i){const e=o.sdS(2),n=o.XpG(2).$index,t=o.XpG();o.Y8G("ngIf",t.editingTableBlockIndex===n)("ngIfElse",e)}}function No(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",32),o.bIt("click",function(t){o.eBV(e);const s=o.XpG(3);return o.Njj(s.onDuplicateProperty(t))}),o.nrm(1,"i",36),o.EFF(2," Duplicar propiedad "),o.k0s()}}function Vo(i,a){if(1&i){const e=o.RV6();o.j41(0,"img",38),o.bIt("click",function(){o.eBV(e);const t=o.XpG(3).$index,s=o.XpG();return o.Njj(s.onToggleBlock(t))}),o.k0s()}2&i&&o.Y8G("src","assets/icon/chevron-up-icon.svg",o.B4B)}function Xo(i,a){if(1&i){const e=o.RV6();o.j41(0,"img",38),o.bIt("click",function(){o.eBV(e);const t=o.XpG(3).$index,s=o.XpG();return o.Njj(s.onToggleBlock(t))}),o.k0s()}2&i&&o.Y8G("src","assets/icon/chevron-down-icon.svg",o.B4B)}function wo(i,a){if(1&i&&(o.j41(0,"div",31),o.DNE(1,Vo,1,1,"img",37)(2,Xo,1,1,"img",37),o.k0s()),2&i){const e=o.XpG(2).$implicit;o.R7$(),o.vxM(e.isOpen?1:2)}}function Ao(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",25),o.DNE(1,So,3,2)(2,No,3,0,"button",26),o.j41(3,"button",27),o.bIt("click",function(){o.eBV(e);const t=o.XpG().$implicit,s=o.XpG();return o.Njj(s.onAddProperty(t))}),o.nrm(4,"i",28),o.EFF(5," A\xf1adir propiedad "),o.k0s(),o.j41(6,"div",29)(7,"img",30),o.bIt("click",function(){o.eBV(e);const t=o.XpG().$implicit,s=o.XpG();return o.Njj(s.onDeleteBlock(t))}),o.k0s()(),o.DNE(8,wo,3,1,"div",31),o.k0s()}if(2&i){const e=o.XpG(),n=e.$implicit,t=e.$index,s=o.XpG();o.R7$(),o.vxM(null!=n&&null!=n.tableConfig&&null!=n.tableConfig.rows&&n.tableConfig.rows.length?1:-1),o.R7$(),o.vxM(s.showDuplicateButtonBlockIndex.includes(t)&&-1===s.editingTableBlockIndex?2:-1),o.R7$(5),o.Y8G("src","assets/icon/trash-icon.svg",o.B4B),o.R7$(),o.vxM(null!=n&&null!=n.tableConfig&&null!=n.tableConfig.rows&&n.tableConfig.rows.length?8:-1)}}function Yo(i,a){if(1&i){const e=o.RV6();o.j41(0,"app-table",39,2),o.bIt("columnClick",function(t){o.eBV(e);const s=o.XpG().$implicit,r=o.XpG();return o.Njj(r.onColumnClicked(t,s))})("rowClicked",function(t){o.eBV(e);const s=o.XpG(2);return o.Njj(s.onRowClicked(t))})("rowCheckboxClicked",function(t){o.eBV(e);const s=o.XpG().$index,r=o.XpG();return o.Njj(r.onRowChecked(t,s))}),o.k0s()}if(2&i){const e=o.XpG().$implicit;o.Y8G("table",null==e?null:e.tableConfig)}}function $o(i,a){if(1&i&&(o.j41(0,"div",6)(1,"div",12)(2,"div",13),o.DNE(3,jo,8,1,"ng-container",14)(4,Ro,2,2,"ng-template",null,0,o.C5r),o.k0s(),o.DNE(6,Ao,9,4,"div",15),o.k0s(),o.DNE(7,Yo,2,1,"app-table",16),o.k0s()),2&i){const e=a.$implicit,n=a.$index,t=o.sdS(5),s=o.XpG();o.R7$(),o.Y8G("ngClass",o.l_i(5,Io,e.isOpen,!e.isOpen)),o.R7$(2),o.Y8G("ngIf",s.editingBlockTitleIndex===n)("ngIfElse",t),o.R7$(3),o.Y8G("ngIf","promoter"===(null==s.currentUser?null:s.currentUser.accountType)),o.R7$(),o.vxM(e.isOpen?7:-1)}}function Uo(i,a){1&i&&(o.j41(0,"div",7)(1,"div",40),o.EFF(2," A\xfan no hay bloques "),o.k0s()())}function Oo(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",41),o.bIt("click",function(){o.eBV(e);const t=o.XpG();return o.Njj(t.onAddBlock())}),o.nrm(1,"i",28),o.EFF(2," A\xf1adir bloque "),o.k0s()}}let Lo=(()=>{var i;class a{constructor(n,t,s,r,c,d,u,g){this.modalCtrl=n,this.tableService=t,this.api=s,this.state=r,this.toastService=c,this.modalsService=d,this.utils=u,this.promotionService=g,this.reloadPromotion=new o.bkB,this.sortBlock=new o.bkB,this.loadingBlocks=!1,this.blocks=[],this.toastConfig={text:"Por favor, rellena todos los campos obligatorios de la promoci\xf3n",theme:"orange",fullWidth:!0,showCloseButton:!1,smaller:!0},this.allColumnsKeysSelected=["externalReference","reference","promotionType","floor","bedrooms","bathrooms","totalMeasures_squareMetersBuilt","totalMeasures_squareMetersUseful","f_pool_comunitaria","planos","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!0,editCellsMode:!1,columns:[{key:"reference",label:"Id",size:"small",editMode:{inputType:"text"}},{key:"externalReference",label:"Ref",size:"medium",editMode:{inputType:"text"}},{key:"promotionType",label:"Subtipo",size:"medium",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"villa",value:"Villa",selected:!1},{key:"country_house",value:"Finca",selected:!1},{key:"chalet",value:"Chalet",selected:!1},{key:"apartment_flat",value:"Piso / Apartamento",selected:!1},{key:"duplex",value:"D\xfaplex",selected:!1},{key:"triplex",value:"Triplex",selected:!1},{key:"ground_floor_apartment",value:"Apto planta baja",selected:!1},{key:"penthouse",value:"\xc1tico",selected:!1},{key:"penthouse_duplex",value:"\xc1tico d\xfaplex",selected:!1},{key:"studio",value:"Estudio",selected:!1},{key:"commercial_space",value:"Local comercial",selected:!1}]}},{key:"floor",label:"Planta",size:"small",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersBuilt",label:"M2 constr.",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersUseful",label:"M2 \xfatiles",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"m2constr",label:"M2 constr. (sin incluir terrazas)",size:"small",extraString:" m\xb2",fn:l=>{let D=(l.totalMeasures_squareMetersBuilt||0)-((l.totalMeasures_squareMetersCoveredTerraces||0)+(l.totalMeasures_squareMetersUncoveredTerraces||0));return D<0&&(D=0),D}},{key:"totalMeasures_squareMetersTerraces",label:"M2 Terrazas",size:"small",extraString:" m\xb2",fn:l=>l.totalMeasures_squareMetersCoveredTerraces+l.totalMeasures_squareMetersUncoveredTerraces},{key:"totalMeasures_squareMetersPatch",label:"Parcela",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"bedrooms",label:"Dorm.",size:"small",editMode:{inputType:"number"}},{key:"bathrooms",label:"Ba\xf1os",size:"small",editMode:{inputType:"number"}},{key:"f_pool_comunitaria",label:"Piscina",size:"medium",fn:l=>l.f_pool_comunitaria?"Comunitaria":l.f_pool_privada?"Privada":"No",editMode:{inputType:"select",selectOptions:[{key:"comunitaria",value:"Comunitaria",selected:!1},{key:"privada",value:"Privada",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_trastero",label:"Trastero",size:"medium",fn:l=>l.fcustom_trastero?l.fcustom_trasteroPrice?this.utils.transformThousandSeparator(l.fcustom_trasteroPrice)+" \u20ac":l.fcustom_trasteroIncludedInPrice?"Incluido":"S\xed":"No",editMode:{inputType:"select",selectOptions:[{key:"S\xed",value:"S\xed",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_parking",label:"Parking",size:"medium",fn:l=>{let m="";return m=l.fcustom_parking?"S\xed":"No",l.fcustom_parkingPrice&&(m=this.utils.transformThousandSeparator(l.fcustom_parkingPrice)+" \u20ac"),l.fcustom_parkingIncludedInPrice&&(m="Incluido"),null!=l&&l.fcustom_parkingComunitario&&(m+=" (Comunitario)"),m},editMode:{inputType:"select",selectOptions:[{key:"S\xed",value:"S\xed",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"solarium",label:"Solarium",size:"small",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"yes",value:"S\xed",selected:!1},{key:"no",value:"No",selected:!1}]},fn:l=>l.fcustom_solarium?"S\xed":"No"},{key:"availabilityStatus",label:"Estado",size:"medium",translate:!0,showOnlyEditMode:!0,editMode:{inputType:"select",selectOptions:[{key:"available",value:"Disponible",selected:!1},{key:"sold",value:"Vendido",selected:!1},{key:"reserved",value:"Reservado",selected:!1},{key:"blocked",value:"Bloqueado",selected:!1},{key:"retired",value:"Retirado",selected:!1}]}},{key:"deliveryDate",label:"Fecha de Entrega",size:"medium",editMode:{inputType:"date"},fn:l=>null!=l&&l.deliveryDate?new Date(null==l?void 0:l.deliveryDate).toLocaleDateString("es-ES"):null},{key:"status",label:"Estado de obra",size:"medium",type:"text",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"proyecto-sin-licencia",value:"Proyecto sin licencia",selected:!1},{key:"proyecto-con-licencia",value:"Proyecto con licencia",selected:!1},{key:"fase-excavacion",value:"En fase de excavaci\xf3n",selected:!1},{key:"cimentacion-completada",value:"Cimentaci\xf3n completada",selected:!1},{key:"estructura-construccion",value:"Estructura en construcci\xf3n",selected:!1},{key:"cerramiento-completado",value:"Cerramiento completado",selected:!1},{key:"instalaciones-proceso",value:"Instalaciones en proceso",selected:!1},{key:"acabados-interiores",value:"Acabados interiores",selected:!1},{key:"obra-finalizada",value:"Obra finalizada",selected:!1}]}},{key:"catalog",label:"Cat\xe1logo",size:"small",type:"file",fn:l=>{var m;return null==l||null===(m=l.propertyFiles)||void 0===m||null===(m=m.find(h=>"catalog"===h.category))||void 0===m?void 0:m.url}},{key:"planos",label:"Plano",size:"small",type:"file",fn:l=>{var m;return null==l||null===(m=l.propertyFiles)||void 0===m||null===(m=m.find(h=>"plan"===h.category))||void 0===m?void 0:m.url}},{key:"price",label:"Precio",size:"medium",fn:l=>{let m=null==l?void 0:l.price;return m&&(m=this.utils.transformThousandSeparator(m)),m+" \u20ac"},editMode:{inputType:"number",parseAsAPrice:!0}},{key:"rowMenu",label:"rowMenu",size:"small",hideSelectColumnsList:!0,customCssClass:"sticky-last-column",type:"component"}],rows:[]},this.checkedRows=[],this.editingTableBlockIndex=-1,this.showDuplicateButtonBlockIndex=[],this.editingBlockTitleIndex=-1,this.editedBlockName=""}ngOnInit(){this.getState()}ngOnChanges(){this.getData()}ionViewWillEnter(){this.reloadPromotion.emit()}getState(){this.state.getState().subscribe(n=>{this.currentUser=n.user})}getData(){var n=this;return(0,C.A)(function*(){var t,s;n.showDuplicateButtonBlockIndex=[],n.checkedRows=[],n.allColumnsKeysSelected=(null===(t=n.promotion)||void 0===t?void 0:t.tableColumnsKeysSelected)||n.allColumnsKeysSelected,n.blocks=(null===(s=n.promotion)||void 0===s?void 0:s.promotionBlocks)||[];for(let r=0;r<n.blocks.length;r++)n.blocks[r].isOpen=!0,n.blocks[r].properties&&0!==n.blocks[r].properties.length&&(n.blocks[r].tableConfig=b.cloneDeep(n.tableConfig),n.allColumnsKeysSelected.includes("rowMenu")||n.allColumnsKeysSelected.push("rowMenu"),n.blocks[r].tableConfig.columns=n.blocks[r].tableConfig.columns.map(c=>(c.show=!!n.allColumnsKeysSelected.includes(c.key),c)),n.blocks[r].tableConfig.rows=n.tableService.convertDataToTableRows(b.cloneDeep(n.blocks[r].properties),b.cloneDeep(n.blocks[r].tableConfig)),n.blocks[r].tableConfig.rows=n.customizeRowsWithComponents(n.blocks[r].tableConfig.rows),n.blocks[r].tableConfig.rows=n.addBackgroundColorsToTableRows(n.blocks[r].tableConfig.rows),n.blocks[r].tableConfig.columns.forEach((c,d)=>{if("rowMenu"===c.key){let u={...c};u.component=ko,u.componentInputs={onClick:()=>{n.onEditColumns()}},n.blocks[r].tableConfig.columns[d]=u}}),console.log(n.blocks[r].tableConfig.columns,"this.blocks[i]"))})()}customizeRowsWithComponents(n){return n.map(t=>(t.cells.rowMenu.type="component",t.cells.rowMenu.component=Do,t.cells.rowMenu.componentInputs={status:t.cells.availabilityStatus.value},t.cells.price.type="component",t.cells.price.component=Po,t.cells.price.componentInputs={status:t.cells.availabilityStatus.value,price:t.cells.price.value},"available"===t.cells.availabilityStatus.value&&(t.checkboxCssClass="border-black"),t))}addBackgroundColorsToTableRows(n){for(let t=0;t<n.length;t++)switch(n[t].rawObject.availabilityStatus){case"available":n[t].style={backgroundColor:"success"};break;case"sold":n[t].style={backgroundColor:"sold"};break;case"reserved":n[t].style={backgroundColor:"reserved"};break;case"blocked":default:n[t].style={backgroundColor:"blocked"};break;case"retired":n[t].style={backgroundColor:"retired"}}return n}onAddProperty(n){var t=this;return(0,C.A)(function*(){const s=yield t.modalCtrl.create({component:U.E,componentProps:{block:n,promotion:t.promotion},cssClass:"modal-create-property"});yield s.present();const{data:r}=yield s.onWillDismiss();r&&(t.reloadPromotion.emit(),t.toastService.showSuccessToast("Propiedad a\xf1adida correctamente"))})()}onAddBlock(){var n=this;return(0,C.A)(function*(){let t={index:n.blocks.length+1,promotionId:n.promotion.id};t=(yield n.api.addBlock(t)).success.data,n.blocks.push(t)})()}onToggleBlock(n){this.blocks[n].isOpen=!this.blocks[n].isOpen}onDeleteBlock(n){var t=this;return(0,C.A)(function*(){if(n.properties.length>0)return void t.toastService.showErrorToast("No se puede eliminar un bloque que tiene propiedades");const s=yield t.modalsService.openConfirmationModal({title:"Eliminar fase",message:"\xbfEst\xe1s seguro de que quieres eliminar esta fase?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]});"delete"===(null==s?void 0:s.data)&&(yield t.api.deleteBlock(n.id),t.blocks=t.blocks.filter(c=>c.id!==n.id))})()}onRowClicked(n){var t=this;return(0,C.A)(function*(){const s=yield t.modalCtrl.create({component:U.E,componentProps:{property:n.rawObject,promotion:t.promotion},cssClass:"modal-create-property"});yield s.present();const{data:r}=yield s.onWillDismiss();r?(console.log("HOLA2"),t.reloadPromotion.emit()):(console.log("HOLA"),t.reloadPromotion.emit())})()}onColumnClicked(n,t){var s=this;return(0,C.A)(function*(){s.sortBlock.emit({block:t,sort:{field:n.column.key,order:n.order}})})()}updateEditedRowsFromTable(n){var t=this;return(0,C.A)(function*(){const r=JSON.parse(JSON.stringify(n.table.rows)).filter(c=>c.hasBeenEdited);for(const c of r){const d=t.buildPropertyValuesToUpdate(c);null==d||delete d.catalog,null==d||delete d.planos,yield t.api.updatePropertyById(c.rawObject.id,d)}r.length>0&&(t.toastService.showSuccessToast("Propiedades actualizadas correctamente"),t.reloadPromotion.emit())})()}buildPropertyValuesToUpdate(n){const t={};return Object.entries(n.cells).forEach(([s,r])=>{var c;if(!r.hasBeenEdited)return;const d=this.tableConfig.columns.find(u=>u.key===s);"f_pool_comunitaria"===s?(t.f_pool_comunitaria="Comunitaria"===r.value,t.f_pool_privada="Privada"===r.value,"No"===r.value&&(t.f_pool_comunitaria=!1,t.f_pool_privada=!1)):t[s]=s.startsWith("fcustom_")?"S\xed"===r.value:"price"===s?parseFloat(r.value):r.value,"date"===(null==d||null===(c=d.editMode)||void 0===c?void 0:c.inputType)&&(t[s]=new Date(r.value).toISOString())}),t}onEditTable(n){const t=this.tableComponents.toArray();if(-1!==this.editingTableBlockIndex&&this.editingTableBlockIndex!==n){const r=t[this.editingTableBlockIndex];null!=r&&r.editCellsMode&&(console.log("HACE UN TOGGLE"),r.resetAndCloseTableEditCellsMode())}const s=t[n];s?(s.enableTableEditCellsMode(),this.editingTableBlockIndex=s.editCellsMode?n:-1):console.warn("Table not found for block index:",n)}onSaveTable(n){var t=this;return(0,C.A)(function*(){const r=t.tableComponents.toArray()[n];r?r.editCellsMode&&(yield t.updateEditedRowsFromTable(r),r.resetAndCloseTableEditCellsMode(),t.editingTableBlockIndex=-1):console.warn("Table not found for block index:",n)})()}onEditColumns(){var n=this;return(0,C.A)(function*(){const t=yield n.modalCtrl.create({component:yo,componentProps:{promotion:n.promotion,columns:n.tableConfig.columns,selectedColumnKeys:n.allColumnsKeysSelected},cssClass:"modal-edit-table-columns"});yield t.present();const{data:s,role:r}=yield t.onWillDismiss();if("save"===r&&s){const c=s;n.allColumnsKeysSelected=c,n.blocks.forEach(u=>{var g;null!=u&&null!==(g=u.tableConfig)&&void 0!==g&&g.columns&&u.tableConfig.columns.forEach(l=>{l.show=c.includes(l.key)})}),yield n.api.updatePromotionById(n.promotion.id,{tableColumnsKeysSelected:n.allColumnsKeysSelected})}})()}onRowChecked(n,t){var s=this;return(0,C.A)(function*(){const r=s.blocks[t].tableConfig.rows[n],c=s.checkedRows.findIndex(u=>u.rawObject.id===r.rawObject.id);-1!==c?s.checkedRows.splice(c,1):(s.checkedRows=s.checkedRows.filter(u=>s.blocks.findIndex(l=>{var m;return null===(m=l.properties)||void 0===m?void 0:m.some(h=>h.id===u.rawObject.id)})!==t),s.checkedRows.push(r));const d=s.checkedRows.filter(u=>s.blocks.findIndex(l=>{var m;return null===(m=l.properties)||void 0===m?void 0:m.some(h=>h.id===u.rawObject.id)})===t).length;Array.isArray(s.showDuplicateButtonBlockIndex)||(s.showDuplicateButtonBlockIndex=[]),1===d?s.showDuplicateButtonBlockIndex.includes(t)||s.showDuplicateButtonBlockIndex.push(t):s.showDuplicateButtonBlockIndex=s.showDuplicateButtonBlockIndex.filter(u=>u!==t)})()}onDuplicateProperty(n){var t=this;return(0,C.A)(function*(){const r=t.checkedRows[0].rawObject;(yield t.promotionService.onDuplicateProperty(n,r))&&t.reloadPromotion.emit()})()}onEditBlockTitle(n,t){this.editingBlockTitleIndex=t,this.editedBlockName=n.name||"Bloque "+n.index}onSaveBlockTitle(n,t){var s=this;return(0,C.A)(function*(){n.name=s.editedBlockName;const r=yield s.api.editBlock(n);r&&r.success?s.toastService.showSuccessToast("Nombre del bloque actualizado correctamente"):s.toastService.showErrorToast("Error al actualizar el nombre del bloque"),s.editingBlockTitleIndex=-1})()}onCancelBlockTitle(){this.editingBlockTitleIndex=-1}}return(i=a).\u0275fac=function(n){return new(n||i)(o.rXU(f.W3),o.rXU(Fo.a),o.rXU(R.i),o.rXU(B.c),o.rXU(E.f),o.rXU(Y.M),o.rXU(G.T),o.rXU(L.J))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-details-availability"]],viewQuery:function(n,t){if(1&n&&o.GBs(Mo,5),2&n){let s;o.mGM(s=o.lsd())&&(t.tableComponents=s)}},inputs:{promotion:"promotion"},outputs:{reloadPromotion:"reloadPromotion",sortBlock:"sortBlock"},features:[o.OA$],decls:8,vars:3,consts:[["viewMode",""],["notEditingBlock",""],["tableComponent",""],[1,"crm-section"],["style","margin-bottom: 16px; width: 100%;","class","crm-section",4,"ngIf"],[1,"",2,"border-radius","16px","padding","24px","background","white"],[2,"margin-bottom","40px"],[1,"crm-header-modal","crm-header-modal-empty"],[1,"d-flex","justify-center"],["class","crm-button crm-button-outline-primary",3,"click",4,"ngIf"],[1,"crm-section",2,"margin-bottom","16px","width","100%"],[3,"options"],[1,"crm-header-modal","crm-header-modal-empty",2,"padding","24px 16px","border","1px solid #E0E0E0","border-top-right-radius","16px","border-top-left-radius","16px",3,"ngClass"],[1,"crm-section-title"],[4,"ngIf","ngIfElse"],["class","crm-buttons-group",4,"ngIf"],[3,"table"],[1,"crm-input-input-and-icon"],[1,"crm-input-input"],["type","text","placeholder","Nombre del bloque",3,"ngModelChange","ngModel"],[1,"crm-input-input-and-icon-right"],[1,"title-edit-icons"],[1,"fa-solid","fa-check",3,"click"],[1,"fa-solid","fa-times",3,"click"],["alt","",1,"cursor-pointer",2,"margin-left","8px",3,"click","src"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button",3,"click"],[1,"fa-solid","fa-plus"],[1,"crm-trash-btn"],["alt","",3,"click","src"],[1,"cursor-pointer"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-save"],["class","crm-button-secondary crm-button-secondary-primary",3,"click",4,"ngIf"],[1,"fa-solid","fa-pencil"],[1,"fa-solid","fa-copy"],["alt","",1,"mb-4",3,"src"],["alt","",1,"mb-4",3,"click","src"],[3,"columnClick","rowClicked","rowCheckboxClicked","table"],[1,"crm-text"],[1,"crm-button","crm-button-outline-primary",3,"click"]],template:function(n,t){1&n&&(o.j41(0,"div",3),o.DNE(1,To,2,1,"div",4),o.j41(2,"div",5),o.Z7z(3,$o,8,8,"div",6,o.fX1),o.DNE(5,Uo,3,0,"div",7),o.j41(6,"div",8),o.DNE(7,Oo,3,0,"button",9),o.k0s()()()),2&n&&(o.R7$(),o.Y8G("ngIf",!(null!=t.promotion&&t.promotion.promotionPaymentInfoIsCompleted)),o.R7$(2),o.Dyx(t.blocks),o.R7$(2),o.vxM(0===t.blocks.length?5:-1),o.R7$(2),o.Y8G("ngIf","promoter"===(null==t.currentUser?null:t.currentUser.accountType)))},dependencies:[y.YU,y.bT,_.me,_.BC,_.vS,xo.O,X.l],styles:[".title-edit-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;color:var(--crm-red-color)}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:first-child{color:var(--crm-success-color)}"]}),a})();var W=p(293),z=p(8857),H=p(7221),S=p(1792),F=p(8129);const Wo=i=>({"crm-section-disabled-inputs":i}),zo=(i,a)=>({"fa-solid fa-chevron-down":i,"fa-solid fa-chevron-up":a});function Ho(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",7),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onEdit())}),o.nrm(1,"i",8),o.EFF(2," Editar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function qo(i,a){if(1&i&&o.DNE(0,Ho,3,1,"button",6),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function Ko(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",10),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onSave())}),o.nrm(1,"i",11),o.EFF(2," Guardar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function Jo(i,a){if(1&i&&o.DNE(0,Ko,3,1,"button",9),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function Qo(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",30)(1,"ion-checkbox",31),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(3);return o.DH7(s.promotion.freeSell,t)||(s.promotion.freeSell=t),o.Njj(t)}),o.k0s()()}if(2&i){const e=o.XpG(3);o.R7$(),o.R50("ngModel",e.promotion.freeSell)}}function Zo(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",32),o.bIt("click",function(){o.eBV(e);const t=o.XpG(3);return o.Njj(t.promotion.freeSell=!t.promotion.freeSell)}),o.j41(1,"div",1),o.EFF(2," Venta libre "),o.k0s()()}}function oe(i,a){1&i&&(o.j41(0,"div",33),o.nrm(1,"i",34),o.j41(2,"div",35),o.EFF(3," Si marcas esta opci\xf3n, tu promoci\xf3n ser\xe1 visible para todos los usuarios de Byvaro y, en cada registro, deber\xe1s reconocer los honorarios de los colaboradores. "),o.k0s()())}function ee(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",15),o.EFF(1," Comisi\xf3n de intermediaci\xf3n por venta de propiedades\n"),o.k0s(),o.j41(2,"div",16)(3,"div",17)(4,"div",18),o.EFF(5," Comisi\xf3n de venta "),o.k0s(),o.j41(6,"div",19)(7,"input",20),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.sellCommissionPercentage,t)||(s.promotion.sellCommissionPercentage=t),o.Njj(t)}),o.k0s(),o.j41(8,"div",21),o.EFF(9," % "),o.k0s()()(),o.j41(10,"div",17)(11,"div",18),o.EFF(12," IVA "),o.k0s(),o.j41(13,"div",19)(14,"select",22),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.sellCommissionTaxes,t)||(s.promotion.sellCommissionTaxes=t),o.Njj(t)}),o.j41(15,"option",23),o.EFF(16,"M\xe1s IVA"),o.k0s(),o.j41(17,"option",24),o.EFF(18,"IVA no inclu\xeddo"),o.k0s()()()()(),o.j41(19,"div",25)(20,"div",26),o.DNE(21,Qo,2,1,"div",27)(22,Zo,3,0,"div",28),o.k0s()(),o.DNE(23,oe,4,0,"div",29)}if(2&i){const e=o.XpG(2);o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.sellCommissionPercentage),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.sellCommissionPercentage),o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.sellCommissionTaxes),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.sellCommissionTaxes),o.R7$(7),o.Y8G("ngIf",!e.isDisabled),o.R7$(),o.Y8G("ngIf",e.isDisabled&&e.promotion.freeSell||!e.isDisabled),o.R7$(),o.Y8G("ngIf",(null==e.promotion?null:e.promotion.freeSell)&&!e.isDisabled)}}function te(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",36),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.showAdvancedOptions=!t.showAdvancedOptions)}),o.nrm(1,"i",12),o.EFF(2," Mostrar opciones avanzadas\n"),o.k0s()}if(2&i){const e=o.XpG(2);o.R7$(),o.Y8G("ngClass",o.l_i(1,zo,!e.showAdvancedOptions,e.showAdvancedOptions))}}function ne(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",15),o.EFF(1," Comisi\xf3n de venta para clientes nacionales "),o.k0s(),o.j41(2,"div",16)(3,"div",17)(4,"div",18),o.EFF(5," Comisi\xf3n de venta "),o.k0s(),o.j41(6,"div",19)(7,"input",20),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(3);return o.DH7(s.promotion.nationalCustomersComissionPercentage,t)||(s.promotion.nationalCustomersComissionPercentage=t),o.Njj(t)}),o.k0s(),o.j41(8,"div",21),o.EFF(9," % "),o.k0s()()(),o.j41(10,"div",17)(11,"div",18),o.EFF(12," IVA "),o.k0s(),o.j41(13,"div",19)(14,"select",22),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(3);return o.DH7(s.promotion.nationalCustomersComissionTaxes,t)||(s.promotion.nationalCustomersComissionTaxes=t),o.Njj(t)}),o.j41(15,"option",37),o.EFF(16,"M\xe1s IVA"),o.k0s(),o.j41(17,"option",24),o.EFF(18,"IVA no inclu\xeddo"),o.k0s()()()()()}if(2&i){const e=o.XpG(3);o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.nationalCustomersComissionPercentage),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.nationalCustomersComissionPercentage),o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.nationalCustomersComissionTaxes),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.nationalCustomersComissionTaxes)}}function ie(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",38),o.EFF(1," Comisi\xf3n de venta para clientes internacionales\n"),o.k0s(),o.j41(2,"div",16)(3,"div",17)(4,"div",18),o.EFF(5," Comisi\xf3n de venta "),o.k0s(),o.j41(6,"div",19)(7,"input",20),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(3);return o.DH7(s.promotion.internationalCustomersComissionPercentage,t)||(s.promotion.internationalCustomersComissionPercentage=t),o.Njj(t)}),o.k0s(),o.j41(8,"div",21),o.EFF(9," % "),o.k0s()()(),o.j41(10,"div",17)(11,"div",18),o.EFF(12," IVA "),o.k0s(),o.j41(13,"div",19)(14,"select",22),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(3);return o.DH7(s.promotion.internationalCustomersComissionTaxes,t)||(s.promotion.internationalCustomersComissionTaxes=t),o.Njj(t)}),o.j41(15,"option",37),o.EFF(16,"M\xe1s IVA"),o.k0s(),o.j41(17,"option",24),o.EFF(18,"IVA no inclu\xeddo"),o.k0s()()()()()}if(2&i){const e=o.XpG(3);o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.internationalCustomersComissionPercentage),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.internationalCustomersComissionPercentage),o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.internationalCustomersComissionTaxes),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.internationalCustomersComissionTaxes)}}function se(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",38),o.EFF(1," Comision de venta para colaboradores que no acompa\xf1an al cliente a la visita\n"),o.k0s(),o.j41(2,"div",16)(3,"div",17)(4,"div",18),o.EFF(5," Comisi\xf3n de venta "),o.k0s(),o.j41(6,"div",19)(7,"input",20),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(3);return o.DH7(s.promotion.collaboratorsNoAccompanyingCustomersToVisitPercentage,t)||(s.promotion.collaboratorsNoAccompanyingCustomersToVisitPercentage=t),o.Njj(t)}),o.k0s(),o.j41(8,"div",21),o.EFF(9," % "),o.k0s()()(),o.j41(10,"div",17)(11,"div",18),o.EFF(12," IVA "),o.k0s(),o.j41(13,"div",19)(14,"select",22),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(3);return o.DH7(s.promotion.collaboratorsNoAccompanyingCustomersToVisitTaxes,t)||(s.promotion.collaboratorsNoAccompanyingCustomersToVisitTaxes=t),o.Njj(t)}),o.j41(15,"option",37),o.EFF(16,"M\xe1s IVA"),o.k0s(),o.j41(17,"option",24),o.EFF(18,"IVA no inclu\xeddo"),o.k0s()()()()()}if(2&i){const e=o.XpG(3);o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.collaboratorsNoAccompanyingCustomersToVisitPercentage),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.collaboratorsNoAccompanyingCustomersToVisitPercentage),o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.collaboratorsNoAccompanyingCustomersToVisitTaxes),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.collaboratorsNoAccompanyingCustomersToVisitTaxes)}}function ae(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",38),o.EFF(1," Comision de venta de cliente referido\n"),o.k0s(),o.j41(2,"div",16)(3,"div",17)(4,"div",18),o.EFF(5," Comisi\xf3n de venta "),o.k0s(),o.j41(6,"div",19)(7,"input",20),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(3);return o.DH7(s.promotion.referralCommissionPercentage,t)||(s.promotion.referralCommissionPercentage=t),o.Njj(t)}),o.k0s(),o.j41(8,"div",21),o.EFF(9," % "),o.k0s()()(),o.j41(10,"div",17)(11,"div",18),o.EFF(12," IVA "),o.k0s(),o.j41(13,"div",19)(14,"select",22),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(3);return o.DH7(s.promotion.referralCommissionTaxes,t)||(s.promotion.referralCommissionTaxes=t),o.Njj(t)}),o.j41(15,"option",37),o.EFF(16,"M\xe1s IVA"),o.k0s(),o.j41(17,"option",24),o.EFF(18,"IVA no inclu\xeddo"),o.k0s()()()()()}if(2&i){const e=o.XpG(3);o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.referralCommissionPercentage),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.referralCommissionPercentage),o.R7$(6),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.referralCommissionTaxes),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.referralCommissionTaxes)}}function re(i,a){if(1&i&&(o.j41(0,"div"),o.DNE(1,ne,19,8)(2,ie,19,8)(3,se,19,8)(4,ae,19,8),o.k0s()),2&i){const e=o.XpG(2);o.R7$(),o.vxM(e.isDisabled&&e.promotion.nationalCustomersComissionPercentage||!e.isDisabled?1:-1),o.R7$(),o.vxM(e.isDisabled&&e.promotion.internationalCustomersComissionPercentage||!e.isDisabled?2:-1),o.R7$(),o.vxM(e.isDisabled&&e.promotion.collaboratorsNoAccompanyingCustomersToVisitPercentage||!e.isDisabled?3:-1),o.R7$(),o.vxM(e.isDisabled&&e.promotion.referralCommissionPercentage||!e.isDisabled?4:-1)}}function le(i,a){if(1&i&&(o.j41(0,"div",12),o.DNE(1,ee,24,11)(2,te,3,4,"button",13)(3,re,5,4,"div",14),o.k0s()),2&i){const e=o.XpG();o.Y8G("ngClass",o.eq3(4,Wo,e.isDisabled)),o.R7$(),o.vxM(e.isDisabled&&(!e.isDisabled||null!=e.promotion&&e.promotion.nationalCustomersComissionPercentage||null!=e.promotion&&e.promotion.internationalCustomersComissionPercentage||null!=e.promotion&&e.promotion.collaboratorsNoAccompanyingCustomersToVisitPercentage||null!=e.promotion&&e.promotion.referralCommissionPercentage)?-1:1),o.R7$(),o.Y8G("ngIf",!e.isDisabled),o.R7$(),o.Y8G("ngIf",!e.isDisabled&&e.showAdvancedOptions||e.isDisabled)}}let q=(()=>{var i;class a{constructor(){this.promotionUpdated=new o.bkB,this.loadingButton=!1,this.isDisabled=!0,this.showAdvancedOptions=!1}ngOnInit(){}set promotionData(n){this.promotion=n}onEdit(){this.isDisabled=!this.isDisabled}onSave(){this.savePromotion(),this.isDisabled=!0}savePromotion(){this.promotionUpdated.emit({sellCommissionPercentage:this.promotion.sellCommissionPercentage,sellCommissionTaxes:this.promotion.sellCommissionTaxes,freeSell:this.promotion.freeSell,nationalCustomersComissionPercentage:this.promotion.nationalCustomersComissionPercentage,nationalCustomersComissionTaxes:this.promotion.nationalCustomersComissionTaxes,internationalCustomersComissionPercentage:this.promotion.internationalCustomersComissionPercentage,internationalCustomersComissionTaxes:this.promotion.internationalCustomersComissionTaxes,collaboratorsNoAccompanyingCustomersToVisitPercentage:this.promotion.collaboratorsNoAccompanyingCustomersToVisitPercentage,collaboratorsNoAccompanyingCustomersToVisitTaxes:this.promotion.collaboratorsNoAccompanyingCustomersToVisitTaxes,referralCommissionPercentage:this.promotion.referralCommissionPercentage,referralCommissionTaxes:this.promotion.referralCommissionTaxes})}}return(i=a).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-payments-details-commission"]],inputs:{currentUser:"currentUser"},outputs:{promotionUpdated:"promotionUpdated"},decls:6,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"appLoadingButton"],[1,"crm-button","crm-button-success",3,"appLoadingButton"],[3,"ngClass",4,"ngIf"],["class","crm-button-secondary crm-button-secondary-primary",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click","appLoadingButton"],[1,"fa-solid","fa-edit"],["class","crm-button crm-button-success",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button","crm-button-success",3,"click","appLoadingButton"],[1,"fa-solid","fa-check"],[3,"ngClass"],["class","crm-button-secondary crm-button-secondary-primary crm-section-margin-top crm-section-margin-bottom",3,"click",4,"ngIf"],[4,"ngIf"],[1,"crm-title-14"],[1,"crm-section-inputs-double-input","crm-section-margin-top"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input",3,"appInputViewMode","externalInputValue"],["type","number","placeholder","Nombre",3,"ngModelChange","disabled","ngModel"],[1,"crm-input-input-symbol"],["placeholder","Seleccione",3,"ngModelChange","disabled","ngModel"],["value","iva"],["value","no_iva"],[1,"crm-section-inline-checkboxes","crm-section-margin-top",2,"margin-top","24px"],[1,"crm-card-user-header"],["class","crm-input-checkbox",4,"ngIf"],["class","crm-card-user-header-data",3,"click",4,"ngIf"],["class","crm-info-banner red-icon",4,"ngIf"],[1,"crm-input-checkbox"],[3,"ngModelChange","ngModel"],[1,"crm-card-user-header-data",3,"click"],[1,"crm-info-banner","red-icon"],[1,"fa-solid","fa-triangle-exclamation"],[1,"crm-text"],[1,"crm-button-secondary","crm-button-secondary-primary","crm-section-margin-top","crm-section-margin-bottom",3,"click"],["value","iva","default",""],[1,"crm-title-14","crm-section-margin-top"]],template:function(n,t){1&n&&(o.j41(0,"div",0),o.nrm(1,"div",1),o.j41(2,"div",2),o.DNE(3,qo,1,1,"button",3)(4,Jo,1,1,"button",4),o.k0s()(),o.DNE(5,le,4,6,"div",5)),2&n&&(o.R7$(3),o.vxM(t.isDisabled?3:4),o.R7$(2),o.Y8G("ngIf",t.promotion))},dependencies:[y.YU,y.bT,_.xH,_.y7,_.me,_.Q0,_.wz,_.BC,_.vS,f.eY,f.hB,S.M,F.K],styles:[".crm-header-modal-empty[_ngcontent-%COMP%]{padding-right:0;padding-left:0}"]}),a})();const ce=i=>({"crm-section-disabled-inputs":i}),K=i=>({"crm-section-invisible":i}),J=i=>({opacity:i}),N=i=>({"crm-input-input-error":i});function me(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",7),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onEdit())}),o.nrm(1,"i",8),o.EFF(2," Editar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function de(i,a){if(1&i&&o.DNE(0,me,3,1,"button",6),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function pe(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",10),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onSave())}),o.nrm(1,"i",11),o.EFF(2," Guardar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function ue(i,a){if(1&i&&o.DNE(0,pe,3,1,"button",9),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function _e(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",42)(1,"ion-checkbox",43),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.deliveryDateModalityByStatus,t)||(s.promotion.deliveryDateModalityByStatus=t),o.Njj(t)}),o.bIt("ionChange",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onSelectModality("deliveryDateModalityByStatus"))}),o.k0s()()}if(2&i){const e=o.XpG(2);o.R7$(),o.R50("ngModel",e.promotion.deliveryDateModalityByStatus)}}function ge(i,a){1&i&&(o.j41(0,"div",44),o.EFF(1," Es necesario seleccionar el estado de promoci\xf3n. "),o.k0s())}function ve(i,a){1&i&&o.EFF(0," Fecha de finalizaci\xf3n ")}function ye(i,a){1&i&&o.EFF(0," Entrega de llaves ")}function fe(i,a){1&i&&(o.j41(0,"div",44),o.EFF(1," Es necesario seleccionar la fecha. "),o.k0s())}function Ce(i,a){1&i&&o.EFF(0," Aplicar a todas las unidades ")}function be(i,a){1&i&&o.EFF(0," Cada unidad tiene fecha de entrega diferente ")}function he(i,a){if(1&i&&(o.j41(0,"div",45),o.DNE(1,Ce,1,0)(2,be,1,0),o.k0s()),2&i){const e=o.XpG(2);o.R7$(),o.vxM(null!=e.promotion&&e.promotion.applyingDeliveryDateForAllProperties?1:2)}}function Pe(i,a){1&i&&(o.j41(0,"div",44),o.EFF(1," Es necesario seleccionar una opci\xf3n. "),o.k0s())}function De(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",46)(1,"ion-radio-group",47),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.applyingDeliveryDateForAllProperties,t)||(s.promotion.applyingDeliveryDateForAllProperties=t),o.Njj(t)}),o.j41(2,"div",48),o.nrm(3,"ion-radio",49),o.j41(4,"div",50),o.EFF(5," Aplicar a todas las unidades "),o.k0s()(),o.j41(6,"div",48),o.nrm(7,"ion-radio",49),o.j41(8,"div",50),o.EFF(9," Cada unidad tiene fecha de entrega diferente "),o.k0s()()(),o.DNE(10,Pe,2,0,"div",33),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.applyingDeliveryDateForAllProperties),o.R7$(),o.R50("ngModel",e.promotion.applyingDeliveryDateForAllProperties),o.Y8G("ngClass",o.eq3(7,N,e.isFieldInvalid("applyingDeliveryDateForAllProperties","status"))),o.R7$(2),o.Y8G("value",!0),o.R7$(4),o.Y8G("value",!1),o.R7$(3),o.Y8G("ngIf",e.isFieldInvalid("applyingDeliveryDateForAllProperties","status"))}}function ke(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",42)(1,"ion-checkbox",43),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.deliveryDateModalityByMonths,t)||(s.promotion.deliveryDateModalityByMonths=t),o.Njj(t)}),o.bIt("ionChange",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onSelectModality("deliveryDateModalityByMonths"))}),o.k0s()()}if(2&i){const e=o.XpG(2);o.R7$(),o.R50("ngModel",e.promotion.deliveryDateModalityByMonths)}}function Fe(i,a){if(1&i&&(o.j41(0,"option",49),o.EFF(1),o.k0s()),2&i){const e=a.$implicit;o.Y8G("value",e),o.R7$(),o.SpI("",e," meses")}}function xe(i,a){1&i&&o.EFF(0," Desde la firma del contrato ")}function Me(i,a){1&i&&o.EFF(0," Desde la obtenci\xf3n de la licencia ")}function Ie(i,a){if(1&i&&(o.j41(0,"div",45),o.DNE(1,xe,1,0)(2,Me,1,0),o.k0s()),2&i){const e=o.XpG(2);o.R7$(),o.vxM("contractSignature"===(null==e.promotion?null:e.promotion.deliveryMonthsFrom)?1:2)}}function Te(i,a){1&i&&(o.j41(0,"div",44),o.EFF(1," Es necesario seleccionar desde cu\xe1ndo se aplica la fecha. "),o.k0s())}function je(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",46)(1,"ion-radio-group",47),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.deliveryMonthsFrom,t)||(s.promotion.deliveryMonthsFrom=t),o.Njj(t)}),o.j41(2,"div",48),o.nrm(3,"ion-radio",49),o.j41(4,"div",50),o.EFF(5," Desde la firma del contrato "),o.k0s()(),o.j41(6,"div",48),o.nrm(7,"ion-radio",49),o.j41(8,"div",50),o.EFF(9," Desde la obtenci\xf3n de la licencia "),o.k0s()()(),o.DNE(10,Te,2,0,"div",33),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.deliveryMonthsFrom),o.R7$(),o.R50("ngModel",e.promotion.deliveryMonthsFrom),o.Y8G("ngClass",o.eq3(7,N,e.isFieldInvalid("deliveryMonthsFrom","months"))),o.R7$(2),o.Y8G("value","contractSignature"),o.R7$(4),o.Y8G("value","license"),o.R7$(3),o.Y8G("ngIf",e.isFieldInvalid("deliveryMonthsFrom","months"))}}function Re(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",12)(1,"div",13)(2,"div",14),o.DNE(3,_e,2,1,"div",15),o.j41(4,"div",16)(5,"div",1)(6,"b",17),o.EFF(7,"Fecha estimada de entrega."),o.k0s(),o.EFF(8," (Indica una fecha concreta de entrega de la propiedad.) "),o.k0s()()(),o.j41(9,"div",18)(10,"div",19)(11,"div",20)(12,"div",21),o.EFF(13," Estado de promoci\xf3n "),o.k0s(),o.j41(14,"div",22)(15,"select",23),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.constructionStatus,t)||(s.promotion.constructionStatus=t),o.Njj(t)}),o.j41(16,"option",24),o.EFF(17,"Proyecto sin licencia"),o.k0s(),o.j41(18,"option",25),o.EFF(19,"Proyecto con licencia"),o.k0s(),o.j41(20,"option",26),o.EFF(21,"En fase de excavaci\xf3n"),o.k0s(),o.j41(22,"option",27),o.EFF(23,"Cimentaci\xf3n completada"),o.k0s(),o.j41(24,"option",28),o.EFF(25,"Estructura en construcci\xf3n"),o.k0s(),o.j41(26,"option",29),o.EFF(27,"Cerramiento completado"),o.k0s(),o.j41(28,"option",30),o.EFF(29,"Instalaciones en proceso"),o.k0s(),o.j41(30,"option",31),o.EFF(31,"Acabados interiores"),o.k0s(),o.j41(32,"option",32),o.EFF(33,"Obra finalizada"),o.k0s()()(),o.DNE(34,ge,2,0,"div",33),o.k0s(),o.j41(35,"div",20)(36,"div",21),o.DNE(37,ve,1,0)(38,ye,1,0),o.k0s(),o.j41(39,"div",22)(40,"input",34),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.keyDeliveryDate,t)||(s.promotion.keyDeliveryDate=t),o.Njj(t)}),o.k0s()(),o.DNE(41,fe,2,0,"div",33),o.k0s()(),o.j41(42,"div",35),o.DNE(43,he,3,1,"div",36)(44,De,11,9,"div",37),o.k0s()()(),o.j41(45,"div",13)(46,"div",14),o.DNE(47,ke,2,1,"div",15),o.j41(48,"div",16)(49,"div",1)(50,"b",17),o.EFF(51,"Plazo de entrega en meses."),o.k0s(),o.EFF(52," (N\xfamero de meses desde a firma del contrato de compraventa u obtenci\xf3n de licencia.) "),o.k0s()()(),o.j41(53,"div",18)(54,"div",19)(55,"div",38)(56,"div",21),o.EFF(57," Entrega en "),o.k0s(),o.j41(58,"div",39)(59,"select",40),o.DNE(60,Fe,2,2,"option",41),o.k0s()()(),o.nrm(61,"div",38),o.k0s(),o.j41(62,"div",35),o.DNE(63,Ie,3,1,"div",36)(64,je,11,9,"div",37),o.k0s()()()()}if(2&i){const e=o.XpG();o.Y8G("ngClass",o.eq3(27,ce,e.isDisabled)),o.R7$(),o.Y8G("ngClass",o.eq3(29,K,!(e.isDisabled&&e.promotion.deliveryDateModalityByStatus||!e.isDisabled))),o.R7$(2),o.Y8G("ngIf",!e.isDisabled),o.R7$(6),o.Y8G("ngStyle",o.eq3(31,J,e.promotion.deliveryDateModalityByStatus?"1":"0.3")),o.R7$(2),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.constructionStatus),o.R7$(3),o.Y8G("ngClass",o.eq3(33,N,e.isFieldInvalid("constructionStatus","status"))),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.constructionStatus),o.R7$(19),o.Y8G("ngIf",e.isFieldInvalid("constructionStatus","status")),o.R7$(),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.keyDeliveryDate),o.R7$(2),o.vxM("obra-finalizada"===(null==e.promotion?null:e.promotion.constructionStatus)?37:38),o.R7$(2),o.Y8G("ngClass",o.eq3(35,N,e.isFieldInvalid("keyDeliveryDate","status"))),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.keyDeliveryDate),o.R7$(),o.Y8G("ngIf",e.isFieldInvalid("keyDeliveryDate","status")),o.R7$(2),o.Y8G("ngIf",e.isDisabled),o.R7$(),o.Y8G("ngIf",!e.isDisabled),o.R7$(),o.Y8G("ngClass",o.eq3(37,K,!(e.isDisabled&&e.promotion.deliveryDateModalityByMonths||!e.isDisabled))),o.R7$(2),o.Y8G("ngIf",!e.isDisabled),o.R7$(6),o.Y8G("ngStyle",o.eq3(39,J,e.promotion.deliveryDateModalityByMonths?"1":"0.3")),o.R7$(5),o.Y8G("appInputViewMode",e.isDisabled),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R7$(),o.Y8G("ngForOf",e.months),o.R7$(3),o.Y8G("ngIf",e.isDisabled),o.R7$(),o.Y8G("ngIf",!e.isDisabled)}}let Q=(()=>{var i;class a{constructor(){this.promotionUpdated=new o.bkB,this.loadingButton=!1,this.isDisabled=!0,this.months=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]}ngOnInit(){}set promotionData(n){var t,s;this.promotion=n,null!==(t=this.promotion)&&void 0!==t&&t.deliveryDateModalityByStatus||null!==(s=this.promotion)&&void 0!==s&&s.deliveryDateModalityByMonths||(this.promotion.deliveryDateModalityByStatus=!0)}onEdit(){var n,t;this.isDisabled=!this.isDisabled,null!==(n=this.promotion)&&void 0!==n&&n.deliveryDateModalityByStatus||null!==(t=this.promotion)&&void 0!==t&&t.deliveryDateModalityByMonths||(this.promotion.deliveryDateModalityByStatus=!0)}onSave(){!this.isDisabled&&!this.isFormValid()||(this.savePromotion(),this.isDisabled=!0)}onSelectModality(n){"deliveryDateModalityByStatus"===n&&(this.promotion.deliveryDateModalityByMonths=!1),"deliveryDateModalityByMonths"===n&&(this.promotion.deliveryDateModalityByStatus=!1)}savePromotion(){this.promotionUpdated.emit({deliveryDateModalityByStatus:this.promotion.deliveryDateModalityByStatus,constructionStatus:this.promotion.constructionStatus,keyDeliveryDate:this.promotion.keyDeliveryDate,applyingDeliveryDateForAllProperties:this.promotion.applyingDeliveryDateForAllProperties,deliveryDateModalityByMonths:this.promotion.deliveryDateModalityByMonths,deliveryMonthsFrom:this.promotion.deliveryMonthsFrom})}isFieldInvalid(n,t){if(this.isDisabled||!this.promotion||"status"===t&&!this.promotion.deliveryDateModalityByStatus||"months"===t&&!this.promotion.deliveryDateModalityByMonths)return!1;const s=this.promotion[n];return null==s||"string"==typeof s&&""===s.trim()}isFormValid(){let n=!0;return this.promotion.deliveryDateModalityByStatus&&(n=n&&!this.isFieldInvalid("constructionStatus","status")&&!this.isFieldInvalid("keyDeliveryDate","status")&&!this.isFieldInvalid("applyingDeliveryDateForAllProperties","status")),this.promotion.deliveryDateModalityByMonths&&(n=n&&!this.isFieldInvalid("deliveryMonthsFrom","months")),n}}return(i=a).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-payments-details-delivery-date"]],inputs:{currentUser:"currentUser"},outputs:{promotionUpdated:"promotionUpdated"},decls:6,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"appLoadingButton"],[1,"crm-button","crm-button-success",3,"appLoadingButton"],[3,"ngClass",4,"ngIf"],["class","crm-button-secondary crm-button-secondary-primary",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click","appLoadingButton"],[1,"fa-solid","fa-edit"],["class","crm-button crm-button-success",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button","crm-button-success",3,"click","appLoadingButton"],[1,"fa-solid","fa-check"],[3,"ngClass"],[1,"crm-card-user","crm-section-margin-top",3,"ngClass"],[1,"crm-card-user-header"],["class","crm-input-checkbox",4,"ngIf"],[1,"crm-card-user-header-data"],[2,"font-weight","bold !important"],[1,"crm-card-user-body",2,"margin-bottom","0",3,"ngStyle"],[1,"crm-section-inputs-double-input"],[1,"crm-input",3,"appInputViewMode","externalInputValue"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["placeholder","Seleccione",3,"ngModelChange","disabled","ngModel"],["value","proyecto-sin-licencia"],["value","proyecto-con-licencia"],["value","fase-excavacion"],["value","cimentacion-completada"],["value","estructura-construccion"],["value","cerramiento-completado"],["value","instalaciones-proceso"],["value","acabados-interiores"],["value","obra-finalizada"],["class","crm-input-error",4,"ngIf"],["type","date","placeholder","Nombre",3,"ngModelChange","disabled","ngModel"],[1,"crm-section-inline-checkboxes","crm-section-margin-top",2,"margin-top","24px"],["class","crm-text",4,"ngIf"],["class","crm-input crm-input-radio-box",3,"appInputViewMode","externalInputValue",4,"ngIf"],[1,"crm-input"],[1,"crm-input-input",3,"appInputViewMode"],["placeholder","Seleccione",3,"disabled"],[3,"value",4,"ngFor","ngForOf"],[1,"crm-input-checkbox"],[3,"ngModelChange","ionChange","ngModel"],[1,"crm-input-error"],[1,"crm-text"],[1,"crm-input","crm-input-radio-box",3,"appInputViewMode","externalInputValue"],[1,"crm-input-radios",3,"ngModelChange","ngModel","ngClass"],[1,"crm-input-radio"],[3,"value"],[1,"crm-input-radio-label"]],template:function(n,t){1&n&&(o.j41(0,"div",0),o.nrm(1,"div",1),o.j41(2,"div",2),o.DNE(3,de,1,1,"button",3)(4,ue,1,1,"button",4),o.k0s()(),o.DNE(5,Re,65,41,"div",5)),2&n&&(o.R7$(3),o.vxM(t.isDisabled?3:4),o.R7$(2),o.Y8G("ngIf",t.promotion))},dependencies:[y.YU,y.Sq,y.bT,y.B3,_.xH,_.y7,_.me,_.wz,_.BC,_.vS,f.eY,f.KO,f.f0,f.hB,f.Je,S.M,F.K],styles:[".crm-header-modal-empty[_ngcontent-%COMP%]{padding-right:0;padding-left:0}"]}),a})();var w=p(4842);const Ee=i=>({"crm-section-disabled-inputs":i}),M=i=>({"crm-input-input-error":i});function Ge(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",7),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onEdit())}),o.nrm(1,"i",8),o.EFF(2," Editar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function Be(i,a){if(1&i&&o.DNE(0,Ge,3,1,"button",6),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function Se(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",10),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onSave())}),o.nrm(1,"i",11),o.EFF(2," Guardar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function Ne(i,a){if(1&i&&o.DNE(0,Se,3,1,"button",9),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function Ve(i,a){1&i&&(o.j41(0,"div",37),o.EFF(1," Es necesario introducir el pago de reserva. "),o.k0s())}function Xe(i,a){1&i&&(o.j41(0,"div",37),o.EFF(1," Es necesario seleccionar la expiraci\xf3n. "),o.k0s())}function we(i,a){1&i&&(o.j41(0,"div",37),o.EFF(1," Es necesario seleccionar el contrato. "),o.k0s())}function Ae(i,a){1&i&&(o.j41(0,"div",37),o.EFF(1," Es necesario introducir el porcentaje de pago. "),o.k0s())}function Ye(i,a){1&i&&(o.j41(0,"div",37),o.EFF(1," Es necesario introducir el restante. "),o.k0s())}function $e(i,a){1&i&&(o.j41(0,"div",37),o.EFF(1," Es necesario seleccionar cu\xe1ndo se paga el restante. "),o.k0s())}function Ue(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",38)(1,"ion-radio-group",39),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.buyAndSellContractPaymentRestantWhen,t)||(s.promotion.buyAndSellContractPaymentRestantWhen=t),o.Njj(t)}),o.j41(2,"div",40),o.nrm(3,"ion-radio",41),o.j41(4,"div",42),o.EFF(5," A la firma de escritura p\xfablica "),o.k0s()(),o.j41(6,"div",40),o.nrm(7,"ion-radio",43),o.j41(8,"div",42),o.EFF(9," Por certificaci\xf3n "),o.k0s()()(),o.DNE(10,$e,2,0,"div",20),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.buyAndSellContractPaymentRestantWhen),o.R7$(),o.R50("ngModel",e.promotion.buyAndSellContractPaymentRestantWhen),o.R7$(9),o.Y8G("ngIf",e.isFieldInvalid("buyAndSellContractPaymentRestantWhen"))}}function Oe(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",69),o.bIt("click",function(){o.eBV(e);const t=o.XpG().$index,s=o.XpG(3);return o.Njj(s.onDelete(t))}),o.nrm(1,"i",70),o.k0s()}}function Le(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",44)(1,"div",47),o.EFF(2),o.k0s(),o.j41(3,"div",15)(4,"div",48)(5,"input",33),o.mxI("ngModelChange",function(t){const s=o.eBV(e).$implicit;return o.DH7(s.percentage,t)||(s.percentage=t),o.Njj(t)}),o.bIt("ngModelChange",function(){o.eBV(e);const t=o.XpG(3);return o.Njj(t.onQuantityPercentageChange())}),o.k0s(),o.j41(6,"div",19),o.EFF(7," % "),o.k0s()()(),o.j41(8,"div",15)(9,"div",48)(10,"select",49),o.mxI("ngModelChange",function(t){const s=o.eBV(e).$implicit;return o.DH7(s.typeOfPercentage,t)||(s.typeOfPercentage=t),o.Njj(t)}),o.j41(11,"option",50),o.EFF(12),o.nI1(13,"translate"),o.k0s(),o.j41(14,"option",51),o.EFF(15),o.nI1(16,"translate"),o.k0s(),o.j41(17,"option",52),o.EFF(18),o.nI1(19,"translate"),o.k0s(),o.j41(20,"option",53),o.EFF(21),o.nI1(22,"translate"),o.k0s(),o.j41(23,"option",54),o.EFF(24),o.nI1(25,"translate"),o.k0s(),o.j41(26,"option",55),o.EFF(27),o.nI1(28,"translate"),o.k0s(),o.j41(29,"option",56),o.EFF(30),o.nI1(31,"translate"),o.k0s(),o.j41(32,"option",57),o.EFF(33),o.nI1(34,"translate"),o.k0s(),o.j41(35,"option",58),o.EFF(36),o.nI1(37,"translate"),o.k0s(),o.j41(38,"option",59),o.EFF(39),o.nI1(40,"translate"),o.k0s(),o.j41(41,"option",60),o.EFF(42),o.nI1(43,"translate"),o.k0s(),o.j41(44,"option",61),o.EFF(45),o.nI1(46,"translate"),o.k0s(),o.j41(47,"option",62),o.EFF(48),o.nI1(49,"translate"),o.k0s(),o.j41(50,"option",63),o.EFF(51),o.nI1(52,"translate"),o.k0s(),o.j41(53,"option",64),o.EFF(54),o.nI1(55,"translate"),o.k0s(),o.j41(56,"option",65),o.EFF(57),o.nI1(58,"translate"),o.k0s(),o.j41(59,"option",66),o.EFF(60),o.nI1(61,"translate"),o.k0s(),o.j41(62,"option",67),o.EFF(63),o.nI1(64,"translate"),o.k0s()()()(),o.DNE(65,Oe,2,0,"button",68),o.k0s()}if(2&i){const e=a.$implicit,n=a.$index,t=o.XpG(3);o.R7$(2),o.SpI(" ",n+1," "),o.R7$(),o.Y8G("appInputViewMode",t.isDisabled)("externalInputValue",e.percentage),o.R7$(2),o.Y8G("disabled",t.isDisabled),o.R50("ngModel",e.percentage),o.R7$(3),o.Y8G("appInputViewMode",t.isDisabled)("externalInputValue",e.typeOfPercentage),o.R7$(2),o.R50("ngModel",e.typeOfPercentage),o.R7$(2),o.JRh(o.bMT(13,27,"text.movimiento_tierras")),o.R7$(3),o.JRh(o.bMT(16,29,"text.cimentacion")),o.R7$(3),o.JRh(o.bMT(19,31,"text.estructura")),o.R7$(3),o.JRh(o.bMT(22,33,"text.cerramientos_exteriores")),o.R7$(3),o.JRh(o.bMT(25,35,"text.cubierta_tejado")),o.R7$(3),o.JRh(o.bMT(28,37,"text.carpinteria_exterior")),o.R7$(3),o.JRh(o.bMT(31,39,"text.instalaciones_basicas")),o.R7$(3),o.JRh(o.bMT(34,41,"text.tabiqueria_revestimientos")),o.R7$(3),o.JRh(o.bMT(37,43,"text.yeso_enlucidos")),o.R7$(3),o.JRh(o.bMT(40,45,"text.solados_alicatados")),o.R7$(3),o.JRh(o.bMT(43,47,"text.carpinteria_interior")),o.R7$(3),o.JRh(o.bMT(46,49,"text.pintura_interior")),o.R7$(3),o.JRh(o.bMT(49,51,"text.sanitarios_griferias")),o.R7$(3),o.JRh(o.bMT(52,53,"text.ascensores_comunes")),o.R7$(3),o.JRh(o.bMT(55,55,"text.zonas_comunes")),o.R7$(3),o.JRh(o.bMT(58,57,"text.finalizacion_obra")),o.R7$(3),o.JRh(o.bMT(61,59,"text.licencia_ocupacion")),o.R7$(3),o.JRh(o.bMT(64,61,"text.entrega_llaves")),o.R7$(2),o.Y8G("ngIf",!t.isDisabled)}}function We(i,a){if(1&i&&(o.j41(0,"div",71),o.EFF(1),o.k0s()),2&i){const e=o.XpG(3);o.R7$(),o.SpI(" La suma de los porcentajes no puede superar el restante (",e.promotion.buyAndSellContractPaymentRestantPercentage,"%) ")}}function ze(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",72)(1,"button",73),o.bIt("click",function(){o.eBV(e);const t=o.XpG(3);return o.Njj(t.onAddCharge())}),o.nrm(2,"i",74),o.EFF(3," A\xf1adir m\xe1s pagos "),o.k0s()()}}function He(i,a){if(1&i&&(o.j41(0,"div",30),o.EFF(1," Definir cobros de las certificaciones "),o.k0s(),o.Z7z(2,Le,66,63,"div",44,o.fX1),o.DNE(4,We,2,1,"div",45)(5,ze,4,0,"div",46)),2&i){const e=o.XpG(2);o.R7$(2),o.Dyx(null==e.promotion?null:e.promotion.certificationsCharges),o.R7$(2),o.Y8G("ngIf",e.percentagesOverflowsMaximum),o.R7$(),o.Y8G("ngIf",!e.isDisabled)}}function qe(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",12)(1,"div",13),o.EFF(2," Reserva "),o.k0s(),o.j41(3,"div",14)(4,"div",15)(5,"div",16),o.EFF(6," Pago de reserva "),o.k0s(),o.j41(7,"div",17)(8,"input",18),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.reservePayment,t)||(s.promotion.reservePayment=t),o.Njj(t)}),o.k0s(),o.j41(9,"div",19),o.EFF(10," \u20ac "),o.k0s()(),o.DNE(11,Ve,2,0,"div",20),o.k0s(),o.j41(12,"div",15)(13,"div",16),o.EFF(14," Expira en "),o.k0s(),o.j41(15,"div",17)(16,"select",21),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.reservePaymentExpirationDays,t)||(s.promotion.reservePaymentExpirationDays=t),o.Njj(t)}),o.j41(17,"option",22),o.EFF(18,"7 d\xedas"),o.k0s(),o.j41(19,"option",23),o.EFF(20,"14 d\xedas"),o.k0s(),o.j41(21,"option",24),o.EFF(22,"21 d\xedas"),o.k0s(),o.j41(23,"option",25),o.EFF(24,"28 d\xedas"),o.k0s(),o.j41(25,"option",26),o.EFF(26,"2 meses"),o.k0s(),o.j41(27,"option",27),o.EFF(28,"3 meses"),o.k0s(),o.j41(29,"option",28),o.EFF(30,"4 meses"),o.k0s(),o.j41(31,"option",29),o.EFF(32,"No definido"),o.k0s()()(),o.DNE(33,Xe,2,0,"div",20),o.k0s()(),o.j41(34,"div",30),o.EFF(35," Compra venta "),o.k0s(),o.j41(36,"div",14)(37,"div",15)(38,"div",16),o.EFF(39," Contrato de compra-venta en "),o.k0s(),o.j41(40,"div",17)(41,"select",21),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.buyAndSellContractInDays,t)||(s.promotion.buyAndSellContractInDays=t),o.Njj(t)}),o.j41(42,"option",22),o.EFF(43,"7 d\xedas"),o.k0s(),o.j41(44,"option",23),o.EFF(45,"14 d\xedas"),o.k0s(),o.j41(46,"option",24),o.EFF(47,"21 d\xedas"),o.k0s(),o.j41(48,"option",25),o.EFF(49,"28 d\xedas"),o.k0s(),o.j41(50,"option",26),o.EFF(51,"2 meses"),o.k0s(),o.j41(52,"option",27),o.EFF(53,"3 meses"),o.k0s(),o.j41(54,"option",28),o.EFF(55,"4 meses"),o.k0s(),o.j41(56,"option",29),o.EFF(57,"No definido"),o.k0s()()(),o.DNE(58,we,2,0,"div",20),o.k0s(),o.j41(59,"div",15)(60,"div",16),o.EFF(61," Porcentaje de pago "),o.k0s(),o.j41(62,"div",17)(63,"input",31),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.buyAndSellContractPaymentQuantityPercentage,t)||(s.promotion.buyAndSellContractPaymentQuantityPercentage=t),o.Njj(t)}),o.bIt("ngModelChange",function(){o.eBV(e);const t=o.XpG();return o.Njj(t.onQuantityPercentageChange())}),o.k0s(),o.j41(64,"div",19),o.EFF(65," % "),o.k0s()(),o.DNE(66,Ae,2,0,"div",20),o.k0s()(),o.j41(67,"div",32)(68,"div",15)(69,"div",16),o.EFF(70," Restante "),o.k0s(),o.j41(71,"div",17)(72,"input",33),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.buyAndSellContractPaymentRestantPercentage,t)||(s.promotion.buyAndSellContractPaymentRestantPercentage=t),o.Njj(t)}),o.bIt("ngModelChange",function(){o.eBV(e);const t=o.XpG();return o.Njj(t.onQuantityPercentageChange())}),o.k0s(),o.j41(73,"div",19),o.EFF(74," % "),o.k0s()(),o.DNE(75,Ye,2,0,"div",20),o.k0s(),o.nrm(76,"div",34),o.k0s(),o.j41(77,"div",35),o.DNE(78,Ue,11,4,"div",36),o.k0s(),o.DNE(79,He,6,2),o.k0s()}if(2&i){const e=o.XpG();o.Y8G("ngClass",o.eq3(33,Ee,e.isDisabled)),o.R7$(4),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.reservePayment),o.R7$(3),o.Y8G("ngClass",o.eq3(35,M,e.isFieldInvalid("reservePayment"))),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.reservePayment),o.R7$(3),o.Y8G("ngIf",e.isFieldInvalid("reservePayment")),o.R7$(),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.reservePaymentExpirationDays),o.R7$(3),o.Y8G("ngClass",o.eq3(37,M,e.isFieldInvalid("reservePaymentExpirationDays"))),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.reservePaymentExpirationDays),o.R7$(17),o.Y8G("ngIf",e.isFieldInvalid("reservePaymentExpirationDays")),o.R7$(4),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.buyAndSellContractInDays),o.R7$(3),o.Y8G("ngClass",o.eq3(39,M,e.isFieldInvalid("buyAndSellContractInDays"))),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.buyAndSellContractInDays),o.R7$(17),o.Y8G("ngIf",e.isFieldInvalid("buyAndSellContractInDays")),o.R7$(),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.buyAndSellContractPaymentQuantityPercentage),o.R7$(3),o.Y8G("ngClass",o.eq3(41,M,e.isFieldInvalid("buyAndSellContractPaymentQuantityPercentage"))),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.buyAndSellContractPaymentQuantityPercentage),o.R7$(3),o.Y8G("ngIf",e.isFieldInvalid("buyAndSellContractPaymentQuantityPercentage")),o.R7$(2),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.buyAndSellContractPaymentRestantPercentage),o.R7$(3),o.Y8G("ngClass",o.eq3(43,M,e.isFieldInvalid("buyAndSellContractPaymentRestantPercentage"))),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.buyAndSellContractPaymentRestantPercentage),o.R7$(3),o.Y8G("ngIf",e.isFieldInvalid("buyAndSellContractPaymentRestantPercentage")),o.R7$(3),o.Y8G("ngIf",!e.isDisabled),o.R7$(),o.vxM("by_certification"===(null==e.promotion?null:e.promotion.buyAndSellContractPaymentRestantWhen)?79:-1)}}let Z=(()=>{var i;class a{constructor(){this.promotionUpdated=new o.bkB,this.loadingButton=!1,this.isDisabled=!0,this.percentagesOverflowsMaximum=!1}ngOnInit(){}set promotionData(n){this.promotion=n}onEdit(){var n,t;this.isDisabled=!this.isDisabled,null!==(n=this.promotion)&&void 0!==n&&n.deliveryDateModalityByStatus||null!==(t=this.promotion)&&void 0!==t&&t.deliveryDateModalityByMonths||(this.promotion.deliveryDateModalityByStatus=!0),(!this.promotion.certificationsCharges||!this.promotion.certificationsCharges.length)&&(this.promotion.certificationsCharges=[],this.promotion.certificationsCharges.push({typeOfPercentage:"",percentage:0}))}onSave(){!this.isDisabled&&!this.isFormValid()||(this.savePromotion(),this.isDisabled=!0)}onQuantityPercentageChange(){setTimeout(()=>{var n;const t=null===(n=this.promotion)||void 0===n?void 0:n.buyAndSellContractPaymentQuantityPercentage;this.promotion.buyAndSellContractPaymentRestantPercentage=100-t;let s=0;for(let r of this.promotion.certificationsCharges)s+=r.percentage;this.percentagesOverflowsMaximum=s>this.promotion.buyAndSellContractPaymentRestantPercentage})}onAddCharge(){this.promotion.certificationsCharges?this.promotion.certificationsCharges.push({typeOfPercentage:"",percentage:0}):this.promotion.certificationsCharges=[{typeOfPercentage:null,percentage:null}]}onDelete(n){this.promotion.certificationsCharges.splice(n,1)}savePromotion(){this.promotionUpdated.emit({reservePayment:this.promotion.reservePayment,reservePaymentExpirationDays:this.promotion.reservePaymentExpirationDays,buyAndSellContractInDays:this.promotion.buyAndSellContractInDays,buyAndSellContractPaymentQuantityPercentage:this.promotion.buyAndSellContractPaymentQuantityPercentage,buyAndSellContractPaymentRestantPercentage:this.promotion.buyAndSellContractPaymentRestantPercentage,buyAndSellContractPaymentRestantWhen:this.promotion.buyAndSellContractPaymentRestantWhen,certificationsCharges:this.promotion.certificationsCharges})}isFieldInvalid(n){if(this.isDisabled||!this.promotion)return!1;const t=this.promotion[n];return null==t||"string"==typeof t&&""===t.trim()}isFormValid(){return!(this.isFieldInvalid("reservePayment")||this.isFieldInvalid("reservePaymentExpirationDays")||this.isFieldInvalid("buyAndSellContractInDays")||this.isFieldInvalid("buyAndSellContractPaymentQuantityPercentage")||this.isFieldInvalid("buyAndSellContractPaymentRestantPercentage")||this.isFieldInvalid("buyAndSellContractPaymentRestantWhen"))}}return(i=a).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-payments-details-payment-method"]],inputs:{currentUser:"currentUser"},outputs:{promotionUpdated:"promotionUpdated"},decls:6,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"appLoadingButton"],[1,"crm-button","crm-button-success",3,"appLoadingButton"],[3,"ngClass",4,"ngIf"],["class","crm-button-secondary crm-button-secondary-primary",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click","appLoadingButton"],[1,"fa-solid","fa-edit"],["class","crm-button crm-button-success",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button","crm-button-success",3,"click","appLoadingButton"],[1,"fa-solid","fa-check"],[3,"ngClass"],[1,"crm-title-14"],[1,"crm-section-inputs-double-input","crm-section-margin-top"],[1,"crm-input",3,"appInputViewMode","externalInputValue"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","number","placeholder","Nombre",3,"ngModelChange","disabled","ngModel"],[1,"crm-input-input-symbol"],["class","crm-input-error",4,"ngIf"],["placeholder","Seleccione",3,"ngModelChange","disabled","ngModel"],["value","7"],["value","14"],["value","21"],["value","28"],["value","60"],["value","90"],["value","120"],["value","No defined"],[1,"crm-title-14","crm-section-margin-top-medium"],["type","number","placeholder","Porcentaje de pago (%)",3,"ngModelChange","disabled","ngModel"],[1,"crm-section-inputs-double-input","crm-section-margin-top-medium"],["type","number","placeholder","Restante (%)",3,"ngModelChange","disabled","ngModel"],[1,"crm-input"],[1,"crm-section-inline-checkboxes","crm-section-margin-top",2,"margin-top","24px"],["class","crm-input crm-input-radio-box",3,"appInputViewMode","externalInputValue",4,"ngIf"],[1,"crm-input-error"],[1,"crm-input","crm-input-radio-box",3,"appInputViewMode","externalInputValue"],[1,"crm-input-radios",3,"ngModelChange","ngModel"],[1,"crm-input-radio"],["value","when_public_signing"],[1,"crm-input-radio-label"],["value","by_certification"],[1,"crm-section-inputs-double-input","crm-section-margin-top-medium",2,"align-items","center"],["class","crm-input-error crm-section-margin-top",4,"ngIf"],["class","crm-section-margin-top","style","display: flex; justify-content: center;",4,"ngIf"],[1,"crm-text"],[1,"crm-input-input"],["placeholder","Seleccione",3,"ngModelChange","ngModel"],["value","movimiento_tierras"],["value","cimentacion"],["value","estructura"],["value","cerramientos_exteriores"],["value","cubierta_tejado"],["value","carpinteria_exterior"],["value","instalaciones_basicas"],["value","tabiqueria_revestimientos"],["value","yeso_enlucidos"],["value","solados_alicatados"],["value","carpinteria_interior"],["value","pintura_interior"],["value","sanitarios_griferias"],["value","ascensores_comunes"],["value","zonas_comunes"],["value","finalizacion_obra"],["value","licencia_ocupacion"],["value","entrega_llaves"],["class","crm-button-icon-solo",3,"click",4,"ngIf"],[1,"crm-button-icon-solo",3,"click"],[1,"fas","fa-trash"],[1,"crm-input-error","crm-section-margin-top"],[1,"crm-section-margin-top",2,"display","flex","justify-content","center"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-add"]],template:function(n,t){1&n&&(o.j41(0,"div",0),o.nrm(1,"div",1),o.j41(2,"div",2),o.DNE(3,Be,1,1,"button",3)(4,Ne,1,1,"button",4),o.k0s()(),o.DNE(5,qe,80,45,"div",5)),2&n&&(o.R7$(3),o.vxM(t.isDisabled?3:4),o.R7$(2),o.Y8G("ngIf",t.promotion))},dependencies:[y.YU,y.bT,_.xH,_.y7,_.me,_.Q0,_.wz,_.BC,_.vS,f.KO,f.f0,f.Je,S.M,F.K,w.D9],styles:[".crm-header-modal-empty[_ngcontent-%COMP%]{padding-right:0;padding-left:0}"]}),a})();const Ke=i=>({"crm-section-disabled-inputs":i}),oo=i=>({"crm-section-invisible":i}),eo=i=>({opacity:i}),to=i=>({"crm-input-input-error":i});function Je(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",7),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onEdit())}),o.nrm(1,"i",8),o.EFF(2," Editar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function Qe(i,a){if(1&i&&o.DNE(0,Je,3,1,"button",6),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function Ze(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",10),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onSave())}),o.nrm(1,"i",11),o.EFF(2," Guardar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function ot(i,a){if(1&i&&o.DNE(0,Ze,3,1,"button",9),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function et(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",44)(1,"ion-checkbox",45),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.registersWithPreRegister,t)||(s.promotion.registersWithPreRegister=t),o.Njj(t)}),o.bIt("ionChange",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onSelectModality("registersWithPreRegister"))}),o.k0s()()}if(2&i){const e=o.XpG(2);o.R7$(),o.R50("ngModel",e.promotion.registersWithPreRegister)}}function tt(i,a){1&i&&(o.j41(0,"div",46),o.EFF(1," Es necesario seleccionar la expiraci\xf3n. "),o.k0s())}function nt(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",44)(1,"ion-checkbox",45),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.registersWithoutPreRegister,t)||(s.promotion.registersWithoutPreRegister=t),o.Njj(t)}),o.bIt("ionChange",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onSelectModality("registersWithoutPreRegister"))}),o.k0s()()}if(2&i){const e=o.XpG(2);o.R7$(),o.R50("ngModel",e.promotion.registersWithoutPreRegister)}}function it(i,a){1&i&&(o.j41(0,"div",46),o.EFF(1," Es necesario seleccionar la expiraci\xf3n. "),o.k0s())}function st(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",12)(1,"div",13)(2,"div",14),o.DNE(3,et,2,1,"div",15),o.j41(4,"div",16)(5,"div",1),o.EFF(6," Registro con pre-registros "),o.k0s()()(),o.j41(7,"div",17)(8,"div",18)(9,"div",19)(10,"div",20),o.EFF(11," Expira en "),o.k0s(),o.j41(12,"div",21)(13,"select",22),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.registersWithPreRegisterExpireIn,t)||(s.promotion.registersWithPreRegisterExpireIn=t),o.Njj(t)}),o.j41(14,"option",23),o.EFF(15,"7 d\xedas"),o.k0s(),o.j41(16,"option",24),o.EFF(17,"14 d\xedas"),o.k0s(),o.j41(18,"option",25),o.EFF(19,"21 d\xedas"),o.k0s(),o.j41(20,"option",26),o.EFF(21,"28 d\xedas"),o.k0s(),o.j41(22,"option",27),o.EFF(23,"2 meses"),o.k0s(),o.j41(24,"option",28),o.EFF(25,"3 meses"),o.k0s(),o.j41(26,"option",29),o.EFF(27,"4 meses"),o.k0s(),o.j41(28,"option",30),o.EFF(29,"No definido"),o.k0s(),o.j41(30,"option",31),o.EFF(31,"No expira nunca"),o.k0s()()(),o.DNE(32,tt,2,0,"div",32),o.k0s(),o.nrm(33,"div",33),o.k0s(),o.j41(34,"div",34),o.EFF(35," En esta opci\xf3n se permite el pre-registro. El registro se validar\xe1 una vez que el cliente pre-registrado haya visitado la propiedad "),o.k0s()()(),o.j41(36,"div",35)(37,"div",14),o.DNE(38,nt,2,1,"div",15),o.j41(39,"div",16)(40,"div",1),o.EFF(41," Registro SIN pre-registros "),o.k0s()()(),o.j41(42,"div",17)(43,"div",18)(44,"div",33)(45,"div",20),o.EFF(46," Expira en "),o.k0s(),o.j41(47,"div",21)(48,"select",22),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.registersWithoutPreRegisterExpireIn,t)||(s.promotion.registersWithoutPreRegisterExpireIn=t),o.Njj(t)}),o.j41(49,"option",23),o.EFF(50,"7 d\xedas"),o.k0s(),o.j41(51,"option",24),o.EFF(52,"14 d\xedas"),o.k0s(),o.j41(53,"option",25),o.EFF(54,"21 d\xedas"),o.k0s(),o.j41(55,"option",26),o.EFF(56,"28 d\xedas"),o.k0s(),o.j41(57,"option",27),o.EFF(58,"2 meses"),o.k0s(),o.j41(59,"option",28),o.EFF(60,"3 meses"),o.k0s(),o.j41(61,"option",29),o.EFF(62,"4 meses"),o.k0s(),o.j41(63,"option",30),o.EFF(64,"No definido"),o.k0s(),o.j41(65,"option",31),o.EFF(66,"No expira nunca"),o.k0s()()(),o.DNE(67,it,2,0,"div",32),o.k0s(),o.nrm(68,"div",33),o.k0s(),o.j41(69,"div",36),o.EFF(70," En esta opci\xf3n, solo se permite el pre-registro. El registro se validar\xe1 una vez que el cliente pre-registrado haya visitado la propiedad "),o.k0s()()(),o.j41(71,"div",37),o.EFF(72," Datos necesarios para el registro "),o.k0s(),o.j41(73,"div",38)(74,"div",39)(75,"div",40)(76,"div",41)(77,"ion-checkbox",42),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.registerNecessaryFieldsName,t)||(s.promotion.registerNecessaryFieldsName=t),o.Njj(t)}),o.k0s(),o.j41(78,"div",43),o.EFF(79,"Nombre y apellidos"),o.k0s()(),o.j41(80,"div",41)(81,"ion-checkbox",42),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.registerNecessaryFieldsNationality,t)||(s.promotion.registerNecessaryFieldsNationality=t),o.Njj(t)}),o.k0s(),o.j41(82,"div",43),o.EFF(83,"Nacionalidad"),o.k0s()(),o.j41(84,"div",41)(85,"ion-checkbox",42),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.registerNecessaryFieldsLast4DigitsPhone,t)||(s.promotion.registerNecessaryFieldsLast4DigitsPhone=t),o.Njj(t)}),o.k0s(),o.j41(86,"div",43),o.EFF(87,"Los \xfaltimos 4 d\xedgitos del tel\xe9fono"),o.k0s()(),o.j41(88,"div",41)(89,"ion-checkbox",42),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG();return o.DH7(s.promotion.registerNecessaryFieldsEmail,t)||(s.promotion.registerNecessaryFieldsEmail=t),o.Njj(t)}),o.k0s(),o.j41(90,"div",43),o.EFF(91,"Email (no recomendable)"),o.k0s()()()()()()}if(2&i){const e=o.XpG();o.Y8G("ngClass",o.eq3(24,Ke,e.isDisabled)),o.R7$(),o.Y8G("ngClass",o.eq3(26,oo,!(e.isDisabled&&e.promotion.registersWithPreRegister||!e.isDisabled))),o.R7$(2),o.Y8G("ngIf",!e.isDisabled),o.R7$(4),o.Y8G("ngStyle",o.eq3(28,eo,e.promotion.registersWithPreRegister?"1":"0.3")),o.R7$(2),o.Y8G("appInputViewMode",e.isDisabled)("externalInputValue",e.promotion.registersWithPreRegisterExpireIn),o.R7$(3),o.Y8G("appInputViewMode",e.isDisabled)("ngClass",o.eq3(30,to,e.isFieldInvalid("registersWithPreRegisterExpireIn","preRegister"))),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.registersWithPreRegisterExpireIn),o.R7$(19),o.Y8G("ngIf",e.isFieldInvalid("registersWithPreRegisterExpireIn","preRegister")),o.R7$(4),o.Y8G("ngClass",o.eq3(32,oo,!(e.isDisabled&&e.promotion.registersWithoutPreRegister||!e.isDisabled))),o.R7$(2),o.Y8G("ngIf",!e.isDisabled),o.R7$(4),o.Y8G("ngStyle",o.eq3(34,eo,e.promotion.registersWithoutPreRegister?"1":"0.5")),o.R7$(5),o.Y8G("appInputViewMode",e.isDisabled)("ngClass",o.eq3(36,to,e.isFieldInvalid("registersWithoutPreRegisterExpireIn","withoutPreRegister"))),o.R7$(),o.Y8G("disabled",e.isDisabled),o.R50("ngModel",e.promotion.registersWithoutPreRegisterExpireIn),o.R7$(19),o.Y8G("ngIf",e.isFieldInvalid("registersWithoutPreRegisterExpireIn","withoutPreRegister")),o.R7$(7),o.Y8G("appInputViewMode",e.isDisabled),o.R7$(3),o.R50("ngModel",e.promotion.registerNecessaryFieldsName),o.R7$(4),o.R50("ngModel",e.promotion.registerNecessaryFieldsNationality),o.R7$(4),o.R50("ngModel",e.promotion.registerNecessaryFieldsLast4DigitsPhone),o.R7$(4),o.R50("ngModel",e.promotion.registerNecessaryFieldsEmail)}}let no=(()=>{var i;class a{constructor(){this.promotionUpdated=new o.bkB,this.loadingButton=!1,this.isDisabled=!0}ngOnInit(){}set promotionData(n){var t,s;this.promotion=n,null!==(t=this.promotion)&&void 0!==t&&t.registersWithoutPreRegister||null!==(s=this.promotion)&&void 0!==s&&s.registersWithPreRegister||(this.promotion.registersWithPreRegister=!0)}onEdit(){this.isDisabled=!this.isDisabled}onSave(){!this.isDisabled&&!this.isFormValid()||(this.savePromotion(),this.isDisabled=!0)}onSelectModality(n){"registersWithPreRegister"===n&&(this.promotion.registersWithoutPreRegister=!1),"registersWithoutPreRegister"===n&&(this.promotion.registersWithPreRegister=!1)}savePromotion(){this.promotionUpdated.emit({registersWithPreRegister:this.promotion.registersWithPreRegister||!1,registersWithPreRegisterExpireIn:this.promotion.registersWithPreRegisterExpireIn,registersWithoutPreRegister:this.promotion.registersWithoutPreRegister||!1,registersWithoutPreRegisterExpireIn:this.promotion.registersWithoutPreRegisterExpireIn,registerNecessaryFieldsName:this.promotion.registerNecessaryFieldsName||!1,registerNecessaryFieldsNationality:this.promotion.registerNecessaryFieldsNationality||!1,registerNecessaryFieldsLast4DigitsPhone:this.promotion.registerNecessaryFieldsLast4DigitsPhone||!1,registerNecessaryFieldsEmail:this.promotion.registerNecessaryFieldsEmail||!1})}isFieldInvalid(n,t){if(this.isDisabled||!this.promotion||"preRegister"===t&&!this.promotion.registersWithPreRegister||"withoutPreRegister"===t&&!this.promotion.registersWithoutPreRegister)return!1;const s=this.promotion[n];return null==s||"string"==typeof s&&""===s.trim()}isFormValid(){let n=!0;return this.promotion.registersWithPreRegister&&(n=n&&!this.isFieldInvalid("registersWithPreRegisterExpireIn","preRegister")),this.promotion.registersWithoutPreRegister&&(n=n&&!this.isFieldInvalid("registersWithoutPreRegisterExpireIn","withoutPreRegister")),n}}return(i=a).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-payments-details-registers"]],inputs:{currentUser:"currentUser"},outputs:{promotionUpdated:"promotionUpdated"},decls:6,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"appLoadingButton"],[1,"crm-button","crm-button-success",3,"appLoadingButton"],[3,"ngClass",4,"ngIf"],["class","crm-button-secondary crm-button-secondary-primary",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click","appLoadingButton"],[1,"fa-solid","fa-edit"],["class","crm-button crm-button-success",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button","crm-button-success",3,"click","appLoadingButton"],[1,"fa-solid","fa-check"],[3,"ngClass"],[1,"crm-card-user",3,"ngClass"],[1,"crm-card-user-header"],["class","crm-input-checkbox",4,"ngIf"],[1,"crm-card-user-header-data"],[1,"crm-card-user-body",2,"margin-bottom","0",3,"ngStyle"],[1,"crm-section-inputs-double-input"],[1,"crm-input",3,"appInputViewMode","externalInputValue"],[1,"crm-input-label"],[1,"crm-input-input",3,"appInputViewMode","ngClass"],["placeholder","Seleccione",3,"ngModelChange","disabled","ngModel"],["value","7"],["value","14"],["value","21"],["value","28"],["value","60"],["value","90"],["value","120"],["value","no_defined"],["value","no_expira"],["class","crm-input-error",4,"ngIf"],[1,"crm-input"],[1,"crm-text","crm-section-margin-top"],[1,"crm-card-user","crm-section-margin-top",3,"ngClass"],[1,"crm-text","crm-section-margin-top",2,"color","red"],[1,"crm-title-14","crm-section-margin-top-big"],[1,"crm-section-inputs","crm-section-margin-top-small","crm-section-inputs-grid-input-100"],[1,"crm-input",3,"appInputViewMode"],[1,"crm-input-checkboxes"],["appToggleCheckbox","",1,"crm-input-checkbox"],[3,"ngModelChange","ngModel"],[1,"crm-input-checkbox-label"],[1,"crm-input-checkbox"],[3,"ngModelChange","ionChange","ngModel"],[1,"crm-input-error"]],template:function(n,t){1&n&&(o.j41(0,"div",0),o.nrm(1,"div",1),o.j41(2,"div",2),o.DNE(3,Qe,1,1,"button",3)(4,ot,1,1,"button",4),o.k0s()(),o.DNE(5,st,92,38,"div",5)),2&n&&(o.R7$(3),o.vxM(t.isDisabled?3:4),o.R7$(2),o.Y8G("ngIf",t.promotion))},dependencies:[y.YU,y.bT,y.B3,_.xH,_.y7,_.wz,_.BC,_.vS,f.eY,f.hB,S.M,O.z,F.K],styles:[".crm-header-modal-empty[_ngcontent-%COMP%]{padding-right:0;padding-left:0}"]}),a})(),at=(()=>{var i;class a{constructor(){}ngOnInit(){}set promotionData(n){this.promotion=n}}return(i=a).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-payments-details-restrictions"]],decls:2,vars:0,template:function(n,t){1&n&&(o.j41(0,"p"),o.EFF(1," promotion-payments-details-restrictions works!\n"),o.k0s())},styles:[".crm-header-modal-empty[_ngcontent-%COMP%]{padding-right:0;padding-left:0}"]}),a})();const rt=i=>({"crm-section-disabled-inputs":i});function lt(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",7),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onEdit())}),o.nrm(1,"i",8),o.EFF(2," Editar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function ct(i,a){if(1&i&&o.DNE(0,lt,3,1,"button",6),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function mt(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",10),o.bIt("click",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.onSave())}),o.nrm(1,"i",11),o.EFF(2," Guardar "),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("appLoadingButton",e.loadingButton)}}function dt(i,a){if(1&i&&o.DNE(0,mt,3,1,"button",9),2&i){const e=o.XpG();o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function pt(i,a){1&i&&(o.j41(0,"div",16),o.EFF(1," Elige la forma de pago de las comisiones a los colaboradores\n"),o.k0s())}function ut(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",17)(1,"ion-radio-group",18),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG(2);return o.DH7(s.promotion.methodToPayCommissions,t)||(s.promotion.methodToPayCommissions=t),o.Njj(t)}),o.j41(2,"div",19),o.nrm(3,"ion-radio",20),o.j41(4,"div",21),o.EFF(5," Parte proporcional seg\xfan paga el comprador "),o.k0s()(),o.j41(6,"div",19),o.nrm(7,"ion-radio",20),o.j41(8,"div",21),o.EFF(9," Todo a la firma de escritura p\xfablica "),o.k0s()(),o.j41(10,"div",19),o.nrm(11,"ion-radio",20),o.j41(12,"div",21),o.EFF(13," Pago completado "),o.k0s()()()()}if(2&i){const e=o.XpG(2);o.R7$(),o.R50("ngModel",e.promotion.methodToPayCommissions),o.R7$(2),o.Y8G("value","by_the_buyer_pays"),o.R7$(4),o.Y8G("value","when_public_signing"),o.R7$(4),o.Y8G("value","by_config")}}function _t(i,a){1&i&&o.EFF(0," Parte proporcional seg\xfan paga el comprador ")}function gt(i,a){1&i&&o.EFF(0," Todo a la firma de escritura p\xfablica ")}function vt(i,a){1&i&&o.EFF(0," Pago completado ")}function yt(i,a){if(1&i&&(o.j41(0,"div",22),o.DNE(1,_t,1,0)(2,gt,1,0)(3,vt,1,0),o.k0s()),2&i){const e=o.XpG(2);o.R7$(),o.vxM("by_the_buyer_pays"===(null==e.promotion?null:e.promotion.methodToPayCommissions)?1:"when_public_signing"===(null==e.promotion?null:e.promotion.methodToPayCommissions)?2:"by_config"===(null==e.promotion?null:e.promotion.methodToPayCommissions)?3:-1)}}function ft(i,a){if(1&i&&(o.j41(0,"div",28),o.EFF(1),o.k0s()),2&i){const e=o.XpG().$implicit;o.R7$(),o.SpI(" ",e.percentageClientPaid," % ")}}function Ct(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",29)(1,"input",31),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG().$implicit;return o.DH7(s.percentageClientPaid,t)||(s.percentageClientPaid=t),o.Njj(t)}),o.bIt("ngModelChange",function(){o.eBV(e);const t=o.XpG(4);return o.Njj(t.checkPercentagesOverflow())}),o.k0s(),o.j41(2,"div",32),o.EFF(3,"%"),o.k0s()()}if(2&i){const e=o.XpG().$implicit,n=o.XpG(3);o.R7$(),o.Y8G("disabled",n.isDisabled),o.R50("ngModel",e.percentageClientPaid)}}function bt(i,a){if(1&i&&(o.j41(0,"div",28),o.EFF(1),o.k0s()),2&i){const e=o.XpG().$implicit;o.R7$(),o.SpI(" ",e.percentageToPayCollaborator," % ")}}function ht(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",29)(1,"input",31),o.mxI("ngModelChange",function(t){o.eBV(e);const s=o.XpG().$implicit;return o.DH7(s.percentageToPayCollaborator,t)||(s.percentageToPayCollaborator=t),o.Njj(t)}),o.bIt("ngModelChange",function(){o.eBV(e);const t=o.XpG(4);return o.Njj(t.checkPercentagesOverflow())}),o.k0s(),o.j41(2,"div",32),o.EFF(3,"%"),o.k0s()()}if(2&i){const e=o.XpG().$implicit,n=o.XpG(3);o.R7$(),o.Y8G("disabled",n.isDisabled),o.R50("ngModel",e.percentageToPayCollaborator)}}function Pt(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",33),o.bIt("click",function(){o.eBV(e);const t=o.XpG().$index,s=o.XpG(3);return o.Njj(s.onDelete(t))}),o.nrm(1,"i",34),o.k0s()}}function Dt(i,a){if(1&i&&(o.j41(0,"div",23)(1,"div",22),o.EFF(2),o.k0s(),o.j41(3,"div",26)(4,"div",27),o.EFF(5," Pago completado por cliente "),o.k0s(),o.DNE(6,ft,2,1,"div",28)(7,Ct,4,2,"div",29),o.k0s(),o.j41(8,"div",26)(9,"div",27),o.EFF(10," Pago a colaborador "),o.k0s(),o.DNE(11,bt,2,1,"div",28)(12,ht,4,2,"div",29),o.k0s(),o.DNE(13,Pt,2,0,"button",30),o.k0s()),2&i){const e=a.$index,n=o.XpG(3);o.R7$(2),o.SpI(" ",e+1," "),o.R7$(4),o.vxM(n.isDisabled?6:7),o.R7$(5),o.vxM(n.isDisabled?11:12),o.R7$(2),o.Y8G("ngIf",!n.isDisabled)}}function kt(i,a){1&i&&(o.j41(0,"div",35),o.EFF(1," La suma de los porcentajes no puede superar el 100% "),o.k0s())}function Ft(i,a){if(1&i){const e=o.RV6();o.j41(0,"div",36)(1,"button",37),o.bIt("click",function(){o.eBV(e);const t=o.XpG(3);return o.Njj(t.onAddTable())}),o.nrm(2,"i",38),o.EFF(3," A\xf1adir m\xe1s tablas "),o.k0s()()}}function xt(i,a){if(1&i&&(o.Z7z(0,Dt,14,4,"div",23,o.fX1),o.DNE(2,kt,2,0,"div",24)(3,Ft,4,0,"div",25)),2&i){const e=o.XpG(2);o.Dyx(null==e.promotion?null:e.promotion.methodToPayCommissionsTables),o.R7$(2),o.Y8G("ngIf",e.percentagesOverflowsMaximum&&!e.isDisabled),o.R7$(),o.Y8G("ngIf",!e.isDisabled)}}function Mt(i,a){if(1&i&&(o.j41(0,"div",12),o.DNE(1,pt,2,0,"div",13)(2,ut,14,4,"div",14)(3,yt,4,1,"div",15)(4,xt,4,2),o.k0s()),2&i){const e=o.XpG();o.Y8G("ngClass",o.eq3(5,rt,e.isDisabled)),o.R7$(),o.Y8G("ngIf",!e.isDisabled),o.R7$(),o.Y8G("ngIf",!e.isDisabled),o.R7$(),o.Y8G("ngIf",e.isDisabled),o.R7$(),o.vxM("by_config"===(null==e.promotion?null:e.promotion.methodToPayCommissions)?4:-1)}}let io=(()=>{var i;class a{constructor(){this.promotionUpdated=new o.bkB,this.loadingButton=!1,this.isDisabled=!0,this.percentagesOverflowsMaximum=!1}ngOnInit(){}set promotionData(n){this.promotion=n}onEdit(){this.isDisabled=!this.isDisabled}onSave(){this.checkPercentagesOverflow(),!this.percentagesOverflowsMaximum&&(this.savePromotion(),this.isDisabled=!0)}onAddTable(){this.promotion.methodToPayCommissionsTables&&this.promotion.methodToPayCommissionsTables.length?this.promotion.methodToPayCommissionsTables.push({percentageClientPaid:null,percentageToPayCollaborator:null}):this.promotion.methodToPayCommissionsTables=[{percentageClientPaid:null,percentageToPayCollaborator:null}]}onDelete(n){this.promotion.methodToPayCommissionsTables.splice(n,1)}savePromotion(){this.promotionUpdated.emit({methodToPayCommissions:this.promotion.methodToPayCommissions,methodToPayCommissionsTables:this.promotion.methodToPayCommissionsTables})}checkPercentagesOverflow(){var n;const t=(null===(n=this.promotion)||void 0===n?void 0:n.methodToPayCommissionsTables)||[],s=t.reduce((c,d)=>c+(Number(d.percentageClientPaid)||0),0),r=t.reduce((c,d)=>c+(Number(d.percentageToPayCollaborator)||0),0);this.percentagesOverflowsMaximum=s>100||r>100}}return(i=a).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-payments-details-commission-payment-method"]],inputs:{currentUser:"currentUser"},outputs:{promotionUpdated:"promotionUpdated"},decls:6,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"appLoadingButton"],[1,"crm-button","crm-button-success",3,"appLoadingButton"],[3,"ngClass",4,"ngIf"],["class","crm-button-secondary crm-button-secondary-primary",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click","appLoadingButton"],[1,"fa-solid","fa-edit"],["class","crm-button crm-button-success",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button","crm-button-success",3,"click","appLoadingButton"],[1,"fa-solid","fa-check"],[3,"ngClass"],["class","crm-title-14",4,"ngIf"],["class","crm-input crm-input-radio-box crm-section-margin-top",4,"ngIf"],["class","crm-text",4,"ngIf"],[1,"crm-title-14"],[1,"crm-input","crm-input-radio-box","crm-section-margin-top"],[1,"crm-input-radios-vertical",3,"ngModelChange","ngModel"],[1,"crm-input-radio"],[3,"value"],[1,"crm-input-radio-label"],[1,"crm-text"],[1,"crm-section-inputs-double-input","crm-section-margin-top-medium",2,"align-items","center"],["class","crm-input-error crm-section-margin-top",4,"ngIf"],["class","crm-section-margin-top","style","display: flex; justify-content: center;",4,"ngIf"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-view"],[1,"crm-input-input"],["class","crm-button-icon-solo",3,"click",4,"ngIf"],["type","number","placeholder","Inserta el porcentaje (%)",3,"ngModelChange","disabled","ngModel"],[1,"crm-input-input-symbol"],[1,"crm-button-icon-solo",3,"click"],[1,"fas","fa-trash"],[1,"crm-input-error","crm-section-margin-top"],[1,"crm-section-margin-top",2,"display","flex","justify-content","center"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-add"]],template:function(n,t){1&n&&(o.j41(0,"div",0),o.nrm(1,"div",1),o.j41(2,"div",2),o.DNE(3,ct,1,1,"button",3)(4,dt,1,1,"button",4),o.k0s()(),o.DNE(5,Mt,5,7,"div",5)),2&n&&(o.R7$(3),o.vxM(t.isDisabled?3:4),o.R7$(2),o.Y8G("ngIf",t.promotion))},dependencies:[y.YU,y.bT,_.me,_.Q0,_.BC,_.vS,f.KO,f.f0,f.Je,F.K],styles:[".crm-header-modal-empty[_ngcontent-%COMP%]{padding-right:0;padding-left:0}"]}),a})();const I=i=>({"background-color":i}),T=i=>({"crm-section-invisible":i});let so=(()=>{var i;class a{constructor(n,t,s,r){this.utils=n,this.api=t,this.toastService=s,this.state=r,this.updatePromotion=new o.bkB,this.allSectionsCompleted=new o.bkB,this.dropdownSections={commission:!0,comissionsPaymentMethod:!0,paymentMethod:!0,deliveryDate:!0,registers:!0,restrictions:!0},this.incompletedSectionsBackgrounds={commission:null,comissionsPaymentMethod:null,paymentMethod:null,deliveryDate:null,registers:null,restrictions:null}}ngOnInit(){}set promotionData(n){console.log("QUE TAL "),this.promotion=n,this.deliveryDate.promotionData=b.cloneDeep(n),this.commission.promotionData=b.cloneDeep(n),this.commissionsPaymentMethod.promotionData=b.cloneDeep(n),this.paymentMethod.promotionData=b.cloneDeep(n),this.registers.promotionData=b.cloneDeep(n),this.detectIfNoConfigIsSet()}checkIncompletedSections(){}detectIfNoConfigIsSet(){var n,t,s,r,c,d,u,g,l,m,h,k,D,j;this.deliveryDate.isDisabled=(null===(n=this.promotion)||void 0===n?void 0:n.deliveryDateModalityByStatus)||(null===(t=this.promotion)||void 0===t?void 0:t.deliveryDateModalityByMonths),this.incompletedSectionsBackgrounds.deliveryDate=null!==(s=this.promotion)&&void 0!==s&&s.deliveryDateModalityByStatus||null!==(r=this.promotion)&&void 0!==r&&r.deliveryDateModalityByMonths?null:"#f8d7da",this.commission.isDisabled=!(null===(c=this.promotion)||void 0===c||!c.sellCommissionPercentage),this.incompletedSectionsBackgrounds.commission=null!==(d=this.promotion)&&void 0!==d&&d.sellCommissionPercentage?null:"#f8d7da",this.commissionsPaymentMethod.isDisabled=!(null===(u=this.promotion)||void 0===u||!u.methodToPayCommissions),this.incompletedSectionsBackgrounds.comissionsPaymentMethod=null!==(g=this.promotion)&&void 0!==g&&g.methodToPayCommissions?null:"#f8d7da",this.paymentMethod.isDisabled=!(null===(l=this.promotion)||void 0===l||!l.reservePayment),this.incompletedSectionsBackgrounds.paymentMethod=null!==(m=this.promotion)&&void 0!==m&&m.reservePayment?null:"#f8d7da",this.registers.isDisabled=!!(null!==(h=this.promotion)&&void 0!==h&&h.registersWithPreRegister||null!==(k=this.promotion)&&void 0!==k&&k.registersWithoutPreRegister),this.incompletedSectionsBackgrounds.registers=null!==(D=this.promotion)&&void 0!==D&&D.registersWithPreRegister||null!==(j=this.promotion)&&void 0!==j&&j.registersWithoutPreRegister?null:"#f8d7da",console.log("HOLA DETECTED"),this.allSectionsCompleted.emit(null===this.incompletedSectionsBackgrounds.deliveryDate&&null===this.incompletedSectionsBackgrounds.commission&&null===this.incompletedSectionsBackgrounds.comissionsPaymentMethod&&null===this.incompletedSectionsBackgrounds.paymentMethod&&null===this.incompletedSectionsBackgrounds.registers)}onPromotionUpdate(n){var t=this;return(0,C.A)(function*(){var s;const r=t.utils.parseProperties(n),d=(yield t.api.updatePromotionById(t.promotion.id,r),yield t.utils.detectIfPromotionIsCompleted(t.promotion));console.log("EL PAYMENT IS COMPLETED?????",d),yield t.api.updatePromotionById(t.promotion.id,{promotionPaymentInfoIsCompleted:d}),t.toastService.showSuccessToast("Promoci\xf3n actualizada correctamente");const g=yield t.api.getPromotionFullDataById(t.promotion.id),l=null==g||null===(s=g.success)||void 0===s?void 0:s.data;t.promotionData=b.cloneDeep(l),t.detectIfNoConfigIsSet(),t.updatePromotion.emit()})()}}return(i=a).\u0275fac=function(n){return new(n||i)(o.rXU(G.T),o.rXU(R.i),o.rXU(E.f),o.rXU(B.c))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-payments-details"]],viewQuery:function(n,t){if(1&n&&(o.GBs(q,5),o.GBs(Z,5),o.GBs(Q,5),o.GBs(no,5),o.GBs(at,5),o.GBs(io,5)),2&n){let s;o.mGM(s=o.lsd())&&(t.commission=s.first),o.mGM(s=o.lsd())&&(t.paymentMethod=s.first),o.mGM(s=o.lsd())&&(t.deliveryDate=s.first),o.mGM(s=o.lsd())&&(t.registers=s.first),o.mGM(s=o.lsd())&&(t.restrictions=s.first),o.mGM(s=o.lsd())&&(t.commissionsPaymentMethod=s.first)}},inputs:{currentUser:"currentUser"},outputs:{updatePromotion:"updatePromotion",allSectionsCompleted:"allSectionsCompleted"},decls:35,vars:40,consts:[[1,"crm-block-dropdown","small","crm-section-margin-top",3,"click","ngStyle"],[1,"crm-section-title"],[1,"crm-block-dropdown-icon"],[3,"name"],[1,"crm-section","size-large",3,"ngClass"],[1,"crm-section-margin-bottom-big",3,"promotionUpdated","currentUser"],[1,"crm-block-dropdown","small",3,"click","ngStyle"],[1,"crm-block-dropdown",3,"click","ngStyle"]],template:function(n,t){1&n&&(o.j41(0,"div",0),o.bIt("click",function(){return t.dropdownSections.deliveryDate=!t.dropdownSections.deliveryDate}),o.j41(1,"div",1),o.EFF(2," Fecha de entrega "),o.k0s(),o.j41(3,"div",2),o.nrm(4,"ion-icon",3),o.k0s()(),o.j41(5,"div",4)(6,"app-promotion-payments-details-delivery-date",5),o.bIt("promotionUpdated",function(r){return t.onPromotionUpdate(r)}),o.k0s()(),o.j41(7,"div",6),o.bIt("click",function(){return t.dropdownSections.paymentMethod=!t.dropdownSections.paymentMethod}),o.j41(8,"div",1),o.EFF(9," Forma de pago "),o.k0s(),o.j41(10,"div",2),o.nrm(11,"ion-icon",3),o.k0s()(),o.j41(12,"div",4)(13,"app-promotion-payments-details-payment-method",5),o.bIt("promotionUpdated",function(r){return t.onPromotionUpdate(r)}),o.k0s()(),o.j41(14,"div",7),o.bIt("click",function(){return t.dropdownSections.commission=!t.dropdownSections.commission}),o.j41(15,"div",1),o.EFF(16," Comisiones "),o.k0s(),o.j41(17,"div",2),o.nrm(18,"ion-icon",3),o.k0s()(),o.j41(19,"div",4)(20,"app-promotion-payments-details-commission",5),o.bIt("promotionUpdated",function(r){return t.onPromotionUpdate(r)}),o.k0s()(),o.j41(21,"div",6),o.bIt("click",function(){return t.dropdownSections.comissionsPaymentMethod=!t.dropdownSections.comissionsPaymentMethod}),o.j41(22,"div",1),o.EFF(23," Forma de pago de las comisiones "),o.k0s(),o.j41(24,"div",2),o.nrm(25,"ion-icon",3),o.k0s()(),o.j41(26,"div",4)(27,"app-promotion-payments-details-commission-payment-method",5),o.bIt("promotionUpdated",function(r){return t.onPromotionUpdate(r)}),o.k0s()(),o.j41(28,"div",6),o.bIt("click",function(){return t.dropdownSections.registers=!t.dropdownSections.registers}),o.j41(29,"div",1),o.EFF(30," Registros "),o.k0s(),o.j41(31,"div",2),o.nrm(32,"ion-icon",3),o.k0s()(),o.j41(33,"div",4)(34,"app-promotion-payments-details-registers",5),o.bIt("promotionUpdated",function(r){return t.onPromotionUpdate(r)}),o.k0s()()),2&n&&(o.Y8G("ngStyle",o.eq3(20,I,t.incompletedSectionsBackgrounds.deliveryDate)),o.R7$(4),o.Y8G("name",t.dropdownSections.deliveryDate?"chevron-up-outline":"chevron-down-outline"),o.R7$(),o.Y8G("ngClass",o.eq3(22,T,!t.dropdownSections.deliveryDate)),o.R7$(),o.Y8G("currentUser",t.currentUser),o.R7$(),o.Y8G("ngStyle",o.eq3(24,I,t.incompletedSectionsBackgrounds.paymentMethod)),o.R7$(4),o.Y8G("name",t.dropdownSections.paymentMethod?"chevron-up-outline":"chevron-down-outline"),o.R7$(),o.Y8G("ngClass",o.eq3(26,T,!t.dropdownSections.paymentMethod)),o.R7$(),o.Y8G("currentUser",t.currentUser),o.R7$(),o.Y8G("ngStyle",o.eq3(28,I,t.incompletedSectionsBackgrounds.commission)),o.R7$(4),o.Y8G("name",t.dropdownSections.commission?"chevron-up-outline":"chevron-down-outline"),o.R7$(),o.Y8G("ngClass",o.eq3(30,T,!t.dropdownSections.commission)),o.R7$(),o.Y8G("currentUser",t.currentUser),o.R7$(),o.Y8G("ngStyle",o.eq3(32,I,t.incompletedSectionsBackgrounds.comissionsPaymentMethod)),o.R7$(4),o.Y8G("name",t.dropdownSections.comissionsPaymentMethod?"chevron-up-outline":"chevron-down-outline"),o.R7$(),o.Y8G("ngClass",o.eq3(34,T,!t.dropdownSections.comissionsPaymentMethod)),o.R7$(),o.Y8G("currentUser",t.currentUser),o.R7$(),o.Y8G("ngStyle",o.eq3(36,I,t.incompletedSectionsBackgrounds.registers)),o.R7$(4),o.Y8G("name",t.dropdownSections.registers?"chevron-up-outline":"chevron-down-outline"),o.R7$(),o.Y8G("ngClass",o.eq3(38,T,!t.dropdownSections.registers)),o.R7$(),o.Y8G("currentUser",t.currentUser))},dependencies:[y.YU,y.B3,f.iq,q,Q,Z,no,io],styles:[".crm-block-dropdown[_ngcontent-%COMP%]{padding-left:8px}"]}),a})();var ao=p(5768),ro=p(2652);function It(i,a){if(1&i&&(o.j41(0,"div",16),o.nrm(1,"app-general-toast",17),o.k0s()),2&i){const e=o.XpG(2);o.R7$(),o.Y8G("options",e.toastConfig)}}function Tt(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",19),o.bIt("click",function(){o.eBV(e);const t=o.XpG(3);return o.Njj(t.onEditPromotion())}),o.nrm(1,"i",20),o.EFF(2," Editar promoci\xf3n "),o.k0s()}if(2&i){const e=o.XpG(3);o.Y8G("appLoadingButton",e.loadingButton)}}function jt(i,a){if(1&i&&o.DNE(0,Tt,3,1,"button",18),2&i){const e=o.XpG(2);o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function Rt(i,a){if(1&i){const e=o.RV6();o.j41(0,"button",22),o.bIt("click",function(){o.eBV(e);const t=o.XpG(3);return o.Njj(t.onSavePromotion())}),o.nrm(1,"i",23),o.EFF(2," Guardar promoci\xf3n "),o.k0s()}if(2&i){const e=o.XpG(3);o.Y8G("appLoadingButton",e.loadingButton)}}function Et(i,a){if(1&i&&o.DNE(0,Rt,3,1,"button",21),2&i){const e=o.XpG(2);o.Y8G("ngIf","promoter"===(null==e.currentUser?null:e.currentUser.accountType))}}function Gt(i,a){if(1&i){const e=o.RV6();o.j41(0,"app-file-item-preview",25),o.bIt("click",function(){o.eBV(e);const t=o.XpG().$index,s=o.XpG(2);return o.Njj(s.openLightbox(t))}),o.k0s()}if(2&i){const e=o.XpG().$implicit;o.Y8G("showName",!1)("size","full")("showRemove",!1)("file",e)}}function Bt(i,a){if(1&i&&o.DNE(0,Gt,1,4,"app-file-item-preview",24),2&i){const e=a.$implicit,n=o.XpG(2);o.vxM(n.utils.isImageFile(null==e?null:e.label)?0:-1)}}function St(i,a){if(1&i){const e=o.RV6();o.DNE(0,It,2,1,"div",4),o.j41(1,"div",5)(2,"div",6)(3,"div",7),o.nrm(4,"div",8),o.j41(5,"div",9),o.DNE(6,jt,1,1,"button",10)(7,Et,1,1,"button",11),o.k0s()(),o.j41(8,"div",12),o.Z7z(9,Bt,1,1,null,null,o.fX1),o.k0s(),o.j41(11,"div"),o.nrm(12,"app-step-one-promotion-form",13,0)(14,"app-step-three-promotion-form",13,1)(16,"app-step-two-promotion-form",14,2),o.k0s()(),o.j41(18,"div",6)(19,"app-promotion-payments-details",15,3),o.bIt("updatePromotion",function(){o.eBV(e);const t=o.XpG();return o.Njj(t.reloadPromotionData())}),o.k0s()()()}if(2&i){const e=o.XpG();o.Y8G("ngIf",!(null!=e.promotion&&e.promotion.promotionPaymentInfoIsCompleted)),o.R7$(6),o.vxM(e.disabled?6:7),o.R7$(3),o.Dyx(null==e.promotion?null:e.promotion.promotionFiles),o.R7$(3),o.Y8G("disabled",e.disabled),o.R7$(2),o.Y8G("disabled",e.disabled),o.R7$(2),o.Y8G("isDisabled",e.disabled),o.R7$(3),o.Y8G("currentUser",e.currentUser)}}let Nt=(()=>{var i;class a{constructor(n,t,s,r,c,d,u){this.promotionTransformersService=n,this.utils=t,this.router=s,this.api=r,this.toastService=c,this.state=d,this.modalController=u,this.reloadPromotion=new o.bkB,this.disabled=!1,this.loadingButton=!1,this.allSectionsCompleted=!0,this.loadingAllData=!0,this.toastConfig={text:"Por favor, rellena todos los campos obligatorios de la promoci\xf3n",theme:"orange",fullWidth:!0,showCloseButton:!1,smaller:!0}}ngAfterViewInit(){var n=this;return(0,C.A)(function*(){n.disabled=!1,n.loadingAllData=!0,yield n.getCurrentPromotion(),setTimeout(()=>{n.setFormValues(),n.getState(),n.disabled||setTimeout(()=>{n.disabled=!0,n.stepThreeForm.syncFiles()})})})()}getState(){this.state.getState().subscribe(n=>{this.currentUser=n.user})}getCurrentPromotion(){var n=this;return(0,C.A)(function*(){var t;n.loadingAllData=!0;const s=yield n.api.getPromotionFullDataById(n.promotionId);n.promotion=null==s||null===(t=s.success)||void 0===t?void 0:t.data,console.log("PROMOTION",n.promotion),n.loadingAllData=!1})()}setFormValues(){const n=this.promotionTransformersService.transformPromotionFormStepOne(this.promotion);this.stepOneForm.promotionStepOne=n,this.stepTwoForm.promotionStepTwo=this.promotion;const t=this.promotionTransformersService.transformPromotionFormStepThree(this.promotion);console.log("PROMOTION STEP THREE",t),this.stepThreeForm.promotionStepThree=t,this.stepThreeForm.syncFiles(),console.log("HACE ALGO?"),this.paymentDetails.promotionData=b.cloneDeep(this.promotion)}onEditPromotion(){this.disabled=!1,this.stepThreeForm.syncFiles()}onSavePromotion(){var n=this;return(0,C.A)(function*(){n.loadingButton=!0,n.promotion={...n.promotion,...n.stepTwoForm.promotionStepTwo,...n.stepOneForm.promotionStepOne,...n.stepThreeForm.promotionStepThree},b.cloneDeep(n.stepThreeForm.fileUploaderManager.config.files),delete n.promotion.promotionBlocks,delete n.promotion.propertiesCount,delete n.promotion.checked,delete n.promotion.promotionFiles,delete n.promotion.properties,delete n.promotion.promoter;const s=n.utils.parseProperties(n.promotion),r=yield n.api.updatePromotionById(n.promotion.id,s);if(!r.success)return console.error(r.error),void n.toastService.showToast({text:r.error.errorMessage,theme:"red",time:2e3});{var c,d,u,g;let rn=[...b.cloneDeep(null===(c=n.stepThreeForm)||void 0===c||null===(c=c.fileUploaderManager)||void 0===c||null===(c=c.config)||void 0===c?void 0:c.files)||[],...b.cloneDeep(null===(d=n.stepThreeForm)||void 0===d||null===(d=d.planosFileUploadManagerComponent)||void 0===d||null===(d=d.config)||void 0===d?void 0:d.files)||[],...b.cloneDeep(null===(u=n.stepThreeForm)||void 0===u||null===(u=u.catalogsFileUploadManagerComponent)||void 0===u||null===(u=u.config)||void 0===u?void 0:u.files)||[],...b.cloneDeep(null===(g=n.stepThreeForm)||void 0===g||null===(g=g.videosFileUploadManagerComponent)||void 0===g||null===(g=g.config)||void 0===g?void 0:g.files)||[]];for(let v of rn){if(null!=v&&v.new){var l,m;const P={promotionId:null===(l=n.promotion)||void 0===l?void 0:l.id,name:"",category:v.category,label:v.label,orderIndex:null==v?void 0:v.orderIndex},V=yield n.api.uploadFile(v.fileBlob),ln=null==V||null===(m=V.success)||void 0===m||null===(m=m.data)||void 0===m?void 0:m.fileName;P.name=ln,yield n.api.addPromotionFile(P)}if(null!=v&&v.deleted&&(yield n.api.removePromotionFileById(null==v?void 0:v.id)),null!=v&&v.moved&&(null==v||!v.deleted)&&(null==v||!v.new)){let P=b.cloneDeep(v);delete P.moved,delete P.fileBase64,delete P.fileBlob,delete P.new,delete P.deleted,delete P.size,delete P.type,yield n.api.editPromotionFile(P)}}n.toastService.showSuccessToast("Promoci\xf3n actualizada correctamente"),n.disabled=!0,n.stepThreeForm.disableFilesInputs(),yield n.reloadPromotionData()}n.loadingButton=!1})()}reloadPromotionData(){var n=this;return(0,C.A)(function*(){n.reloadPromotion.emit(),n.ngAfterViewInit()})()}openLightbox(n){var t=this;return(0,C.A)(function*(){var s,r;console.log("PROMOTION FILES",null===(s=t.promotion)||void 0===s?void 0:s.promotionFiles);let c=b.cloneDeep(null===(r=t.promotion)||void 0===r?void 0:r.promotionFiles).filter(g=>t.utils.isImageFile(null==g?void 0:g.label));const d=yield t.modalController.create({component:ao.$,componentProps:{items:c,currentIndex:n||0},cssClass:"lightbox-modal-class",animated:!1});yield d.present();const{data:u}=yield d.onDidDismiss();console.log("Lightbox closed, data returned:",u)})()}}return(i=a).\u0275fac=function(n){return new(n||i)(o.rXU(L.J),o.rXU(G.T),o.rXU(x.Ix),o.rXU(R.i),o.rXU(E.f),o.rXU(B.c),o.rXU(f.W3))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-details-info"]],viewQuery:function(n,t){if(1&n&&(o.GBs(W.N,5),o.GBs(H.T,5),o.GBs(z.f,5),o.GBs(so,5)),2&n){let s;o.mGM(s=o.lsd())&&(t.stepOneForm=s.first),o.mGM(s=o.lsd())&&(t.stepTwoForm=s.first),o.mGM(s=o.lsd())&&(t.stepThreeForm=s.first),o.mGM(s=o.lsd())&&(t.paymentDetails=s.first)}},inputs:{promotionId:"promotionId"},outputs:{reloadPromotion:"reloadPromotion"},decls:1,vars:1,consts:[["stepOneForm",""],["stepThreeForm",""],["stepTwoForm",""],["paymentDetails",""],["style","margin-bottom: 16px; width: 100%;","class","crm-section",4,"ngIf"],[1,"crm-boxes-user-create"],[1,"crm-box","crm-section"],[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"appLoadingButton"],[1,"crm-button","crm-button-success",3,"appLoadingButton"],[1,"crm-section-files-previews-promotion-images"],[3,"disabled"],[3,"isDisabled"],[3,"updatePromotion","currentUser"],[1,"crm-section",2,"margin-bottom","16px","width","100%"],[3,"options"],["class","crm-button-secondary crm-button-secondary-primary",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click","appLoadingButton"],[1,"fa-solid","fa-edit"],["class","crm-button crm-button-success",3,"appLoadingButton","click",4,"ngIf"],[1,"crm-button","crm-button-success",3,"click","appLoadingButton"],[1,"fa-solid","fa-check"],[3,"showName","size","showRemove","file"],[3,"click","showName","size","showRemove","file"]],template:function(n,t){1&n&&o.DNE(0,St,21,6),2&n&&o.vxM(t.loadingAllData?-1:0)},dependencies:[y.bT,W.N,H.T,z.f,so,F.K,ro.T,X.l]}),a})();var Vt=p(4558);const Xt=["promotionDetailsInfo"],wt=i=>({"crm-block-body-blue-content-no-padding":i});function At(i,a){if(1&i){const e=o.RV6();o.j41(0,"app-tabs",27),o.bIt("tabClicked",function(t){o.eBV(e);const s=o.XpG();return o.Njj(s.onTabClicked(t))}),o.k0s()}if(2&i){const e=o.XpG();o.Y8G("tabs",e.promotionTabs)}}function Yt(i,a){if(1&i&&o.nrm(0,"img",14),2&i){const e=o.XpG().$implicit;o.Y8G("src",null==e?null:e.url,o.B4B)}}function $t(i,a){if(1&i&&o.DNE(0,Yt,1,1,"img",14),2&i){const e=a.$implicit;o.vxM(null!=e&&e.mainImage?0:-1)}}function Ut(i,a){if(1&i&&o.Z7z(0,$t,1,1,null,null,o.fX1),2&i){const e=o.XpG();o.Dyx(null==e.promotion?null:e.promotion.promotionFiles)}}function Ot(i,a){if(1&i&&o.nrm(0,"img",14),2&i){const e=o.XpG();o.Y8G("src",(null==e.promotion||null==e.promotion.promotionFiles?null:e.promotion.promotionFiles.length)>0?null==e.promotion?null:e.promotion.promotionFiles[0].url:"assets/images/building.png",o.B4B)}}function Lt(i,a){if(1&i){const e=o.RV6();o.j41(0,"img",28),o.bIt("click",function(){o.eBV(e);const t=o.XpG();return o.Njj(t.onDeletePromotion())}),o.k0s()}2&i&&o.Y8G("src","assets/icon/trash-icon.svg",o.B4B)}function Wt(i,a){if(1&i){const e=o.RV6();o.j41(0,"app-promotion-details-info",32,0),o.bIt("reloadPromotion",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.reloadPromotion())}),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("promotionId",e.promotion.id)}}function zt(i,a){if(1&i){const e=o.RV6();o.j41(0,"app-promotion-details-availability",33),o.bIt("reloadPromotion",function(){o.eBV(e);const t=o.XpG(2);return o.Njj(t.reloadPromotion())}),o.k0s()}if(2&i){const e=o.XpG(2);o.Y8G("promotion",e.promotion)}}function Ht(i,a){if(1&i&&o.nrm(0,"app-agencies-list",30),2&i){const e=o.XpG(2);o.Y8G("promotion",e.promotion)}}function qt(i,a){if(1&i&&o.nrm(0,"app-file-explorer",31),2&i){const e=o.XpG(2);o.Y8G("directoryBaseElement",e.promotionFolder)}}function Kt(i,a){if(1&i&&o.DNE(0,Wt,2,1,"app-promotion-details-info",29)(1,zt,1,1,"app-promotion-details-availability",30)(2,Ht,1,1,"app-agencies-list",30)(3,qt,1,1,"app-file-explorer",31),2&i){const e=o.XpG();o.vxM("info"===e.activeTab?0:-1),o.R7$(),o.vxM("availability"===e.activeTab?1:-1),o.R7$(),o.vxM("agencies"===e.activeTab?2:-1),o.R7$(),o.vxM("file-explorer"===e.activeTab?3:-1)}}const Jt=[{path:"",component:(()=>{var i;class a{constructor(n,t,s,r,c,d,u,g,l){this.activatedRoute=n,this.router=t,this.location=s,this.api=r,this.headerService=c,this.toastService=d,this.utils=u,this.state=g,this.modalsService=l,this.promotionId=null,this.promotion=null,this.promotionTabsForPromoter=[{id:"1",title:"availability",active:!0},{id:"2",title:"agencies",active:!1},{id:"3",title:"file-explorer",active:!1},{id:"4",title:"info",active:!1}],this.promotionTabsForAgency=[{id:"1",title:"availability",active:!0},{id:"3",title:"file-explorer",active:!1},{id:"4",title:"info",active:!1}],this.promotionTabs=this.promotionTabsForPromoter,this.availableProperties=[],this.rangeOfPropertiesPrices={min:0,max:0},this.rangeOfPropertiesRooms={min:0,max:0},this.activeTab="availability",this.promotionFolder=null,this.thereIsAMainImage=!1}ngOnInit(){this.getState(),this.promotionId=this.activatedRoute.snapshot.paramMap.get("id");const n=this.activatedRoute.snapshot.paramMap.get("tab");n&&this.setActiveTab(n),this.getCurrentPromotion(this.promotionId)}ionViewWillEnter(){this.headerService.setConfig({title:"promotion_details"})}getState(){this.state.getState().subscribe(n=>{this.currentUser=n.user,this.promotionTabs=this.currentUser&&"agency"===this.currentUser.accountType?this.promotionTabsForAgency:this.promotionTabsForPromoter})}getHeaderInfo(){var n,t,s;this.promotion&&(this.availableProperties=null===(n=this.promotion)||void 0===n||null===(n=n.properties)||void 0===n?void 0:n.filter(r=>"available"===(null==r?void 0:r.availabilityStatus)),this.rangeOfPropertiesPrices=this.utils.calculateRangeOfPropertiesPrices(null===(t=this.promotion)||void 0===t?void 0:t.properties),this.rangeOfPropertiesRooms=this.utils.calculateRangeOfPropertiesRooms(null===(s=this.promotion)||void 0===s?void 0:s.properties))}onRedirectPromoter(n,t){n.stopPropagation(),this.utils.redirectToPromoter(t)}setActiveTab(n){this.activeTab=n,this.promotionTabs.forEach(t=>{t.active=t.title===n})}createCurrentPromotionDirectoryFiles(){this.promotionFolder={type:"promotion_folder",name:this.promotion.projectName,parent:this.promotion}}onDeletePromotion(){var n=this;return(0,C.A)(function*(){if(n.promotion.properties.length>0)return void n.toastService.showToast({text:"No puedes borrar una promoci\xf3n con propiedades vinculadas",theme:"red",time:2e3});const t=yield n.modalsService.openConfirmationModal({title:"Eliminar promoci\xf3n",message:"\xbfEst\xe1s seguro de que quieres eliminar esta promoci\xf3n?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]});if("delete"===(null==t?void 0:t.data)){const s=yield n.api.deletePromotionById(n.promotion.id);s.success?window.location.href="/promotions":(console.error(s.error),n.toastService.showToast({text:"Error deleting promotion",theme:"red",time:2e3}))}})()}onTabClicked(n){this.activeTab=n,this.location.replaceState(`/promotions/${this.promotionId}/${n}`)}getCurrentPromotion(n){var t=this;return(0,C.A)(function*(){var s;const r=yield t.api.getPromotionFullDataById(n);t.promotion=r.success.data,t.createCurrentPromotionDirectoryFiles(),t.thereIsAMainImage=null===(s=t.promotion)||void 0===s||null===(s=s.promotionFiles)||void 0===s?void 0:s.some(c=>c.mainImage),t.getHeaderInfo()})()}reloadPromotion(){var n=this;return(0,C.A)(function*(){yield n.getCurrentPromotion(n.promotionId)})()}}return(i=a).\u0275fac=function(n){return new(n||i)(o.rXU(x.nX),o.rXU(x.Ix),o.rXU(y.aZ),o.rXU(R.i),o.rXU(lo.d),o.rXU(E.f),o.rXU(G.T),o.rXU(B.c),o.rXU(Y.M))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-promotion-details"]],viewQuery:function(n,t){if(1&n&&o.GBs(Xt,5),2&n){let s;o.mGM(s=o.lsd())&&(t.promotionDetailsInfo=s.first)}},decls:63,vars:26,consts:[["promotionDetailsInfo",""],[1,"crm-block-body"],[1,"crm-block-body-fixed"],[1,"crm-block-details-header"],[1,"crm-block-breadcrumbs"],[1,"crm-block-breadcrumbs-item"],[1,"crm-block-breadcrumbs-item-text","crm-block-breadcrumbs-item-separator"],[1,"crm-block-breadcrumbs-item-text"],[1,"crm-block-details-bottom"],[3,"tabs"],[1,"crm-block-details-header-top"],[1,"d-flex","justify-between","align-center","w-full","p-24"],[1,"crm-block-photo-and-info"],[1,"crm-block-photo-and-info-img","crm-block-photo-and-info-img-promotion"],["alt","",3,"src"],[1,"crm-block-photo-and-info-info"],[1,"crm-block-photo-and-info-info-title"],[3,"text","maxLength"],[1,"crm-card-promotion-left-subtitle"],[1,"crm-block-info-horizontal","ml-20"],[1,"crm-info"],[1,"crm-info-content",3,"click"],[1,"crm-info-content"],[1,"text-black"],[1,"crm-trash-btn"],["alt","",3,"src","click",4,"ngIf"],[1,"crm-block-body-blue-content",3,"ngClass"],[3,"tabClicked","tabs"],["alt","",3,"click","src"],[3,"promotionId"],[3,"promotion"],[3,"directoryBaseElement"],[3,"reloadPromotion","promotionId"],[3,"reloadPromotion","promotion"]],template:function(n,t){1&n&&(o.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),o.EFF(6," Promotions "),o.k0s()(),o.j41(7,"div",5)(8,"div",7),o.EFF(9," / "),o.k0s()(),o.j41(10,"div",5)(11,"div",7),o.EFF(12," Text presentation "),o.k0s()()(),o.j41(13,"div",8),o.DNE(14,At,1,1,"app-tabs",9),o.k0s(),o.j41(15,"div",10)(16,"div",11)(17,"div",12)(18,"div",13),o.DNE(19,Ut,2,0)(20,Ot,1,1,"img",14),o.k0s(),o.j41(21,"div",15)(22,"div")(23,"div",16),o.nrm(24,"app-tooltip-text",17),o.k0s(),o.j41(25,"div",18),o.nrm(26,"app-tooltip-text",17),o.k0s()(),o.nrm(27,"div"),o.k0s()(),o.j41(28,"div",19)(29,"div",20)(30,"div",21),o.bIt("click",function(r){return t.onRedirectPromoter(r,null==t.promotion?null:t.promotion.promoter)}),o.j41(31,"div"),o.EFF(32),o.k0s()()(),o.j41(33,"div",20)(34,"div",22)(35,"div"),o.EFF(36),o.nI1(37,"translate"),o.k0s()()(),o.j41(38,"div",20)(39,"div",22)(40,"div")(41,"span",23),o.EFF(42),o.k0s(),o.EFF(43),o.k0s()()(),o.j41(44,"div",20)(45,"div",22)(46,"div"),o.EFF(47),o.nI1(48,"translate"),o.k0s()()(),o.j41(49,"div",20)(50,"div",22)(51,"div"),o.EFF(52," Excavation phase "),o.k0s()()(),o.j41(53,"div",20)(54,"div",22)(55,"div"),o.EFF(56),o.nI1(57,"thousandSeparator"),o.nI1(58,"thousandSeparator"),o.k0s()()()(),o.j41(59,"div",24),o.DNE(60,Lt,1,1,"img",25),o.k0s()()()()(),o.j41(61,"div",26),o.DNE(62,Kt,4,4),o.k0s()()),2&n&&(o.R7$(14),o.vxM(t.promotionTabs?14:-1),o.R7$(5),o.vxM(t.thereIsAMainImage?19:20),o.R7$(5),o.Y8G("text",null==t.promotion?null:t.promotion.projectName)("maxLength",20),o.R7$(2),o.Y8G("text",(null==t.promotion?null:t.promotion.city)+" / "+(null==t.promotion?null:t.promotion.province))("maxLength",25),o.R7$(6),o.SpI(" ",null==t.promotion||null==t.promotion.promoter?null:t.promotion.promoter.name," "),o.R7$(4),o.SpI(" ",null!=t.promotion&&t.promotion.constructionType?o.bMT(37,16,"promotion_constructionType_texts."+(null==t.promotion?null:t.promotion.constructionType)):""," "),o.R7$(6),o.SpI(" ",null==t.availableProperties?null:t.availableProperties.length,""),o.R7$(),o.SpI(" / ",null==t.promotion||null==t.promotion.properties?null:t.promotion.properties.length," "),o.R7$(4),o.SpI(" ",null!=t.promotion&&t.promotion.constructionStatus?o.bMT(48,18,"text."+(null==t.promotion?null:t.promotion.constructionStatus)):""," "),o.R7$(9),o.Lme(" ",o.bMT(57,20,null==t.rangeOfPropertiesPrices?null:t.rangeOfPropertiesPrices.min)," \u20ac - ",o.bMT(58,22,null==t.rangeOfPropertiesPrices?null:t.rangeOfPropertiesPrices.max)," \u20ac. "),o.R7$(4),o.Y8G("ngIf","promoter"===(null==t.currentUser?null:t.currentUser.accountType)),o.R7$(),o.Y8G("ngClass",o.eq3(24,wt,"agencies"===t.activeTab)),o.R7$(),o.vxM(t.promotion?62:-1))},dependencies:[y.YU,y.bT,$.O,co.F,mo.b,po.e,Lo,Nt,w.D9,Vt.w]}),a})()}];let Qt=(()=>{var i;class a{}return(i=a).\u0275fac=function(n){return new(n||i)},i.\u0275mod=o.$C({type:i}),i.\u0275inj=o.G2t({imports:[x.iI.forChild(Jt),x.iI]}),a})();var Zt=p(3895),on=p(802),en=p(8284),tn=p(9083),nn=p(9662),sn=p(3732);let an=(()=>{var i;class a{}return(i=a).\u0275fac=function(n){return new(n||i)},i.\u0275mod=o.$C({type:i}),i.\u0275inj=o.G2t({imports:[y.MD,_.YN,f.bv,Qt,$.O,Zt.b,on.AgenciesListPageModule,en.o,tn.E,w.h,nn.Y,ro.T,ao.$,sn.D]}),a})()}}]);