"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3732],{9066:(E,I,i)=>{i.d(I,{K:()=>h});var d=i(177),y=i(9465),l=i(3953);let h=(()=>{var u;class f{}return(u=f).\u0275fac=function(_){return new(_||u)},u.\u0275mod=l.$C({type:u}),u.\u0275inj=l.G2t({imports:[d.MD,y.bv]}),f})()},3732:(E,I,i)=>{i.d(I,{D:()=>ge});var d=i(177),y=i(4716),l=i(9417),h=i(9465),u=i(7944),f=i(7991),e=i(3953);let _=(()=>{var n;class a{}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[d.MD,l.YN]}),a})();var g=i(4842),j=i(2652),S=i(6812);let R=(()=>{var n;class a{}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[d.MD,l.YN]}),a})();var b=i(7282);let x=(()=>{var n;class a{}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[d.MD,l.YN,l.X1,h.bv,g.h,S.u,R,b.F]}),a})();var $=i(2606),A=i(179),D=i(3675),G=i(3895),N=i(9662);let B=(()=>{var n;class a{}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[d.MD,l.YN,l.X1,h.bv,j.T,b.F,N.Y,g.h]}),a})();var Y=i(3274),O=i(2306),P=i(68),V=i(144),U=i(8433),X=i(9066),M=i(467),L=i(6552),w=i(5970),k=i(6039),z=i(8397),K=i(1129);const H=["fileUploaderManagerComponent"],C=n=>({"crm-input-input-error":n}),F=n=>({field:n}),J=n=>({item:n});function W(n,a){1&n&&(e.j41(0,"div",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function Z(n,a){1&n&&(e.j41(0,"div",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function Q(n,a){1&n&&(e.j41(0,"div",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function q(n,a){1&n&&(e.j41(0,"div",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function ee(n,a){if(1&n){const r=e.RV6();e.j41(0,"div",15)(1,"div",25)(2,"div",26),e.nrm(3,"span"),e.k0s(),e.j41(4,"div",27),e.EFF(5),e.k0s()(),e.j41(6,"div",28),e.bIt("click",function(){const o=e.eBV(r).$implicit,s=e.XpG();return e.Njj(s.onRemoveLanguage(o))}),e.nrm(7,"i",29),e.k0s()()}if(2&n){let r,t;const o=a.$implicit,s=e.XpG();e.R7$(3),e.HbH(null==(r=s.getLanguageInfo(o))?null:r.flagClass),e.R7$(2),e.SpI(" ",null==(t=s.getLanguageInfo(o))?null:t.name," ")}}function te(n,a){if(1&n){const r=e.RV6();e.j41(0,"button",30),e.bIt("click",function(){e.eBV(r);const o=e.XpG();return e.Njj(o.changeUserInactiveState(!1))}),e.EFF(1,"Activar Usuario"),e.k0s()}}function ne(n,a){if(1&n){const r=e.RV6();e.j41(0,"button",31),e.bIt("click",function(){e.eBV(r);const o=e.XpG();return e.Njj(o.changeUserInactiveState(!0))}),e.EFF(1,"Desactivar Usuario"),e.k0s()}}let oe=(()=>{var n;class a{constructor(t,o,s,c,m){this.fb=t,this.utils=o,this.popoverService=s,this.api=c,this.toast=m,this.user={},this.onChange=new e.bkB,this.userCopy=null,this.files=[],this.photoEdited=!1}ngOnInit(){this.userCopy=JSON.parse(JSON.stringify(this.user)),this.initForm(),this.user?(this.populateForm(this.userCopy),this.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]},this.fileUploaderManager.createProfileFilePic(this.user)):this.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]}}getLanguageInfo(t){return this.utils.getLanguageInfo(t)}onAddLanguage(t){var o=this;return(0,M.A)(function*(){var s,c;const m={languageSelector:!0,showCountryCode:!1,selectedCodes:null===(s=o.user)||void 0===s?void 0:s.languages},p=yield o.popoverService.onShowCountrySelectorPopover(t,m);var T,v;null!=p&&null!==(c=p.data)&&void 0!==c&&c.country&&(o.user=o.user||{},o.user.languages=(null===(T=o.user)||void 0===T?void 0:T.languages)||[],o.user.languages.push(null===(v=p.data)||void 0===v||null===(v=v.country)||void 0===v?void 0:v.code))})()}changeUserInactiveState(t){var o=this;return(0,M.A)(function*(){const s=yield o.api.updateUserById(o.user.id,{...o.user,inactive:t});s.success?(o.user.inactive=t,o.toast.showSuccessToast("Estado del usuario actualizado correctamente")):o.toast.showErrorToast("Ha ocurrido un error al actualizar el estado del usuario. "+s.error.errorMessage)})()}onRemoveLanguage(t){this.user.languages=this.user.languages.filter(o=>o!==t)}initForm(){this.userForm=this.fb.group({email:["",l.k0.required],name:["",l.k0.required],jobTitle:[""],phone:["+34 "],visibleForCollaborators:[]})}populateForm(t){var o,s,c,m,p;this.userForm.patchValue({email:null!==(o=null==t?void 0:t.email)&&void 0!==o?o:"",name:null!==(s=null==t?void 0:t.name)&&void 0!==s?s:"",jobTitle:null!==(c=null==t?void 0:t.jobTitle)&&void 0!==c?c:"",phone:null!==(m=null==t?void 0:t.phone)&&void 0!==m?m:"",visibleForCollaborators:null!==(p=null==t?void 0:t.visibleForCollaborators)&&void 0!==p&&p}),this.userForm.get("email").disable()}onSelectCountry(t){this.userForm.get("phone").setValue((null==t?void 0:t.phoneCode)+" ")}isControlInvalid(t){const o=this.userForm.get(t);return!(!o||!o.invalid||!o.dirty&&!o.touched)}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(l.ok),e.rXU(L.T),e.rXU(w.m),e.rXU(k.i),e.rXU(z.f))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-user-form"]],viewQuery:function(t,o){if(1&t&&e.GBs(H,7),2&t){let s;e.mGM(s=e.lsd())&&(o.fileUploaderManager=s.first)}},inputs:{user:"user"},outputs:{onChange:"onChange"},decls:67,vars:73,consts:[["fileUploaderManagerComponent",""],[1,"crm-section",3,"formGroup"],[1,"crm-section-small-title"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","formControlName","email",3,"placeholder"],["class","crm-input-error",4,"ngIf"],["type","text","formControlName","name",3,"placeholder"],["type","text","formControlName","jobTitle",3,"placeholder"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected"],["type","text","formControlName","phone",3,"placeholder"],[1,"crm-input","crm-input-medium"],[1,"crm-section-items"],[1,"crm-item-option","crm-item-option-lang","edit"],["type","button",1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fas","fa-add"],[1,"crm-input-checkboxes"],["appToggleCheckbox","",1,"crm-input-checkbox"],["formControlName","visibleForCollaborators"],[1,"crm-input-checkbox-label"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button-secondary","crm-button-secondary-red"],[1,"crm-input-error"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[1,"crm-item-option-label"],[1,"crm-item-option-remove",3,"click"],[1,"fas","fa-trash"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"crm-button-secondary","crm-button-secondary-red",3,"click"]],template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"form",1)(1,"div",2),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.nrm(4,"app-file-uploader-manager",null,0),e.j41(6,"div",3)(7,"div",4),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"div",5),e.nrm(11,"input",6),e.nI1(12,"translate"),e.nI1(13,"translate"),e.k0s(),e.DNE(14,W,3,3,"div",7),e.k0s(),e.j41(15,"div",3)(16,"div",4),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"div",5),e.nrm(20,"input",8),e.nI1(21,"translate"),e.nI1(22,"translate"),e.k0s(),e.DNE(23,Z,3,3,"div",7),e.k0s(),e.j41(24,"div",3)(25,"div",4),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.j41(28,"div",5),e.nrm(29,"input",9),e.nI1(30,"translate"),e.nI1(31,"translate"),e.k0s(),e.DNE(32,Q,3,3,"div",7),e.k0s(),e.j41(33,"div",3)(34,"div",4),e.EFF(35),e.nI1(36,"translate"),e.k0s(),e.j41(37,"div",10)(38,"div",5)(39,"app-flag-country-selector",11),e.bIt("emitCountrySelected",function(m){return e.eBV(s),e.Njj(o.onSelectCountry(m))}),e.k0s(),e.nrm(40,"input",12),e.nI1(41,"translate"),e.nI1(42,"translate"),e.k0s()(),e.DNE(43,q,3,3,"div",7),e.k0s(),e.j41(44,"div",13)(45,"div",4),e.EFF(46," Idiomas "),e.k0s(),e.j41(47,"div",14),e.Z7z(48,ee,8,3,"div",15,e.fX1),e.j41(50,"button",16),e.bIt("click",function(m){return e.eBV(s),e.Njj(o.onAddLanguage(m))}),e.nrm(51,"i",17),e.EFF(52),e.nI1(53,"translate"),e.nI1(54,"translate"),e.k0s(),e.j41(55,"div",3)(56,"div",4),e.EFF(57,"Mostrar usuario a colaboradores"),e.k0s(),e.j41(58,"div",18)(59,"div",19),e.nrm(60,"ion-checkbox",20),e.j41(61,"div",21),e.EFF(62,"Mostrar"),e.k0s()()()()(),e.nrm(63,"br")(64,"br"),e.DNE(65,te,2,0,"button",22)(66,ne,2,0,"button",23),e.k0s()()}2&t&&(e.Y8G("formGroup",o.userForm),e.R7$(2),e.SpI(" ",e.bMT(3,20,"text.profile_pic")," "),e.R7$(6),e.SpI(" ",e.bMT(9,22,"text.email")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(55,C,o.isControlInvalid("email"))),e.R7$(),e.Y8G("placeholder",e.i5U(13,26,"text.input_placeholder",e.eq3(57,F,e.bMT(12,24,"text.email")))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("email")),e.R7$(3),e.SpI(" ",e.bMT(18,29,"text.name")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(59,C,o.isControlInvalid("name"))),e.R7$(),e.Y8G("placeholder",e.i5U(22,33,"text.input_placeholder",e.eq3(61,F,e.bMT(21,31,"text.name")))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("name")),e.R7$(3),e.SpI(" ",e.bMT(27,36,"text.job_title")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(63,C,o.isControlInvalid("jobTitle"))),e.R7$(),e.Y8G("placeholder",e.i5U(31,40,"text.input_placeholder",e.eq3(65,F,e.bMT(30,38,"text.job_title")))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("jobTitle")),e.R7$(3),e.SpI(" ",e.bMT(36,43,"text.phone")," "),e.R7$(3),e.Y8G("ngClass",e.eq3(67,C,o.isControlInvalid("phone"))),e.R7$(2),e.Y8G("placeholder",e.i5U(42,47,"text.input_placeholder",e.eq3(69,F,e.bMT(41,45,"text.phone")))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("phone")),e.R7$(5),e.Dyx(null==o.user?null:o.user.languages),e.R7$(4),e.SpI(" ",e.i5U(54,52,"text.add_item",e.eq3(71,J,e.bMT(53,50,"text.language")))," "),e.R7$(13),e.vxM(!0===(null==o.user?null:o.user.inactive)?65:66))},dependencies:[d.YU,d.bT,l.qT,l.me,l.BC,l.cb,l.j4,l.JD,h.eY,h.hB,K.Z,b.F,g.D9]}),a})();var re=i(8129),ie=i(904),ae=i(8359),se=i(1413),le=i(152),ce=i(5558);let de=(()=>{var n;class a{constructor(t){this.api=t,this.searchTermSubject=new se.B,this.allAgencies=[],this.searchResults$=this.searchTermSubject.pipe((0,le.B)(300),(0,ce.n)(o=>this.performSearch(o)))}search(t){this.searchTermSubject.next(t)}performSearch(t){var o=this;return(0,M.A)(function*(){let s=[];if(t.includes("@")){const c=t.split("@")[1];s=(yield o.api.getAgency({email:{contains:"@"+c}},null,{page:0,itemsPerPage:50})).success.data}return s})()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.KVO(k.i))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),a})();function me(n,a){if(1&n){const r=e.RV6();e.j41(0,"div",8),e.bIt("click",function(o){const s=e.eBV(r).$implicit,c=e.XpG(2);return e.Njj(c.selectAgency(s,o))}),e.j41(1,"div",9)(2,"div",10),e.nrm(3,"img",11),e.k0s(),e.j41(4,"div",12)(5,"div",13),e.EFF(6),e.k0s(),e.j41(7,"div",14),e.EFF(8),e.k0s()()(),e.nrm(9,"div",15),e.k0s()}if(2&n){const r=a.$implicit;e.R7$(6),e.SpI(" ",null==r?null:r.name," "),e.R7$(2),e.SpI(" ",null==r?null:r.domain," ")}}function ue(n,a){1&n&&(e.j41(0,"div",16),e.EFF(1," No hay resultados en Byvaro "),e.k0s())}function pe(n,a){if(1&n){const r=e.RV6();e.j41(0,"div",8),e.bIt("click",function(o){e.eBV(r);const s=e.XpG(2);return e.Njj(s.selectAgency(null,o))}),e.j41(1,"div",9)(2,"div",10),e.nrm(3,"img",11),e.k0s(),e.j41(4,"div",12)(5,"div",13),e.EFF(6),e.k0s(),e.j41(7,"div",14),e.EFF(8," Esta agencia no est\xe1 registrada en Byvaro, haz clic para invitarla. "),e.k0s()()(),e.nrm(9,"div",15),e.k0s()}if(2&n){const r=e.XpG(2);e.R7$(6),e.SpI(" ",r.searchTerm," ")}}function he(n,a){if(1&n&&(e.j41(0,"div",5),e.Z7z(1,me,10,2,"div",6,e.fX1),e.DNE(3,ue,2,0,"div",7)(4,pe,10,1,"div",6),e.k0s()),2&n){const r=e.XpG();e.R7$(),e.Dyx(r.searchResults),e.R7$(2),e.Y8G("ngIf",0===r.searchResults.length&&!r.validEmail),e.R7$(),e.vxM(r.validEmail?4:-1)}}let ve=(()=>{var n;class a{constructor(t,o){this.renderer=t,this.searchbarService=o,this.selectedAgency=new e.bkB,this.textUpdated=new e.bkB,this.searchTerm="",this.dropdownOpen=!1,this.searchResults=[],this.validEmail=!1,this.globalClickUnlistener=null,this.searchSubscription=new ae.yU}ngOnInit(){this.searchSubscription=this.searchbarService.searchResults$.subscribe(t=>{this.searchResults=t})}onInputClick(t){t.stopPropagation(),this.dropdownOpen||this.openDropdown()}onSearchTermChange(t){this.searchTerm=t,this.searchbarService.search(t),this.checkEmail(),this.textUpdated.emit(t)}checkEmail(){this.validEmail=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.searchTerm)}selectAgency(t,o){t||(t={name:this.searchTerm,email:"Esta agencia no est\xe1 registrada en Byvaro, se enviar\xe1 una invitaci\xf3n por e-mail."}),o.stopPropagation(),this.selectedAgency.emit({name:t.name,email:this.searchTerm,id:t.id}),this.closeDropdown()}openDropdown(){this.dropdownOpen=!0,this.attachDocumentClickListener()}closeDropdown(){this.dropdownOpen=!1,this.detachDocumentClickListener()}attachDocumentClickListener(){this.globalClickUnlistener=this.renderer.listen("document","click",t=>{t.target.closest(".agents-searchbar-container")||this.closeDropdown()})}detachDocumentClickListener(){this.globalClickUnlistener&&(this.globalClickUnlistener(),this.globalClickUnlistener=null)}ngOnDestroy(){this.detachDocumentClickListener(),this.searchSubscription.unsubscribe()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(e.sFG),e.rXU(de))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-agencies-searchbar"]],outputs:{selectedAgency:"selectedAgency",textUpdated:"textUpdated"},decls:5,vars:2,consts:[[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar","crm-input-input-searchbar-square","agents-searchbar-container",3,"click"],[1,"fas","fa-search"],["type","text","placeholder","Email de la agencia",3,"ngModelChange","ngModel"],["class","dropdown-options",4,"ngIf"],[1,"dropdown-options"],[1,"crm-item-searchbar-agent-result"],["class","no-results",4,"ngIf"],[1,"crm-item-searchbar-agent-result",3,"click"],[1,"crm-item-searchbar-agent-result-left"],[1,"crm-item-searchbar-agent-result-left-image"],["src","assets/images/building.png","alt",""],[1,"crm-item-searchbar-agent-result-left-info"],[1,"crm-item-searchbar-agent-result-left-info-name"],[1,"crm-item-searchbar-agent-result-left-info-email"],[1,"crm-item-searchbar-agent-result-right"],[1,"no-results"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.bIt("click",function(c){return o.onInputClick(c)}),e.nrm(2,"i",2),e.j41(3,"input",3),e.mxI("ngModelChange",function(c){return e.DH7(o.searchTerm,c)||(o.searchTerm=c),c}),e.bIt("ngModelChange",function(c){return o.onSearchTermChange(c)}),e.k0s(),e.DNE(4,he,5,2,"div",4),e.k0s()()),2&t&&(e.R7$(3),e.R50("ngModel",o.searchTerm),e.R7$(),e.Y8G("ngIf",o.dropdownOpen))},dependencies:[d.bT,l.me,l.BC,l.vS],styles:[".agents-searchbar-container[_ngcontent-%COMP%]{position:relative;cursor:pointer}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;z-index:9999;background-color:#fff;padding:8px 0;border-radius:0 0 8px 8px;border:1px solid var(--crm-border-light-color);max-height:200px;overflow-y:auto;font-size:14px}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.no-results[_ngcontent-%COMP%]{padding:8px;color:#888}"]}),a})(),ge=(()=>{var n;class a{}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[d.MD,l.YN,l.X1,h.bv,f.S,_,g.h,j.T,x,$.O,D.S,A.Y,G.b,B,Y.K,O.T,P.k,S.u,b.F,U.x,X.K]}),a})();e.wjB(y.K,[d.bT,oe,re.K],[g.D9]),e.wjB(u.v,[d.bT,ie.X,ve],[]),e.wjB(V.f,[U.x],[])}}]);