"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2703],{9604:(x,C,c)=>{c.d(C,{b:()=>Z});var u=c(467),F=c(7376),o=c(3953),y=c(6039);let g=(()=>{var n;class d{constructor(e){this.api=e}createPromoterFolder(e){var t=this;return(0,u.A)(function*(){const r=[],i={type:"documents_folder",name:"Documentos",parent:e};return r.push(t.createDirectoryItem({type:"promotions_folder",name:"Promociones",parent:e})),r.push(t.createDirectoryItem(i)),r})()}createAgencyFolder(e){var t=this;return(0,u.A)(function*(){const r=[];return r.push(t.createDirectoryItem({type:"documents_folder",name:"Documentos",parent:e})),r})()}createPromotionsFolder(e){var t=this;return(0,u.A)(function*(){const r=[];console.log("promoter",e);const i=(yield t.api.getPromotions({promoterId:{equals:null==e?void 0:e.id}},null,{itemsPerPage:100,page:0})).success.data;for(const a of i)r.push(t.createDirectoryItem({type:"promotion_folder",name:null==a?void 0:a.projectName,parent:a}));return r})()}createPromotionFolder(e){var t=this;return(0,u.A)(function*(){const r=[],i=(yield t.api.getPromotionFullDataById(null==e?void 0:e.id)).success.data,p={type:"promotion_planos_folder",name:"Planos",parent:i},m={type:"promotion_photos_folder",name:"Fotos",parent:i},v={type:"promotion_catalog_folder",name:"Cat\xe1logos",parent:i},I={type:"documents_folder",name:"Documentos",parent:i};return r.push(t.createDirectoryItem({type:"properties_folder",name:"Unidades",parent:i})),r.push(t.createDirectoryItem(p)),r.push(t.createDirectoryItem(m)),r.push(t.createDirectoryItem(v)),r.push(t.createDirectoryItem(I)),r})()}createPropertiesFolder(e){var t=this;return(0,u.A)(function*(){const r=[],i=(yield t.api.getProperty({promotionId:{equals:null==e?void 0:e.id}},null,{itemsPerPage:100,page:0})).success.data;for(const a of i)r.push(t.createDirectoryItem({type:"property_folder",name:null==a?void 0:a.title,parent:a}));return r})()}createPropertyFolder(e){var t=this;return(0,u.A)(function*(){const r=[],i={type:"property_photos_folder",name:"Fotos",parent:e};return r.push(t.createDirectoryItem({type:"property_plans_folder",name:"Planos",parent:e})),r.push(t.createDirectoryItem(i)),r})()}createPropertyPlansFolder(e){var t=this;return(0,u.A)(function*(){const r=[],l=yield t.api.getProperty({id:{equals:null==e?void 0:e.id}},null,null,{propertyFile:{apply:!0,onlyCount:!1,filter:null}}),[i]=l.success.data,a=i.propertyFiles;for(const p of a)r.push(t.createDirectoryItem(p));return r})()}createPropertyPhotosFolder(e){var t=this;return(0,u.A)(function*(){const r=[],l=yield t.api.getProperty({id:{equals:null==e?void 0:e.id}},null,null,{propertyFile:{apply:!0,onlyCount:!1,filter:null}}),[i]=l.success.data,a=i.propertyFiles;for(const p of a)r.push(t.createDirectoryItem(p));return r})()}createPromotionPlansFolder(e){var t=this;return(0,u.A)(function*(){const r=[],l=yield t.api.getPromotions({id:{equals:null==e?void 0:e.id}},null,null,{promotionFiles:{apply:!0,onlyCount:!1,filter:null}}),[i]=l.success.data,a=null==i?void 0:i.promotionFiles;for(const p of a)r.push(t.createDirectoryItem(p));return r})()}createPromotionPhotosFolder(e){var t=this;return(0,u.A)(function*(){const r=[],l=yield t.api.getPromotions({id:{equals:null==e?void 0:e.id}},null,null,{promotionFiles:{apply:!0,onlyCount:!1,filter:null}}),[i]=l.success.data,a=null==i?void 0:i.promotionFiles;for(const p of a)r.push(t.createDirectoryItem(p));return r})()}createPromotionCatalogFolder(e){var t=this;return(0,u.A)(function*(){const r=[],l=yield t.api.getPromotions({id:{equals:null==e?void 0:e.id}},null,null,{promotionFiles:{apply:!0,onlyCount:!1,filter:null}}),[i]=l.success.data,a=null==i?void 0:i.promotionFiles;for(const p of a)r.push(t.createDirectoryItem(p));return r})()}createDirectoryItem(e){const r={type:null!=e&&e.url?"file":"folder",subtype:this.getSubtype(e),object:e,url:null==e?void 0:e.url},l=this.getItemNameAndSubtitle(e);return r.name=l.name,r.subtitle=l.subtitle,r}getSubtype(e){if(null!=e&&e.url){var t;let r=this.getFileExtension((null==e?void 0:e.label)||(null==e?void 0:e.name));return r=null===(t=r)||void 0===t?void 0:t.toLowerCase().trim(),["pdf"].includes(r)?"pdf":["jpg","jpeg","png","gif","webp","heic","heif","bmp","tiff","svg","ico","jfif","raw","indd","ai","eps"].includes(r)?"img":"other-file"}return"folder"}getFileExtension(e){const r=e.split("?")[0].split(".").pop();return r.includes("/")?null:r}getItemNameAndSubtitle(e){var t,r;let l={name:(null==e?void 0:e.label)||(null==e?void 0:e.name),subtitle:""};switch(null==e?void 0:e.type){case"promotion_folder":l.subtitle="Promoci\xf3n",l.name=null==e||null===(t=e.parent)||void 0===t?void 0:t.projectName;break;case"properties_folder":case"property_plans_folder":case"property_photos_folder":case"promotion_planos_folder":case"promotion_photos_folder":case"promotion_catalog_folder":break;case"property_folder":l.subtitle="Propiedad",l.name=null==e||null===(r=e.parent)||void 0===r?void 0:r.reference}return l}}return(n=d).\u0275fac=function(e){return new(e||n)(o.KVO(y.i))},n.\u0275prov=o.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),d})(),P=(()=>{var n;class d{constructor(e,t){this.fileExplorerDirectoryBuilderService=e,this.api=t}createFileExplorerDirectory(e){var t=this;return(0,u.A)(function*(){const r={};return r.object=e,r.items=yield t.createDirectoryItems(e),r})()}createDirectoryItems(e){var t=this;return(0,u.A)(function*(){const r=[];switch(null==e?void 0:e.type){case"promoter_folder":const l=yield t.fileExplorerDirectoryBuilderService.createPromoterFolder(e.parent);r.push(...l);break;case"agency_folder":const i=yield t.fileExplorerDirectoryBuilderService.createAgencyFolder(e.parent);r.push(...i);break;case"documents_folder":break;case"promotions_folder":const a=yield t.fileExplorerDirectoryBuilderService.createPromotionsFolder(e.parent);r.push(...a);break;case"promotion_folder":const p=yield t.fileExplorerDirectoryBuilderService.createPromotionFolder(e.parent);r.push(...p);break;case"properties_folder":const m=yield t.fileExplorerDirectoryBuilderService.createPropertiesFolder(e.parent);r.push(...m);break;case"property_folder":const v=yield t.fileExplorerDirectoryBuilderService.createPropertyFolder(e.parent);r.push(...v);break;case"property_plans_folder":const I=yield t.fileExplorerDirectoryBuilderService.createPropertyPlansFolder(e.parent);r.push(...I);break;case"property_photos_folder":const J=yield t.fileExplorerDirectoryBuilderService.createPropertyPhotosFolder(e.parent);r.push(...J);break;case"promotion_planos_folder":const q=yield t.fileExplorerDirectoryBuilderService.createPromotionPlansFolder(e.parent);r.push(...q);break;case"promotion_photos_folder":const j=yield t.fileExplorerDirectoryBuilderService.createPromotionPhotosFolder(e.parent);r.push(...j);break;case"promotion_catalog_folder":const ee=yield t.fileExplorerDirectoryBuilderService.createPromotionCatalogFolder(e.parent);r.push(...ee)}return r})()}}return(n=d).\u0275fac=function(e){return new(e||n)(o.KVO(g),o.KVO(y.i))},n.\u0275prov=o.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),d})();var f=c(638),h=c(5970),E=c(5188),D=c(6552),M=c(1213),k=c(177),U=c(6279),B=c(8147);const S=["propertyFileUploaderManagerComponent"],T=["propertyPlansFileUploaderManagerComponent"],b=["promotionFileUploaderManagerComponent"],A=["promotionPlanosFileUploadManagerComponent"],G=["promotionCatalogsFileUploadManagerComponent"],O=["videosFileUploadManagerComponent"],_=n=>({"d-block":n}),R=n=>({"crm-block-breadcrumbs-item-separator":n});function N(n,d){1&n&&(o.j41(0,"div",11)(1,"div",20),o.EFF(2," / "),o.k0s()())}function w(n,d){if(1&n){const s=o.RV6();o.DNE(0,N,3,0,"div",11),o.j41(1,"div",18),o.bIt("click",function(){o.eBV(s);const t=o.XpG().$implicit,r=o.XpG();return o.Njj(r.onClickNavigation(t))}),o.j41(2,"div",19),o.EFF(3),o.k0s()()}if(2&n){const s=o.XpG(),e=s.$implicit,t=s.$index,r=o.XpG();o.vxM(t>0?0:-1),o.R7$(2),o.Y8G("ngClass",o.eq3(3,R,t>0)),o.R7$(),o.SpI(" ",r.getFolderName(e)," ")}}function X(n,d){if(1&n&&o.DNE(0,w,4,5,"div",11),2&n){const s=d.$implicit,e=o.XpG();o.vxM(e.getFolderName(s)?0:-1)}}function $(n,d){if(1&n){const s=o.RV6();o.j41(0,"button",21),o.bIt("click",function(){o.eBV(s);const t=o.XpG();return o.Njj(t.onSaveFiles())}),o.nrm(1,"i",22),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&n&&(o.R7$(2),o.SpI(" ",o.bMT(3,1,"buttons.save_files")," "))}function V(n,d){1&n&&o.nrm(0,"img",26)}function W(n,d){1&n&&o.nrm(0,"img",27)}function K(n,d){1&n&&o.nrm(0,"img",28)}function Y(n,d){}function L(n,d){if(1&n&&(o.j41(0,"div",29),o.EFF(1),o.k0s()),2&n){const s=o.XpG(2).$implicit;o.R7$(),o.SpI(" ",null==s?null:s.subtitle," ")}}function z(n,d){if(1&n){const s=o.RV6();o.j41(0,"div",24),o.bIt("click",function(){o.eBV(s);const t=o.XpG().$implicit,r=o.XpG();return o.Njj(r.onItemClick(t))}),o.j41(1,"div",25),o.DNE(2,V,1,0,"img",26)(3,W,1,0,"img",27)(4,K,1,0,"img",28)(5,Y,0,0),o.k0s(),o.DNE(6,L,2,1,"div",29),o.j41(7,"div",30),o.EFF(8),o.k0s()()}if(2&n){const s=o.XpG().$implicit;o.R7$(2),o.vxM("folder"===(null==s?null:s.subtype)?2:"pdf"===(null==s?null:s.subtype)?3:"other-file"===(null==s?null:s.subtype)?4:5),o.R7$(4),o.vxM(null!=s&&s.subtitle?6:-1),o.R7$(2),o.SpI(" ",null==s?null:s.name," ")}}function H(n,d){if(1&n&&o.DNE(0,z,9,3,"div",23),2&n){const s=d.$implicit;o.vxM("img"!==(null==s?null:s.subtype)?0:-1)}}function Q(n,d){1&n&&o.EFF(0," No hay archivos ")}let Z=(()=>{var n;class d{constructor(e,t,r,l,i,a,p){this.fileExplorerService=e,this.modalsService=t,this.popoversService=r,this.router=l,this.utils=i,this.api=a,this.state=p,this.options={type:"promoterFolder"},this.history=[],this.navigation=[],this.testClass="d-none",this.propertyId=null,this.parentId=null,this.showSaveFilesBtn=!1,this.objectType="",this.promotionId="",this.activeFileUploaderManager=null}ngOnInit(){this.state.getState().subscribe(e=>{this.currentUser=e.user})}ngAfterViewInit(){}ngOnChanges(){this.directoryBaseElement&&(console.log("directoryBaseElement",this.directoryBaseElement),this.navigation=[],this.navigation.push(this.directoryBaseElement),this.buildDirectory())}getFolderName(e){var t,r,l,i;return null!=e&&e.name?e.name:null!=e&&null!==(t=e.parent)&&void 0!==t&&t.reference?null==e||null===(l=e.parent)||void 0===l?void 0:l.reference:null!=e&&null!==(r=e.parent)&&void 0!==r&&r.projectName?null==e||null===(i=e.parent)||void 0===i?void 0:i.projectName:""}onItemMenuClick(e){var t=this;return(0,u.A)(function*(){e.stopPropagation(),e.preventDefault();yield t.popoversService.onShowMenuPopover(e,"file-explorer-item-options")})()}onUploadFiles(){var e=this;return(0,u.A)(function*(){const t=yield e.modalsService.onShowUploadFilesModal();t.data&&console.log("Archivos a subir",t.data)})()}onItemClick(e){var t,r;"Documentos"!==e.name?("folder"===e.type&&this.buildDirectory(null==e?void 0:e.object),"file"===e.type&&window.open(e.url,"_blank")):this.router.navigate(["/documents"],{queryParams:{agencyId:"agencyFolder"===this.options.type?null===(t=this.directoryBaseElement)||void 0===t||null===(t=t.parent)||void 0===t?void 0:t.id:void 0,promotionId:"promotion_folder"===this.directoryBaseElement.type?null===(r=this.directoryBaseElement)||void 0===r||null===(r=r.parent)||void 0===r?void 0:r.id:void 0}})}onClickNavigation(e){const t=this.navigation.findIndex(r=>r===e);this.navigation=this.navigation.slice(0,t+1),this.buildDirectory(e,!0)}onGoRoot(){this.buildDirectory(this.directoryBaseElement,!0)}onGoBack(){this.navigation.length>1&&(this.navigation.pop(),this.buildDirectory(this.navigation[this.navigation.length-1],!0))}buildDirectory(e,t){var r=this;return(0,u.A)(function*(){var l,i;r.showSaveFilesBtn=!1,r.directory=yield r.fileExplorerService.createFileExplorerDirectory(e||r.directoryBaseElement),t||r.navigation.push(e);let a=[];null!==(l=r.directory)&&void 0!==l&&null!==(l=l.object)&&void 0!==l&&null!==(l=l.parent)&&void 0!==l&&l.id&&(r.parentId=r.directory.object.parent.id),null===(i=r.directory)||void 0===i||i.items.forEach(m=>{a.push(m.object)}),r.objectType=null==e?void 0:e.type;const p={multiple:!0,size:"medium",showRemove:!0,showName:!0,rounded:!1,allowUpload:!0,accept:"image/*",showStar:!1,files:[],openUrlOnClick:!0};"property_photos_folder"===(null==e?void 0:e.type)?(r.showSaveFilesBtn=!0,setTimeout(()=>{r.propertyFileUploaderManagerComponent.config={...p,filesCategory:"images",files:r.utils.filterFilesByCategoryAndSort(a,"images")}}),r.activeFileUploaderManager=r.propertyFileUploaderManagerComponent):"property_plans_folder"===(null==e?void 0:e.type)?(r.showSaveFilesBtn=!0,r.propertyPlansFileUploaderManagerComponent.config={...p,filesCategory:"plan",accept:"image/*,application/pdf",files:r.utils.filterFilesByCategoryAndSort(a,"plan")},r.activeFileUploaderManager=r.propertyPlansFileUploaderManagerComponent):"promotion_photos_folder"===(null==e?void 0:e.type)?(r.showSaveFilesBtn=!0,setTimeout(()=>{var m;r.promotionFileUploaderManagerComponent.config={...p,allowUpload:"promoter"===(null===(m=r.currentUser)||void 0===m?void 0:m.accountType),filesCategory:"images",files:r.utils.filterFilesByCategoryAndSort(a,"images")}}),r.activeFileUploaderManager=r.promotionFileUploaderManagerComponent):"promotion_planos_folder"===(null==e?void 0:e.type)?(r.showSaveFilesBtn=!0,r.promotionPlanosFileUploadManagerComponent.config={...p,filesCategory:"plan",accept:"image/*,application/pdf",files:r.utils.filterFilesByCategoryAndSort(a,"plan")},r.activeFileUploaderManager=r.promotionPlanosFileUploadManagerComponent):"promotion_catalog_folder"===(null==e?void 0:e.type)&&(r.showSaveFilesBtn=!0,r.promotionCatalogsFileUploadManagerComponent.config={...p,filesCategory:"catalog",accept:"image/*,application/pdf",files:r.utils.filterFilesByCategoryAndSort(a,"catalog")},r.activeFileUploaderManager=r.promotionCatalogsFileUploadManagerComponent)})()}onSaveFiles(){var e=this;return(0,u.A)(function*(){var t;let r=F.cloneDeep(null===(t=e.activeFileUploaderManager)||void 0===t||null===(t=t.config)||void 0===t?void 0:t.files)||[];for(let i of r){if(null!=i&&i.new){var l;let a={name:"",category:i.category,label:i.label,orderIndex:null==i?void 0:i.orderIndex};e.objectType.includes("promotion")?a={...a,promotionId:e.parentId}:e.objectType.includes("property")&&(a={...a,propertyId:e.parentId});const p=yield e.api.uploadFile(i.fileBlob),m=null==p||null===(l=p.success)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.fileName;a.name=m;let v=null;e.objectType.includes("promotion")?v=yield e.api.addPromotionFile(a):e.objectType.includes("property")&&(v=yield e.api.addPropertyFile(a))}if(null!=i&&i.deleted&&(e.objectType.includes("promotion")?yield e.api.removePromotionFileById(null==i?void 0:i.id):e.objectType.includes("property")&&(yield e.api.deletePropertyFileById(null==i?void 0:i.id))),null!=i&&i.moved&&(null==i||!i.deleted)&&(null==i||!i.new)){let a=F.cloneDeep(i);delete a.moved,delete a.fileBase64,delete a.fileBlob,delete a.new,delete a.deleted,delete a.size,delete a.type,e.objectType.includes("promotion")?yield e.api.editPromotionFile(a):e.objectType.includes("property")&&(yield e.api.editPropertyFile(a))}}})()}}return(n=d).\u0275fac=function(e){return new(e||n)(o.rXU(P),o.rXU(f.M),o.rXU(h.m),o.rXU(E.Ix),o.rXU(D.T),o.rXU(y.i),o.rXU(M.c))},n.\u0275cmp=o.VBU({type:n,selectors:[["app-file-explorer"]],viewQuery:function(e,t){if(1&e&&(o.GBs(S,7),o.GBs(T,7),o.GBs(b,7),o.GBs(A,5),o.GBs(G,5),o.GBs(O,5)),2&e){let r;o.mGM(r=o.lsd())&&(t.propertyFileUploaderManagerComponent=r.first),o.mGM(r=o.lsd())&&(t.propertyPlansFileUploaderManagerComponent=r.first),o.mGM(r=o.lsd())&&(t.promotionFileUploaderManagerComponent=r.first),o.mGM(r=o.lsd())&&(t.promotionPlanosFileUploadManagerComponent=r.first),o.mGM(r=o.lsd())&&(t.promotionCatalogsFileUploadManagerComponent=r.first),o.mGM(r=o.lsd())&&(t.videosFileUploadManagerComponent=r.first)}},inputs:{directoryBaseElement:"directoryBaseElement",options:"options"},features:[o.OA$],decls:33,vars:17,consts:[["promotionPlanosFileUploadManagerComponent",""],["promotionCatalogsFileUploadManagerComponent",""],["promotionFileUploaderManagerComponent",""],["propertyFileUploaderManagerComponent",""],["propertyPlansFileUploaderManagerComponent",""],[1,"crm-section"],[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-buttons-group"],[1,"crm-button-icon-solo",3,"click"],[1,"fa","fa-arrow-left"],[1,"crm-block-breadcrumbs"],[1,"crm-block-breadcrumbs-item"],[1,"crm-block-breadcrumbs-item-icon"],[1,"fas","fa-folder"],[1,"crm-button"],[1,"d-none",3,"ngClass"],[1,"crm-section-margin-top"],[1,"crm-section-files"],[1,"crm-block-breadcrumbs-item",3,"click"],[1,"crm-block-breadcrumbs-item-text",3,"ngClass"],[1,"crm-block-breadcrumbs-item-text","crm-block-breadcrumbs-item-separator"],[1,"crm-button",3,"click"],[1,"fa","fa-upload"],[1,"crm-directory-item"],[1,"crm-directory-item",3,"click"],[1,"crm-directory-item-icon"],["src","assets/images/folder.png"],["src","assets/images/pdf1.png"],["src","assets/images/doc.png"],[1,"crm-directory-item-subtitle"],[1,"crm-directory-item-title"]],template:function(e,t){if(1&e){const r=o.RV6();o.j41(0,"div",5)(1,"div",6)(2,"div")(3,"div",7)(4,"button",8),o.bIt("click",function(){return o.eBV(r),o.Njj(t.onGoBack())}),o.nrm(5,"i",9),o.k0s(),o.j41(6,"div",10)(7,"div",11)(8,"div",12),o.nrm(9,"i",13),o.k0s()(),o.Z7z(10,X,1,1,null,null,o.fX1),o.k0s()()(),o.j41(12,"div",7),o.DNE(13,$,4,3,"button",14),o.k0s()(),o.j41(14,"div",15),o.nrm(15,"app-file-uploader-manager",16,0),o.k0s(),o.j41(17,"div",15),o.nrm(18,"app-file-uploader-manager",16,1),o.k0s(),o.j41(20,"div",15),o.nrm(21,"app-file-uploader-manager",16,2),o.k0s(),o.j41(23,"div",15),o.nrm(24,"app-file-uploader-manager",16,3),o.k0s(),o.j41(26,"div",15),o.nrm(27,"app-file-uploader-manager",16,4),o.k0s(),o.j41(29,"div",17),o.Z7z(30,H,1,1,null,null,o.fX1),o.DNE(32,Q,1,0),o.k0s()()}2&e&&(o.R7$(10),o.Dyx(t.navigation),o.R7$(3),o.vxM(null!=t.directory&&null!=t.directory.items&&t.directory.items.length&&t.showSaveFilesBtn?13:-1),o.R7$(),o.Y8G("ngClass",o.eq3(7,_,"promotion_planos_folder"===t.objectType)),o.R7$(3),o.Y8G("ngClass",o.eq3(9,_,"promotion_catalog_folder"===t.objectType)),o.R7$(3),o.Y8G("ngClass",o.eq3(11,_,"promotion_photos_folder"===t.objectType)),o.R7$(3),o.Y8G("ngClass",o.eq3(13,_,"property_photos_folder"===t.objectType)),o.R7$(3),o.Y8G("ngClass",o.eq3(15,_,"property_plans_folder"===t.objectType)),o.R7$(4),o.Dyx(null==t.directory?null:t.directory.items),o.R7$(2),o.vxM(0===(null==t.directory||null==t.directory.items?null:t.directory.items.length)?32:-1))},dependencies:[k.YU,U.F,B.D9]}),d})()},8284:(x,C,c)=>{c.d(C,{o:()=>P});var u=c(177),F=c(9417),o=c(8147),y=c(6279),g=c(3953);let P=(()=>{var f;class h{}return(f=h).\u0275fac=function(D){return new(D||f)},f.\u0275mod=g.$C({type:f}),f.\u0275inj=g.G2t({imports:[u.MD,F.YN,o.h,y.F]}),h})()}}]);