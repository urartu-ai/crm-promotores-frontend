"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2098],{1129:(V,j,p)=>{p.d(j,{Z:()=>C});var d=p(3953),c=p(6069),y=p(1982);function b(e,k){if(1&e){const F=d.RV6();d.j41(0,"app-country-selector-popover",4),d.bIt("countrySelected",function(x){d.eBV(F);const E=d.XpG();return d.Njj(E.selectCountry(x))})("closePopover",function(){d.eBV(F);const x=d.XpG();return d.Njj(x.dropdownOpen=!1)}),d.k0s()}2&e&&d.Y8G("showCountryCode",!0)}let C=(()=>{var e;class k{constructor(){this.emitCountrySelected=new d.bkB,this.countries=c.X,this.selectedCountry=c.X[0],this.dropdownOpen=!1}ngOnChanges(){const _=this.extractCountryPhoneCodeFromPhoneNumber(this.selectedPhoneNumber);_!==this.extractCountryPhoneCodeFromPhoneNumber(this.selectedCountry.phoneCode)&&this.selectCountryByPhoneCode(_)}toggleDropdown(_){_.stopPropagation(),this.dropdownOpen=!this.dropdownOpen}selectCountry(_){_.event.stopPropagation(),this.selectedCountry=_.country,this.emitCountrySelected.emit(_.country),this.dropdownOpen=!1}selectCountryByPhoneCode(_){const x=this.countries.find(E=>E.phoneCode===_);x&&(this.selectedCountry=x,this.emitCountrySelected.emit(x))}extractCountryPhoneCodeFromPhoneNumber(_){return null==_?void 0:_.split(" ")[0]}}return(e=k).\u0275fac=function(_){return new(_||e)},e.\u0275cmp=d.VBU({type:e,selectors:[["app-flag-country-selector"]],inputs:{selectedPhoneNumber:"selectedPhoneNumber"},outputs:{emitCountrySelected:"emitCountrySelected"},features:[d.OA$],decls:5,vars:3,consts:[["tabindex","0",1,"flag-country-selector-container",3,"click"],[1,"selected-country"],[1,"fas","fa-caret-down","dropdown-arrow"],[3,"showCountryCode"],[3,"countrySelected","closePopover","showCountryCode"]],template:function(_,x){1&_&&(d.j41(0,"div",0),d.bIt("click",function(R){return x.toggleDropdown(R)}),d.j41(1,"div",1),d.nrm(2,"span")(3,"i",2),d.k0s(),d.DNE(4,b,1,1,"app-country-selector-popover",3),d.k0s()),2&_&&(d.R7$(2),d.HbH(null==x.selectedCountry?null:x.selectedCountry.flagClass),d.R7$(2),d.vxM(x.dropdownOpen?4:-1))},dependencies:[y.u],styles:[".flag-country-selector-container[_ngcontent-%COMP%]{position:relative;width:50px;cursor:pointer;color:#000}.selected-country[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:50px}.dropdown-arrow[_ngcontent-%COMP%]{margin-left:8px}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:200px;z-index:9999;background-color:#fff;border:1px solid #ccc;padding:8px 0;border-radius:12px;border:1px solid var(--crm-border-light-color);color:#000;max-height:150px;overflow-y:auto}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;display:inline-block;margin-right:8px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.flag-country-selector-container[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{color:#000}.selected-country[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;width:18px;height:18px}"]}),k})()},6812:(V,j,p)=>{p.d(j,{u:()=>C});var d=p(177),c=p(9417),y=p(7754),b=p(3953);let C=(()=>{var e;class k{}return(e=k).\u0275fac=function(_){return new(_||e)},e.\u0275mod=b.$C({type:e}),e.\u0275inj=b.G2t({imports:[d.MD,c.YN,y.X]}),k})()},7754:(V,j,p)=>{p.d(j,{X:()=>C});var d=p(177),c=p(9417),y=p(9465),b=p(3953);let C=(()=>{var e;class k{}return(e=k).\u0275fac=function(_){return new(_||e)},e.\u0275mod=b.$C({type:e}),e.\u0275inj=b.G2t({imports:[d.MD,c.YN,y.bv]}),k})()},2098:(V,j,p)=>{p.r(j),p.d(j,{VentaOperationProcessPageModule:()=>ot});var d=p(177),c=p(9417),y=p(9465),b=p(5188),C=p(467),e=p(3953),k=p(6039),F=p(8397);function _(i,s){if(1&i){const a=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,o=e.XpG();return e.Njj(o.onSelectPromotion(t))}),e.EFF(1," Seleccionada "),e.k0s()}}function x(i,s){if(1&i){const a=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,o=e.XpG();return e.Njj(o.onSelectPromotion(t))}),e.EFF(1," Seleccionar "),e.k0s()}}function E(i,s){if(1&i&&(e.j41(0,"div",14)(1,"div",15),e.EFF(2),e.k0s(),e.j41(3,"div",16),e.EFF(4),e.k0s(),e.j41(5,"div",17),e.DNE(6,_,2,0,"button",18)(7,x,2,0,"button",19),e.k0s()()),2&i){const a=s.$implicit,n=e.XpG();e.R7$(2),e.SpI(" ",a.projectName," "),e.R7$(2),e.Lme(" ",a.availableProperties.length," / ",a.properties.length," "),e.R7$(2),e.vxM((null==n.selectedPromotion?null:n.selectedPromotion.id)===a.id?6:7)}}let R=(()=>{var i;class s{constructor(n){this.api=n,this.selectPromotion=new e.bkB,this.promotions=[],this.selectedPromotion=null,this.searchTerm=""}ngOnInit(){this.getAllPromotions()}getAllPromotions(){var n=this;return(0,C.A)(function*(){try{const t={page:0,itemsPerPage:500},o=yield n.api.getPromotions({},null,t,{properties:{apply:!0,filter:null,onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},promoter:{apply:!0,filter:null,onlyCount:!1}});null!=o&&o.success?(n.promotions=o.success.data,n.promotions.forEach(r=>{var l;r.availableProperties=null===(l=r.properties)||void 0===l?void 0:l.filter(u=>"available"===u.availabilityStatus)}),console.log("All Promotions:",n.promotions)):console.error("Error fetching promotions:",null==o?void 0:o.error)}catch(t){console.error("Error in getAllPromotions:",t)}})()}get filteredPromotions(){return this.searchTerm?this.promotions.filter(n=>{var t;return null===(t=n.projectName)||void 0===t?void 0:t.toLowerCase().includes(this.searchTerm.toLowerCase())}):this.promotions}onSelectPromotion(n){this.selectPromotion.emit(n),this.selectedPromotion=n}}return(i=s).\u0275fac=function(n){return new(n||i)(e.rXU(k.i))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-promotion"]],outputs:{selectPromotion:"selectPromotion"},decls:19,vars:3,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","300px","margin-bottom","16px"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar promoci\xf3n...",3,"ngModelChange","ngModel"],[1,"promotions-table"],[1,"promotions-table-header"],[1,"promotions-table-header-title"],[1,"promotions-table-header-availability"],[1,"promotions-table-header-actions"],["class","promotions-table-row",4,"ngFor","ngForOf"],[1,"promotions-table-footer"],[1,"promotions-table-row"],[1,"promotions-table-row-title"],[1,"promotions-table-row-availability"],[1,"promotions-table-row-actions"],["disabled","",1,"crm-button"],[1,"crm-button"],["disabled","",1,"crm-button",3,"click"],[1,"crm-button",3,"click"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2," 1. Promoci\xf3n "),e.k0s(),e.j41(3,"div",2)(4,"div",3)(5,"div",4),e.nrm(6,"i",5),e.j41(7,"input",6),e.mxI("ngModelChange",function(r){return e.DH7(t.searchTerm,r)||(t.searchTerm=r),r}),e.k0s()()(),e.j41(8,"div",7)(9,"div",8)(10,"div",9),e.EFF(11,"Promoci\xf3n"),e.k0s(),e.j41(12,"div",10),e.EFF(13,"Viviendas disponibles"),e.k0s(),e.j41(14,"div",11),e.EFF(15,"Acciones"),e.k0s()(),e.DNE(16,E,8,4,"div",12),e.k0s(),e.j41(17,"div",13),e.EFF(18),e.k0s()()()),2&n&&(e.R7$(7),e.R50("ngModel",t.searchTerm),e.R7$(9),e.Y8G("ngForOf",t.filteredPromotions),e.R7$(2),e.SpI(" Total promociones: ",t.filteredPromotions.length," "))},dependencies:[d.Sq,c.me,c.BC,c.vS]}),s})();var G=p(7376),K=p(1296),z=p(6552),L=p(1880);function J(i,s){if(1&i){const a=e.RV6();e.qex(0),e.j41(1,"div",4),e.EFF(2),e.k0s(),e.j41(3,"app-table",5),e.bIt("rowClicked",function(t){e.eBV(a);const o=e.XpG();return e.Njj(o.onRowClicked(t))}),e.k0s(),e.nrm(4,"div",6),e.bVm()}if(2&i){const a=s.$implicit,n=s.index;e.R7$(2),e.SpI(" ",a.name||"Bloque "+(a.index||n+1)," "),e.R7$(),e.Y8G("table",a.tableConfig)}}let H=(()=>{var i;class s{constructor(n,t,o){this.tableService=n,this.utils=t,this.toastService=o,this.selectProperty=new e.bkB,this.blocks=[],this.allColumnsKeysSelected=["externalReference","reference","m2useful","m2total","terrace","plot","bedrooms","bathrooms","pool","storage","parking","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!1,editCellsMode:!1,columns:[{key:"externalReference",label:"Ref. externa",size:"medium",editMode:{inputType:"text"}},{key:"reference",label:"Identificador",size:"medium",editMode:{inputType:"text"}},{key:"m2useful",label:"M2 \xfatiles",size:"small",extraString:" m\xb2",fn:r=>null!=r&&r.totalMeasures_squareMetersUseful?r.totalMeasures_squareMetersUseful+" m\xb2":""},{key:"m2total",label:"M2 total",size:"small",extraString:" m\xb2",fn:r=>null!=r&&r.totalMeasures_squareMetersBuilt?r.totalMeasures_squareMetersBuilt+" m\xb2":""},{key:"terrace",label:"Terraza",size:"small",fn:r=>{const m=(r.totalMeasures_squareMetersCoveredTerraces||0)+(r.totalMeasures_squareMetersUncoveredTerraces||0);return m?m+" m\xb2":""}},{key:"plot",label:"Parcela",size:"small",extraString:" m\xb2",fn:r=>null!=r&&r.totalMeasures_squareMetersPatch?r.totalMeasures_squareMetersPatch+" m\xb2":""},{key:"bedrooms",label:"Dorm.",size:"small"},{key:"bathrooms",label:"Ba\xf1os",size:"small"},{key:"pool",label:"Piscina",size:"small",fn:r=>r.f_pool_comunitaria?"Comunitaria":r.f_pool_privada?"Privada":"No"},{key:"storage",label:"Trastero",size:"small",fn:r=>r.fcustom_trastero?r.fcustom_trasteroPrice?this.utils.transformThousandSeparator(r.fcustom_trasteroPrice)+" \u20ac":r.fcustom_trasteroIncludedInPrice?"Incluido":"S\xed":"No"},{key:"parking",label:"Parking",size:"small",fn:r=>{let l=r.fcustom_parking?"S\xed":"No";return r.fcustom_parkingPrice&&(l=this.utils.transformThousandSeparator(r.fcustom_parkingPrice)+" \u20ac"),r.fcustom_parkingIncludedInPrice&&(l="Incluido"),r.fcustom_parkingComunitario&&(l+=" (Comunitario)"),l}},{key:"price",label:"Precio",size:"small",fn:r=>null!=r&&r.price?this.utils.transformThousandSeparator(r.price)+" \u20ac":""}],rows:[]}}ngOnInit(){}set selectedPromotion(n){this.promotion=n,this.getData()}getData(){var n;if(this.promotion){this.allColumnsKeysSelected=(null===(n=this.promotion)||void 0===n?void 0:n.tableColumnsKeysSelected)||this.allColumnsKeysSelected,this.blocks=this.promotion.promotionBlocks||[];for(let t=0;t<this.blocks.length;t++){const o=this.blocks[t];!o.properties||0===o.properties.length||(o.tableConfig=G.cloneDeep(this.tableConfig),o.tableConfig.rows=this.tableService.convertDataToTableRows(G.cloneDeep(o.properties),G.cloneDeep(o.tableConfig)),o.tableConfig.rows=this.addBackgroundColorsToTableRows(o.tableConfig.rows))}}}addBackgroundColorsToTableRows(n){for(let t=0;t<n.length;t++)switch(n[t].rawObject.availabilityStatus){case"available":n[t].style={backgroundColor:"success"};break;case"sold":n[t].style={backgroundColor:"red"};break;case"reserved":n[t].style={backgroundColor:"warning"};break;default:n[t].style={backgroundColor:"blocked"}}return n}onRowClicked(n){const t=n.rawObject;console.log("Row clicked, property:",t),this.selectProperty.emit(t)}}return(i=s).\u0275fac=function(n){return new(n||i)(e.rXU(K.a),e.rXU(z.T),e.rXU(F.f))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-property"]],outputs:{selectProperty:"selectProperty"},decls:5,vars:1,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[4,"ngFor","ngForOf"],[1,"block-title"],[2,"margin-bottom","16px",3,"rowClicked","table"],[2,"margin-bottom","16px"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2," 2. Vivienda principal "),e.k0s(),e.j41(3,"div",2),e.DNE(4,J,5,2,"ng-container",3),e.k0s()()),2&n&&(e.R7$(4),e.Y8G("ngForOf",t.blocks))},dependencies:[d.Sq,L.O],styles:[".block-title[_ngcontent-%COMP%]{margin-bottom:16px;font-size:14px;font-weight:500}"]}),s})();var W=p(4558);function Q(i,s){if(1&i&&(e.j41(0,"option",21),e.EFF(1),e.k0s()),2&i){const a=s.$implicit;e.Y8G("value",a),e.R7$(),e.JRh(a)}}function Z(i,s){if(1&i){const a=e.RV6();e.j41(0,"div",22),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.editingPrice=!0)}),e.EFF(1),e.nI1(2,"thousandSeparator"),e.nrm(3,"i",23),e.k0s()}if(2&i){const a=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,a.priceSelected.priceWithoutIva)," \u20ac ")}}function ee(i,s){if(1&i){const a=e.RV6();e.j41(0,"div",24)(1,"input",25),e.mxI("ngModelChange",function(t){e.eBV(a);const o=e.XpG();return e.DH7(o.priceSelected.priceWithoutIva,t)||(o.priceSelected.priceWithoutIva=t),e.Njj(t)}),e.k0s(),e.j41(2,"i",26),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.onPriceConfirm())}),e.k0s()()}if(2&i){const a=e.XpG();e.R7$(),e.R50("ngModel",a.priceSelected.priceWithoutIva)}}let te=(()=>{var i;class s{constructor(){this.selectPrice=new e.bkB,this.priceSelected={priceWithoutIva:0,priceWithIva:0,finalPrice:0,iva:10},this.taxRates=["0%","10%","21%"],this.selectedTaxRate="10%",this.editingPrice=!1}set selectedProperty(n){this.property=n,this.priceSelected.priceWithoutIva=(null==n?void 0:n.price)||0,this.updateCalculations()}ngOnInit(){this.updateCalculations()}onTaxRateChange(){this.updateCalculations()}onPriceConfirm(){this.updateCalculations(),this.editingPrice=!1}updateCalculations(){const n=parseFloat(this.selectedTaxRate);this.priceSelected.iva=isNaN(n)?0:n,this.priceSelected.priceWithIva=this.priceSelected.priceWithoutIva*(this.priceSelected.iva/100),this.priceSelected.finalPrice=this.priceSelected.priceWithoutIva+this.priceSelected.priceWithIva}goNextSection(){this.selectPrice.emit(this.priceSelected),console.log("Go to the next section...")}}return(i=s).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-price"]],outputs:{selectPrice:"selectPrice"},decls:48,vars:17,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","200px","margin-bottom","24px"],[1,"crm-input-label"],[1,"crm-input-input","crm-input-input-searchbar-square"],[3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"title",2,"margin-bottom","8px"],[1,"price-table-header",2,"padding","0px 16px"],[1,"price-table-header-cell"],[1,"price-table"],[1,"price-table-row"],[1,"price-table-cell"],[1,"price-table-cell","editable-cell"],["class","editable-price-display",3,"click",4,"ngIf"],["class","editable-price-edit",4,"ngIf"],[1,"price-table-footer"],[1,"price-table-footer-cell"],[1,"crm-block-buttons-right",2,"margin-top","16px"],[1,"crm-button",3,"click"],[3,"value"],[1,"editable-price-display",3,"click"],[1,"fas","fa-pencil",2,"color","rgb(130, 130, 130)"],[1,"editable-price-edit"],["type","number",3,"ngModelChange","ngModel"],[1,"fas","fa-check",2,"color","rgb(11, 169, 11)",3,"click"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2," 3. Por precio "),e.k0s(),e.j41(3,"div",2)(4,"div",3)(5,"div",4),e.EFF(6," Impuestos IVA/IT "),e.k0s(),e.j41(7,"div",5)(8,"select",6),e.mxI("ngModelChange",function(r){return e.DH7(t.selectedTaxRate,r)||(t.selectedTaxRate=r),r}),e.bIt("change",function(){return t.onTaxRateChange()}),e.DNE(9,Q,2,2,"option",7),e.k0s()()(),e.j41(10,"div",8),e.EFF(11," Tabla de precios "),e.k0s(),e.j41(12,"div",9)(13,"div",10),e.EFF(14,"Vivienda"),e.k0s(),e.j41(15,"div",10),e.EFF(16,"Precio"),e.k0s(),e.j41(17,"div",10),e.EFF(18,"IVA/ITP"),e.k0s(),e.j41(19,"div",10),e.EFF(20,"PVP"),e.k0s()(),e.j41(21,"div",11)(22,"div",12)(23,"div",13),e.EFF(24," 1A "),e.k0s(),e.j41(25,"div",14),e.DNE(26,Z,4,3,"div",15)(27,ee,3,1,"div",16),e.k0s(),e.j41(28,"div",13),e.EFF(29),e.k0s(),e.j41(30,"div",13),e.EFF(31),e.nI1(32,"thousandSeparator"),e.k0s()(),e.j41(33,"div",17)(34,"div",18),e.EFF(35," Total "),e.k0s(),e.j41(36,"div",18),e.EFF(37),e.nI1(38,"thousandSeparator"),e.k0s(),e.j41(39,"div",18),e.EFF(40),e.nI1(41,"thousandSeparator"),e.k0s(),e.j41(42,"div",18),e.EFF(43),e.nI1(44,"thousandSeparator"),e.k0s()()(),e.j41(45,"div",19)(46,"button",20),e.bIt("click",function(){return t.goNextSection()}),e.EFF(47," Ir a la siguiente secci\xf3n "),e.k0s()()()()),2&n&&(e.R7$(8),e.R50("ngModel",t.selectedTaxRate),e.R7$(),e.Y8G("ngForOf",t.taxRates),e.R7$(17),e.Y8G("ngIf",!t.editingPrice),e.R7$(),e.Y8G("ngIf",t.editingPrice),e.R7$(2),e.SpI(" ",t.selectedTaxRate," "),e.R7$(2),e.SpI(" ",e.bMT(32,9,t.priceSelected.finalPrice)," \u20ac "),e.R7$(6),e.SpI(" ",e.bMT(38,11,t.priceSelected.priceWithoutIva)," \u20ac "),e.R7$(3),e.SpI(" ",e.bMT(41,13,t.priceSelected.priceWithIva)," \u20ac "),e.R7$(3),e.SpI(" ",e.bMT(44,15,t.priceSelected.finalPrice)," \u20ac "))},dependencies:[d.Sq,d.bT,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.vS,W.w],styles:[".venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .crm-input[_ngcontent-%COMP%]{margin-bottom:16px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]   .price-table-header-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]{border-radius:12px;padding:0 16px;background:#f9f9f9}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 0;border-bottom:1px solid var(--crm-border-light-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{font-weight:500;border:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-cell[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-cell[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]{display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:120px;background:#fff;outline:none;border:1px solid var(--crm-border-light-color);border-radius:8px;padding:4px 8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--crm-text-color);cursor:pointer}"]}),s})();const ne=i=>({"text-error":i}),oe=i=>({"border-error":i});let ie=(()=>{var i;class s{constructor(){this.reservationAmount=0,this.selectDocumentData=new e.bkB,this.reservationAmountError=!1,this.formData={contractType:"propio",signatureType:"papel",reservationAmount:this.reservationAmount}}ngOnInit(){}onContinue(){console.log("Form data:",this.formData),this.reservationAmountError=!1,this.formData.reservationAmount?this.selectDocumentData.emit(this.formData):this.reservationAmountError=!0}ngOnChanges(n){this.formData.reservationAmount=this.reservationAmount}}return(i=s).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-document"]],inputs:{reservationAmount:"reservationAmount"},outputs:{selectDocumentData:"selectDocumentData"},features:[e.OA$],decls:44,vars:9,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"margin-bottom","16px"],[1,"crm-text"],[3,"ngModelChange","ngModel"],[1,"crm-input-radio"],["value","byvaro"],[1,"crm-input-radio-label"],["value","propio"],[2,"border","none","border-bottom","1px solid #e5e5e5","margin","24px 0"],["value","electronica"],["value","papel"],[1,"title","mb8"],[1,"crm-text","small","light","mb16"],[1,"crm-input",2,"margin-bottom","24px","max-width","300px"],[1,"crm-input-label",3,"ngClass"],[1,"crm-input-input",3,"ngClass"],["type","number","placeholder","Por ejemplo 3000\u20ac",3,"ngModelChange","ngModel"],[1,"crm-block-buttons-right"],[1,"crm-button",3,"click"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2," 4. Documento de reserva "),e.k0s(),e.j41(3,"div",2)(4,"div",3)(5,"div",4),e.EFF(6," Redacci\xf3n del contrato: "),e.k0s(),e.j41(7,"ion-radio-group",5),e.mxI("ngModelChange",function(r){return e.DH7(t.formData.contractType,r)||(t.formData.contractType=r),r}),e.j41(8,"div",6),e.nrm(9,"ion-radio",7),e.j41(10,"div",8),e.EFF(11," Contrato redactado en Byvaro "),e.k0s()(),e.j41(12,"div",6),e.nrm(13,"ion-radio",9),e.j41(14,"div",8),e.EFF(15," Contrato propio "),e.k0s()()()(),e.nrm(16,"hr",10),e.j41(17,"div",3)(18,"div",4),e.EFF(19," T\xe9rminos y condiciones de la firma: "),e.k0s(),e.j41(20,"ion-radio-group",5),e.mxI("ngModelChange",function(r){return e.DH7(t.formData.signatureType,r)||(t.formData.signatureType=r),r}),e.j41(21,"div",6),e.nrm(22,"ion-radio",11),e.j41(23,"div",8),e.EFF(24," Firma electr\xf3nica "),e.k0s()(),e.j41(25,"div",6),e.nrm(26,"ion-radio",12),e.j41(27,"div",8),e.EFF(28," Firma en papel "),e.k0s()()()(),e.nrm(29,"hr",10),e.j41(30,"div",13),e.EFF(31," Cantidad que debe pagar el cliente para reservar: "),e.k0s(),e.j41(32,"div",14),e.EFF(33," Este campo puede heredar autom\xe1ticamente el valor definido en la configuraci\xf3n de la promoci\xf3n."),e.nrm(34,"br"),e.EFF(35," Por favor, rev\xedsalo antes de continuar. "),e.k0s(),e.j41(36,"div",15)(37,"div",16),e.EFF(38," Cantidad de reserva (\u20ac) "),e.k0s(),e.j41(39,"div",17)(40,"input",18),e.mxI("ngModelChange",function(r){return e.DH7(t.formData.reservationAmount,r)||(t.formData.reservationAmount=r),r}),e.k0s()()(),e.j41(41,"div",19)(42,"button",20),e.bIt("click",function(){return t.onContinue()}),e.EFF(43," Continuar la reserva "),e.k0s()()()()),2&n&&(e.R7$(7),e.R50("ngModel",t.formData.contractType),e.R7$(13),e.R50("ngModel",t.formData.signatureType),e.R7$(17),e.Y8G("ngClass",e.eq3(5,ne,t.reservationAmountError)),e.R7$(2),e.Y8G("ngClass",e.eq3(7,oe,t.reservationAmountError)),e.R7$(),e.R50("ngModel",t.formData.reservationAmount))},dependencies:[d.YU,c.me,c.Q0,c.BC,c.vS,y.KO,y.f0,y.Je],styles:[".crm-text[_ngcontent-%COMP%]{font-style:normal;margin-bottom:8px}.crm-input-radio[_ngcontent-%COMP%]{margin-bottom:8px}ion-radio-group[_ngcontent-%COMP%]{display:flex;gap:16px}.mb8[_ngcontent-%COMP%]{margin-bottom:8px}.mb16[_ngcontent-%COMP%]{margin-bottom:16px}"]}),s})();var N=p(6906),re=p(6968),ae=p(1129);const I=i=>({"crm-input-input-error":i});function le(i,s){1&i&&(e.j41(0,"div",39),e.EFF(1," Por favor, introduce un correo electr\xf3nico v\xe1lido "),e.k0s())}function se(i,s){if(1&i&&(e.j41(0,"option",42),e.EFF(1),e.k0s()),2&i){const a=s.$implicit;e.FS9("value",a.key),e.R7$(),e.JRh(a.label)}}function ce(i,s){if(1&i&&(e.j41(0,"div",8)(1,"div",3),e.EFF(2," Role "),e.k0s(),e.j41(3,"div",15)(4,"select",40)(5,"option",41),e.EFF(6,"Selecciona un origen"),e.k0s(),e.Z7z(7,se,2,2,"option",42,e.fX1),e.k0s()()()),2&i){const a=e.XpG();e.R7$(5),e.Y8G("value",null),e.R7$(2),e.Dyx(a.responsibilityOptions)}}function de(i,s){1&i&&(e.j41(0,"div",39),e.EFF(1," El nombre es requerido "),e.k0s())}function pe(i,s){1&i&&(e.j41(0,"div",39),e.EFF(1," La fecha de nacimiento es requerida "),e.k0s())}function ue(i,s){1&i&&(e.j41(0,"div",39),e.EFF(1," Error "),e.k0s())}function me(i,s){if(1&i&&(e.j41(0,"div",8)(1,"div",3),e.EFF(2," \xbfQue porcentaje compra el comprador? "),e.k0s(),e.j41(3,"div",4),e.nrm(4,"input",43),e.k0s(),e.DNE(5,ue,2,0,"div",6),e.k0s()),2&i){const a=e.XpG();e.R7$(3),e.Y8G("ngClass",e.eq3(2,I,a.isControlInvalid("participationPercentage"))),e.R7$(2),e.Y8G("ngIf",a.isControlInvalid("participationPercentage"))}}function ve(i,s){1&i&&(e.j41(0,"div",39),e.EFF(1," La direcci\xf3n es obligatoria "),e.k0s())}function _e(i,s){1&i&&(e.j41(0,"div",39),e.EFF(1," El DNI o Pasaporte es requerido "),e.k0s())}function ge(i,s){1&i&&(e.j41(0,"div",39),e.EFF(1," El n\xfamero de tel\xe9fono es requerido "),e.k0s())}function Ce(i,s){1&i&&(e.j41(0,"div",10),e.nrm(1,"ion-radio",44),e.j41(2,"div",21),e.EFF(3," Gananciales "),e.k0s()(),e.j41(4,"div",22),e.nrm(5,"ion-radio",45),e.j41(6,"div",21),e.EFF(7," Separacion de bienes "),e.k0s()())}function fe(i,s){1&i&&(e.j41(0,"div",10),e.nrm(1,"ion-radio",46),e.j41(2,"div",21),e.EFF(3," Soltera "),e.k0s()(),e.j41(4,"div",22),e.nrm(5,"ion-radio",47),e.j41(6,"div",21),e.EFF(7," Separada "),e.k0s()(),e.j41(8,"div",22),e.nrm(9,"ion-radio",48),e.j41(10,"div",21),e.EFF(11," Divorciada "),e.k0s()(),e.j41(12,"div",22),e.nrm(13,"ion-radio",49),e.j41(14,"div",21),e.EFF(15," Viuda "),e.k0s()(),e.j41(16,"div",22),e.nrm(17,"ion-radio",50),e.j41(18,"div",21),e.EFF(19," Pareja de hecho "),e.k0s()())}let he=(()=>{var i;class s{constructor(){this.responsibilityOptions=N.Rl}ngOnInit(){}isControlInvalid(n){const t=this.form.get(n);return!(!t||!t.invalid||!t.dirty&&!t.touched)}onSelectCountry(n){}onNextStep(){}onChangeMaritalType(n){var t;null===(t=this.form.get("civilType"))||void 0===t||t.setValue(n)}}return(i=s).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-person-form"]],inputs:{form:"form",hasParentContact:"hasParentContact"},decls:97,vars:26,consts:[["addressInput",""],[3,"ngSubmit","formGroup"],[1,"crm-input",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","placeholder","Field","formControlName","email"],["class","crm-input-error",4,"ngIf"],[1,"crm-text","small","light","mb-15"],[1,"crm-input","mb-15"],["formControlName","gender",1,"d-flex","gap-16"],[1,"crm-input-radio"],["value","male"],[1,"crm-input-radio-label"],["value","female"],["type","text","placeholder","ex: Juan","formControlName","name"],[1,"crm-input-input"],["type","date","formControlName","birthDate"],[1,"crm-input",2,"margin-bottom","16px"],["type","text","formControlName","address","placeholder","Escribe la direcci\xf3n"],["formControlName","identityType",1,"gap-16"],["value","dni"],[1,"crm-input-radio-label","text-secondary"],[1,"crm-input-radio","mt-10"],["value","nif"],["value","nie"],["value","passport"],["value","identityCard"],[1,"crm-input-input","mt-10",3,"ngClass"],["type","text","placeholder","ex: 48500285A","formControlName","identityNumber"],[1,"crm-input"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected","selectedPhoneNumber"],["type","text","placeholder","N\xfamero de tel\xe9fono","formControlName","phoneNumber"],[1,"crm-text","small","light",2,"margin-bottom","8px"],["formControlName","civilType",1,"d-flex","gap-16"],[1,"crm-input-radio",3,"click"],["value","married"],["value","other"],["formControlName","civilStatus",1,"gap-16"],[1,"crm-input-error"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],["type","number","formControlName","participationPercentage","placeholder","%"],["value","communityProperty"],["value","separateProperty"],["value","single"],["value","separated"],["value","divorced"],["value","widowed"],["value","civilUnion"]],template:function(n,t){if(1&n){const o=e.RV6();e.j41(0,"form",1),e.bIt("ngSubmit",function(){return e.eBV(o),e.Njj(t.onNextStep())}),e.j41(1,"div",2)(2,"div",3),e.EFF(3," Correo electr\xf3nico "),e.k0s(),e.j41(4,"div",4),e.nrm(5,"input",5),e.k0s(),e.DNE(6,le,2,0,"div",6),e.k0s(),e.j41(7,"div",7),e.EFF(8," Por favor, compruebe que la direcci\xf3n de correo electr\xf3nico ingresada es correcta. "),e.k0s(),e.DNE(9,ce,9,1,"div",8),e.j41(10,"div",8)(11,"ion-radio-group",9)(12,"div",10),e.nrm(13,"ion-radio",11),e.j41(14,"div",12),e.EFF(15," Don "),e.k0s()(),e.j41(16,"div",10),e.nrm(17,"ion-radio",13),e.j41(18,"div",12),e.EFF(19," Do\xf1a "),e.k0s()()()(),e.j41(20,"div",8)(21,"div",3),e.EFF(22," Nombre y apellidos "),e.k0s(),e.j41(23,"div",4),e.nrm(24,"input",14),e.k0s(),e.DNE(25,de,2,0,"div",6),e.k0s(),e.j41(26,"div",8)(27,"div",3),e.EFF(28," Fecha de nacimiento "),e.k0s(),e.j41(29,"div",15),e.nrm(30,"input",16),e.k0s(),e.DNE(31,pe,2,0,"div",6),e.k0s(),e.DNE(32,me,6,4,"div",8),e.j41(33,"div",17)(34,"div",3),e.EFF(35," Direcci\xf3n "),e.k0s(),e.j41(36,"div",4),e.nrm(37,"input",18,0),e.k0s(),e.DNE(39,ve,2,0,"div",6),e.k0s(),e.j41(40,"div",8)(41,"div",3),e.EFF(42," Identificaci\xf3n "),e.k0s(),e.j41(43,"ion-radio-group",19)(44,"div",10),e.nrm(45,"ion-radio",20),e.j41(46,"div",21),e.EFF(47," DNI "),e.k0s()(),e.j41(48,"div",22),e.nrm(49,"ion-radio",23),e.j41(50,"div",21),e.EFF(51," NIF "),e.k0s()(),e.j41(52,"div",22),e.nrm(53,"ion-radio",24),e.j41(54,"div",21),e.EFF(55," NIE "),e.k0s()(),e.j41(56,"div",22),e.nrm(57,"ion-radio",25),e.j41(58,"div",21),e.EFF(59," Pasaporte "),e.k0s()(),e.j41(60,"div",22),e.nrm(61,"ion-radio",26),e.j41(62,"div",21),e.EFF(63," Carta de identidad "),e.k0s()()(),e.j41(64,"div",27),e.nrm(65,"input",28),e.k0s(),e.DNE(66,_e,2,0,"div",6),e.k0s(),e.j41(67,"div",29)(68,"div",3),e.EFF(69," Phone number "),e.k0s(),e.j41(70,"div",30)(71,"div",4)(72,"app-flag-country-selector",31),e.bIt("emitCountrySelected",function(l){return e.eBV(o),e.Njj(t.onSelectCountry(l))}),e.k0s(),e.nrm(73,"input",32),e.k0s()(),e.DNE(74,ge,2,0,"div",6),e.j41(75,"div",33),e.EFF(76," Por favor, compruebe que el n\xfamero de tel\xe9fono m\xf3vil ingresado es correcto. Ser\xe1 utilizado para la firma electr\xf3nica."),e.nrm(77,"br")(78,"br"),e.k0s()(),e.j41(79,"div",8)(80,"div",3),e.EFF(81," Estado civil "),e.k0s(),e.j41(82,"ion-radio-group",34)(83,"div",35),e.bIt("click",function(){return e.eBV(o),e.Njj(t.onChangeMaritalType("married"))}),e.nrm(84,"ion-radio",36),e.j41(85,"div",12),e.EFF(86," Casada "),e.k0s()(),e.j41(87,"div",35),e.bIt("click",function(){return e.eBV(o),e.Njj(t.onChangeMaritalType("other"))}),e.nrm(88,"ion-radio",37),e.j41(89,"div",12),e.EFF(90," Otro "),e.k0s()()()(),e.j41(91,"div",17)(92,"div",3),e.EFF(93," Precise "),e.k0s(),e.j41(94,"ion-radio-group",38),e.DNE(95,Ce,8,0)(96,fe,20,0),e.k0s()()()}if(2&n){let o,r;e.Y8G("formGroup",t.form),e.R7$(4),e.Y8G("ngClass",e.eq3(16,I,t.isControlInvalid("email"))),e.R7$(2),e.Y8G("ngIf",t.isControlInvalid("email")),e.R7$(3),e.vxM(t.hasParentContact?9:-1),e.R7$(14),e.Y8G("ngClass",e.eq3(18,I,t.isControlInvalid("name"))),e.R7$(2),e.Y8G("ngIf",t.isControlInvalid("name")),e.R7$(6),e.Y8G("ngIf",t.isControlInvalid("birthDate")),e.R7$(),e.vxM(t.hasParentContact?-1:32),e.R7$(4),e.Y8G("ngClass",e.eq3(20,I,t.isControlInvalid("address"))),e.R7$(3),e.Y8G("ngIf",t.isControlInvalid("address")),e.R7$(25),e.Y8G("ngClass",e.eq3(22,I,t.isControlInvalid("identityNumber"))),e.R7$(2),e.Y8G("ngIf",t.isControlInvalid("identityNumber")),e.R7$(5),e.Y8G("ngClass",e.eq3(24,I,t.isControlInvalid("phoneNumber"))),e.R7$(),e.Y8G("selectedPhoneNumber",null==(o=t.form.get("phoneNumber"))?null:o.value),e.R7$(2),e.Y8G("ngIf",t.isControlInvalid("phoneNumber")),e.R7$(21),e.vxM("married"===(null==(r=t.form.get("civilType"))?null:r.value)?95:96)}},dependencies:[d.YU,d.bT,c.qT,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.cb,y.KO,y.f0,y.Je,c.j4,c.JD,ae.Z]}),s})();const Pe=["addressInput"],q=i=>({"background-color":i}),D=i=>({"crm-input-input-error":i});function ye(i,s){if(1&i&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&i){let a;const n=e.XpG(2).$implicit;e.R7$(),e.JRh(null==(a=n.get("name"))?null:a.value)}}function be(i,s){1&i&&e.nrm(0,"img",5),2&i&&e.Y8G("src","assets/icon/chevron-down-icon.svg",e.B4B)}function Fe(i,s){1&i&&e.nrm(0,"img",5),2&i&&e.Y8G("src","assets/icon/chevron-up-icon.svg",e.B4B)}function ke(i,s){if(1&i){const a=e.RV6();e.j41(0,"div"),e.nrm(1,"app-person-form",18),e.j41(2,"div",19)(3,"button",20),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG();return e.Njj(o.onSaveContact(t))}),e.EFF(4," Guardar "),e.k0s(),e.j41(5,"div",21)(6,"div",22)(7,"div",23),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG();return e.Njj(o.removePerson(t))}),e.nrm(8,"img",24),e.j41(9,"span",25),e.EFF(10,"Eliminar"),e.k0s()()()()()()}if(2&i){const a=e.XpG(2).index,n=e.XpG();e.R7$(),e.Y8G("hasParentContact",!1)("form",n.getContactForm(a)),e.R7$(7),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B)}}function xe(i,s){if(1&i){const a=e.RV6();e.j41(0,"div",13)(1,"div",14)(2,"div"),e.EFF(3),e.k0s(),e.DNE(4,ye,2,1,"div",15),e.k0s(),e.j41(5,"div",16),e.bIt("click",function(){e.eBV(a);const t=e.XpG().index,o=e.XpG();return e.Njj(o.togglePersonForm(t))}),e.DNE(6,be,1,1,"img",5)(7,Fe,1,1,"img",5),e.k0s()(),e.DNE(8,ke,11,3,"div",17)}if(2&i){let a,n,t;const o=e.XpG(),r=o.$implicit,l=o.index;e.R7$(3),e.SpI(" Comprador ",l+1,""),e.R7$(),e.vxM(null!=(a=r.get("showForm"))&&a.value?-1:4),e.R7$(2),e.vxM(null!=(n=r.get("showForm"))&&n.value?6:7),e.R7$(2),e.Y8G("ngIf",null==(t=r.get("showForm"))?null:t.value)}}function je(i,s){if(1&i&&(e.j41(0,"option",46),e.EFF(1),e.k0s()),2&i){const a=s.$implicit;e.FS9("value",a.key),e.R7$(),e.JRh(a.label)}}function Se(i,s){if(1&i&&(e.j41(0,"div",41)(1,"div",42)(2,"div",30),e.EFF(3," Role "),e.k0s(),e.j41(4,"div",43)(5,"select",44)(6,"option",45),e.EFF(7,"Selecciona un origen"),e.k0s(),e.Z7z(8,je,2,2,"option",46,e.fX1),e.k0s()()()()),2&i){const a=e.XpG().index,n=e.XpG(3).index,t=e.XpG();e.Y8G("formGroup",t.getCompanyPersonForm(n,a)),e.R7$(6),e.Y8G("value",null),e.R7$(2),e.Dyx(t.responsibilityOptions)}}function Me(i,s){if(1&i&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&i){let a;const n=e.XpG(2).index,t=e.XpG(3).index,o=e.XpG();e.R7$(),e.JRh(null==(a=o.getCompanyPersonForm(t,n).get("name"))?null:a.value)}}function Oe(i,s){if(1&i){const a=e.RV6();e.j41(0,"img",50),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG(3).index,r=e.XpG();return e.Njj(r.toggleCompanyPersonForm(o,t))}),e.k0s()}2&i&&e.Y8G("src","assets/icon/chevron-down-icon.svg",e.B4B)}function Ee(i,s){if(1&i){const a=e.RV6();e.j41(0,"img",50),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG(3).index,r=e.XpG();return e.Njj(r.toggleCompanyPersonForm(o,t))}),e.k0s()}2&i&&e.Y8G("src","assets/icon/chevron-up-icon.svg",e.B4B)}function Ie(i,s){if(1&i){const a=e.RV6();e.nrm(0,"app-person-form",18),e.j41(1,"div",19)(2,"button",51),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG(3).index,r=e.XpG();return e.Njj(r.onSaveChildContact(o,t))}),e.EFF(3," Guardar "),e.k0s(),e.j41(4,"div",21)(5,"div",22)(6,"div",52),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG(3).index,r=e.XpG();return e.Njj(r.removePersonFromCompany(o,t))}),e.nrm(7,"img",53),e.j41(8,"span",25),e.EFF(9,"Eliminar"),e.k0s()()()()()}if(2&i){const a=e.XpG(2).index,n=e.XpG(3).index,t=e.XpG();e.Y8G("hasParentContact",!0)("form",t.getCompanyPersonForm(n,a)),e.R7$(7),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B)}}function Ve(i,s){if(1&i&&(e.j41(0,"div")(1,"div",47)(2,"div")(3,"div"),e.EFF(4),e.k0s(),e.DNE(5,Me,2,1,"div",15),e.k0s(),e.j41(6,"div",48),e.DNE(7,Oe,1,1,"img",49)(8,Ee,1,1,"img",49),e.k0s()(),e.DNE(9,Ie,10,3),e.k0s()),2&i){let a,n,t,o;const r=e.XpG(),l=r.$implicit,u=r.index,m=e.XpG(3).index,v=e.XpG();e.R7$(4),e.JRh(v.responsibilityOptionsObj[null==(a=v.getCompanyPersonForm(m,u).get("role"))?null:a.value]),e.R7$(),e.vxM(null!=(n=l.get("showForm"))&&n.value?-1:5),e.R7$(2),e.vxM(null!=(t=l.get("showForm"))&&t.value?7:8),e.R7$(2),e.vxM(null!=(o=l.get("showForm"))&&o.value?9:-1)}}function Te(i,s){if(1&i&&(e.j41(0,"div")(1,"div",39),e.DNE(2,Se,10,2,"div",40)(3,Ve,10,4,"div",17),e.k0s()()),2&i){let a,n;const t=s.index,o=e.XpG(3).index,r=e.XpG();e.R7$(2),e.Y8G("ngIf",!(null!=(a=r.getCompanyPersonForm(o,t).get("role"))&&a.value)),e.R7$(),e.Y8G("ngIf",null==(n=r.getCompanyPersonForm(o,t).get("role"))?null:n.value)}}function De(i,s){if(1&i){const a=e.RV6();e.j41(0,"div")(1,"form",28)(2,"div",13)(3,"div",29)(4,"div",30),e.EFF(5," Nombre de la empresa "),e.k0s(),e.j41(6,"div",31),e.nrm(7,"input",32),e.k0s()(),e.j41(8,"div",33)(9,"div",30),e.EFF(10," Direcci\xf3n "),e.k0s(),e.j41(11,"div",31),e.nrm(12,"input",34),e.k0s()()(),e.j41(13,"div",13)(14,"div",29)(15,"div",30),e.EFF(16," CIF "),e.k0s(),e.j41(17,"div",31),e.nrm(18,"input",35),e.k0s()(),e.j41(19,"div",33)(20,"div",30),e.EFF(21," \xbfQue porcentaje compra el comprador? "),e.k0s(),e.j41(22,"div",31),e.nrm(23,"input",36),e.k0s()()(),e.DNE(24,Te,4,2,"div",37),e.j41(25,"div",38)(26,"button",4),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).index,o=e.XpG();return e.Njj(o.addPersonToCompany(t))}),e.nrm(27,"img",5),e.EFF(28," A\xf1adir persona responsable "),e.k0s()()()()}if(2&i){let a;const n=e.XpG(2).index,t=e.XpG();e.R7$(),e.Y8G("formGroup",t.getContactForm(n)),e.R7$(5),e.Y8G("ngClass",e.eq3(7,D,t.isControlInvalid(t.getContactForm(n),"name"))),e.R7$(5),e.Y8G("ngClass",e.eq3(9,D,t.isControlInvalid(t.getContactForm(n),"address"))),e.R7$(6),e.Y8G("ngClass",e.eq3(11,D,t.isControlInvalid(t.getContactForm(n),"identityNumber"))),e.R7$(5),e.Y8G("ngClass",e.eq3(13,D,t.isControlInvalid(t.getContactForm(n),"participationPercentage"))),e.R7$(2),e.Y8G("ngForOf",null==(a=t.getPersons(n))?null:a.controls),e.R7$(3),e.Y8G("src","assets/icon/plus-icon.svg",e.B4B)}}function Re(i,s){if(1&i){const a=e.RV6();e.j41(0,"div",13)(1,"div",26),e.EFF(2),e.k0s(),e.j41(3,"div")(4,"img",27),e.bIt("click",function(){e.eBV(a);const t=e.XpG().index,o=e.XpG();return e.Njj(o.removeCompany(t))}),e.k0s()()(),e.DNE(5,De,29,15,"div",17)}if(2&i){let a;const n=e.XpG(),t=n.$implicit,o=n.index;e.R7$(2),e.SpI("Comprador ",o+1,""),e.R7$(2),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B),e.R7$(),e.Y8G("ngIf",null==(a=t.get("showForm"))?null:a.value)}}function Ge(i,s){if(1&i){const a=e.RV6();e.j41(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12),e.bIt("click",function(){const t=e.eBV(a).index,o=e.XpG();return e.Njj(o.onChangePersonType(t,"particular"))}),e.EFF(4," Personas f\xedsicas "),e.k0s(),e.j41(5,"div",12),e.bIt("click",function(){const t=e.eBV(a).index,o=e.XpG();return e.Njj(o.onChangePersonType(t,"empresa"))}),e.EFF(6," Persona jur\xeddica "),e.k0s()()(),e.DNE(7,xe,9,4)(8,Re,6,3),e.k0s()}if(2&i){let a,n,t;const o=s.$implicit;e.R7$(3),e.Y8G("ngStyle",e.eq3(3,q,"particular"===(null==(a=o.get("type"))?null:a.value)?"#ECF2FF":"")),e.R7$(2),e.Y8G("ngStyle",e.eq3(5,q,"empresa"===(null==(n=o.get("type"))?null:n.value)?"#ECF2FF":"")),e.R7$(2),e.vxM("particular"===(null==(t=o.get("type"))?null:t.value)?7:8)}}let Ne=(()=>{var i;class s{constructor(n,t,o,r,l,u){this.fb=n,this.ngZone=t,this.api=o,this.utils=r,this.modalsService=l,this.toastService=u,this.selectContactData=new e.bkB,this.mapCenter={lat:40.416775,lng:-3.70379},this.mapZoom=6,this.markerPosition=this.mapCenter,this.mapOptions={disableDefaultUI:!1,styles:[{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]}]},this.markerOptions={draggable:!0},this.disabled=!0,this.showForms=[],this.FormGroup=c.gE,this.responsibilityOptions=N.Rl,this.responsibilityOptionsObj=N.qA;const m=this.createContactForm(!1,"particular");this.contactFormArray=this.fb.array([m])}ngOnInit(){}set contactData(n){this.contact=n,this.contact&&!this.contacts.length&&this.patchContactData(0,this.contact)}set operationData(n){this.operation=n}set reservedContacts(n){if(this.contacts=n,this.contacts.length){const t=this.extractRelatedContactIds(this.contacts);let o=0;this.contacts.forEach(r=>{t.includes(r.id)||(this.patchContactData(o,r,!1),o++)})}}extractRelatedContactIds(n){const t=[];for(const o of n.filter(r=>"empresa"===r.type))for(const r of o.contactsRelation||[])t.push(r.contactRelatedId);return t}patchContactData(n,t,o=!1){var r,l;let u=this.utils.parseBackendDateToFrontendDateInput(null==t?void 0:t.birthdate),m="";null!=t&&t.civilStatus&&(m=["communityProperty","separateProperty"].includes(t.civilStatus)?"married":"other");let v={id:t.id||null,email:(null===(r=t.emails)||void 0===r?void 0:r[0])||"",name:t.name||"",birthDate:u||"",phoneNumber:(null===(l=t.phones)||void 0===l?void 0:l[0])||"+34 ",address:t.address||"",gender:t.gender||"",type:t.type||"particular",role:"sole_administrator",identityType:t.typeOfIdentification||"dni",identityNumber:t.dniPassport,civilStatus:t.civilStatus,civilType:m,showForm:!o,uniqId:n},P=this.getContactForm(n);if(o){let g=this.createContactForm(o,"particular");g.patchValue(v),P.get("persons").push(g)}else{var f;null!==(f=this.operation)&&void 0!==f&&f.buyersContactsPercentages&&this.operation.buyersContactsPercentages[t.id]&&(v.participationPercentage=this.operation.buyersContactsPercentages[t.id].percentage),P||(P=this.createContactForm(o,v.type)),P.patchValue(v)}if(this.contactFormArray.setControl(n,P),"empresa"===t.type)for(const g of t.contactsRelation||[]){const h=this.contacts.find(S=>S.id===g.contactRelatedId);h&&this.patchContactData(n,h,!0)}}createContactForm(n=!1,t){var o,r;const l=this.fb.group({type:[t],showForm:[!0],name:[""],email:[""],phoneNumber:["+34 "],birthDate:[""],identityNumber:[""],identityType:["dni"],address:[""],role:[""],id:[null],parentContact:[null],gender:[""],civilStatus:[""],civilType:[""],participationPercentage:["",[c.k0.min(1),c.k0.max(100)]],formId:[""],persons:this.fb.array([])});return this.applyConditionalValidators(n,l,t),null===(o=l.get("type"))||void 0===o||o.valueChanges.subscribe(u=>{this.applyConditionalValidators(n,l,u)}),null===(r=l.get("participationPercentage"))||void 0===r||r.valueChanges.subscribe(u=>{this.onParticipationPercentageChanged(u,l)}),l}onParticipationPercentageChanged(n,t){var o;let r=null===(o=t.get("formId"))||void 0===o?void 0:o.value;const u=100-this.contactFormArray.controls.reduce((f,g)=>{var h;return g.value.formId!==r?f+parseFloat((null===(h=g.get("participationPercentage"))||void 0===h?void 0:h.value)||"0"):f},0);var v;parseFloat(n||"0")>u&&(null===(v=t.get("participationPercentage"))||void 0===v||v.setValue(u,{emitEvent:!1}));const P=this.contactFormArray.controls.reduce((f,g)=>{var h;return f+parseFloat((null===(h=g.get("participationPercentage"))||void 0===h?void 0:h.value)||"0")},0);this.disabled=100!==P}applyConditionalValidators(n=!1,t,o){var r,l,u,m,v,P,f,g,h,S,M,O,w;if(null===(r=t.get("email"))||void 0===r||r.clearValidators(),null===(l=t.get("phoneNumber"))||void 0===l||l.clearValidators(),null===(u=t.get("birthDate"))||void 0===u||u.clearValidators(),null===(m=t.get("identityNumber"))||void 0===m||m.clearValidators(),null===(v=t.get("address"))||void 0===v||v.clearValidators(),"particular"!==o||n){if("particular"===o&&n){var A,B,X,$;null===(A=t.get("email"))||void 0===A||A.setValidators([c.k0.required,c.k0.email]),null===(B=t.get("phoneNumber"))||void 0===B||B.setValidators([c.k0.required]),null===(X=t.get("birthDate"))||void 0===X||X.setValidators([c.k0.required]),null===($=t.get("identityNumber"))||void 0===$||$.setValidators([c.k0.required])}else if("empresa"===o){var Y,U;null===(Y=t.get("cif"))||void 0===Y||Y.setValidators([c.k0.required]),null===(U=t.get("participationPercentage"))||void 0===U||U.setValidators([c.k0.required,c.k0.min(1),c.k0.max(100)])}}else null===(h=t.get("email"))||void 0===h||h.setValidators([c.k0.required,c.k0.email]),null===(S=t.get("phoneNumber"))||void 0===S||S.setValidators([c.k0.required]),null===(M=t.get("birthDate"))||void 0===M||M.setValidators([c.k0.required]),null===(O=t.get("identityNumber"))||void 0===O||O.setValidators([c.k0.required]),null===(w=t.get("participationPercentage"))||void 0===w||w.setValidators([c.k0.required,c.k0.min(1),c.k0.max(100)]);null===(P=t.get("name"))||void 0===P||P.setValidators([c.k0.required]),null===(f=t.get("identityNumber"))||void 0===f||f.setValidators([c.k0.required]),null===(g=t.get("address"))||void 0===g||g.setValidators([c.k0.required])}removeCompany(n){var t=this;return(0,C.A)(function*(){let o=t.getPersons(n),r=t.getContactForm(n),l=!1;if(o.value.forEach(m=>{m.id&&(l=!0)}),r.value.id&&(l=!0),l){let m=yield t.openConfirmationModal();var u;if("delete"===(null==m?void 0:m.data))r.value.id&&(yield t.api.unlinkReserveContactToOperation(null===(u=t.operation)||void 0===u?void 0:u.id,r.value.id)),o.value.forEach(function(){var v=(0,C.A)(function*(P){var f,g;P.id&&(yield t.api.unlinkReserveContactToOperation(null===(f=t.operation)||void 0===f?void 0:f.id,P.id),r.value.id&&(yield t.api.removeContactRelation(P.id,null===(g=r.value)||void 0===g?void 0:g.id)))});return function(P){return v.apply(this,arguments)}}()),t.contactFormArray.removeAt(n)}else t.contactFormArray.removeAt(n)})()}getContactForm(n){return this.contactFormArray.at(n)}getPersons(n){return this.getContactForm(n).get("persons")}getCompanyPersonForm(n,t){return this.getPersons(n).at(t)}addPersonToCompany(n){this.getPersons(n).push(this.createContactForm(!0,"particular"))}removePersonFromCompany(n,t){var o=this;return(0,C.A)(function*(){let r=o.getCompanyPersonForm(n,t),l=o.getContactForm(n);if(r.value.id&&l.value.id){let v=yield o.openConfirmationModal();var u,m;"delete"===(null==v?void 0:v.data)&&(o.getPersons(n).removeAt(t),yield o.api.unlinkReserveContactToOperation(null===(u=o.operation)||void 0===u?void 0:u.id,r.value.id),yield o.api.removeContactRelation(r.value.id,null===(m=l.value)||void 0===m?void 0:m.id))}else o.getPersons(n).removeAt(t)})()}toggleCompanyPersonForm(n,t){var o;const r=this.getCompanyPersonForm(n,t);r.patchValue({showForm:!(null!==(o=r.get("showForm"))&&void 0!==o&&o.value)})}toggleCompanyForm(n){var t;const o=this.getContactForm(n);o.patchValue({showForm:!(null!==(t=o.get("showForm"))&&void 0!==t&&t.value)})}addNewForm(){this.contactFormArray.push(this.createContactForm(!1,"particular"))}ngAfterViewInit(){this.addressInput&&(this.autocomplete=new google.maps.places.Autocomplete(this.addressInput.nativeElement,{types:["geocode"],componentRestrictions:{country:"es"}}),this.autocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{const t=this.autocomplete.getPlace();if(!t.geometry)return;this.mapCenter={lat:t.geometry.location.lat(),lng:t.geometry.location.lng()},this.markerPosition=this.mapCenter,this.mapZoom=17;const o=t.formatted_address||t.name||"";this.contactForm.patchValue({address:o}),this.addressInput.nativeElement.value=o})}))}isControlInvalid(n,t){const o=n.get(t);return!(!o||!o.invalid||!o.dirty&&!o.touched)}onSelectCountry(n){console.log("Selected country prefix:",n);const t=null==n?void 0:n.phoneCode,o=this.contactForm.get("phoneNumber");if(!o)return;const l=(o.value||"").split(" ");l.shift();const u=l.join(" ");o.setValue(`${t} ${u}`)}onAddressSelected(n){console.log("Address selected:",n),this.contactForm.patchValue({address:(null==n?void 0:n.formatted_address)||(null==n?void 0:n.address)||""})}getAddressFromCoordinates(n,t){(new google.maps.Geocoder).geocode({location:{lat:n,lng:t}},(r,l)=>{"OK"===l&&r&&r[0]&&this.ngZone.run(()=>{const u=r[0].formatted_address;this.contactForm.patchValue({address:u}),this.addressInput&&(this.addressInput.nativeElement.value=u),this.markerPosition={lat:n,lng:t}})})}onPrevStep(){console.log("Going to previous step...")}onNextStep(){var n=this;return(0,C.A)(function*(){n.contactFormArray.invalid?n.contactFormArray.markAllAsTouched():n.selectContactData.emit()})()}onChangePersonType(n,t){const o=this.createContactForm(!1,t),r=this.contactFormArray.at(n).value;if("empresa"===t){let l=this.createContactForm(!0,"particular");l.patchValue({id:r.id||null,name:r.name||"",email:r.email||"",address:r.address||"",birthDate:r.birthDate||"",phoneNumber:r.phoneNumber||"+34 ",gender:r.gender||"male",showForm:!0,identityNumber:r.identityNumber,identityType:r.identityType,civilStatus:r.civilStatus}),o.patchValue({name:"",identityNumber:"",showForm:!0,participationPercentage:r.participationPercentage,formId:r.formId||1}),o.get("persons").push(l)}else{let l=r;Array.isArray(r.persons)&&r.persons.length>0&&(l=r.persons[0]),o.patchValue({id:l.id||null,parentContact:r||null,name:l.name||"",participationPercentage:r.participationPercentage,email:l.email||"",address:l.address||"",birthDate:l.birthDate||"",phoneNumber:l.phoneNumber||"+34 ",gender:l.gender||"male",formId:r.formId||1,identityNumber:l.identityNumber,identityType:l.identityType,civilStatus:l.civilStatus})}this.contactFormArray.setControl(n,o)}togglePersonForm(n){var t;const o=this.getContactForm(n);o.patchValue({showForm:!(null!==(t=o.get("showForm"))&&void 0!==t&&t.value)})}openConfirmationModal(){var n=this;return(0,C.A)(function*(){const t=yield n.modalsService.openConfirmationModal({title:"Eliminar contactos",message:"\xbfEst\xe1s seguro de que deseas eliminar los contactos seleccionados?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]});return console.log(77777777,t),t})()}removePerson(n){var t=this;return(0,C.A)(function*(){const o=t.getContactForm(n);if(o.value.id){let l=yield t.openConfirmationModal();var r;"delete"===(null==l?void 0:l.data)&&(yield t.api.unlinkReserveContactToOperation(null===(r=t.operation)||void 0===r?void 0:r.id,o.value.id)),t.contactFormArray.removeAt(n)}else t.contactFormArray.removeAt(n)})()}onSaveChildContact(n,t){var o=this;return(0,C.A)(function*(){var r,l;const u=o.getContactForm(n),m=o.getCompanyPersonForm(n,t);if(u.invalid)return void u.markAllAsTouched();let v=o.buildContactData(u.value),P=o.buildContactData(m.value),f=yield o.saveOrUpdateContact(m.value.id,P),g=yield o.saveOrUpdateContact(u.value.id,v),h=null==g||null===(r=g.success)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.id,S=null==f||null===(l=f.success)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.id;var M,O;m.value.id||(yield o.api.addReserveContactToOperation(null===(M=o.operation)||void 0===M?void 0:M.id,S)),u.value.id||(yield o.api.addReserveContactToOperation(null===(O=o.operation)||void 0===O?void 0:O.id,h)),yield o.updateBuyersContactsPercentages(h,u.value.participationPercentage),yield o.api.addContactRelation(h,S,m.value.role),o.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3}),m.patchValue({showForm:!1})})()}onSaveContact(n){var t=this;return(0,C.A)(function*(){const o=t.getContactForm(n);if(o.invalid)o.markAllAsTouched();else{if("particular"===o.value.type){var r,l;let f=t.buildContactData(o.value);var u,m,v;o.value.parentContact&&(yield t.api.unlinkReserveContactToOperation(null===(u=t.operation)||void 0===u?void 0:u.id,null===(m=o.value.parentContact)||void 0===m?void 0:m.id),o.value.id&&(yield t.api.removeContactRelation(o.value.id,null===(v=o.value.parentContact)||void 0===v?void 0:v.id)));let g=yield t.saveOrUpdateContact(o.value.id,f),h=null==g||null===(r=g.success)||void 0===r?void 0:r.data.id;yield t.api.addReserveContactToOperation(null===(l=t.operation)||void 0===l?void 0:l.id,h),yield t.updateBuyersContactsPercentages(h,o.value.participationPercentage),t.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3})}else if("empresa"===o.value.type){var P;let f={name:o.value.name,type:o.value.type,identityNumber:o.value.identityNumber,address:o.value.address},h=(yield t.saveOrUpdateContact(o.value.id,f)).success.data.id;yield t.api.addReserveContactToOperation(null===(P=t.operation)||void 0===P?void 0:P.id,h)}o.patchValue({showForm:!1})}})()}saveOrUpdateContact(n,t){var o=this;return(0,C.A)(function*(){return n?yield o.api.updateContactById(n,t):yield o.api.createContact(t)})()}updateBuyersContactsPercentages(n,t){var o=this;return(0,C.A)(function*(){var r;let l=o.operation.buyersContactsPercentages;l?l[n]={percentage:t,order:1}:l={[n]:{percentage:t,order:1}},yield o.api.updateOperationById(null===(r=o.operation)||void 0===r?void 0:r.id,{buyersContactsPercentages:l})})()}buildContactData(n){if("particular"===n.type){const t=n.phoneNumber,o=n.email,r=[];t&&!r.includes(t)&&r.unshift(t);const l=[];return o&&!l.includes(o)&&l.unshift(o),{name:n.name,birthdate:new Date(n.birthDate),phones:r,emails:l,address:n.address,gender:n.gender,typeOfIdentification:n.identityType,dniPassport:n.identityNumber,type:n.type,civilStatus:n.civilStatus}}return{name:n.name,address:n.address,dniPassport:n.identityNumber,type:n.type}}}return(i=s).\u0275fac=function(n){return new(n||i)(e.rXU(c.ok),e.rXU(e.SKi),e.rXU(k.i),e.rXU(z.T),e.rXU(re.M),e.rXU(F.f))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-select-contact-data"]],viewQuery:function(n,t){if(1&n&&e.GBs(Pe,5),2&n){let o;e.mGM(o=e.lsd())&&(t.addressInput=o.first)}},inputs:{contact:"contact",operationId:"operationId",operation:"operation",contactData:"contactData",operationData:"operationData",reservedContacts:"reservedContacts"},outputs:{selectContactData:"selectContactData"},decls:12,vars:3,consts:[[1,"venta-component"],[1,"venta-component-body"],["class","content mt-15",4,"ngFor","ngForOf"],[1,"w-full"],["type","button",1,"crm-button-secondary","w-full","d-flex","justify-center","align-center",3,"click"],["alt","",1,"cursor-pointer",3,"src"],[1,"mt-10",2,"display","flex","gap","16px","justify-content","space-between"],["type","button",1,"crm-button-secondary","w-50p","d-block","text-center","border-primary",3,"click"],["type","submit",1,"crm-button","w-50p","d-block","text-center",3,"click","disabled"],[1,"content","mt-15"],[1,"",2,"border","1px solid #E0E0E0","width","100%","padding","6px","border-radius","20px","margin-bottom","16px"],[1,"d-flex","text-14"],[1,"cursor-pointer","w-50p","text-center",2,"padding","6px 10px","border-radius","20px",3,"click","ngStyle"],[1,"d-flex","justify-between"],[1,"title","mb-10"],[1,"text-14","text-secondary","font-weight-400"],[1,"cursor-pointer",3,"click"],[4,"ngIf"],[3,"hasParentContact","form"],[1,"mt-10",2,"gap","16px"],["type","submit",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"w-full","d-block","text-center","text-13","mt-15","text-secondary"],[1,"d-flex","justify-center","align-center"],[1,"d-flex","align-center","cursor-pointer",3,"click"],[2,"width","14px",3,"src"],[1,"ml-5"],[1,"title"],["alt","",1,"cursor-pointer",3,"click","src"],[3,"formGroup"],[1,"crm-input","w-50p",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","placeholder","Field","formControlName","name"],[1,"crm-input","w-50p","ml-10",2,"margin-bottom","8px"],["type","text","placeholder","Field","formControlName","address"],["type","text","placeholder","Field","formControlName","identityNumber"],["type","number","placeholder","%","formControlName","participationPercentage"],[4,"ngFor","ngForOf"],[1,"w-full","mt-20"],[1,"p-16","mt-10",2,"border","1px solid #EBEBEB","border-radius","12px"],["class","w-full  ",3,"formGroup",4,"ngIf"],[1,"w-full",3,"formGroup"],[1,"crm-input"],[1,"crm-input-input"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],[1,"d-flex","justify-between","mb-10"],[1,"d-flex","align-center"],["alt","",1,"cursor-pointer","ml-10",3,"src"],["alt","",1,"cursor-pointer","ml-10",3,"click","src"],["type","button",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"cursor-pointer","d-flex","align-center",3,"click"],[1,"cursor-pointer",2,"width","14px",3,"src"]],template:function(n,t){1&n&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,Ge,9,7,"div",2),e.j41(3,"div",3)(4,"button",4),e.bIt("click",function(){return t.addNewForm()}),e.nrm(5,"img",5),e.EFF(6," A\xf1adir otro comprador "),e.k0s()()(),e.j41(7,"div",6)(8,"button",7),e.bIt("click",function(){return t.onPrevStep()}),e.EFF(9," Anterior "),e.k0s(),e.j41(10,"button",8),e.bIt("click",function(){return t.onNextStep()}),e.EFF(11," Siguiente "),e.k0s()()()),2&n&&(e.R7$(2),e.Y8G("ngForOf",t.contactFormArray.controls),e.R7$(3),e.Y8G("src","assets/icon/user-plus-icon.svg",e.B4B),e.R7$(5),e.Y8G("disabled",t.disabled))},dependencies:[d.YU,d.Sq,d.bT,d.B3,c.qT,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.cb,c.j4,c.JD,he],styles:[".venta-component[_ngcontent-%COMP%]{max-width:500px}"]}),s})();const we=["selectPropertyComponent"],Ae=["selectPriceComponent"],T=i=>({"hidden-step":i}),Be=(i,s)=>({"crm-steps-container-step-current":i,"crm-steps-container-step-inactive":s});function Xe(i,s){1&i&&e.nrm(0,"i",24)}function $e(i,s){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const a=e.XpG().index;e.R7$(),e.JRh(a+1)}}function Ye(i,s){1&i&&e.nrm(0,"div",25)}function Ue(i,s){if(1&i&&(e.j41(0,"div",18)(1,"div",19),e.DNE(2,Xe,1,0,"i",20)(3,$e,2,1,"span",21),e.k0s(),e.j41(4,"div",22),e.EFF(5),e.k0s(),e.DNE(6,Ye,1,0,"div",23),e.k0s()),2&i){const a=s.$implicit,n=s.index,t=e.XpG();e.Y8G("ngClass",e.l_i(5,Be,n==t.activeIndex,n>t.activeIndex)),e.R7$(2),e.Y8G("ngIf",n<t.activeIndex),e.R7$(),e.Y8G("ngIf",n>=t.activeIndex),e.R7$(2),e.JRh(a),e.R7$(),e.Y8G("ngIf",n<t.steps.length-1)}}function ze(i,s){if(1&i){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3," 1. Promoci\xf3n "),e.k0s(),e.j41(4,"div",31),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.changeStep(0))}),e.nrm(5,"i",32),e.k0s()(),e.j41(6,"div",33),e.EFF(7),e.k0s()()}if(2&i){const a=e.XpG(2);e.R7$(7),e.SpI(" ",null==a.data||null==a.data.promotion?null:a.data.promotion.projectName," ")}}function We(i,s){if(1&i){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3," 2. Vivienda principal "),e.k0s(),e.j41(4,"div",31),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.changeStep(1))}),e.nrm(5,"i",32),e.k0s()(),e.j41(6,"div",33),e.EFF(7),e.k0s()()}if(2&i){const a=e.XpG(2);e.R7$(7),e.SpI(" ",null==a.data||null==a.data.property?null:a.data.property.reference," ")}}function qe(i,s){if(1&i){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3," 3. Por precio "),e.k0s(),e.j41(4,"div",31),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.changeStep(2))}),e.nrm(5,"i",32),e.k0s()(),e.j41(6,"div",33),e.EFF(7),e.nI1(8,"thousandSeparator"),e.k0s()()}if(2&i){const a=e.XpG(2);e.R7$(7),e.SpI(" ",e.bMT(8,1,null==a.data||null==a.data.priceSelected?null:a.data.priceSelected.finalPrice)," \u20ac ")}}function Ke(i,s){if(1&i){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3," 4. Documento de reserva "),e.k0s(),e.j41(4,"div",31),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.changeStep(3))}),e.nrm(5,"i",32),e.k0s()(),e.j41(6,"div",33),e.EFF(7),e.k0s()()}if(2&i){const a=e.XpG(2);e.R7$(7),e.SpI(" ",null==a.data||null==a.data.documentData?null:a.data.documentData.contractType," ")}}function Le(i,s){if(1&i&&(e.j41(0,"div",26),e.DNE(1,ze,8,1,"div",27)(2,We,8,1,"div",27)(3,qe,9,3,"div",27)(4,Ke,8,1,"div",27),e.k0s()),2&i){const a=e.XpG();e.R7$(),e.Y8G("ngIf",null==a.data?null:a.data.promotion),e.R7$(),e.Y8G("ngIf",null==a.data?null:a.data.property),e.R7$(),e.Y8G("ngIf",null==a.data||null==a.data.priceSelected?null:a.data.priceSelected.finalPrice),e.R7$(),e.Y8G("ngIf",null==a.data?null:a.data.documentData)}}const Je=[{path:"",component:(()=>{var i;class s{constructor(n,t,o,r){this.api=n,this.route=t,this.toast=o,this.router=r,this.reservationPayment=0,this.data={promotion:null,property:null,priceSelected:{priceWithoutIva:null,priceWithIva:null,finalPrice:null,iva:10},documentData:null},this.steps=["Promoci\xf3n","Vivienda principal","Por precio","Documento de reserva","Datos del cliente"],this.activeIndex=0,this.reservedContacts=[]}ngOnInit(){const n=this.route.snapshot.paramMap.get("operationId");n?this.api.getOperation({id:{equals:n}},null,null,{contact:{apply:!0,filter:null,onlyCount:!1},createdBy:{apply:!0,filter:null,onlyCount:!1},responsible:{apply:!0,filter:null,onlyCount:!1},mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1},selectedProperties:{apply:!0,filter:null,onlyCount:!1},notes:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1},operationRegisters:{apply:!0,filter:null,onlyCount:!1}}).then(t=>{t.success&&t.success.data&&t.success.data.length&&(this.operation=t.success.data[0],this.api.getOperationById(n).then(o=>{o.success&&o.success.data&&o.success.data.reserveContacts.length&&(this.reservedContacts=o.success.data.reserveContacts)}))}).catch(t=>{console.error("Error retrieving operation:",t)}):console.warn("No operationId parameter found in the URL.")}onSelectPromotion(n){var t=this;return(0,C.A)(function*(){var o;t.data.promotion=n,t.activeIndex=1;const r=yield t.api.getPromotionFullDataById(t.data.promotion.id);t.data.promotion=null==r||null===(o=r.success)||void 0===o?void 0:o.data,t.selectPropertyComponent.selectedPromotion=t.data.promotion})()}onSelectProperty(n){var t=this;return(0,C.A)(function*(){t.data.property=n,t.selectPriceComponent.selectedProperty=n,t.activeIndex=2})()}onSelectPrice(n){var t;this.data.priceSelected=n,this.reservationPayment=null===(t=this.operation)||void 0===t||null===(t=t.mainProperty)||void 0===t||null===(t=t.promotion)||void 0===t?void 0:t.reservePayment,this.activeIndex=3}onSelectDocumentData(n){this.data.documentData=n,this.activeIndex=4}onSelectContactData(){console.log("Contact data selected:",this.data.documentData),this.finishFlow()}finishFlow(){var n=this;return(0,C.A)(function*(){const t={propertyId:n.data.property.id,operationId:n.operation.id,priceSelected:n.data.priceSelected,documentData:n.data.documentData};(yield n.api.reserveProperty(t)).success?(n.toast.showSuccessToast("Reserva realizada correctamente"),n.router.navigate(["/contacts",n.operation.contactId,"operations",n.operation.id])):n.toast.showErrorToast("Error al realizar la reserva")})()}changeStep(n){this.activeIndex=n,0===n&&(this.data.property=null,this.data.priceSelected=null,this.data.documentData=null,this.selectPropertyComponent.selectedPromotion=null),1===n&&(this.data.priceSelected=null,this.data.documentData=null,this.selectPriceComponent.selectedProperty=null),console.log("DATAAAA",this.data)}}return(i=s).\u0275fac=function(n){return new(n||i)(e.rXU(k.i),e.rXU(b.nX),e.rXU(F.f),e.rXU(b.Ix))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-venta-operation-process"]],viewQuery:function(n,t){if(1&n&&(e.GBs(we,7),e.GBs(Ae,7)),2&n){let o;e.mGM(o=e.lsd())&&(t.selectPropertyComponent=o.first),e.mGM(o=e.lsd())&&(t.selectPriceComponent=o.first)}},decls:22,vars:22,consts:[["selectPropertyComponent",""],["selectPriceComponent",""],["selectClientComponent",""],[3,"fullscreen"],[1,"crm-block-content"],[1,"crm-block-body"],[1,"crm-block-body-blue-content"],[1,"crm-steps-container"],["class","crm-steps-container-step",3,"ngClass",4,"ngFor","ngForOf"],[1,"venta-body"],[1,"venta-body-component"],[3,"ngClass"],[3,"selectPromotion"],[3,"selectProperty"],[3,"selectPrice"],[3,"selectDocumentData","reservationAmount"],[3,"selectContactData","contactData","reservedContacts","operationData"],["class","steps-cards-body",4,"ngIf"],[1,"crm-steps-container-step",3,"ngClass"],[1,"crm-steps-container-step-circle"],["class","fa fa-check",4,"ngIf"],[4,"ngIf"],[1,"crm-steps-container-step-label"],["class","crm-steps-container-step-separator",4,"ngIf"],[1,"fa","fa-check"],[1,"crm-steps-container-step-separator"],[1,"steps-cards-body"],["class","steps-cards-body-card",4,"ngIf"],[1,"steps-cards-body-card"],[1,"steps-cards-body-card-header"],[1,"steps-cards-body-card-header-title"],[1,"steps-cards-body-card-header-icon",3,"click"],[1,"fa-solid","fa-pencil"],[1,"steps-cards-body-card-text"]],template:function(n,t){if(1&n){const o=e.RV6();e.j41(0,"ion-content",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),e.DNE(5,Ue,7,8,"div",8),e.k0s(),e.j41(6,"div",9)(7,"div",10)(8,"div",11)(9,"app-venta-select-promotion",12),e.bIt("selectPromotion",function(l){return e.eBV(o),e.Njj(t.onSelectPromotion(l))}),e.k0s()(),e.j41(10,"div",11)(11,"app-venta-select-property",13,0),e.bIt("selectProperty",function(l){return e.eBV(o),e.Njj(t.onSelectProperty(l))}),e.k0s()(),e.j41(13,"div",11)(14,"app-venta-select-price",14,1),e.bIt("selectPrice",function(l){return e.eBV(o),e.Njj(t.onSelectPrice(l))}),e.k0s()(),e.j41(16,"div",11)(17,"app-venta-select-document",15,2),e.bIt("selectDocumentData",function(l){return e.eBV(o),e.Njj(t.onSelectDocumentData(l))}),e.k0s()(),e.j41(19,"div",11)(20,"app-venta-select-contact-data",16),e.bIt("selectContactData",function(){return e.eBV(o),e.Njj(t.onSelectContactData())}),e.k0s()()(),e.DNE(21,Le,5,4,"div",17),e.k0s()()()()()}2&n&&(e.Y8G("fullscreen",!0),e.R7$(5),e.Y8G("ngForOf",t.steps),e.R7$(3),e.Y8G("ngClass",e.eq3(12,T,0!==t.activeIndex)),e.R7$(2),e.Y8G("ngClass",e.eq3(14,T,1!==t.activeIndex)),e.R7$(3),e.Y8G("ngClass",e.eq3(16,T,2!==t.activeIndex)),e.R7$(3),e.Y8G("ngClass",e.eq3(18,T,3!==t.activeIndex)),e.R7$(),e.Y8G("reservationAmount",t.reservationPayment),e.R7$(2),e.Y8G("ngClass",e.eq3(20,T,4!==t.activeIndex)),e.R7$(),e.Y8G("contactData",null==t.operation?null:t.operation.contact)("reservedContacts",t.reservedContacts)("operationData",t.operation),e.R7$(),e.Y8G("ngIf",null==t.data?null:t.data.promotion))},dependencies:[d.YU,d.Sq,d.bT,y.W9,R,H,te,ie,Ne,W.w],styles:[".crm-steps-container[_ngcontent-%COMP%], .crm-steps-container-step[_ngcontent-%COMP%]{display:flex;align-items:center}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#3a50e4;border:1px solid #3A50E4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#3a50e4}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#a8a8a8;border:1px solid rgb(168,168,168)}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#a8a8a8}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#a8a8a8}.crm-steps-container-step-circle[_ngcontent-%COMP%]{width:21px;min-width:21px;height:21px;min-height:21px;border-radius:50%;background:#3a50e4;color:#fff;display:flex;justify-content:center;align-items:center;font-weight:700;font-size:12px;margin-right:8px}.crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4;font-weight:500;margin-right:16px;font-size:13px}.crm-steps-container-step-separator[_ngcontent-%COMP%]{width:20px;height:1px;background:#3a50e4;margin-right:16px}.hidden-step[_ngcontent-%COMP%]{height:0;overflow:hidden;opacity:0;position:absolute;width:0;visibility:hidden}.steps-cards-body[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:16px}.steps-cards-body-card[_ngcontent-%COMP%]{border:1px solid var(--crm-border-light-color);border-radius:6px;padding:12px}.steps-cards-body-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--crm-border-light-color);padding-bottom:16px}.steps-cards-body-card-header-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:var(--crm-text-color)}.steps-cards-body-card-header-icon[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;color:var(--crm-text-color)}.steps-cards-body-card-text[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color);padding-top:16px}.venta-body[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px}.venta-body[_ngcontent-%COMP%]   .steps-cards-body[_ngcontent-%COMP%]{min-width:300px;width:300px;flex-shrink:0}.venta-body-component[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;overflow-y:auto}"]}),s})()}];let He=(()=>{var i;class s{}return(i=s).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[b.iI.forChild(Je),b.iI]}),s})();var Qe=p(3895),Ze=p(9662),et=p(6812),tt=p(969),nt=p(8147);let ot=(()=>{var i;class s{}return(i=s).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[d.MD,c.YN,y.bv,c.X1,He,Qe.b,Ze.Y,et.u,tt.rJ,nt.h]}),s})()},9662:(V,j,p)=>{p.d(j,{Y:()=>y});var d=p(177),c=p(3953);let y=(()=>{var b;class C{}return(b=C).\u0275fac=function(k){return new(k||b)},b.\u0275mod=c.$C({type:b}),b.\u0275inj=c.G2t({imports:[d.MD]}),C})()},4558:(V,j,p)=>{p.d(j,{w:()=>c});var d=p(3953);let c=(()=>{var y;class b{transform(e,...k){if(null==e||""===e)return"";let F;return F="string"==typeof e?parseFloat(e):e,isNaN(F)?"":F.toString().replace(/\.(?=\d+$)/,",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}}return(y=b).\u0275fac=function(e){return new(e||y)},y.\u0275pipe=d.EJ8({name:"thousandSeparator",type:y,pure:!0}),b})()}}]);