"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6915],{1129:(N,M,_)=>{_.d(M,{Z:()=>x});var g=_(3953),e=_(6069),v=_(1982);function b(t,k){if(1&t){const j=g.RV6();g.j41(0,"app-country-selector-popover",4),g.bIt("countrySelected",function(F){g.eBV(j);const E=g.XpG();return g.Njj(E.selectCountry(F))})("closePopover",function(){g.eBV(j);const F=g.XpG();return g.Njj(F.dropdownOpen=!1)}),g.k0s()}2&t&&g.Y8G("showCountryCode",!0)}let x=(()=>{var t;class k{constructor(){this.emitCountrySelected=new g.bkB,this.countries=e.X,this.selectedCountry=e.X[0],this.dropdownOpen=!1}ngOnChanges(){const h=this.extractCountryPhoneCodeFromPhoneNumber(this.selectedPhoneNumber);h!==this.extractCountryPhoneCodeFromPhoneNumber(this.selectedCountry.phoneCode)&&this.selectCountryByPhoneCode(h)}toggleDropdown(h){h.stopPropagation(),this.dropdownOpen=!this.dropdownOpen}selectCountry(h){h.event.stopPropagation(),this.selectedCountry=h.country,this.emitCountrySelected.emit(h.country),this.dropdownOpen=!1}selectCountryByPhoneCode(h){const F=this.countries.find(E=>E.phoneCode===h);F&&(this.selectedCountry=F,this.emitCountrySelected.emit(F))}extractCountryPhoneCodeFromPhoneNumber(h){return null==h?void 0:h.split(" ")[0]}}return(t=k).\u0275fac=function(h){return new(h||t)},t.\u0275cmp=g.VBU({type:t,selectors:[["app-flag-country-selector"]],inputs:{selectedPhoneNumber:"selectedPhoneNumber"},outputs:{emitCountrySelected:"emitCountrySelected"},features:[g.OA$],decls:5,vars:3,consts:[["tabindex","0",1,"flag-country-selector-container",3,"click"],[1,"selected-country"],[1,"fas","fa-caret-down","dropdown-arrow"],[3,"showCountryCode"],[3,"countrySelected","closePopover","showCountryCode"]],template:function(h,F){1&h&&(g.j41(0,"div",0),g.bIt("click",function(V){return F.toggleDropdown(V)}),g.j41(1,"div",1),g.nrm(2,"span")(3,"i",2),g.k0s(),g.DNE(4,b,1,1,"app-country-selector-popover",3),g.k0s()),2&h&&(g.R7$(2),g.HbH(null==F.selectedCountry?null:F.selectedCountry.flagClass),g.R7$(2),g.vxM(F.dropdownOpen?4:-1))},dependencies:[v.u],styles:[".flag-country-selector-container[_ngcontent-%COMP%]{position:relative;width:50px;cursor:pointer;color:#000}.selected-country[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:50px}.dropdown-arrow[_ngcontent-%COMP%]{margin-left:8px}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:200px;z-index:9999;background-color:#fff;border:1px solid #ccc;padding:8px 0;border-radius:12px;border:1px solid var(--crm-border-light-color);color:#000;max-height:150px;overflow-y:auto}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;display:inline-block;margin-right:8px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.flag-country-selector-container[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{color:#000}.selected-country[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;width:18px;height:18px}"]}),k})()},6812:(N,M,_)=>{_.d(M,{u:()=>x});var g=_(177),e=_(9417),v=_(7754),b=_(3953);let x=(()=>{var t;class k{}return(t=k).\u0275fac=function(h){return new(h||t)},t.\u0275mod=b.$C({type:t}),t.\u0275inj=b.G2t({imports:[g.MD,e.YN,v.X]}),k})()},7754:(N,M,_)=>{_.d(M,{X:()=>x});var g=_(177),e=_(9417),v=_(9465),b=_(3953);let x=(()=>{var t;class k{}return(t=k).\u0275fac=function(h){return new(h||t)},t.\u0275mod=b.$C({type:t}),t.\u0275inj=b.G2t({imports:[g.MD,e.YN,v.bv]}),k})()},7700:(N,M,_)=>{_.d(M,{K:()=>ve});var g=_(467),e=_(3953),v=_(9417),b=_(6906),x=_(6039),t=_(6552),k=_(638),j=_(8397),h=_(177),F=_(9465),E=_(1129);const V=d=>({"crm-input-input-error":d}),Y=d=>({"text-error-importan":d});function $(d,f){1&d&&(e.j41(0,"div",40),e.EFF(1," Por favor, introduce un correo electr\xf3nico v\xe1lido "),e.k0s())}function B(d,f){if(1&d&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&d){const m=f.$implicit;e.FS9("value",m.key),e.R7$(),e.JRh(m.label)}}function U(d,f){if(1&d&&(e.j41(0,"div",8)(1,"div",3),e.EFF(2," Role "),e.k0s(),e.j41(3,"div",15)(4,"select",41)(5,"option",42),e.EFF(6,"Selecciona un origen"),e.k0s(),e.Z7z(7,B,2,2,"option",43,e.fX1),e.k0s()()()),2&d){const m=e.XpG();e.R7$(5),e.Y8G("value",null),e.R7$(2),e.Dyx(m.responsibilityOptions)}}function z(d,f){1&d&&(e.j41(0,"div",40),e.EFF(1," El nombre es requerido "),e.k0s())}function W(d,f){1&d&&(e.j41(0,"div",40),e.EFF(1," La fecha de nacimiento es requerida "),e.k0s())}function K(d,f){1&d&&(e.j41(0,"div",40),e.EFF(1," Error "),e.k0s())}function q(d,f){if(1&d&&(e.j41(0,"div",8)(1,"div",3),e.EFF(2," \xbfQue porcentaje compra el comprador? "),e.k0s(),e.j41(3,"div",4),e.nrm(4,"input",44),e.k0s(),e.DNE(5,K,2,0,"div",6),e.k0s()),2&d){const m=e.XpG();e.R7$(3),e.Y8G("ngClass",e.eq3(2,V,m.isControlInvalid("participationPercentage"))),e.R7$(2),e.Y8G("ngIf",m.isControlInvalid("participationPercentage"))}}function w(d,f){1&d&&(e.j41(0,"div",40),e.EFF(1," La direcci\xf3n es obligatoria "),e.k0s())}function L(d,f){1&d&&(e.j41(0,"div",40),e.EFF(1," El DNI o Pasaporte es requerido "),e.k0s())}function J(d,f){1&d&&(e.j41(0,"div",40),e.EFF(1," El n\xfamero de tel\xe9fono es requerido "),e.k0s())}function H(d,f){1&d&&(e.j41(0,"div",10),e.nrm(1,"ion-radio",45),e.j41(2,"div",22),e.EFF(3," Gananciales "),e.k0s()(),e.j41(4,"div",23),e.nrm(5,"ion-radio",46),e.j41(6,"div",22),e.EFF(7," Separacion de bienes "),e.k0s()())}function Q(d,f){1&d&&(e.j41(0,"div",10),e.nrm(1,"ion-radio",47),e.j41(2,"div",22),e.EFF(3," Soltero/a "),e.k0s()(),e.j41(4,"div",23),e.nrm(5,"ion-radio",48),e.j41(6,"div",22),e.EFF(7," Separado/a "),e.k0s()(),e.j41(8,"div",23),e.nrm(9,"ion-radio",49),e.j41(10,"div",22),e.EFF(11," Divorciado/a "),e.k0s()(),e.j41(12,"div",23),e.nrm(13,"ion-radio",50),e.j41(14,"div",22),e.EFF(15," Viudo/a "),e.k0s()(),e.j41(16,"div",23),e.nrm(17,"ion-radio",51),e.j41(18,"div",22),e.EFF(19," Pareja de hecho "),e.k0s()())}let A=(()=>{var d;class f{constructor(){this.responsibilityOptions=b.Rl}ngOnInit(){}isControlInvalid(r){const o=this.form.get(r);return!(!o||!o.invalid||!o.dirty&&!o.touched)}onSelectCountry(r){}onNextStep(){}onChangeMaritalType(r){var o;null===(o=this.form.get("civilType"))||void 0===o||o.setValue(r)}}return(d=f).\u0275fac=function(r){return new(r||d)},d.\u0275cmp=e.VBU({type:d,selectors:[["app-person-form"]],inputs:{form:"form",hasParentContact:"hasParentContact"},decls:97,vars:29,consts:[["addressInput",""],[3,"ngSubmit","formGroup"],[1,"crm-input",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","placeholder","Field","formControlName","email"],["class","crm-input-error",4,"ngIf"],[1,"crm-text","small","light","mb-15"],[1,"crm-input","mb-15"],["formControlName","gender",1,"d-flex","gap-16"],[1,"crm-input-radio"],["value","male"],[1,"crm-input-radio-label"],["value","female"],["type","text","placeholder","ex: Juan","formControlName","name"],[1,"crm-input-input"],["type","date","formControlName","birthDate"],[1,"crm-input",2,"margin-bottom","16px"],["type","text","formControlName","address","placeholder","Escribe la direcci\xf3n"],[1,"crm-input-label",3,"ngClass"],["formControlName","identityType",1,"gap-16"],["value","dni"],[1,"crm-input-radio-label","text-secondary"],[1,"crm-input-radio","mt-10"],["value","nif"],["value","nie"],["value","passport"],["value","identityCard"],[1,"crm-input-input","mt-10",3,"ngClass"],["type","text","placeholder","ex: 48500285A","formControlName","identityNumber"],[1,"crm-input"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected","selectedPhoneNumber"],["type","text","placeholder","N\xfamero de tel\xe9fono","formControlName","phoneNumber"],[1,"crm-text","small","light",2,"margin-bottom","8px"],["formControlName","civilType",1,"d-flex","gap-16"],[1,"crm-input-radio",3,"click"],["value","married"],["value","other"],["formControlName","civilStatus",1,"gap-16"],[1,"crm-input-error"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],["type","number","formControlName","participationPercentage","placeholder","%"],["value","communityProperty"],["value","separateProperty"],["value","single"],["value","separated"],["value","divorced"],["value","widowed"],["value","civilUnion"]],template:function(r,o){if(1&r){const a=e.RV6();e.j41(0,"form",1),e.bIt("ngSubmit",function(){return e.eBV(a),e.Njj(o.onNextStep())}),e.j41(1,"div",2)(2,"div",3),e.EFF(3," Correo electr\xf3nico "),e.k0s(),e.j41(4,"div",4),e.nrm(5,"input",5),e.k0s(),e.DNE(6,$,2,0,"div",6),e.k0s(),e.j41(7,"div",7),e.EFF(8," Por favor, compruebe que la direcci\xf3n de correo electr\xf3nico ingresada es correcta. "),e.k0s(),e.DNE(9,U,9,1,"div",8),e.j41(10,"div",8)(11,"ion-radio-group",9)(12,"div",10),e.nrm(13,"ion-radio",11),e.j41(14,"div",12),e.EFF(15," Don "),e.k0s()(),e.j41(16,"div",10),e.nrm(17,"ion-radio",13),e.j41(18,"div",12),e.EFF(19," Do\xf1a "),e.k0s()()()(),e.j41(20,"div",8)(21,"div",3),e.EFF(22," Nombre y apellidos "),e.k0s(),e.j41(23,"div",4),e.nrm(24,"input",14),e.k0s(),e.DNE(25,z,2,0,"div",6),e.k0s(),e.j41(26,"div",8)(27,"div",3),e.EFF(28," Fecha de nacimiento "),e.k0s(),e.j41(29,"div",15),e.nrm(30,"input",16),e.k0s(),e.DNE(31,W,2,0,"div",6),e.k0s(),e.DNE(32,q,6,4,"div",8),e.j41(33,"div",17)(34,"div",3),e.EFF(35," Direcci\xf3n "),e.k0s(),e.j41(36,"div",4),e.nrm(37,"input",18,0),e.k0s(),e.DNE(39,w,2,0,"div",6),e.k0s(),e.j41(40,"div",8)(41,"div",19),e.EFF(42," Identificaci\xf3n "),e.k0s(),e.j41(43,"ion-radio-group",20)(44,"div",10),e.nrm(45,"ion-radio",21),e.j41(46,"div",22),e.EFF(47," DNI "),e.k0s()(),e.j41(48,"div",23),e.nrm(49,"ion-radio",24),e.j41(50,"div",22),e.EFF(51," NIF "),e.k0s()(),e.j41(52,"div",23),e.nrm(53,"ion-radio",25),e.j41(54,"div",22),e.EFF(55," NIE "),e.k0s()(),e.j41(56,"div",23),e.nrm(57,"ion-radio",26),e.j41(58,"div",22),e.EFF(59," Pasaporte "),e.k0s()(),e.j41(60,"div",23),e.nrm(61,"ion-radio",27),e.j41(62,"div",22),e.EFF(63," Carta de identidad "),e.k0s()()(),e.j41(64,"div",28),e.nrm(65,"input",29),e.k0s(),e.DNE(66,L,2,0,"div",6),e.k0s(),e.j41(67,"div",30)(68,"div",3),e.EFF(69," Phone number "),e.k0s(),e.j41(70,"div",31)(71,"div",4)(72,"app-flag-country-selector",32),e.bIt("emitCountrySelected",function(c){return e.eBV(a),e.Njj(o.onSelectCountry(c))}),e.k0s(),e.nrm(73,"input",33),e.k0s()(),e.DNE(74,J,2,0,"div",6),e.j41(75,"div",34),e.EFF(76," Por favor, compruebe que el n\xfamero de tel\xe9fono m\xf3vil ingresado es correcto. Ser\xe1 utilizado para la firma electr\xf3nica."),e.nrm(77,"br")(78,"br"),e.k0s()(),e.j41(79,"div",8)(80,"div",3),e.EFF(81," Estado civil "),e.k0s(),e.j41(82,"ion-radio-group",35)(83,"div",36),e.bIt("click",function(){return e.eBV(a),e.Njj(o.onChangeMaritalType("married"))}),e.nrm(84,"ion-radio",37),e.j41(85,"div",12),e.EFF(86," Casada "),e.k0s()(),e.j41(87,"div",36),e.bIt("click",function(){return e.eBV(a),e.Njj(o.onChangeMaritalType("other"))}),e.nrm(88,"ion-radio",38),e.j41(89,"div",12),e.EFF(90," Otro "),e.k0s()()()(),e.j41(91,"div",17)(92,"div",3),e.EFF(93," Seleccionar "),e.k0s(),e.j41(94,"ion-radio-group",39),e.DNE(95,H,8,0)(96,Q,20,0),e.k0s()()()}if(2&r){let a,n;e.Y8G("formGroup",o.form),e.R7$(4),e.Y8G("ngClass",e.eq3(17,V,o.isControlInvalid("email"))),e.R7$(2),e.Y8G("ngIf",o.isControlInvalid("email")),e.R7$(3),e.vxM(o.hasParentContact?9:-1),e.R7$(14),e.Y8G("ngClass",e.eq3(19,V,o.isControlInvalid("name"))),e.R7$(2),e.Y8G("ngIf",o.isControlInvalid("name")),e.R7$(6),e.Y8G("ngIf",o.isControlInvalid("birthDate")),e.R7$(),e.vxM(o.hasParentContact?-1:32),e.R7$(4),e.Y8G("ngClass",e.eq3(21,V,o.isControlInvalid("address"))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("address")),e.R7$(2),e.Y8G("ngClass",e.eq3(23,Y,o.isControlInvalid("identityType"))),e.R7$(23),e.Y8G("ngClass",e.eq3(25,V,o.isControlInvalid("identityNumber"))),e.R7$(2),e.Y8G("ngIf",o.isControlInvalid("identityNumber")),e.R7$(5),e.Y8G("ngClass",e.eq3(27,V,o.isControlInvalid("phoneNumber"))),e.R7$(),e.Y8G("selectedPhoneNumber",null==(a=o.form.get("phoneNumber"))?null:a.value),e.R7$(2),e.Y8G("ngIf",o.isControlInvalid("phoneNumber")),e.R7$(21),e.vxM("married"===(null==(n=o.form.get("civilType"))?null:n.value)?95:96)}},dependencies:[h.YU,h.bT,v.qT,v.xH,v.y7,v.me,v.Q0,v.wz,v.BC,v.cb,F.KO,F.f0,F.Je,v.j4,v.JD,E.Z]}),f})();const Z=["addressInput"],X=d=>({"background-color":d}),G=d=>({"crm-input-input-error":d});function ee(d,f){if(1&d&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&d){let m;const r=e.XpG(2).$implicit;e.R7$(),e.JRh(null==(m=r.get("name"))?null:m.value)}}function te(d,f){1&d&&e.nrm(0,"img",5),2&d&&e.Y8G("src","assets/icon/chevron-down-icon.svg",e.B4B)}function ne(d,f){1&d&&e.nrm(0,"img",5),2&d&&e.Y8G("src","assets/icon/chevron-up-icon.svg",e.B4B)}function I(d,f){if(1&d){const m=e.RV6();e.j41(0,"div"),e.nrm(1,"app-person-form",18),e.j41(2,"div",19)(3,"button",20),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2).index,a=e.XpG();return e.Njj(a.onSaveContact(o))}),e.EFF(4," Guardar "),e.k0s(),e.j41(5,"div",21)(6,"div",22)(7,"div",23),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2).index,a=e.XpG();return e.Njj(a.removePerson(o))}),e.nrm(8,"img",24),e.j41(9,"span",25),e.EFF(10,"Eliminar"),e.k0s()()()()()()}if(2&d){const m=e.XpG(2).index,r=e.XpG();e.R7$(),e.Y8G("hasParentContact",!1)("form",r.getContactForm(m)),e.R7$(7),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B)}}function oe(d,f){if(1&d){const m=e.RV6();e.j41(0,"div",13)(1,"div",14)(2,"div"),e.EFF(3),e.k0s(),e.DNE(4,ee,2,1,"div",15),e.k0s(),e.j41(5,"div",16),e.bIt("click",function(){e.eBV(m);const o=e.XpG().index,a=e.XpG();return e.Njj(a.togglePersonForm(o))}),e.DNE(6,te,1,1,"img",5)(7,ne,1,1,"img",5),e.k0s()(),e.DNE(8,I,11,3,"div",17)}if(2&d){let m,r,o;const a=e.XpG(),n=a.$implicit,c=a.index;e.R7$(3),e.SpI(" Comprador ",c+1,""),e.R7$(),e.vxM(null!=(m=n.get("showForm"))&&m.value?-1:4),e.R7$(2),e.vxM(null!=(r=n.get("showForm"))&&r.value?6:7),e.R7$(2),e.Y8G("ngIf",null==(o=n.get("showForm"))?null:o.value)}}function ie(d,f){if(1&d&&(e.j41(0,"option",46),e.EFF(1),e.k0s()),2&d){const m=f.$implicit;e.FS9("value",m.key),e.R7$(),e.JRh(m.label)}}function re(d,f){if(1&d&&(e.j41(0,"div",41)(1,"div",42)(2,"div",30),e.EFF(3," Role "),e.k0s(),e.j41(4,"div",43)(5,"select",44)(6,"option",45),e.EFF(7,"Selecciona un origen"),e.k0s(),e.Z7z(8,ie,2,2,"option",46,e.fX1),e.k0s()()()()),2&d){const m=e.XpG().index,r=e.XpG(3).index,o=e.XpG();e.Y8G("formGroup",o.getCompanyPersonForm(r,m)),e.R7$(6),e.Y8G("value",null),e.R7$(2),e.Dyx(o.responsibilityOptions)}}function ae(d,f){if(1&d&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&d){let m;const r=e.XpG(2).index,o=e.XpG(3).index,a=e.XpG();e.R7$(),e.JRh(null==(m=a.getCompanyPersonForm(o,r).get("name"))?null:m.value)}}function le(d,f){if(1&d){const m=e.RV6();e.j41(0,"img",50),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2).index,a=e.XpG(3).index,n=e.XpG();return e.Njj(n.toggleCompanyPersonForm(a,o))}),e.k0s()}2&d&&e.Y8G("src","assets/icon/chevron-down-icon.svg",e.B4B)}function se(d,f){if(1&d){const m=e.RV6();e.j41(0,"img",50),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2).index,a=e.XpG(3).index,n=e.XpG();return e.Njj(n.toggleCompanyPersonForm(a,o))}),e.k0s()}2&d&&e.Y8G("src","assets/icon/chevron-up-icon.svg",e.B4B)}function ce(d,f){if(1&d){const m=e.RV6();e.nrm(0,"app-person-form",18),e.j41(1,"div",19)(2,"button",51),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2).index,a=e.XpG(3).index,n=e.XpG();return e.Njj(n.onSaveChildContact(a,o))}),e.EFF(3," Guardar "),e.k0s(),e.j41(4,"div",21)(5,"div",22)(6,"div",52),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2).index,a=e.XpG(3).index,n=e.XpG();return e.Njj(n.removePersonFromCompany(a,o))}),e.nrm(7,"img",53),e.j41(8,"span",25),e.EFF(9,"Eliminar"),e.k0s()()()()()}if(2&d){const m=e.XpG(2).index,r=e.XpG(3).index,o=e.XpG();e.Y8G("hasParentContact",!0)("form",o.getCompanyPersonForm(r,m)),e.R7$(7),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B)}}function de(d,f){if(1&d&&(e.j41(0,"div")(1,"div",47)(2,"div")(3,"div"),e.EFF(4),e.k0s(),e.DNE(5,ae,2,1,"div",15),e.k0s(),e.j41(6,"div",48),e.DNE(7,le,1,1,"img",49)(8,se,1,1,"img",49),e.k0s()(),e.DNE(9,ce,10,3),e.k0s()),2&d){let m,r,o,a;const n=e.XpG(),c=n.$implicit,s=n.index,l=e.XpG(3).index,i=e.XpG();e.R7$(4),e.JRh(i.responsibilityOptionsObj[null==(m=i.getCompanyPersonForm(l,s).get("role"))?null:m.value]),e.R7$(),e.vxM(null!=(r=c.get("showForm"))&&r.value?-1:5),e.R7$(2),e.vxM(null!=(o=c.get("showForm"))&&o.value?7:8),e.R7$(2),e.vxM(null!=(a=c.get("showForm"))&&a.value?9:-1)}}function pe(d,f){if(1&d&&(e.j41(0,"div")(1,"div",39),e.DNE(2,re,10,2,"div",40)(3,de,10,4,"div",17),e.k0s()()),2&d){let m,r;const o=f.index,a=e.XpG(3).index,n=e.XpG();e.R7$(2),e.Y8G("ngIf",!(null!=(m=n.getCompanyPersonForm(a,o).get("role"))&&m.value)),e.R7$(),e.Y8G("ngIf",null==(r=n.getCompanyPersonForm(a,o).get("role"))?null:r.value)}}function ue(d,f){if(1&d){const m=e.RV6();e.j41(0,"div")(1,"form",28)(2,"div",13)(3,"div",29)(4,"div",30),e.EFF(5," Nombre de la empresa "),e.k0s(),e.j41(6,"div",31),e.nrm(7,"input",32),e.k0s()(),e.j41(8,"div",33)(9,"div",30),e.EFF(10," Direcci\xf3n "),e.k0s(),e.j41(11,"div",31),e.nrm(12,"input",34),e.k0s()()(),e.j41(13,"div",13)(14,"div",29)(15,"div",30),e.EFF(16," CIF "),e.k0s(),e.j41(17,"div",31),e.nrm(18,"input",35),e.k0s()(),e.j41(19,"div",33)(20,"div",30),e.EFF(21," \xbfQue porcentaje compra el comprador? "),e.k0s(),e.j41(22,"div",31),e.nrm(23,"input",36),e.k0s()()(),e.DNE(24,pe,4,2,"div",37),e.j41(25,"div",38)(26,"button",4),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2).index,a=e.XpG();return e.Njj(a.addPersonToCompany(o))}),e.nrm(27,"img",5),e.EFF(28," A\xf1adir persona responsable "),e.k0s()()()()}if(2&d){let m;const r=e.XpG(2).index,o=e.XpG();e.R7$(),e.Y8G("formGroup",o.getContactForm(r)),e.R7$(5),e.Y8G("ngClass",e.eq3(7,G,o.isControlInvalid(o.getContactForm(r),"name"))),e.R7$(5),e.Y8G("ngClass",e.eq3(9,G,o.isControlInvalid(o.getContactForm(r),"address"))),e.R7$(6),e.Y8G("ngClass",e.eq3(11,G,o.isControlInvalid(o.getContactForm(r),"identityNumber"))),e.R7$(5),e.Y8G("ngClass",e.eq3(13,G,o.isControlInvalid(o.getContactForm(r),"participationPercentage"))),e.R7$(2),e.Y8G("ngForOf",null==(m=o.getPersons(r))?null:m.controls),e.R7$(3),e.Y8G("src","assets/icon/plus-icon.svg",e.B4B)}}function be(d,f){if(1&d){const m=e.RV6();e.j41(0,"div",13)(1,"div",26),e.EFF(2),e.k0s(),e.j41(3,"div")(4,"img",27),e.bIt("click",function(){e.eBV(m);const o=e.XpG().index,a=e.XpG();return e.Njj(a.removeCompany(o))}),e.k0s()()(),e.DNE(5,ue,29,15,"div",17)}if(2&d){let m;const r=e.XpG(),o=r.$implicit,a=r.index;e.R7$(2),e.SpI("Comprador ",a+1,""),e.R7$(2),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B),e.R7$(),e.Y8G("ngIf",null==(m=o.get("showForm"))?null:m.value)}}function me(d,f){if(1&d){const m=e.RV6();e.j41(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12),e.bIt("click",function(){const o=e.eBV(m).index,a=e.XpG();return e.Njj(a.onChangePersonType(o,"particular"))}),e.EFF(4," Persona f\xedsica "),e.k0s(),e.j41(5,"div",12),e.bIt("click",function(){const o=e.eBV(m).index,a=e.XpG();return e.Njj(a.onChangePersonType(o,"empresa"))}),e.EFF(6," Persona jur\xeddica "),e.k0s()()(),e.DNE(7,oe,9,4)(8,be,6,3),e.k0s()}if(2&d){let m,r,o;const a=f.$implicit;e.R7$(3),e.Y8G("ngStyle",e.eq3(3,X,"particular"===(null==(m=a.get("type"))?null:m.value)?"#ECF2FF":"")),e.R7$(2),e.Y8G("ngStyle",e.eq3(5,X,"empresa"===(null==(r=a.get("type"))?null:r.value)?"#ECF2FF":"")),e.R7$(2),e.vxM("particular"===(null==(o=a.get("type"))?null:o.value)?7:8)}}let ve=(()=>{var d;class f{constructor(r,o,a,n,c,s){this.fb=r,this.ngZone=o,this.api=a,this.utils=n,this.modalsService=c,this.toastService=s,this.selectContactData=new e.bkB,this.screen="reserve",this.mapCenter={lat:40.416775,lng:-3.70379},this.mapZoom=6,this.markerPosition=this.mapCenter,this.mapOptions={disableDefaultUI:!1,styles:[{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]}]},this.markerOptions={draggable:!0},this.disabled=!0,this.showForms=[],this.FormGroup=v.gE,this.responsibilityOptions=b.Rl,this.responsibilityOptionsObj=b.qA;const l=this.createContactForm(!1,"particular");this.contactFormArray=this.fb.array([l])}ngOnInit(){}set contactData(r){this.contact=r,this.contact&&!this.contacts.length&&this.patchContactData(0,this.contact)}set operationData(r){this.operation=r}set reservedContacts(r){if(this.contacts=r,this.contacts.length){const o=this.extractRelatedContactIds(this.contacts);let a=0;this.contacts.forEach(n=>{o.includes(n.id)||(this.patchContactData(a,n,!1),a++)})}}extractRelatedContactIds(r){const o=[];for(const a of r.filter(n=>"empresa"===n.type))for(const n of a.contactsRelation||[])o.push(n.contactRelatedId);return o}patchContactData(r,o,a=!1){var n,c;let s=this.utils.parseBackendDateToFrontendDateInput(null==o?void 0:o.birthdate),l="";null!=o&&o.civilStatus&&(l=["communityProperty","separateProperty"].includes(o.civilStatus)?"married":"other");let i={id:o.id||null,email:(null===(n=o.emails)||void 0===n?void 0:n[0])||"",name:o.name||"",birthDate:s||"",phoneNumber:(null===(c=o.phones)||void 0===c?void 0:c[0])||"+34 ",address:o.address||"",gender:o.gender||"",type:o.type||"particular",role:"sole_administrator",identityType:o.typeOfIdentification||"",identityNumber:o.dniPassport,civilStatus:o.civilStatus,civilType:l,showForm:!a,formId:r},u=this.getContactForm(r);if(a){let y=this.createContactForm(a,"particular");y.patchValue(i),u.get("persons").push(y)}else{var p;null!==(p=this.operation)&&void 0!==p&&p.buyersContactsPercentages&&this.operation.buyersContactsPercentages[o.id]&&(i.participationPercentage=Number(this.operation.buyersContactsPercentages[o.id].percentage)),u?(u.patchValue(i),u.patchValue({participationPercentage:i.participationPercentage})):(u=this.createContactForm(a,i.type),u.patchValue(i))}if(this.contactFormArray.setControl(r,u),"empresa"===o.type)for(const y of o.contactsRelation||[]){const P=this.contacts.find(S=>S.id===y.contactRelatedId);P&&this.patchContactData(r,P,!0)}let C=0;this.contactFormArray.controls.forEach(y=>{var P;C+=null===(P=y.get("participationPercentage"))||void 0===P?void 0:P.value}),this.disabled=100!==C}createContactForm(r=!1,o){var a,n;const c=this.fb.group({type:[o],showForm:[!0],name:[""],email:[""],phoneNumber:["+34 "],birthDate:[""],identityNumber:[""],identityType:[""],address:[""],role:[""],id:[null],parentContact:[null],gender:[""],civilStatus:[""],civilType:[""],participationPercentage:["",[v.k0.min(1),v.k0.max(100)]],formId:[""],persons:this.fb.array([])});return this.applyConditionalValidators(r,c,o),null===(a=c.get("type"))||void 0===a||a.valueChanges.subscribe(s=>{this.applyConditionalValidators(r,c,s)}),null===(n=c.get("participationPercentage"))||void 0===n||n.valueChanges.subscribe(s=>{this.onParticipationPercentageChanged(s,c)}),c}onParticipationPercentageChanged(r,o){var a;let n=null===(a=o.get("formId"))||void 0===a?void 0:a.value;const s=100-this.contactFormArray.controls.reduce((p,C)=>{var y;return C.value.formId!==n?p+parseFloat((null===(y=C.get("participationPercentage"))||void 0===y?void 0:y.value)||"0"):p},0);var i;parseFloat(r||"0")>s&&(null===(i=o.get("participationPercentage"))||void 0===i||i.setValue(s,{emitEvent:!1}));const u=this.contactFormArray.controls.reduce((p,C)=>{var y;return p+parseFloat((null===(y=C.get("participationPercentage"))||void 0===y?void 0:y.value)||"0")},0);this.disabled=100!==u}applyConditionalValidators(r=!1,o,a){var n,c,s,l,i,u,p,C,y,P,S,T,O,D,R;if(null===(n=o.get("email"))||void 0===n||n.clearValidators(),null===(c=o.get("phoneNumber"))||void 0===c||c.clearValidators(),null===(s=o.get("birthDate"))||void 0===s||s.clearValidators(),null===(l=o.get("identityNumber"))||void 0===l||l.clearValidators(),null===(i=o.get("address"))||void 0===i||i.clearValidators(),null===(u=o.get("identityType"))||void 0===u||u.clearValidators(),"particular"!==a||r){if("particular"===a&&r){var _e,ge,Ce,fe,he;null===(_e=o.get("email"))||void 0===_e||_e.setValidators([v.k0.required,v.k0.email]),null===(ge=o.get("phoneNumber"))||void 0===ge||ge.setValidators([v.k0.required]),null===(Ce=o.get("birthDate"))||void 0===Ce||Ce.setValidators([v.k0.required]),null===(fe=o.get("identityNumber"))||void 0===fe||fe.setValidators([v.k0.required]),null===(he=o.get("identityType"))||void 0===he||he.setValidators([v.k0.required])}else if("empresa"===a){var ye,Pe;null===(ye=o.get("cif"))||void 0===ye||ye.setValidators([v.k0.required]),null===(Pe=o.get("participationPercentage"))||void 0===Pe||Pe.setValidators([v.k0.required,v.k0.min(1),v.k0.max(100)])}}else null===(P=o.get("email"))||void 0===P||P.setValidators([v.k0.required,v.k0.email]),null===(S=o.get("phoneNumber"))||void 0===S||S.setValidators([v.k0.required]),null===(T=o.get("birthDate"))||void 0===T||T.setValidators([v.k0.required]),null===(O=o.get("identityNumber"))||void 0===O||O.setValidators([v.k0.required]),null===(D=o.get("identityType"))||void 0===D||D.setValidators([v.k0.required]),null===(R=o.get("participationPercentage"))||void 0===R||R.setValidators([v.k0.required,v.k0.min(1),v.k0.max(100)]);null===(p=o.get("name"))||void 0===p||p.setValidators([v.k0.required]),null===(C=o.get("identityNumber"))||void 0===C||C.setValidators([v.k0.required]),null===(y=o.get("address"))||void 0===y||y.setValidators([v.k0.required])}removeCompany(r){var o=this;return(0,g.A)(function*(){let a=o.getPersons(r),n=o.getContactForm(r),c=!1;if(a.value.forEach(i=>{i.id&&(c=!0)}),n.value.id&&(c=!0),c){let i=yield o.openConfirmationModal();var s,l;if("delete"===(null==i?void 0:i.data))n.value.id&&(yield o.api.unlinkReserveContactToOperation(null===(s=o.operation)||void 0===s?void 0:s.id,n.value.id),yield o.api.unlinkBuyerContactToOperation(null===(l=o.operation)||void 0===l?void 0:l.id,n.value.id)),a.value.forEach(function(){var u=(0,g.A)(function*(p){var C,y,P;p.id&&(yield o.api.unlinkReserveContactToOperation(null===(C=o.operation)||void 0===C?void 0:C.id,p.id),yield o.api.unlinkBuyerContactToOperation(null===(y=o.operation)||void 0===y?void 0:y.id,p.id),n.value.id&&(yield o.api.removeContactRelation(p.id,null===(P=n.value)||void 0===P?void 0:P.id)))});return function(p){return u.apply(this,arguments)}}()),o.contactFormArray.removeAt(r)}else o.contactFormArray.removeAt(r)})()}getContactForm(r){return this.contactFormArray.at(r)}getPersons(r){return this.getContactForm(r).get("persons")}getCompanyPersonForm(r,o){return this.getPersons(r).at(o)}addPersonToCompany(r){this.getPersons(r).push(this.createContactForm(!0,"particular"))}removePersonFromCompany(r,o){var a=this;return(0,g.A)(function*(){let n=a.getCompanyPersonForm(r,o),c=a.getContactForm(r);if(n.value.id&&c.value.id){let u=yield a.openConfirmationModal();var s,l,i;"delete"===(null==u?void 0:u.data)&&(a.getPersons(r).removeAt(o),yield a.api.unlinkReserveContactToOperation(null===(s=a.operation)||void 0===s?void 0:s.id,n.value.id),yield a.api.unlinkBuyerContactToOperation(null===(l=a.operation)||void 0===l?void 0:l.id,n.value.id),yield a.api.removeContactRelation(n.value.id,null===(i=c.value)||void 0===i?void 0:i.id))}else a.getPersons(r).removeAt(o)})()}toggleCompanyPersonForm(r,o){var a;const n=this.getCompanyPersonForm(r,o);n.patchValue({showForm:!(null!==(a=n.get("showForm"))&&void 0!==a&&a.value)})}toggleCompanyForm(r){var o;const a=this.getContactForm(r);a.patchValue({showForm:!(null!==(o=a.get("showForm"))&&void 0!==o&&o.value)})}addNewForm(){this.contactFormArray.push(this.createContactForm(!1,"particular"))}ngAfterViewInit(){this.addressInput&&(this.autocomplete=new google.maps.places.Autocomplete(this.addressInput.nativeElement,{types:["geocode"],componentRestrictions:{country:"es"}}),this.autocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{const o=this.autocomplete.getPlace();if(!o.geometry)return;this.mapCenter={lat:o.geometry.location.lat(),lng:o.geometry.location.lng()},this.markerPosition=this.mapCenter,this.mapZoom=17;const a=o.formatted_address||o.name||"";this.contactForm.patchValue({address:a}),this.addressInput.nativeElement.value=a})}))}isControlInvalid(r,o){const a=r.get(o);return!(!a||!a.invalid||!a.dirty&&!a.touched)}onSelectCountry(r){console.log("Selected country prefix:",r);const o=null==r?void 0:r.phoneCode,a=this.contactForm.get("phoneNumber");if(!a)return;const c=(a.value||"").split(" ");c.shift();const s=c.join(" ");a.setValue(`${o} ${s}`)}onAddressSelected(r){console.log("Address selected:",r),this.contactForm.patchValue({address:(null==r?void 0:r.formatted_address)||(null==r?void 0:r.address)||""})}getAddressFromCoordinates(r,o){(new google.maps.Geocoder).geocode({location:{lat:r,lng:o}},(n,c)=>{"OK"===c&&n&&n[0]&&this.ngZone.run(()=>{const s=n[0].formatted_address;this.contactForm.patchValue({address:s}),this.addressInput&&(this.addressInput.nativeElement.value=s),this.markerPosition={lat:r,lng:o}})})}onPrevStep(){console.log("Going to previous step...")}onNextStep(){var r=this;return(0,g.A)(function*(){r.contactFormArray.invalid?r.contactFormArray.markAllAsTouched():(r.contactFormArray.controls.forEach((o,a)=>{"particular"===o.value.type?r.onSaveContact(a,!1):"empresa"===o.value.type&&r.getPersons(a).controls.forEach((c,s)=>{r.onSaveChildContact(a,s,!1)})}),r.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3}),r.selectContactData.emit())})()}onChangePersonType(r,o){const a=this.createContactForm(!1,o),n=this.contactFormArray.at(r).value;if("empresa"===o){let c=this.createContactForm(!0,"particular");c.patchValue({id:n.id||null,name:n.name||"",email:n.email||"",address:n.address||"",birthDate:n.birthDate||"",phoneNumber:n.phoneNumber||"+34 ",gender:n.gender||"male",showForm:!0,identityNumber:n.identityNumber,identityType:n.identityType,civilStatus:n.civilStatus}),a.patchValue({name:"",identityNumber:"",showForm:!0,participationPercentage:n.participationPercentage,formId:n.formId||1}),a.get("persons").push(c)}else{let c=n;Array.isArray(n.persons)&&n.persons.length>0&&(c=n.persons[0]),a.patchValue({id:c.id||null,parentContact:n||null,name:c.name||"",participationPercentage:n.participationPercentage,email:c.email||"",address:c.address||"",birthDate:c.birthDate||"",phoneNumber:c.phoneNumber||"+34 ",gender:c.gender||"male",formId:n.formId||1,identityNumber:c.identityNumber,identityType:c.identityType,civilStatus:c.civilStatus})}this.contactFormArray.setControl(r,a)}togglePersonForm(r){var o;const a=this.getContactForm(r);a.patchValue({showForm:!(null!==(o=a.get("showForm"))&&void 0!==o&&o.value)})}openConfirmationModal(){var r=this;return(0,g.A)(function*(){return yield r.modalsService.openConfirmationModal({title:"Eliminar contactos",message:"\xbfEst\xe1s seguro de que deseas eliminar los contactos seleccionados?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]})})()}removePerson(r){var o=this;return(0,g.A)(function*(){const a=o.getContactForm(r);if(a.value.id){let s=yield o.openConfirmationModal();var n,c;"delete"===(null==s?void 0:s.data)&&(yield o.api.unlinkReserveContactToOperation(null===(n=o.operation)||void 0===n?void 0:n.id,a.value.id),yield o.api.unlinkBuyerContactToOperation(null===(c=o.operation)||void 0===c?void 0:c.id,a.value.id),o.contactFormArray.removeAt(r))}else o.contactFormArray.removeAt(r)})()}onSaveChildContact(r,o,a=!0){var n=this;return(0,g.A)(function*(){var c,s;const l=n.getContactForm(r),i=n.getCompanyPersonForm(r,o);if(l.invalid)return void l.markAllAsTouched();let u=n.buildContactData(l.value),p=n.buildContactData(i.value),C=yield n.saveOrUpdateContact(i.value.id,p),y=yield n.saveOrUpdateContact(l.value.id,u),P=null==y||null===(c=y.success)||void 0===c||null===(c=c.data)||void 0===c?void 0:c.id,S=null==C||null===(s=C.success)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.id;var T,O,D,R;i.value.id||(yield n.api.addReserveContactToOperation(null===(T=n.operation)||void 0===T?void 0:T.id,S)),l.value.id||(yield n.api.addReserveContactToOperation(null===(O=n.operation)||void 0===O?void 0:O.id,P)),"buy"===n.screen&&(yield n.api.addBuyerContactToOperation(null===(D=n.operation)||void 0===D?void 0:D.id,P),yield n.api.addBuyerContactToOperation(null===(R=n.operation)||void 0===R?void 0:R.id,S)),yield n.api.addContactRelation(P,S,i.value.role),yield n.updateBuyersContactsPercentages(P,l.value.participationPercentage),a&&n.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3}),i.patchValue({showForm:!1})})()}onSaveContact(r,o=!0){var a=this;return(0,g.A)(function*(){const n=a.getContactForm(r);if(n.invalid)n.markAllAsTouched();else{if("particular"===n.value.type){var c,s;let S=a.buildContactData(n.value);var l,i,u,p,C;n.value.parentContact&&(yield a.api.unlinkReserveContactToOperation(null===(l=a.operation)||void 0===l?void 0:l.id,null===(i=n.value.parentContact)||void 0===i?void 0:i.id),yield a.api.unlinkBuyerContactToOperation(null===(u=a.operation)||void 0===u?void 0:u.id,null===(p=n.value.parentContact)||void 0===p?void 0:p.id),n.value.id&&(yield a.api.removeContactRelation(n.value.id,null===(C=n.value.parentContact)||void 0===C?void 0:C.id)));let T=yield a.saveOrUpdateContact(n.value.id,S),O=null==T||null===(c=T.success)||void 0===c?void 0:c.data.id;var y;yield a.api.addReserveContactToOperation(null===(s=a.operation)||void 0===s?void 0:s.id,O),"buy"===a.screen&&(yield a.api.addBuyerContactToOperation(null===(y=a.operation)||void 0===y?void 0:y.id,O)),yield a.updateBuyersContactsPercentages(O,n.value.participationPercentage),o&&a.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3})}else if("empresa"===n.value.type){var P;let S={name:n.value.name,type:n.value.type,identityNumber:n.value.identityNumber,address:n.value.address},O=(yield a.saveOrUpdateContact(n.value.id,S)).success.data.id;yield a.api.addReserveContactToOperation(null===(P=a.operation)||void 0===P?void 0:P.id,O)}n.patchValue({showForm:!1})}})()}saveOrUpdateContact(r,o){var a=this;return(0,g.A)(function*(){return r?yield a.api.updateContactById(r,o):yield a.api.createContact(o)})()}updateBuyersContactsPercentages(r,o){var a=this;return(0,g.A)(function*(){var n;let c=a.operation.buyersContactsPercentages;c?c[r]={percentage:o,order:1}:c={[r]:{percentage:o,order:1}},yield a.api.updateOperationById(null===(n=a.operation)||void 0===n?void 0:n.id,{buyersContactsPercentages:c})})()}buildContactData(r){if("particular"===r.type){const o=r.phoneNumber,a=r.email,n=[];o&&!n.includes(o)&&n.unshift(o);const c=[];return a&&!c.includes(a)&&c.unshift(a),{name:r.name,birthdate:new Date(r.birthDate),phones:n,emails:c,address:r.address,gender:r.gender,typeOfIdentification:r.identityType,dniPassport:r.identityNumber,type:r.type,civilStatus:r.civilStatus}}return{name:r.name,address:r.address,dniPassport:r.identityNumber,type:r.type}}}return(d=f).\u0275fac=function(r){return new(r||d)(e.rXU(v.ok),e.rXU(e.SKi),e.rXU(x.i),e.rXU(t.T),e.rXU(k.M),e.rXU(j.f))},d.\u0275cmp=e.VBU({type:d,selectors:[["app-venta-select-contact-data"]],viewQuery:function(r,o){if(1&r&&e.GBs(Z,5),2&r){let a;e.mGM(a=e.lsd())&&(o.addressInput=a.first)}},inputs:{contact:"contact",operationId:"operationId",operation:"operation",screen:"screen",contactData:"contactData",operationData:"operationData",reservedContacts:"reservedContacts"},outputs:{selectContactData:"selectContactData"},decls:12,vars:3,consts:[[1,"venta-component"],[1,"venta-component-body"],["class","content mt-15",4,"ngFor","ngForOf"],[1,"w-full"],["type","button",1,"crm-button-secondary","w-full","d-flex","justify-center","align-center",3,"click"],["alt","",1,"cursor-pointer",3,"src"],[1,"mt-10",2,"display","flex","gap","16px","justify-content","space-between"],["type","button",1,"crm-button-secondary","w-50p","d-block","text-center","border-primary",3,"click"],["type","submit",1,"crm-button","w-50p","d-block","text-center",3,"click","disabled"],[1,"content","mt-15"],[1,"",2,"border","1px solid #E0E0E0","width","100%","padding","6px","border-radius","20px","margin-bottom","16px"],[1,"d-flex","text-14"],[1,"cursor-pointer","w-50p","text-center",2,"padding","6px 10px","border-radius","20px",3,"click","ngStyle"],[1,"d-flex","justify-between"],[1,"title","mb-10"],[1,"text-14","text-secondary","font-weight-400"],[1,"cursor-pointer",3,"click"],[4,"ngIf"],[3,"hasParentContact","form"],[1,"mt-10",2,"gap","16px"],["type","submit",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"w-full","d-block","text-center","text-13","mt-15","text-secondary"],[1,"d-flex","justify-center","align-center"],[1,"d-flex","align-center","cursor-pointer",3,"click"],[2,"width","14px",3,"src"],[1,"ml-5"],[1,"title"],["alt","",1,"cursor-pointer",3,"click","src"],[3,"formGroup"],[1,"crm-input","w-50p",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","placeholder","Field","formControlName","name"],[1,"crm-input","w-50p","ml-10",2,"margin-bottom","8px"],["type","text","placeholder","Field","formControlName","address"],["type","text","placeholder","Field","formControlName","identityNumber"],["type","number","placeholder","%","formControlName","participationPercentage"],[4,"ngFor","ngForOf"],[1,"w-full","mt-20"],[1,"p-16","mt-10",2,"border","1px solid #EBEBEB","border-radius","12px"],["class","w-full  ",3,"formGroup",4,"ngIf"],[1,"w-full",3,"formGroup"],[1,"crm-input"],[1,"crm-input-input"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],[1,"d-flex","justify-between","mb-10"],[1,"d-flex","align-center"],["alt","",1,"cursor-pointer","ml-10",3,"src"],["alt","",1,"cursor-pointer","ml-10",3,"click","src"],["type","button",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"cursor-pointer","d-flex","align-center",3,"click"],[1,"cursor-pointer",2,"width","14px",3,"src"]],template:function(r,o){1&r&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,me,9,7,"div",2),e.j41(3,"div",3)(4,"button",4),e.bIt("click",function(){return o.addNewForm()}),e.nrm(5,"img",5),e.EFF(6," A\xf1adir otro comprador "),e.k0s()()(),e.j41(7,"div",6)(8,"button",7),e.bIt("click",function(){return o.onPrevStep()}),e.EFF(9," Anterior "),e.k0s(),e.j41(10,"button",8),e.bIt("click",function(){return o.onNextStep()}),e.EFF(11," Siguiente "),e.k0s()()()),2&r&&(e.R7$(2),e.Y8G("ngForOf",o.contactFormArray.controls),e.R7$(3),e.Y8G("src","assets/icon/user-plus-icon.svg",e.B4B),e.R7$(5),e.Y8G("disabled",o.disabled))},dependencies:[h.YU,h.Sq,h.bT,h.B3,v.qT,v.xH,v.y7,v.me,v.Q0,v.wz,v.BC,v.cb,v.j4,v.JD,A],styles:[".venta-component[_ngcontent-%COMP%]{max-width:500px}"]}),f})()},6915:(N,M,_)=>{_.r(M),_.d(M,{VentaOperationProcessPageModule:()=>a});var g=_(177),e=_(9417),v=_(9465),b=_(5188),x=_(467),t=_(3953),k=_(6039),j=_(8397),h=_(6906);function F(n,c){if(1&n){const s=t.RV6();t.j41(0,"button",19),t.bIt("click",function(){t.eBV(s);const i=t.XpG(2).$implicit,u=t.XpG();return t.Njj(u.onSelectPromotion(i))}),t.EFF(1," Seleccionada "),t.k0s()}}function E(n,c){if(1&n){const s=t.RV6();t.j41(0,"button",20),t.bIt("click",function(){t.eBV(s);const i=t.XpG(2).$implicit,u=t.XpG();return t.Njj(u.onSelectPromotion(i))}),t.EFF(1," Seleccionar "),t.k0s()}}function V(n,c){if(1&n&&(t.j41(0,"div",13)(1,"div",14),t.EFF(2),t.k0s(),t.j41(3,"div",15),t.EFF(4),t.k0s(),t.j41(5,"div",16),t.DNE(6,F,2,0,"button",17)(7,E,2,0,"button",18),t.k0s()()),2&n){const s=t.XpG().$implicit,l=t.XpG();t.R7$(2),t.SpI(" ",s.projectName," "),t.R7$(2),t.Lme(" ",s.availableProperties.length," / ",s.properties.length," "),t.R7$(2),t.vxM((null==l.selectedPromotion?null:l.selectedPromotion.id)===s.id?6:7)}}function Y(n,c){1&n&&t.DNE(0,V,8,4,"div",13),2&n&&t.vxM(c.$implicit.availableProperties.length?0:-1)}let $=(()=>{var n;class c{constructor(l){this.api=l,this.selectPromotion=new t.bkB,this.promotions=[],this.selectedPromotion=null,this.searchTerm="",this.responsibilityOptions=h.Rl}ngOnInit(){this.getAllPromotions()}getAllPromotions(){var l=this;return(0,x.A)(function*(){try{const i={page:0,itemsPerPage:500},u=yield l.api.getPromotions({},null,i,{properties:{apply:!0,filter:null,onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},promoter:{apply:!0,filter:null,onlyCount:!1}});null!=u&&u.success?(l.promotions=u.success.data,l.promotions.forEach(p=>{var C;p.availableProperties=null===(C=p.properties)||void 0===C?void 0:C.filter(y=>"available"===y.availabilityStatus)}),console.log("All Promotions:",l.promotions)):console.error("Error fetching promotions:",null==u?void 0:u.error)}catch(i){console.error("Error in getAllPromotions:",i)}})()}get filteredPromotions(){return this.promotions.filter(i=>{var u;return null===(u=i.projectName)||void 0===u?void 0:u.toLowerCase().includes(this.searchTerm.toLowerCase())})}onSelectPromotion(l){this.selectPromotion.emit(l),this.selectedPromotion=l}}return(n=c).\u0275fac=function(l){return new(l||n)(t.rXU(k.i))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-select-promotion"]],outputs:{selectPromotion:"selectPromotion"},decls:20,vars:2,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","300px","margin-bottom","16px"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar promoci\xf3n...",3,"ngModelChange","ngModel"],[1,"promotions-table"],[1,"promotions-table-header"],[1,"promotions-table-header-title"],[1,"promotions-table-header-availability"],[1,"promotions-table-header-actions"],[1,"promotions-table-footer"],[1,"promotions-table-row"],[1,"promotions-table-row-title"],[1,"promotions-table-row-availability"],[1,"promotions-table-row-actions"],["disabled","",1,"crm-button"],[1,"crm-button"],["disabled","",1,"crm-button",3,"click"],[1,"crm-button",3,"click"]],template:function(l,i){1&l&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," 1. Promoci\xf3n "),t.k0s(),t.j41(3,"div",2)(4,"div",3)(5,"div",4),t.nrm(6,"i",5),t.j41(7,"input",6),t.mxI("ngModelChange",function(p){return t.DH7(i.searchTerm,p)||(i.searchTerm=p),p}),t.k0s()()(),t.j41(8,"div",7)(9,"div",8)(10,"div",9),t.EFF(11,"Promoci\xf3n"),t.k0s(),t.j41(12,"div",10),t.EFF(13,"Viviendas disponibles"),t.k0s(),t.j41(14,"div",11),t.EFF(15,"Acciones"),t.k0s()(),t.Z7z(16,Y,1,1,null,null,t.fX1),t.k0s(),t.j41(18,"div",12),t.EFF(19),t.k0s()()()),2&l&&(t.R7$(7),t.R50("ngModel",i.searchTerm),t.R7$(9),t.Dyx(i.filteredPromotions),t.R7$(3),t.SpI(" Total promociones: ",i.filteredPromotions.length," "))},dependencies:[e.me,e.BC,e.vS]}),c})();var B=_(7376),U=_(1296),z=_(6552),W=_(1880);function K(n,c){if(1&n){const s=t.RV6();t.qex(0),t.j41(1,"div",4),t.EFF(2),t.k0s(),t.j41(3,"app-table",5),t.bIt("rowClicked",function(i){t.eBV(s);const u=t.XpG();return t.Njj(u.onRowClicked(i))}),t.k0s(),t.nrm(4,"div",6),t.bVm()}if(2&n){const s=c.$implicit,l=c.index;t.R7$(2),t.SpI(" ",s.name||"Bloque "+(s.index||l+1)," "),t.R7$(),t.Y8G("table",s.tableConfig)}}let q=(()=>{var n;class c{constructor(l,i,u){this.tableService=l,this.utils=i,this.toastService=u,this.selectProperty=new t.bkB,this.blocks=[],this.allColumnsKeysSelected=["externalReference","reference","m2useful","m2total","terrace","plot","bedrooms","bathrooms","pool","storage","parking","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!1,editCellsMode:!1,columns:[{key:"externalReference",label:"Ref. externa",size:"medium",editMode:{inputType:"text"}},{key:"reference",label:"Identificador",size:"medium",editMode:{inputType:"text"}},{key:"m2useful",label:"M2 \xfatiles",size:"small",extraString:" m\xb2",fn:p=>null!=p&&p.totalMeasures_squareMetersUseful?p.totalMeasures_squareMetersUseful+" m\xb2":""},{key:"m2total",label:"M2 total",size:"small",extraString:" m\xb2",fn:p=>null!=p&&p.totalMeasures_squareMetersBuilt?p.totalMeasures_squareMetersBuilt+" m\xb2":""},{key:"terrace",label:"Terraza",size:"small",fn:p=>{const P=(p.totalMeasures_squareMetersCoveredTerraces||0)+(p.totalMeasures_squareMetersUncoveredTerraces||0);return P?P+" m\xb2":""}},{key:"plot",label:"Parcela",size:"small",extraString:" m\xb2",fn:p=>null!=p&&p.totalMeasures_squareMetersPatch?p.totalMeasures_squareMetersPatch+" m\xb2":""},{key:"bedrooms",label:"Dorm.",size:"small"},{key:"bathrooms",label:"Ba\xf1os",size:"small"},{key:"pool",label:"Piscina",size:"small",fn:p=>p.f_pool_comunitaria?"Comunitaria":p.f_pool_privada?"Privada":"No"},{key:"storage",label:"Trastero",size:"small",fn:p=>p.fcustom_trastero?p.fcustom_trasteroPrice?this.utils.transformThousandSeparator(p.fcustom_trasteroPrice)+" \u20ac":p.fcustom_trasteroIncludedInPrice?"Incluido":"S\xed":"No"},{key:"parking",label:"Parking",size:"small",fn:p=>{let C=p.fcustom_parking?"S\xed":"No";return p.fcustom_parkingPrice&&(C=this.utils.transformThousandSeparator(p.fcustom_parkingPrice)+" \u20ac"),p.fcustom_parkingIncludedInPrice&&(C="Incluido"),p.fcustom_parkingComunitario&&(C+=" (Comunitario)"),C}},{key:"price",label:"Precio",size:"small",fn:p=>null!=p&&p.price?this.utils.transformThousandSeparator(p.price)+" \u20ac":""}],rows:[]}}ngOnInit(){}set selectedPromotion(l){this.promotion=l,this.getData()}getData(){var l;if(this.promotion){this.allColumnsKeysSelected=(null===(l=this.promotion)||void 0===l?void 0:l.tableColumnsKeysSelected)||this.allColumnsKeysSelected,this.blocks=this.promotion.promotionBlocks||[];for(let i=0;i<this.blocks.length;i++){const u=this.blocks[i];!u.properties||0===u.properties.length||(u.tableConfig=B.cloneDeep(this.tableConfig),u.tableConfig.rows=this.tableService.convertDataToTableRows(B.cloneDeep(u.properties),B.cloneDeep(u.tableConfig)),u.tableConfig.rows=this.addBackgroundColorsToTableRows(u.tableConfig.rows))}}}addBackgroundColorsToTableRows(l){for(let i=0;i<l.length;i++)switch(l[i].rawObject.availabilityStatus){case"available":l[i].style={backgroundColor:"success"};break;case"sold":l[i].style={backgroundColor:"red"};break;case"reserved":l[i].style={backgroundColor:"warning"};break;default:l[i].style={backgroundColor:"blocked"}}return l}onRowClicked(l){const i=l.rawObject;console.log("Row clicked, property:",i),this.selectProperty.emit(i)}}return(n=c).\u0275fac=function(l){return new(l||n)(t.rXU(U.a),t.rXU(z.T),t.rXU(j.f))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-select-property"]],outputs:{selectProperty:"selectProperty"},decls:5,vars:1,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[4,"ngFor","ngForOf"],[1,"block-title"],[2,"margin-bottom","16px",3,"rowClicked","table"],[2,"margin-bottom","16px"]],template:function(l,i){1&l&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," 2. Vivienda principal "),t.k0s(),t.j41(3,"div",2),t.DNE(4,K,5,2,"ng-container",3),t.k0s()()),2&l&&(t.R7$(4),t.Y8G("ngForOf",i.blocks))},dependencies:[g.Sq,W.O],styles:[".block-title[_ngcontent-%COMP%]{margin-bottom:16px;font-size:14px;font-weight:500}"]}),c})();var w=_(4558);function L(n,c){if(1&n&&(t.j41(0,"option",21),t.EFF(1),t.k0s()),2&n){const s=c.$implicit;t.Y8G("value",s),t.R7$(),t.JRh(s)}}function J(n,c){if(1&n){const s=t.RV6();t.j41(0,"div",22),t.bIt("click",function(){t.eBV(s);const i=t.XpG();return t.Njj(i.editingPrice=!0)}),t.EFF(1),t.nI1(2,"thousandSeparator"),t.nrm(3,"i",23),t.k0s()}if(2&n){const s=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,1,s.priceSelected.priceWithoutIva)," \u20ac ")}}function H(n,c){if(1&n){const s=t.RV6();t.j41(0,"div",24)(1,"input",25),t.mxI("ngModelChange",function(i){t.eBV(s);const u=t.XpG();return t.DH7(u.priceSelected.priceWithoutIva,i)||(u.priceSelected.priceWithoutIva=i),t.Njj(i)}),t.k0s(),t.j41(2,"i",26),t.bIt("click",function(){t.eBV(s);const i=t.XpG();return t.Njj(i.onPriceConfirm())}),t.k0s()()}if(2&n){const s=t.XpG();t.R7$(),t.R50("ngModel",s.priceSelected.priceWithoutIva)}}let Q=(()=>{var n;class c{constructor(){this.selectPrice=new t.bkB,this.priceSelected={priceWithoutIva:0,priceWithIva:0,finalPrice:0,iva:10},this.taxRates=["0%","10%","21%"],this.selectedTaxRate="10%",this.editingPrice=!1}set selectedProperty(l){this.property=l,this.priceSelected.priceWithoutIva=(null==l?void 0:l.price)||0,this.updateCalculations()}ngOnInit(){this.updateCalculations()}onTaxRateChange(){this.updateCalculations()}onPriceConfirm(){this.updateCalculations(),this.editingPrice=!1}updateCalculations(){const l=parseFloat(this.selectedTaxRate);this.priceSelected.iva=isNaN(l)?0:l,this.priceSelected.priceWithIva=this.priceSelected.priceWithoutIva*(this.priceSelected.iva/100),this.priceSelected.finalPrice=this.priceSelected.priceWithoutIva+this.priceSelected.priceWithIva}goNextSection(){this.selectPrice.emit(this.priceSelected),console.log("Go to the next section...")}}return(n=c).\u0275fac=function(l){return new(l||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-select-price"]],outputs:{selectPrice:"selectPrice"},decls:48,vars:17,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","200px","margin-bottom","24px"],[1,"crm-input-label"],[1,"crm-input-input","crm-input-input-searchbar-square"],[3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"title",2,"margin-bottom","8px"],[1,"price-table-header",2,"padding","0px 16px"],[1,"price-table-header-cell"],[1,"price-table"],[1,"price-table-row"],[1,"price-table-cell"],[1,"price-table-cell","editable-cell"],["class","editable-price-display",3,"click",4,"ngIf"],["class","editable-price-edit",4,"ngIf"],[1,"price-table-footer"],[1,"price-table-footer-cell"],[1,"crm-block-buttons-right",2,"margin-top","16px"],[1,"crm-button",3,"click"],[3,"value"],[1,"editable-price-display",3,"click"],[1,"fas","fa-pencil",2,"color","rgb(130, 130, 130)"],[1,"editable-price-edit"],["type","number",3,"ngModelChange","ngModel"],[1,"fas","fa-check",2,"color","rgb(11, 169, 11)",3,"click"]],template:function(l,i){1&l&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," 3. Por precio "),t.k0s(),t.j41(3,"div",2)(4,"div",3)(5,"div",4),t.EFF(6," Impuestos IVA/IT "),t.k0s(),t.j41(7,"div",5)(8,"select",6),t.mxI("ngModelChange",function(p){return t.DH7(i.selectedTaxRate,p)||(i.selectedTaxRate=p),p}),t.bIt("change",function(){return i.onTaxRateChange()}),t.DNE(9,L,2,2,"option",7),t.k0s()()(),t.j41(10,"div",8),t.EFF(11," Tabla de precios "),t.k0s(),t.j41(12,"div",9)(13,"div",10),t.EFF(14,"Vivienda"),t.k0s(),t.j41(15,"div",10),t.EFF(16,"Precio"),t.k0s(),t.j41(17,"div",10),t.EFF(18,"IVA/ITP"),t.k0s(),t.j41(19,"div",10),t.EFF(20,"PVP"),t.k0s()(),t.j41(21,"div",11)(22,"div",12)(23,"div",13),t.EFF(24," 1A "),t.k0s(),t.j41(25,"div",14),t.DNE(26,J,4,3,"div",15)(27,H,3,1,"div",16),t.k0s(),t.j41(28,"div",13),t.EFF(29),t.k0s(),t.j41(30,"div",13),t.EFF(31),t.nI1(32,"thousandSeparator"),t.k0s()(),t.j41(33,"div",17)(34,"div",18),t.EFF(35," Total "),t.k0s(),t.j41(36,"div",18),t.EFF(37),t.nI1(38,"thousandSeparator"),t.k0s(),t.j41(39,"div",18),t.EFF(40),t.nI1(41,"thousandSeparator"),t.k0s(),t.j41(42,"div",18),t.EFF(43),t.nI1(44,"thousandSeparator"),t.k0s()()(),t.j41(45,"div",19)(46,"button",20),t.bIt("click",function(){return i.goNextSection()}),t.EFF(47," Ir a la siguiente secci\xf3n "),t.k0s()()()()),2&l&&(t.R7$(8),t.R50("ngModel",i.selectedTaxRate),t.R7$(),t.Y8G("ngForOf",i.taxRates),t.R7$(17),t.Y8G("ngIf",!i.editingPrice),t.R7$(),t.Y8G("ngIf",i.editingPrice),t.R7$(2),t.SpI(" ",i.selectedTaxRate," "),t.R7$(2),t.SpI(" ",t.bMT(32,9,i.priceSelected.finalPrice)," \u20ac "),t.R7$(6),t.SpI(" ",t.bMT(38,11,i.priceSelected.priceWithoutIva)," \u20ac "),t.R7$(3),t.SpI(" ",t.bMT(41,13,i.priceSelected.priceWithIva)," \u20ac "),t.R7$(3),t.SpI(" ",t.bMT(44,15,i.priceSelected.finalPrice)," \u20ac "))},dependencies:[g.Sq,g.bT,e.xH,e.y7,e.me,e.Q0,e.wz,e.BC,e.vS,w.w],styles:[".venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .crm-input[_ngcontent-%COMP%]{margin-bottom:16px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]   .price-table-header-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]{border-radius:12px;padding:0 16px;background:#f9f9f9}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 0;border-bottom:1px solid var(--crm-border-light-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{font-weight:500;border:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-cell[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-cell[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]{display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:120px;background:#fff;outline:none;border:1px solid var(--crm-border-light-color);border-radius:8px;padding:4px 8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--crm-text-color);cursor:pointer}"]}),c})();const A=n=>({"text-error-important":n}),Z=n=>({"text-error":n}),X=n=>({"border-error":n});let G=(()=>{var n;class c{constructor(){this.reservationAmount=0,this.selectDocumentData=new t.bkB,this.errors=[],this.formData={contractType:"",signatureType:"",reservationAmount:this.reservationAmount}}ngOnInit(){}onContinue(){this.errors=[],this.formData.reservationAmount||this.errors.push("reservationAmount"),this.formData.contractType||this.errors.push("contractType"),this.formData.signatureType||this.errors.push("signatureType"),this.errors.length||this.selectDocumentData.emit(this.formData)}ngOnChanges(l){this.formData.reservationAmount=this.reservationAmount}}return(n=c).\u0275fac=function(l){return new(l||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-select-document"]],inputs:{reservationAmount:"reservationAmount"},outputs:{selectDocumentData:"selectDocumentData"},features:[t.OA$],decls:44,vars:15,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"margin-bottom","16px"],[1,"crm-text",3,"ngClass"],[3,"ngModelChange","ngModel"],[1,"crm-input-radio"],["value","byvaro"],[1,"crm-input-radio-label"],["value","propio"],[2,"border","none","border-bottom","1px solid #e5e5e5","margin","24px 0"],["value","electronica"],["value","papel"],[1,"title","mb8"],[1,"crm-text","small","light","mb16"],[1,"crm-input",2,"margin-bottom","24px","max-width","300px"],[1,"crm-input-label",3,"ngClass"],[1,"crm-input-input",3,"ngClass"],["type","number","placeholder","Por ejemplo 3000\u20ac",3,"ngModelChange","ngModel"],[1,"crm-block-buttons-right"],[1,"crm-button",3,"click"]],template:function(l,i){1&l&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," 4. Documento de reserva "),t.k0s(),t.j41(3,"div",2)(4,"div",3)(5,"div",4),t.EFF(6," Redacci\xf3n del contrato: "),t.k0s(),t.j41(7,"ion-radio-group",5),t.mxI("ngModelChange",function(p){return t.DH7(i.formData.contractType,p)||(i.formData.contractType=p),p}),t.j41(8,"div",6),t.nrm(9,"ion-radio",7),t.j41(10,"div",8),t.EFF(11," Contrato redactado en Byvaro "),t.k0s()(),t.j41(12,"div",6),t.nrm(13,"ion-radio",9),t.j41(14,"div",8),t.EFF(15," Contrato propio "),t.k0s()()()(),t.nrm(16,"hr",10),t.j41(17,"div",3)(18,"div",4),t.EFF(19," T\xe9rminos y condiciones de la firma: "),t.k0s(),t.j41(20,"ion-radio-group",5),t.mxI("ngModelChange",function(p){return t.DH7(i.formData.signatureType,p)||(i.formData.signatureType=p),p}),t.j41(21,"div",6),t.nrm(22,"ion-radio",11),t.j41(23,"div",8),t.EFF(24," Firma electr\xf3nica "),t.k0s()(),t.j41(25,"div",6),t.nrm(26,"ion-radio",12),t.j41(27,"div",8),t.EFF(28," Firma en papel "),t.k0s()()()(),t.nrm(29,"hr",10),t.j41(30,"div",13),t.EFF(31," Cantidad que debe pagar el cliente para reservar: "),t.k0s(),t.j41(32,"div",14),t.EFF(33," Este campo puede heredar autom\xe1ticamente el valor definido en la configuraci\xf3n de la promoci\xf3n."),t.nrm(34,"br"),t.EFF(35," Por favor, rev\xedsalo antes de continuar. "),t.k0s(),t.j41(36,"div",15)(37,"div",16),t.EFF(38," Cantidad de reserva (\u20ac) "),t.k0s(),t.j41(39,"div",17)(40,"input",18),t.mxI("ngModelChange",function(p){return t.DH7(i.formData.reservationAmount,p)||(i.formData.reservationAmount=p),p}),t.k0s()()(),t.j41(41,"div",19)(42,"button",20),t.bIt("click",function(){return i.onContinue()}),t.EFF(43," Continuar la reserva "),t.k0s()()()()),2&l&&(t.R7$(5),t.Y8G("ngClass",t.eq3(7,A,i.errors.includes("contractType"))),t.R7$(2),t.R50("ngModel",i.formData.contractType),t.R7$(11),t.Y8G("ngClass",t.eq3(9,A,i.errors.includes("signatureType"))),t.R7$(2),t.R50("ngModel",i.formData.signatureType),t.R7$(17),t.Y8G("ngClass",t.eq3(11,Z,i.errors.includes("reservationAmount"))),t.R7$(2),t.Y8G("ngClass",t.eq3(13,X,i.errors.includes("reservationAmount"))),t.R7$(),t.R50("ngModel",i.formData.reservationAmount))},dependencies:[g.YU,e.me,e.Q0,e.BC,e.vS,v.KO,v.f0,v.Je],styles:[".crm-text[_ngcontent-%COMP%]{font-style:normal;margin-bottom:8px}.crm-input-radio[_ngcontent-%COMP%]{margin-bottom:8px}ion-radio-group[_ngcontent-%COMP%]{display:flex;gap:16px}.mb8[_ngcontent-%COMP%]{margin-bottom:8px}.mb16[_ngcontent-%COMP%]{margin-bottom:16px}"]}),c})();var ee=_(7700);const te=["selectPropertyComponent"],ne=["selectPriceComponent"],I=n=>({"hidden-step":n}),oe=(n,c)=>({"crm-steps-container-step-current":n,"crm-steps-container-step-inactive":c});function ie(n,c){1&n&&t.nrm(0,"i",24)}function re(n,c){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const s=t.XpG().index;t.R7$(),t.JRh(s+1)}}function ae(n,c){1&n&&t.nrm(0,"div",25)}function le(n,c){if(1&n&&(t.j41(0,"div",18)(1,"div",19),t.DNE(2,ie,1,0,"i",20)(3,re,2,1,"span",21),t.k0s(),t.j41(4,"div",22),t.EFF(5),t.k0s(),t.DNE(6,ae,1,0,"div",23),t.k0s()),2&n){const s=c.$implicit,l=c.index,i=t.XpG();t.Y8G("ngClass",t.l_i(5,oe,l==i.activeIndex,l>i.activeIndex)),t.R7$(2),t.Y8G("ngIf",l<i.activeIndex),t.R7$(),t.Y8G("ngIf",l>=i.activeIndex),t.R7$(2),t.JRh(s),t.R7$(),t.Y8G("ngIf",l<i.steps.length-1)}}function se(n,c){if(1&n){const s=t.RV6();t.j41(0,"div",28)(1,"div",29)(2,"div",30),t.EFF(3," 1. Promoci\xf3n "),t.k0s(),t.j41(4,"div",31),t.bIt("click",function(){t.eBV(s);const i=t.XpG(2);return t.Njj(i.changeStep(0))}),t.nrm(5,"i",32),t.k0s()(),t.j41(6,"div",33),t.EFF(7),t.k0s()()}if(2&n){const s=t.XpG(2);t.R7$(7),t.SpI(" ",null==s.data||null==s.data.promotion?null:s.data.promotion.projectName," ")}}function ce(n,c){if(1&n){const s=t.RV6();t.j41(0,"div",28)(1,"div",29)(2,"div",30),t.EFF(3," 2. Vivienda principal "),t.k0s(),t.j41(4,"div",31),t.bIt("click",function(){t.eBV(s);const i=t.XpG(2);return t.Njj(i.changeStep(1))}),t.nrm(5,"i",32),t.k0s()(),t.j41(6,"div",33),t.EFF(7),t.k0s()()}if(2&n){const s=t.XpG(2);t.R7$(7),t.SpI(" ",null==s.data||null==s.data.property?null:s.data.property.reference," ")}}function de(n,c){if(1&n){const s=t.RV6();t.j41(0,"div",28)(1,"div",29)(2,"div",30),t.EFF(3," 3. Por precio "),t.k0s(),t.j41(4,"div",31),t.bIt("click",function(){t.eBV(s);const i=t.XpG(2);return t.Njj(i.changeStep(2))}),t.nrm(5,"i",32),t.k0s()(),t.j41(6,"div",33),t.EFF(7),t.nI1(8,"thousandSeparator"),t.k0s()()}if(2&n){const s=t.XpG(2);t.R7$(7),t.SpI(" ",t.bMT(8,1,null==s.data||null==s.data.priceSelected?null:s.data.priceSelected.finalPrice)," \u20ac ")}}function pe(n,c){if(1&n){const s=t.RV6();t.j41(0,"div",28)(1,"div",29)(2,"div",30),t.EFF(3," 4. Documento de reserva "),t.k0s(),t.j41(4,"div",31),t.bIt("click",function(){t.eBV(s);const i=t.XpG(2);return t.Njj(i.changeStep(3))}),t.nrm(5,"i",32),t.k0s()(),t.j41(6,"div",33),t.EFF(7),t.k0s()()}if(2&n){const s=t.XpG(2);t.R7$(7),t.SpI(" ",null==s.data||null==s.data.documentData?null:s.data.documentData.contractType," ")}}function ue(n,c){if(1&n&&(t.j41(0,"div",26),t.DNE(1,se,8,1,"div",27)(2,ce,8,1,"div",27)(3,de,9,3,"div",27)(4,pe,8,1,"div",27),t.k0s()),2&n){const s=t.XpG();t.R7$(),t.Y8G("ngIf",null==s.data?null:s.data.promotion),t.R7$(),t.Y8G("ngIf",null==s.data?null:s.data.property),t.R7$(),t.Y8G("ngIf",null==s.data||null==s.data.priceSelected?null:s.data.priceSelected.finalPrice),t.R7$(),t.Y8G("ngIf",null==s.data?null:s.data.documentData)}}const me=[{path:"",component:(()=>{var n;class c{constructor(l,i,u,p){this.api=l,this.route=i,this.toast=u,this.router=p,this.reservationPayment=0,this.data={promotion:null,property:null,priceSelected:{priceWithoutIva:null,priceWithIva:null,finalPrice:null,iva:10},documentData:null},this.steps=["Promoci\xf3n","Vivienda principal","Por precio","Documento de reserva","Datos del cliente"],this.activeIndex=0,this.reservedContacts=[]}ngOnInit(){const l=this.route.snapshot.paramMap.get("operationId");l?this.api.getOperation({id:{equals:l}},null,null,{contact:{apply:!0,filter:null,onlyCount:!1},createdBy:{apply:!0,filter:null,onlyCount:!1},responsible:{apply:!0,filter:null,onlyCount:!1},mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1},selectedProperties:{apply:!0,filter:null,onlyCount:!1},notes:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1},operationRegisters:{apply:!0,filter:null,onlyCount:!1}}).then(i=>{i.success&&i.success.data&&i.success.data.length&&(this.operation=i.success.data[0],this.api.getOperationById(l).then(u=>{u.success&&u.success.data&&u.success.data.reserveContacts.length&&(this.reservedContacts=u.success.data.reserveContacts)}))}).catch(i=>{console.error("Error retrieving operation:",i)}):console.warn("No operationId parameter found in the URL.")}onSelectPromotion(l){var i=this;return(0,x.A)(function*(){var u;i.data.promotion=l,i.activeIndex=1;const p=yield i.api.getPromotionFullDataById(i.data.promotion.id);i.data.promotion=null==p||null===(u=p.success)||void 0===u?void 0:u.data,i.selectPropertyComponent.selectedPromotion=i.data.promotion})()}onSelectProperty(l){var i=this;return(0,x.A)(function*(){i.data.property=l,i.selectPriceComponent.selectedProperty=l,i.activeIndex=2})()}onSelectPrice(l){var i;this.data.priceSelected=l,this.reservationPayment=null===(i=this.operation)||void 0===i||null===(i=i.mainProperty)||void 0===i||null===(i=i.promotion)||void 0===i?void 0:i.reservePayment,this.activeIndex=3}onSelectDocumentData(l){this.data.documentData=l,this.activeIndex=4}onSelectContactData(){console.log("Contact data selected:",this.data.documentData),this.finishFlow()}finishFlow(){var l=this;return(0,x.A)(function*(){const i={propertyId:l.data.property.id,operationId:l.operation.id,priceSelected:l.data.priceSelected,documentData:l.data.documentData};(yield l.api.reserveProperty(i)).success?(l.toast.showSuccessToast("Reserva realizada correctamente"),l.router.navigate(["/contacts",l.operation.contactId,"operations",l.operation.id])):l.toast.showErrorToast("Error al realizar la reserva")})()}changeStep(l){this.activeIndex=l,0===l&&(this.data.property=null,this.data.priceSelected=null,this.data.documentData=null,this.selectPropertyComponent.selectedPromotion=null),1===l&&(this.data.priceSelected=null,this.data.documentData=null,this.selectPriceComponent.selectedProperty=null),console.log("DATAAAA",this.data)}}return(n=c).\u0275fac=function(l){return new(l||n)(t.rXU(k.i),t.rXU(b.nX),t.rXU(j.f),t.rXU(b.Ix))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-operation-process"]],viewQuery:function(l,i){if(1&l&&(t.GBs(te,7),t.GBs(ne,7)),2&l){let u;t.mGM(u=t.lsd())&&(i.selectPropertyComponent=u.first),t.mGM(u=t.lsd())&&(i.selectPriceComponent=u.first)}},decls:22,vars:22,consts:[["selectPropertyComponent",""],["selectPriceComponent",""],["selectClientComponent",""],[3,"fullscreen"],[1,"crm-block-content"],[1,"crm-block-body"],[1,"crm-block-body-blue-content"],[1,"crm-steps-container"],["class","crm-steps-container-step",3,"ngClass",4,"ngFor","ngForOf"],[1,"venta-body"],[1,"venta-body-component"],[3,"ngClass"],[3,"selectPromotion"],[3,"selectProperty"],[3,"selectPrice"],[3,"selectDocumentData","reservationAmount"],[3,"selectContactData","contactData","reservedContacts","operationData"],["class","steps-cards-body",4,"ngIf"],[1,"crm-steps-container-step",3,"ngClass"],[1,"crm-steps-container-step-circle"],["class","fa fa-check",4,"ngIf"],[4,"ngIf"],[1,"crm-steps-container-step-label"],["class","crm-steps-container-step-separator",4,"ngIf"],[1,"fa","fa-check"],[1,"crm-steps-container-step-separator"],[1,"steps-cards-body"],["class","steps-cards-body-card",4,"ngIf"],[1,"steps-cards-body-card"],[1,"steps-cards-body-card-header"],[1,"steps-cards-body-card-header-title"],[1,"steps-cards-body-card-header-icon",3,"click"],[1,"fa-solid","fa-pencil"],[1,"steps-cards-body-card-text"]],template:function(l,i){if(1&l){const u=t.RV6();t.j41(0,"ion-content",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),t.DNE(5,le,7,8,"div",8),t.k0s(),t.j41(6,"div",9)(7,"div",10)(8,"div",11)(9,"app-venta-select-promotion",12),t.bIt("selectPromotion",function(C){return t.eBV(u),t.Njj(i.onSelectPromotion(C))}),t.k0s()(),t.j41(10,"div",11)(11,"app-venta-select-property",13,0),t.bIt("selectProperty",function(C){return t.eBV(u),t.Njj(i.onSelectProperty(C))}),t.k0s()(),t.j41(13,"div",11)(14,"app-venta-select-price",14,1),t.bIt("selectPrice",function(C){return t.eBV(u),t.Njj(i.onSelectPrice(C))}),t.k0s()(),t.j41(16,"div",11)(17,"app-venta-select-document",15,2),t.bIt("selectDocumentData",function(C){return t.eBV(u),t.Njj(i.onSelectDocumentData(C))}),t.k0s()(),t.j41(19,"div",11)(20,"app-venta-select-contact-data",16),t.bIt("selectContactData",function(){return t.eBV(u),t.Njj(i.onSelectContactData())}),t.k0s()()(),t.DNE(21,ue,5,4,"div",17),t.k0s()()()()()}2&l&&(t.Y8G("fullscreen",!0),t.R7$(5),t.Y8G("ngForOf",i.steps),t.R7$(3),t.Y8G("ngClass",t.eq3(12,I,0!==i.activeIndex)),t.R7$(2),t.Y8G("ngClass",t.eq3(14,I,1!==i.activeIndex)),t.R7$(3),t.Y8G("ngClass",t.eq3(16,I,2!==i.activeIndex)),t.R7$(3),t.Y8G("ngClass",t.eq3(18,I,3!==i.activeIndex)),t.R7$(),t.Y8G("reservationAmount",i.reservationPayment),t.R7$(2),t.Y8G("ngClass",t.eq3(20,I,4!==i.activeIndex)),t.R7$(),t.Y8G("contactData",null==i.operation?null:i.operation.contact)("reservedContacts",i.reservedContacts)("operationData",i.operation),t.R7$(),t.Y8G("ngIf",null==i.data?null:i.data.promotion))},dependencies:[g.YU,g.Sq,g.bT,v.W9,$,q,Q,G,ee.K,w.w],styles:[".crm-steps-container[_ngcontent-%COMP%], .crm-steps-container-step[_ngcontent-%COMP%]{display:flex;align-items:center}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#3a50e4;border:1px solid #3A50E4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#3a50e4}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#a8a8a8;border:1px solid rgb(168,168,168)}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#a8a8a8}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#a8a8a8}.crm-steps-container-step-circle[_ngcontent-%COMP%]{width:21px;min-width:21px;height:21px;min-height:21px;border-radius:50%;background:#3a50e4;color:#fff;display:flex;justify-content:center;align-items:center;font-weight:700;font-size:12px;margin-right:8px}.crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4;font-weight:500;margin-right:16px;font-size:13px}.crm-steps-container-step-separator[_ngcontent-%COMP%]{width:20px;height:1px;background:#3a50e4;margin-right:16px}.hidden-step[_ngcontent-%COMP%]{height:0;overflow:hidden;opacity:0;position:absolute;width:0;visibility:hidden}.steps-cards-body[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:16px}.steps-cards-body-card[_ngcontent-%COMP%]{border:1px solid var(--crm-border-light-color);border-radius:6px;padding:12px}.steps-cards-body-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--crm-border-light-color);padding-bottom:16px}.steps-cards-body-card-header-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:var(--crm-text-color)}.steps-cards-body-card-header-icon[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;color:var(--crm-text-color)}.steps-cards-body-card-text[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color);padding-top:16px}.venta-body[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px}.venta-body[_ngcontent-%COMP%]   .steps-cards-body[_ngcontent-%COMP%]{min-width:300px;width:300px;flex-shrink:0}.venta-body-component[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;overflow-y:auto}"]}),c})()}];let ve=(()=>{var n;class c{}return(n=c).\u0275fac=function(l){return new(l||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.iI.forChild(me),b.iI]}),c})();var d=_(3895),f=_(9662),m=_(6812),r=_(969),o=_(8147);let a=(()=>{var n;class c{}return(n=c).\u0275fac=function(l){return new(l||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[g.MD,e.YN,v.bv,e.X1,ve,d.b,f.Y,m.u,r.rJ,o.h]}),c})()},9662:(N,M,_)=>{_.d(M,{Y:()=>v});var g=_(177),e=_(3953);let v=(()=>{var b;class x{}return(b=x).\u0275fac=function(k){return new(k||b)},b.\u0275mod=e.$C({type:b}),b.\u0275inj=e.G2t({imports:[g.MD]}),x})()}}]);