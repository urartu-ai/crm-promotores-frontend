"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7306],{8129:(U,T,o)=>{o.d(T,{K:()=>g});var c=o(3953);let g=(()=>{var m;class v{constructor(r,f){this.el=r,this.renderer=f,this.isLoading=!1}ngOnChanges(r){"isLoading"in r&&this.updateButtonState()}updateButtonState(){const r=this.el.nativeElement;if(this.isLoading){r.getAttribute("data-original-content")||this.renderer.setAttribute(r,"data-original-content",r.innerHTML),this.renderer.setProperty(r,"disabled",!0),this.renderer.setStyle(r,"opacity","0.6"),this.renderer.setStyle(r,"pointer-events","none"),this.renderer.setStyle(r,"cursor","not-allowed");const f=this.renderer.createElement("ion-spinner"),L=this.renderer.createText(" Cargando...");this.renderer.setProperty(r,"innerHTML",""),this.renderer.appendChild(r,f),this.renderer.appendChild(r,L)}else{this.renderer.setProperty(r,"disabled",!1),this.renderer.removeStyle(r,"opacity"),this.renderer.removeStyle(r,"pointer-events"),this.renderer.removeStyle(r,"cursor");const f=r.getAttribute("data-original-content");f&&(this.renderer.setProperty(r,"innerHTML",f),this.renderer.removeAttribute(r,"data-original-content"))}}}return(m=v).\u0275fac=function(r){return new(r||m)(c.rXU(c.aKT),c.rXU(c.sFG))},m.\u0275dir=c.FsC({type:m,selectors:[["","appLoadingButton",""]],inputs:{isLoading:[0,"appLoadingButton","isLoading"]},standalone:!0,features:[c.OA$]}),v})()},1748:(U,T,o)=>{o.d(T,{z:()=>g});var c=o(3953);let g=(()=>{var m;class v{constructor(r,f){this.el=r,this.renderer=f}ngOnInit(){this.checkbox=this.el.nativeElement.querySelector("ion-checkbox"),this.renderer.listen(this.el.nativeElement,"click",r=>{r.target!==this.checkbox&&this.checkbox&&this.checkbox.click()})}}return(m=v).\u0275fac=function(r){return new(r||m)(c.rXU(c.aKT),c.rXU(c.sFG))},m.\u0275dir=c.FsC({type:m,selectors:[["","appToggleCheckbox",""]],standalone:!0}),v})()},6676:(U,T,o)=>{o.r(T),o.d(T,{PromotionCreatePageModule:()=>M});var c=o(177),g=o(9417),m=o(9465),v=o(5188),I=o(467),r=o(293),f=o(7221),L=o(8857),y=o(7376),e=o(3953),G=o(6039),Y=o(4501),t=o(8031),S=o(6552),p=o(8397),h=o(8129);const s=d=>({"crm-block-steps-step-disabled":d}),C=d=>({"crm-section-invisible":d}),a=[{path:"",component:(()=>{var d;class k{constructor(i,n,u,O,E,b){this.api=i,this.headerService=n,this.promotionTransformersService=u,this.utils=O,this.router=E,this.toastService=b,this.currentStep=0,this.loadingButton=!1,this.promotionStep1RequiredFields=[],this.promotionStep3RequiredFields=[]}ngOnInit(){}ionViewWillEnter(){this.headerService.setConfig({title:"promotion_create"})}getData(){}setFormValues(){const i=this.promotionTransformersService.transformPromotionFormStepOne(this.promotion);this.stepOneForm.promotionStepOne=i,this.stepTwoForm.promotionStepTwo=this.promotion,this.promotionTransformersService.transformPromotionFormStepThree(this.promotion)}step1Validation(i){this.promotionStep1RequiredFields=[],i.projectName||this.promotionStep1RequiredFields.push("projectName"),i.constructionType||this.promotionStep1RequiredFields.push("constructionType"),i.constructionSubType||this.promotionStep1RequiredFields.push("constructionSubType"),i.address||this.promotionStep1RequiredFields.push("address"),i.co2EmissionsValue||this.promotionStep1RequiredFields.push("co2EmissionsValue"),i.co2EmissionsCertificate||this.promotionStep1RequiredFields.push("co2EmissionsCertificate"),i.energyEfficiencyValue||this.promotionStep1RequiredFields.push("energyEfficiencyValue"),i.energyEfficiencyCertificate||this.promotionStep1RequiredFields.push("energyEfficiencyCertificate")}step3Validation(i){var n;this.promotionStep3RequiredFields=[],console.log(34234324,i),i.title_es||this.promotionStep3RequiredFields.push("title_es"),i.description_es||this.promotionStep3RequiredFields.push("description_es"),(y.cloneDeep(null===(n=this.stepThreeForm)||void 0===n||null===(n=n.fileUploaderManager)||void 0===n||null===(n=n.config)||void 0===n?void 0:n.files)||[]).length||this.promotionStep3RequiredFields.push("images")}nextStep(){var i=this;return(0,I.A)(function*(){if(0!==i.currentStep||(i.promotion={...i.promotion,...i.stepOneForm.promotionStepOne},i.step1Validation(i.promotion),!i.promotionStep1RequiredFields.length)){if(1===i.currentStep){const n=i.promotionTransformersService.deleteAllPromotionPropertiesExceptFeatures(i.stepTwoForm.promotionStepTwo);i.promotion={...i.promotion,...n},i.stepThreeForm.disabled=!1,i.stepThreeForm.syncFiles()}2===i.currentStep&&(i.promotion={...i.promotion,title_es:i.stepThreeForm.promotionStepThree.title_es,title_en:i.stepThreeForm.promotionStepThree.title_en,title_de:i.stepThreeForm.promotionStepThree.title_de,title_fr:i.stepThreeForm.promotionStepThree.title_fr,title_ru:i.stepThreeForm.promotionStepThree.title_ru,description_es:i.stepThreeForm.promotionStepThree.description_es,description_en:i.stepThreeForm.promotionStepThree.description_en,description_de:i.stepThreeForm.promotionStepThree.description_de,description_fr:i.stepThreeForm.promotionStepThree.description_fr,description_ru:i.stepThreeForm.promotionStepThree.description_ru,promotionFiles:i.stepThreeForm.promotionStepThree.promotionFiles},i.step3Validation(i.promotion),i.promotionStep3RequiredFields.length)||(i.currentStep>=2&&(console.log("promotion",i.promotion),i.loadingButton=!0,yield i.createPromotion(),i.loadingButton=!1),i.currentStep<2&&i.currentStep++)}})()}prevStep(){this.currentStep--}createPromotion(){var i=this;return(0,I.A)(function*(){console.log("create promotion"),y.cloneDeep(i.promotion.promotionFiles),delete i.promotion.promotionBlocks,delete i.promotion.propertiesCount,delete i.promotion.checked,delete i.promotion.promotionFiles,i.promotion=i.utils.parseProperties(i.promotion),i.promotion.promotionPaymentInfoIsCompleted=!1;const u=yield i.api.createPromotion(i.promotion),O=u.success.data.id;if(!u.success)return console.error(u.error),void i.toastService.showToast({text:u.error.errorMessage,theme:"red",time:2e3});{var E,b,_,B;let x=[...y.cloneDeep(null===(E=i.stepThreeForm)||void 0===E||null===(E=E.fileUploaderManager)||void 0===E||null===(E=E.config)||void 0===E?void 0:E.files)||[],...y.cloneDeep(null===(b=i.stepThreeForm)||void 0===b||null===(b=b.planosFileUploadManagerComponent)||void 0===b||null===(b=b.config)||void 0===b?void 0:b.files)||[],...y.cloneDeep(null===(_=i.stepThreeForm)||void 0===_||null===(_=_.catalogsFileUploadManagerComponent)||void 0===_||null===(_=_.config)||void 0===_?void 0:_.files)||[],...y.cloneDeep(null===(B=i.stepThreeForm)||void 0===B||null===(B=B.videosFileUploadManagerComponent)||void 0===B||null===(B=B.config)||void 0===B?void 0:B.files)||[]];for(let l of x){if(null!=l&&l.new){var A;const P={promotionId:O,name:"",category:l.category,label:l.label,orderIndex:null==l?void 0:l.orderIndex},V=yield i.api.uploadFile(l.fileBlob),w=null==V||null===(A=V.success)||void 0===A||null===(A=A.data)||void 0===A?void 0:A.fileName;P.name=w,yield i.api.addPromotionFile(P)}if(null!=l&&l.deleted&&(yield i.api.removePromotionFileById(null==l?void 0:l.id)),null!=l&&l.moved&&(null==l||!l.deleted)&&(null==l||!l.new)){let P=y.cloneDeep(l);delete P.moved,delete P.fileBase64,delete P.fileBlob,delete P.new,delete P.deleted,delete P.size,delete P.type,yield i.api.editPromotionFile(P)}}}window.location.href="/promotions"})()}}return(d=k).\u0275fac=function(i){return new(i||d)(e.rXU(G.i),e.rXU(Y.d),e.rXU(t.J),e.rXU(S.T),e.rXU(v.Ix),e.rXU(p.f))},d.\u0275cmp=e.VBU({type:d,selectors:[["app-promotion-create"]],viewQuery:function(i,n){if(1&i&&(e.GBs(r.N,5),e.GBs(f.T,5),e.GBs(L.f,5)),2&i){let u;e.mGM(u=e.lsd())&&(n.stepOneForm=u.first),e.mGM(u=e.lsd())&&(n.stepTwoForm=u.first),e.mGM(u=e.lsd())&&(n.stepThreeForm=u.first)}},decls:67,vars:18,consts:[["stepOneForm",""],["stepTwoForm",""],["stepThreeForm",""],[1,"crm-block-body"],[1,"crm-block-steps"],[1,"crm-block-steps-step"],[1,"crm-block-steps-step-left"],[1,"crm-block-steps-step-number"],[1,"crm-block-steps-step-right"],[1,"crm-block-steps-step-title"],[1,"crm-block-steps-step-subtitle"],[1,"crm-block-steps-step",3,"ngClass"],[1,"crm-block-body-white-content"],[1,"crm-section","crm-section-center-content",3,"ngClass"],[1,"crm-header-modal","crm-header-modal-padding","crm-header-modal-fixed-top"],[1,"crm-modal-header-title"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[3,"requiredFields"],[1,"crm-button-secondary",3,"click"],[1,"crm-button",3,"click","appLoadingButton"]],template:function(i,n){if(1&i){const u=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),e.EFF(5," 1 "),e.k0s()(),e.j41(6,"div",8)(7,"div",9),e.EFF(8," Definir la promoci\xf3n "),e.k0s(),e.j41(9,"div",10),e.EFF(10," Establece la informaci\xf3n general de la promoci\xf3n "),e.k0s()()(),e.j41(11,"div",11)(12,"div",6)(13,"div",7),e.EFF(14," 2 "),e.k0s()(),e.j41(15,"div",8)(16,"div",9),e.EFF(17," Caracter\xedsticas "),e.k0s(),e.j41(18,"div",10),e.EFF(19," Selecciona las caracter\xedsticas de las propiedades "),e.k0s()()(),e.j41(20,"div",11)(21,"div",6)(22,"div",7),e.EFF(23," 3 "),e.k0s()(),e.j41(24,"div",8)(25,"div",9),e.EFF(26," Im\xe1genes y textos "),e.k0s(),e.j41(27,"div",10),e.EFF(28," Sube im\xe1genes y selecciona los textos "),e.k0s()()()(),e.j41(29,"div",12)(30,"div",13)(31,"div",14),e.nrm(32,"div",15),e.j41(33,"div",16)(34,"button",17),e.bIt("click",function(){return e.eBV(u),e.Njj(n.nextStep())}),e.EFF(35," Siguiente "),e.k0s()()(),e.nrm(36,"app-step-one-promotion-form",18,0)(38,"br")(39,"br")(40,"br"),e.k0s(),e.j41(41,"div",13)(42,"div",14),e.nrm(43,"div",15),e.j41(44,"div",16)(45,"button",19),e.bIt("click",function(){return e.eBV(u),e.Njj(n.prevStep())}),e.EFF(46," Atr\xe1s "),e.k0s(),e.j41(47,"button",17),e.bIt("click",function(){return e.eBV(u),e.Njj(n.nextStep())}),e.EFF(48," Siguiente "),e.k0s()()(),e.nrm(49,"app-step-two-promotion-form",null,1)(51,"br")(52,"br")(53,"br"),e.k0s(),e.j41(54,"div",13)(55,"div",14),e.nrm(56,"div",15),e.j41(57,"div",16)(58,"button",19),e.bIt("click",function(){return e.eBV(u),e.Njj(n.prevStep())}),e.EFF(59," Atr\xe1s "),e.k0s(),e.j41(60,"button",20),e.bIt("click",function(){return e.eBV(u),e.Njj(n.nextStep())}),e.EFF(61," Siguiente "),e.k0s()()(),e.nrm(62,"app-step-three-promotion-form",18,2)(64,"br")(65,"br")(66,"br"),e.k0s()()()}2&i&&(e.R7$(11),e.Y8G("ngClass",e.eq3(8,s,n.currentStep<1)),e.R7$(9),e.Y8G("ngClass",e.eq3(10,s,n.currentStep<2)),e.R7$(10),e.Y8G("ngClass",e.eq3(12,C,0!==n.currentStep)),e.R7$(6),e.Y8G("requiredFields",n.promotionStep1RequiredFields),e.R7$(5),e.Y8G("ngClass",e.eq3(14,C,1!==n.currentStep)),e.R7$(13),e.Y8G("ngClass",e.eq3(16,C,2!==n.currentStep)),e.R7$(6),e.Y8G("appLoadingButton",n.loadingButton),e.R7$(2),e.Y8G("requiredFields",n.promotionStep3RequiredFields))},dependencies:[c.YU,r.N,f.T,L.f,h.K]}),k})()}];let R=(()=>{var d;class k{}return(d=k).\u0275fac=function(i){return new(i||d)},d.\u0275mod=e.$C({type:d}),d.\u0275inj=e.G2t({imports:[v.iI.forChild(a),v.iI]}),k})();var D=o(9083);let M=(()=>{var d;class k{}return(d=k).\u0275fac=function(i){return new(i||d)},d.\u0275mod=e.$C({type:d}),d.\u0275inj=e.G2t({imports:[c.MD,g.YN,m.bv,R,D.E]}),k})()},8031:(U,T,o)=>{o.d(T,{J:()=>y});var c=o(467),g=o(7376),v=o(3953),I=o(5970),r=o(8397),f=o(6039),L=o(6552);let y=(()=>{var e;class G{constructor(t,S,p,h){this.popoversService=t,this.toastService=S,this.api=p,this.utils=h}transformPromotionFormStepOne(t){return{projectName:null==t?void 0:t.projectName,constructionType:null==t?void 0:t.constructionType,constructionSubType:null==t?void 0:t.constructionSubType,constructionStatus:null==t?void 0:t.constructionStatus,constructionYear:null==t?void 0:t.constructionYear,constructionStart:null==t?void 0:t.constructionStart,commercializationStart:null==t?void 0:t.commercializationStart,keyDeliveryDate:null==t?void 0:t.keyDeliveryDate,country:null==t?void 0:t.country,province:null==t?void 0:t.province,city:null==t?void 0:t.city,neighborhood:null==t?void 0:t.neighborhood,address:null==t?void 0:t.address,postalCode:null==t?void 0:t.postalCode,number:null==t?void 0:t.number,showAddressPublicly:null==t?void 0:t.showAddressPublicly,showGeoreferencePublicly:null==t?void 0:t.showGeoreferencePublicly,energyEfficiencyCertificate:null==t?void 0:t.energyEfficiencyCertificate,co2EmissionsCertificate:null==t?void 0:t.co2EmissionsCertificate,energyEfficiencyValue:null==t?void 0:t.energyEfficiencyValue,co2EmissionsValue:null==t?void 0:t.co2EmissionsValue}}transformPromotionFormStepThree(t){return{title_es:null==t?void 0:t.title_es,title_en:null==t?void 0:t.title_en,title_de:null==t?void 0:t.title_de,title_fr:null==t?void 0:t.title_fr,title_ru:null==t?void 0:t.title_ru,description_es:null==t?void 0:t.description_es,description_en:null==t?void 0:t.description_en,description_de:null==t?void 0:t.description_de,description_fr:null==t?void 0:t.description_fr,description_ru:null==t?void 0:t.description_ru,promotionFiles:null==t?void 0:t.promotionFiles}}deleteAllPromotionPropertiesExceptFeatures(t){const S=g.cloneDeep(t);for(const p in S)p.startsWith("f_")||p.startsWith("fcustom_")||delete S[p];return S}onDuplicateProperty(t,S){var p=this;return(0,c.A)(function*(){let h=null;const s=yield p.popoversService.onShowDuplicatePropertyPopover(t);var C,F,a,R,D;if(console.log("POPOVER RESULT",s),s&&(null!=s&&null!==(C=s.data)&&void 0!==C&&C.count&&(null==s||null===(F=s.data)||void 0===F?void 0:F.count)>0&&(null==s||null===(a=s.data)||void 0===a?void 0:a.count)<=25?h=null==s||null===(D=s.data)||void 0===D?void 0:D.count:(null==s||null===(R=s.data)||void 0===R?void 0:R.count)>25&&(yield p.toastService.showErrorToast("La cantidad de propiedades a duplicar debe ser mayor a 0 y menor o igual a 25"))),!h)return!1;for(let M=0;M<h;M++)console.log("DUPLICATING PROPERTY",M),yield p.duplicateProperty(S,M);return yield p.toastService.showSuccessToast("Propiedad duplicada exitosamente"),!0})()}duplicateProperty(t,S){var p=this;return(0,c.A)(function*(){var h,s,C,F;let a=g.cloneDeep(t);a=p.utils.parseProperties(a),a.promotionBlockId=t.promotionBlockId,a.promotionId=t.promotionId,a.reference=null!==(h=a)&&void 0!==h&&h.reference?`${null===(s=a)||void 0===s?void 0:s.reference} - Copia ${S+1}`:null,a.availabilityStatus=null;const R=g.cloneDeep((null===(C=a)||void 0===C?void 0:C.propertyFiles)||[]);delete a.id,delete a.propertyFiles,delete a.measurements_floors,delete a.byvaroId,delete a.updatedAt,delete a.createdAt;const D=yield p.api.createProperty(a);null==D||null===(F=D.success)||void 0===F||(F=F.data),console.log("LA PROPERTYYYYYYY",a),console.log("PROPERTY FILES",R)})()}}return(e=G).\u0275fac=function(t){return new(t||e)(v.KVO(I.m),v.KVO(r.f),v.KVO(f.i),v.KVO(L.T))},e.\u0275prov=v.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),G})()},1280:(U,T,o)=>{o.d(T,{B:()=>g,X:()=>c});const c={general:["general","airConditioning","heating"],urbanizacion:["urbanizacion"],cercania:["cercania"],caracteristicas:["caracteristicas"]},g={airConditioning:["AACentralizado","Split","PreInstalacion"],heating:["CentralConGasNatural","CentralConDiesel","CentralConElectricidad","CentralConSueloRadiante","SueloRadianteSoloBanos","CentralConAerotermia","IndividualBombaCalorFrio","IndividualGasPropanoButano"],general:["barbacoa","armariosEmpotrados","puertaBlindada","ascensor","panelesSolares","domotica","gymPrivado","jacuzziPrivado","saunaPrivada","alarma","persianasElectricas","dobleAcristalamiento"],urbanizacion:["Urbanizacion","Portero","UrbanizacionCerrada","Vigilancia24Horas","Gym","PistaDePadel","PistaDeTenis","RestauranteEnElRecinto","SalaDeEventos","Coworking","ZonasAjardinadas","ParqueInfantil","PiscinaInfantil","Hammam","Jacuzzi","Sauna"],cercania:["PrimeraLineaDePlaya","SegundaLineaDePlaya","CercaDeLaPlaya","PrimeraLineaDeGolf","SegundaLineaDeGolf","CercaDeGolf","CentroDeCiudad","CercaDelPuerto"],caracteristicas:["LicenciaTuristica","Balcon","JardinPrivado","Vestidor","Lavanderia","CasaDeInvitados","Chimenea","PistaDeTenisPrivado","PistaDePadelPrivado","Bodega","Despensa"]}}}]);