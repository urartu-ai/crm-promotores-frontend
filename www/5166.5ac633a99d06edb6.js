"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5166],{5166:(j,v,l)=>{l.r(v),l.d(v,{OperationsListPageModule:()=>L});var u=l(177),h=l(9417),P=l(9465),O=l(5188),e=l(5990),g=l(3953);const C=[{path:"",component:e.Q}];let b=(()=>{var p;class _{}return(p=_).\u0275fac=function(m){return new(m||p)},p.\u0275mod=g.$C({type:p}),p.\u0275inj=g.G2t({imports:[O.iI.forChild(C),O.iI]}),_})();var y=l(3895),E=l(5603);let L=(()=>{var p;class _{}return(p=_).\u0275fac=function(m){return new(m||p)},p.\u0275mod=g.$C({type:p}),p.\u0275inj=g.G2t({imports:[u.MD,h.YN,P.bv,b,y.b,E.P]}),_})()},5990:(j,v,l)=>{l.d(v,{Q:()=>X});var u=l(467),h=l(1413),P=l(7376),e=l(3953),g=l(5970),C=l(4501),b=l(6039),y=l(1296),E=l(5952),L=l(5188),p=l(177),_=l(9465),f=l(1880),m=l(6580);const I=s=>({"crm-block-body-fixed":s}),k=s=>({"crm-button-secondary-primary":s}),T=s=>({active:s}),D=(s,c)=>({"background-color":s,border:c}),M=(s,c,n,t,i)=>({pageStartIndex:s,pageEndIndex:c,totalCount:n,paginationPage:t,sortField:i});function S(s,c){if(1&s){const n=e.RV6();e.j41(0,"div",19),e.bIt("click",function(){const i=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.onClickStep(i))}),e.j41(1,"div",20),e.EFF(2),e.k0s(),e.j41(3,"div",21),e.EFF(4),e.nrm(5,"div",22),e.k0s()()}if(2&s){const n=c.$implicit,t=e.XpG();e.Y8G("ngClass",e.eq3(4,T,null==n?null:n.isInOperationsTableActive)),e.R7$(2),e.SpI(" ",t.stepsCount[n.id]," "),e.R7$(2),e.SpI(" ",null==n?null:n.text," "),e.R7$(),e.Y8G("ngStyle",e.l_i(6,D,null==n?null:n.color,"1px solid "+(null==n?null:n.color)))}}function R(s,c){1&s&&(e.nrm(0,"i",23),e.EFF(1," Cerrar filtros "))}function N(s,c){1&s&&(e.nrm(0,"i",24),e.EFF(1," Filtros activados "))}function x(s,c){1&s&&(e.nrm(0,"i",24),e.EFF(1," Filtrar "))}function A(s,c){if(1&s&&e.DNE(0,N,2,0)(1,x,2,0),2&s){const n=e.XpG();e.vxM(n.filters?0:1)}}function F(s,c){if(1&s){const n=e.RV6();e.j41(0,"app-list-pagination-selectors",25),e.bIt("goPreviousPage",function(){e.eBV(n);const i=e.XpG();return e.Njj(i.onGoPreviousPage())})("goNextPage",function(){e.eBV(n);const i=e.XpG();return e.Njj(i.onGoNextPage())})("sort",function(i){e.eBV(n);const o=e.XpG();return e.Njj(o.onSort(i))}),e.k0s()}if(2&s){const n=e.XpG();e.Y8G("listPaginationConfig",e.s1E(1,M,n.updatePagination().startIndex,n.updatePagination().endIndex,n.allSystemOperationsCount,n.pagination.page+1,null!=n.sort&&n.sort.field?(null==n.sort?null:n.sort.field)+" "+(null==n.sort?null:n.sort.order):"Fecha de creaci\xf3n"))}}function G(s,c){if(1&s){const n=e.RV6();e.j41(0,"div",16)(1,"app-list-pagination-selectors",25),e.bIt("goPreviousPage",function(){e.eBV(n);const i=e.XpG();return e.Njj(i.onGoPreviousPage())})("goNextPage",function(){e.eBV(n);const i=e.XpG();return e.Njj(i.onGoNextPage())})("sort",function(i){e.eBV(n);const o=e.XpG();return e.Njj(o.onSort(i))}),e.k0s()()}if(2&s){const n=e.XpG();e.R7$(),e.Y8G("listPaginationConfig",e.s1E(1,M,n.updatePagination().startIndex,n.updatePagination().endIndex,n.allSystemOperationsCount,n.pagination.page+1,null!=n.sort&&n.sort.field?(null==n.sort?null:n.sort.field)+" "+(null==n.sort?null:n.sort.order):"Fecha de creaci\xf3n"))}}function B(s,c){}function U(s,c){if(1&s){const n=e.RV6();e.j41(0,"app-table",26),e.bIt("columnClick",function(i){e.eBV(n);const o=e.XpG();return e.Njj(o.onColumnClicked(i))})("rowClicked",function(i){e.eBV(n);const o=e.XpG();return e.Njj(o.onRowClicked(i))}),e.k0s()}if(2&s){const n=e.XpG();e.Y8G("table",n.tableConfig)}}let X=(()=>{var s;class c{constructor(t,i,o,a,r,d){this.popoversService=t,this.headerService=i,this.sdk=o,this.tableService=a,this.modalService=r,this.activatedRoute=d,this.pipeline=null,this.operations=[],this.allSystemOperationsCount=0,this.checkedOperations=0,this.searchString="",this.searchSubject=new h.B,this.aside={type:"filters",visible:!1},this.pipelineName="operaciones",this.showFilters=!1,this.filters=null,this.sort=null,this.pagination={page:0,itemsPerPage:25},this.tableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"currentPipelineStep.text",label:"Etapa",size:"medium"},{key:"contact.name",label:"Contacto",size:"large"},{key:"mainProperty.promotion.projectName",label:"Promoci\xf3n",size:"large"},{key:"mainProperty.reference",label:"Identificador",size:"large"},{key:"mainProperty.availabilityStatus",label:"Estado propiedad",size:"medium"},{key:"createdAt",label:"Creado",size:"medium"},{key:"responsible.name",label:"Responsable",size:"large"}],rows:[]},this.relationsFilter={mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},contact:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:{title:{equals:this.pipelineName}},onlyCount:!1}},this.loadingList=!1,this.stepsCount={}}ionViewWillEnter(){this.getData()}ngOnInit(){var t;null!==(t=this.options)&&void 0!==t&&t.fatherObj&&(this.relationsFilter.operations={apply:!0,filter:{agencyId:{equals:this.options.fatherObj.id}},onlyCount:!1},this.getData())}getData(){var t=this;return(0,u.A)(function*(){yield t.getOperationNameInUrl(),yield t.getPipelines(),yield t.getOperations(),yield t.getOperationsStepsCount()})()}getOperationNameInUrl(){var t=this;return(0,u.A)(function*(){var i;t.pipelineName=t.activatedRoute.snapshot.params.pipelineName||"operaciones",console.log("pipelineName",t.pipelineName),t.relationsFilter.currentPipeline.filter.title.equals=t.pipelineName,null!==(i=t.options)&&void 0!==i&&i.fatherObj||t.headerService.setConfig({title:"operations/"+t.pipelineName})})()}getOperationsStepsCount(){var t=this;return(0,u.A)(function*(){var i,o;if(!t.pipeline)return;let a={};var r;null!==(i=t.options)&&void 0!==i&&i.fatherObj&&(a={agencyId:null===(r=t.options)||void 0===r||null===(r=r.fatherObj)||void 0===r?void 0:r.id});const d=yield t.sdk.countOperationsPerStep(t.pipeline.id,a);t.stepsCount=null===(o=d.success)||void 0===o?void 0:o.data})()}getPipelines(){var t=this;return(0,u.A)(function*(){const i=yield t.sdk.getPipelines({title:{equals:t.pipelineName}},{field:"createdAt",order:"asc"},{itemsPerPage:200,page:0},{steps:{filter:null,apply:!0,onlyCount:!1},buttons:{filter:null,apply:!0,onlyCount:!1}});if(i.success){var o;const a=null==i||null===(o=i.success)||void 0===o?void 0:o.data[0],r=P.cloneDeep(null==a?void 0:a.steps)||[];r.sort((d,W)=>d.order-W.order),a.steps=r,t.pipeline=a}})()}getOperations(){var t=this;return(0,u.A)(function*(){const i=yield t.sdk.getOperation(t.filters,t.sort,t.pagination,t.relationsFilter);if(i.success){t.operations=i.success.data;let o=t.tableService.convertDataToTableRows(t.operations,t.tableConfig);o=t.tableService.setRowsChipsFromOperations(o),o=o.map(a=>{var r;return null!=a&&null!==(r=a.rawObject)&&void 0!==r&&r.viewed||(a.style={backgroundColor:"success"}),a}),t.tableConfig.rows=o}})()}setCountsOfPipelinesSteps(){var t=this;return(0,u.A)(function*(){for(let o=0;o<(null===(i=t.pipeline)||void 0===i||null===(i=i.steps)||void 0===i?void 0:i.length);o++)var i})()}onClickStep(t){if(null!=t&&t.isInOperationsTableActive){var i;const a=(null===(i=this.filters)||void 0===i?void 0:i.OR)||[],r=a.findIndex(d=>d.currentPipelineStepId.equals===t.id);a.splice(r,1),this.pipeline.steps.forEach(d=>{d.id===t.id&&(d.isInOperationsTableActive=!1)}),this.filters=0===a.length?null:{OR:a}}else{var o;const a=(null===(o=this.filters)||void 0===o?void 0:o.OR)||[];a.push({currentPipelineStepId:{equals:t.id}}),this.pipeline.steps.forEach(r=>{r.id===t.id&&(r.isInOperationsTableActive=!0)}),this.filters={OR:a}}this.getOperations()}onSearchInputChange(t){this.searchSubject.next(t.target.value)}onSearchChanged(t){this.searchString=t}onToggleAside(){this.aside.visible=!this.aside.visible}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemOperationsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}onToggleAllCheckboxes(t){}onShowMenuSelectAll(t){}onSort(t){}onRowClicked(t){var i=this;return(0,u.A)(function*(){const o=t.rawObject;console.log("operation",o),yield(yield i.modalService.showOperationModal(null==o?void 0:o.id)).onDidDismiss(),i.getOperations()})()}onColumnClicked(t){var i=this;return(0,u.A)(function*(){switch(t.column.key){case"contact.name":i.relationsFilter.contact={apply:!0,filter:{},sort:{field:"name",order:t.order},onlyCount:!1};break;case"mainProperty.promotion.projectName":i.relationsFilter.mainProperty={apply:!0,filter:{},sort:{field:"projectName",order:t.order},onlyCount:!1};break;case"mainProperty.reference":i.relationsFilter.mainProperty={apply:!0,filter:{},sort:{field:"reference",order:t.order},onlyCount:!1};break;case"mainProperty.availabilityStatus":i.relationsFilter.mainProperty={apply:!0,filter:{},sort:{field:"availabilityStatus",order:t.order},onlyCount:!1};break;case"responsible.name":i.relationsFilter.operations={apply:!0,filter:{},sort:{field:"responsible.name",order:t.order},onlyCount:!1};break;case"createdAt":console.log("Created at"),i.sort={field:"createdAt",order:t.order}}i.getData()})()}onClickMoreTools(t){var i=this;return(0,u.A)(function*(){const o=yield i.popoversService.onShowMenuPopover(t,"contacts-list-more-tools");console.log("Popover result:",o)})()}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemOperationsCount)}}}return(s=c).\u0275fac=function(t){return new(t||s)(e.rXU(g.m),e.rXU(C.d),e.rXU(b.i),e.rXU(y.a),e.rXU(E.M),e.rXU(L.nX))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-operations-list"]],inputs:{options:"options"},decls:23,vars:12,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content"],[1,"crm-block-body"],[3,"ngClass"],[1,"crm-section-operations-list-buttons"],[1,"crm-operations-list-pipe-button",3,"ngClass"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar operaci\xf3n",3,"input"],[1,"crm-buttons-group"],[1,"crm-button-secondary",3,"click","ngClass"],[1,"crm-button-secondary","crm-button-secondary-icon-solo",3,"click"],[1,"fa","fa-ellipsis"],[3,"listPaginationConfig"],[1,"crm-block-body-fixed","crm-block-body-fixed-padding-bigger"],[1,"crm-block-body-blue-content"],[3,"table"],[1,"crm-operations-list-pipe-button",3,"click","ngClass"],[1,"crm-operations-list-pipe-button-title"],[1,"crm-operations-list-pipe-button-subtitle"],[1,"crm-dot","success",3,"ngStyle"],[1,"fa","fa-times"],[1,"fa","fa-filter"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[3,"columnClick","rowClicked","table"]],template:function(t,i){1&t&&(e.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e.Z7z(5,S,6,9,"div",5,e.fX1),e.k0s(),e.j41(7,"div",6)(8,"div",7)(9,"div",8),e.nrm(10,"i",9),e.j41(11,"input",10),e.bIt("input",function(a){return i.onSearchInputChange(a)}),e.k0s()()(),e.j41(12,"div",11)(13,"button",12),e.bIt("click",function(){return i.onToggleAside()}),e.DNE(14,R,2,0)(15,A,2,1),e.k0s(),e.j41(16,"button",13),e.bIt("click",function(a){return i.onClickMoreTools(a)}),e.nrm(17,"i",14),e.k0s()()(),e.DNE(18,F,1,7,"app-list-pagination-selectors",15),e.k0s(),e.DNE(19,G,2,7,"div",16),e.j41(20,"div",17),e.DNE(21,B,0,0)(22,U,1,1,"app-table",18),e.k0s()()()()),2&t&&(e.Y8G("fullscreen",!0)("scrollY",!1),e.R7$(3),e.Y8G("ngClass",e.eq3(8,I,!(null!=i.options&&i.options.fatherObj))),e.R7$(2),e.Dyx(null==i.pipeline?null:i.pipeline.steps),e.R7$(8),e.Y8G("ngClass",e.eq3(10,k,!("filters"===(null==i.aside?null:i.aside.type)&&null!=i.aside&&i.aside.visible)&&i.filters)),e.R7$(),e.vxM("filters"===(null==i.aside?null:i.aside.type)&&null!=i.aside&&i.aside.visible?14:15),e.R7$(4),e.vxM(null!=i.options&&i.options.fatherObj?-1:18),e.R7$(),e.vxM(null!=i.options&&i.options.fatherObj?19:-1),e.R7$(2),e.vxM(i.loadingList?21:22))},dependencies:[p.YU,p.B3,_.W9,f.O,m.k]}),c})()}}]);