"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9910],{4821:(j,k,d)=>{d.d(k,{e:()=>v});var _=d(3953);let v=(()=>{var f;class D{constructor(g){this.renderer=g,this.text="",this.maxLength=20,this.tooltipClass="",this.tooltipElement=null}ngOnInit(){}get trimmedText(){return this.text?this.text.length>this.maxLength?this.text.slice(0,this.maxLength)+"...":this.text:""}showTooltip(g){this.text.length<=this.maxLength||(this.tooltipElement=this.renderer.createElement("div"),this.tooltipElement.innerText=this.text,this.renderer.addClass(this.tooltipElement,"custom-tooltip"),this.tooltipClass&&this.tooltipClass.split(" ").forEach(e=>{e.trim()&&this.renderer.addClass(this.tooltipElement,e.trim())}),this.renderer.setStyle(this.tooltipElement,"position","fixed"),this.renderer.setStyle(this.tooltipElement,"top",g.clientY-30+"px"),this.renderer.setStyle(this.tooltipElement,"left",`${g.clientX}px`),this.renderer.setStyle(this.tooltipElement,"z-index","9999"),this.renderer.appendChild(document.body,this.tooltipElement))}hideTooltip(){this.tooltipElement&&(this.renderer.removeChild(document.body,this.tooltipElement),this.tooltipElement=null)}}return(f=D).\u0275fac=function(g){return new(g||f)(_.rXU(_.sFG))},f.\u0275cmp=_.VBU({type:f,selectors:[["app-tooltip-text"]],inputs:{text:"text",maxLength:"maxLength",tooltipClass:"tooltipClass"},standalone:!0,features:[_.aNF],decls:2,vars:1,consts:[[1,"text",3,"mouseenter","mouseleave"]],template:function(g,P){1&g&&(_.j41(0,"span",0),_.bIt("mouseenter",function(y){return P.showTooltip(y)})("mouseleave",function(){return P.hideTooltip()}),_.EFF(1),_.k0s()),2&g&&(_.R7$(),_.SpI(" ",P.trimmedText,"\n"))}}),D})()},5551:(j,k,d)=>{d.r(k),d.d(k,{PromotionListPageModule:()=>z});var _=d(177),v=d(9417),f=d(9465),D=d(5188),C=d(467),g=d(9969),P=d(1413),e=d(3953),y=d(6039),M=d(8397),x=d(4501),n=d(1213),c=d(5970),s=d(904);const p=["provinceInput"],b=["cityInput"],F=()=>({standalone:!0});function T(a,m){if(1&a&&(e.j41(0,"ion-select-option",41),e.EFF(1),e.k0s()),2&a){const u=m.$implicit;e.Y8G("value",u.value),e.R7$(),e.JRh(u.label)}}function E(a,m){if(1&a&&(e.j41(0,"ion-select-option",41),e.EFF(1),e.k0s()),2&a){const u=m.$implicit;e.Y8G("value",u.value),e.R7$(),e.JRh(u.label)}}function S(a,m){if(1&a&&(e.j41(0,"ion-select-option",41),e.EFF(1),e.k0s()),2&a){const u=m.$implicit;e.Y8G("value",u.value),e.R7$(),e.JRh(u.label)}}function B(a,m){if(1&a){const u=e.RV6();e.j41(0,"div",27)(1,"ion-checkbox",42),e.bIt("ionChange",function(t){const r=e.eBV(u).$implicit,l=e.XpG();return e.Njj(l.onCheckboxChange(r.value,t,"bedrooms"))}),e.k0s(),e.j41(2,"div",29),e.EFF(3),e.k0s()()}if(2&a){const u=m.$implicit,i=e.XpG();e.R7$(),e.Y8G("value",u.value)("checked",i.filterData.bedrooms.includes(u.value)),e.R7$(2),e.JRh(u.label)}}function L(a,m){if(1&a){const u=e.RV6();e.j41(0,"div",27)(1,"ion-checkbox",42),e.bIt("ionChange",function(t){const r=e.eBV(u).$implicit,l=e.XpG();return e.Njj(l.onCheckboxChange(r.value,t,"bathrooms"))}),e.k0s(),e.j41(2,"div",29),e.EFF(3),e.k0s()()}if(2&a){const u=m.$implicit,i=e.XpG();e.R7$(),e.Y8G("value",u.value)("checked",i.filterData.bathrooms.includes(u.value)),e.R7$(2),e.JRh(u.label)}}let I=(()=>{var a;class m{constructor(i,t){this.ngZone=i,this.api=t,this.setFilter=new e.bkB,this.onFilter=new e.bkB,this.sort=null,this.pagination={page:0,itemsPerPage:25},this.promotions=[],this.filterData={province:"",city:"",price:{min:null,max:null},propertySubtypes:[],constructionStatus:"",bedrooms:[],bathrooms:[],builtArea:{min:null,max:null},plotArea:{min:null,max:null},extras:{communityPool:!1,privatePool:!1,parking:!1,elevator:!1,touristLicense:!1,storageRoom:!1,basement:!1,solarium:!1,beachfrontFirstLine:!1,beachfrontSecondLine:!1,golfFrontFirstLine:!1,golfFrontSecondLine:!1}},this.bathroomOptions=[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4 o m\xe1s"}],this.bedroomOptions=[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4 o m\xe1s"}],this.currentYear=(new Date).getFullYear(),this.currentYearFirstDate=new Date(this.currentYear,0,1),this.currentYearFinalDate=new Date(this.currentYear,11,31),this.nextYearFirstDate=new Date(this.currentYear+1,0,1),this.nextYearFinalDate=new Date(this.currentYear+1,11,31),this.keyDeliveryOption="",this.keyDeliveryOptions=[{value:"tres_meses",label:"Menos de 3 meses"},{value:"seis_meses",label:"Menos de 6 meses"},{value:"este_a\xf1o",label:"Este a\xf1o"},{value:"a\xf1o_siguiente",label:"A\xf1o que viene"}],this.subtypesOptions=[{value:"villa",label:"Villa"},{value:"country_house",label:"Finca"},{value:"chalet",label:"Chalet"},{value:"apartment_flat",label:"Piso / Apartamento"},{value:"duplex",label:"D\xfaplex"},{value:"triplex",label:"Triplex"},{value:"ground_floor_apartment",label:"Apto planta baja"},{value:"penthouse",label:"\xc1tico"},{value:"penthouse_duplex",label:"\xc1tico d\xfaplex"},{value:"studio",label:"Estudio"},{value:"commercial_space",label:"Local comercial"}],this.constructionStateOptions=[{value:"proyecto-sin-licencia",label:"Sin Licencia"},{value:"proyecto-con-licencia",label:"Con Licencia"},{value:"fase-excavacion",label:"Fase Excavaci\xf3n"},{value:"cimentacion-completada",label:"Cimentaci\xf3n Completada"},{value:"estructura-construccion",label:"Estructura Construcci\xf3n"},{value:"cerramiento-completado",label:"Cerramiento Completado"},{value:"instalaciones-proceso",label:"Instalaciones Proceso"},{value:"acabados-interiores",label:"Acabados Interiores"},{value:"obra-finalizada",label:"Obra Finalizada"}]}setSubtypes(i){this.filterData.propertySubtypes=i.detail.value}setConstructionStatus(i){this.filterData.constructionStatus=i.detail.value}setKeyDateOption(i){this.keyDeliveryOption=i.detail.value}calculateDaysBetween(i,t){const r=new Date(i),l=new Date(t),o=Math.abs(l.getTime()-r.getTime());return Math.ceil(o/864e5)}onCheckboxChange(i,t,r){const l=this.filterData[r],o={bedrooms:this.bedroomOptions,bathrooms:this.bathroomOptions}[r].map(h=>h.value);if(t.detail.checked)o.filter(h=>h>=i).forEach(h=>{l.includes(h)||l.push(h)});else{const h=l.indexOf(i);h>-1&&l.splice(h,1)}}onClickFilter(){const i={},t={};this.filterData.province&&(t.province={equals:this.filterData.province}),this.filterData.city&&(t.city={equals:this.filterData.city}),null!=this.filterData.price.min&&null==this.filterData.price.max&&(i.properties={apply:!0,filter:{price:{gte:this.filterData.price.min}},onlyCount:!1}),null==this.filterData.price.min&&null!=this.filterData.price.max&&(i.properties={apply:!0,filter:{price:{lte:this.filterData.price.max}},onlyCount:!1}),null!=this.filterData.price.min&&null!=this.filterData.price.max&&(i.properties={apply:!0,filter:{AND:[{price:{gte:this.filterData.price.min}},{price:{lte:this.filterData.price.max}}]},onlyCount:!1}),""!=this.filterData.constructionStatus&&(t.constructionStatus={equals:this.filterData.constructionStatus}),0!=this.filterData.bedrooms.length&&(i.properties=1==this.filterData.bedrooms.length&&4!=this.filterData.bedrooms[0]?{apply:!0,filter:{bedrooms:{equals:this.filterData.bedrooms[0]}},onlyCount:!1}:{apply:!0,filter:{bedrooms:{gte:this.filterData.bedrooms[0]}},onlyCount:!1}),0!=this.filterData.bathrooms.length&&(i.properties=1==this.filterData.bathrooms.length&&4!=this.filterData.bathrooms[0]?{apply:!0,filter:{bathrooms:{equals:this.filterData.bathrooms[0]}},onlyCount:!1}:{apply:!0,filter:{bathrooms:{gte:this.filterData.bathrooms[0]}},onlyCount:!1}),null!=this.filterData.builtArea.min&&null==this.filterData.builtArea.max&&(i.properties={apply:!0,filter:{totalMeasures_squareMetersBuilt:{gte:this.filterData.builtArea.min}},onlyCount:!1}),null==this.filterData.builtArea.min&&null!=this.filterData.builtArea.max&&(i.properties={apply:!0,filter:{totalMeasures_squareMetersBuilt:{lte:this.filterData.builtArea.max}},onlyCount:!1}),null!=this.filterData.builtArea.min&&null!=this.filterData.builtArea.max&&(i.properties={apply:!0,filter:{AND:[{totalMeasures_squareMetersBuilt:{gte:this.filterData.builtArea.min}},{totalMeasures_squareMetersBuilt:{lte:this.filterData.builtArea.max}}]},onlyCount:!1}),null!=this.filterData.plotArea.min&&null==this.filterData.plotArea.max&&(i.properties={apply:!0,filter:{totalMeasures_squareMetersPatch:{gte:this.filterData.plotArea.min}},onlyCount:!1}),null==this.filterData.plotArea.min&&null!=this.filterData.plotArea.max&&(i.properties={apply:!0,filter:{totalMeasures_squareMetersPatch:{lte:this.filterData.plotArea.max}},onlyCount:!1}),null!=this.filterData.plotArea.min&&null!=this.filterData.plotArea.max&&(i.properties={apply:!0,filter:{AND:[{totalMeasures_squareMetersPatch:{gte:this.filterData.plotArea.min}},{totalMeasures_squareMetersBuilt:{lte:this.filterData.plotArea.max}}]},onlyCount:!1}),"tres_meses"==this.keyDeliveryOption&&(t.keyDeliveryDate={lte:new Date((new Date).getTime()+7776e6)}),"seis_meses"==this.keyDeliveryOption&&(t.keyDeliveryDate={lte:new Date((new Date).getTime()+15552e6)}),"este_a\xf1o"==this.keyDeliveryOption&&(t.keyDeliveryDate={gte:this.currentYearFirstDate,lte:this.currentYearFinalDate}),"a\xf1o_siguiente"==this.keyDeliveryOption&&(t.keyDeliveryDate={gte:this.nextYearFirstDate,lte:this.nextYearFinalDate}),0!=this.filterData.propertySubtypes.length&&(i.properties={apply:!0,filter:{promotionType:{in:this.filterData.propertySubtypes}},onlyCount:!1}),this.filterData.extras.communityPool&&(t.f_pool_comunitaria={equals:!0}),this.filterData.extras.privatePool&&(t.f_pool_privada={equals:!0}),this.filterData.extras.parking&&(t.fcustom_parking={equals:!0}),this.filterData.extras.elevator&&(t.f_general_ascensor={equals:!0}),this.filterData.extras.touristLicense&&(t.f_caracteristicas_LicenciaTuristica={equals:!0}),this.filterData.extras.storageRoom&&(t.fcustom_trastero={equals:!0}),this.filterData.extras.basement&&(t.fcustom_sotano={equals:!0}),this.filterData.extras.solarium&&(t.fcustom_solarium={equals:!0}),this.filterData.extras.beachfrontFirstLine&&(t.f_cercania_PrimeraLineaDePlaya={equals:!0}),this.filterData.extras.beachfrontSecondLine&&(t.f_cercania_SegundaLineaDePlaya={equals:!0}),this.filterData.extras.golfFrontFirstLine&&(t.f_cercania_PrimeraLineaDeGolf={equals:!0}),this.filterData.extras.golfFrontSecondLine&&(t.f_cercania_SegundaLineaDeGolf={equals:!0}),console.log("Filter emitted:",t),console.log("Join emitted:",i),this.setFilter.emit(!0),this.onFilter.emit({filter:t,joinTables:i})}onResetFilters(){this.keyDeliveryOption="",this.filterData={province:"",city:"",price:{min:null,max:null},propertySubtypes:[],constructionStatus:"",bedrooms:[],bathrooms:[],builtArea:{min:null,max:null},plotArea:{min:null,max:null},extras:{communityPool:!1,privatePool:!1,parking:!1,elevator:!1,touristLicense:!1,storageRoom:!1,basement:!1,solarium:!1,beachfrontFirstLine:!1,beachfrontSecondLine:!1,golfFrontFirstLine:!1,golfFrontSecondLine:!1}},this.setFilter.emit(!1),this.onFilter.emit({filter:{},joinTables:{}})}ngOnInit(){}getPromotions(){var i=this;return(0,C.A)(function*(){const t=yield i.api.getPromotions({},i.sort,i.pagination,null);i.promotions=t.success.data||[]})()}ngAfterViewInit(){this.getPromotions(),this.provinceAutocomplete=new google.maps.places.Autocomplete(this.provinceInput.nativeElement,{types:["(regions)"],componentRestrictions:{country:"es"},fields:["address_component","geometry"]}),this.provinceAutocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{var i,t;const r=this.provinceAutocomplete.getPlace(),l=null===(i=r.address_components)||void 0===i?void 0:i.find(o=>o.types.includes("administrative_area_level_2"));l&&(this.filterData.province=l.long_name,this.provinceInput.nativeElement.value=l.long_name),null!==(t=r.geometry)&&void 0!==t&&t.viewport&&this.cityAutocomplete.setBounds(r.geometry.viewport)})}),this.cityAutocomplete=new google.maps.places.Autocomplete(this.cityInput.nativeElement,{types:["locality"],componentRestrictions:{country:"es"},fields:["address_component"]}),this.cityAutocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{var i;const r=null===(i=this.cityAutocomplete.getPlace().address_components)||void 0===i?void 0:i.find(l=>l.types.includes("locality"));r&&(this.filterData.city=r.long_name,this.cityInput.nativeElement.value=r.long_name)})})}}return(a=m).\u0275fac=function(i){return new(i||a)(e.rXU(e.SKi),e.rXU(y.i))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-promotions-filter-block"]],viewQuery:function(i,t){if(1&i&&(e.GBs(p,5),e.GBs(b,5)),2&i){let r;e.mGM(r=e.lsd())&&(t.provinceInput=r.first),e.mGM(r=e.lsd())&&(t.cityInput=r.first)}},outputs:{setFilter:"setFilter",onFilter:"onFilter"},decls:141,vars:32,consts:[["provinceInput",""],["cityInput",""],[2,"position","relative","background","white"],["autocomplete","off","novalidate",""],["type","text","autocomplete","username",2,"display","none"],["type","password","autocomplete","new-password",2,"display","none"],[1,"crm-header-modal","crm-header-modal-fixed-top"],[1,"crm-modal-header-title"],[1,"crm-buttons-group"],["type","button",1,"crm-button",3,"click"],["type","button",1,"crm-button-secondary","crm-button-secondary-red",3,"click"],[1,"crm-block-inputs","crm-block-filters-inputs"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input"],["type","text","placeholder","Seleccione provincia","name","province","autocomplete","off","autocorrect","off","spellcheck","false",3,"ngModelChange","ngModel","ngModelOptions"],["type","text","placeholder","Seleccione ciudad","name","city","autocomplete","off","autocorrect","off","spellcheck","false",3,"ngModelChange","ngModel","ngModelOptions"],[1,"crm-section-inputs-double-input"],["type","number","name","priceMin","placeholder","M\xednimo",3,"ngModelChange","ngModel"],["type","number","name","priceMax","placeholder","M\xe1ximo",3,"ngModelChange","ngModel"],["toggleIcon","chevron-down-outline","justify","end","interface","popover","multiple","true","name","constructionSubType",1,"crm-select-item",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["toggleIcon","chevron-down-outline","justify","end","interface","popover","name","constructionStatus",1,"crm-select-item",3,"ngModelChange","ionChange","ngModel"],["toggleIcon","chevron-down-outline","justify","end","interface","popover","name","deliveryOption",1,"crm-select-item",3,"ngModelChange","ionChange","ngModel"],[1,"crm-input-checkboxes",2,"grid-template-columns","1fr"],["class","crm-input-checkbox",4,"ngFor","ngForOf"],[1,"crm-input-checkboxes"],[1,"crm-input-checkbox"],["name","communityPool",3,"ngModelChange","ngModel"],[1,"crm-input-checkbox-label"],["name","privatePool",3,"ngModelChange","ngModel"],["name","parking",3,"ngModelChange","ngModel"],["name","elevator",3,"ngModelChange","ngModel"],["name","touristLicense",3,"ngModelChange","ngModel"],["name","storageRoom",3,"ngModelChange","ngModel"],["name","basement",3,"ngModelChange","ngModel"],["name","solarium",3,"ngModelChange","ngModel"],["name","beachfrontFirstLine",3,"ngModelChange","ngModel"],["name","beachfrontSecondLine",3,"ngModelChange","ngModel"],["name","golfFrontFirstLine",3,"ngModelChange","ngModel"],["name","golfFrontSecondLine",3,"ngModelChange","ngModel"],[3,"value"],[3,"ionChange","value","checked"]],template:function(i,t){if(1&i){const r=e.RV6();e.j41(0,"div",2)(1,"form",3),e.nrm(2,"input",4)(3,"input",5),e.j41(4,"div",6)(5,"div",7),e.EFF(6,"Filtrar"),e.k0s(),e.j41(7,"div",8)(8,"button",9),e.bIt("click",function(){return e.eBV(r),e.Njj(t.onClickFilter())}),e.EFF(9," Filtrar "),e.k0s(),e.j41(10,"button",10),e.bIt("click",function(){return e.eBV(r),e.Njj(t.onResetFilters())}),e.EFF(11," Reiniciar "),e.k0s()()(),e.j41(12,"div",11)(13,"div",12)(14,"div",13),e.EFF(15,"Provincia"),e.k0s(),e.j41(16,"div",14)(17,"input",15,0),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.province,o)||(t.filterData.province=o),e.Njj(o)}),e.k0s()()(),e.j41(19,"div",12)(20,"div",13),e.EFF(21,"Ciudad"),e.k0s(),e.j41(22,"div",14)(23,"input",16,1),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.city,o)||(t.filterData.city=o),e.Njj(o)}),e.k0s()()(),e.j41(25,"div",17)(26,"div",12)(27,"div",13),e.EFF(28,"Min.Precio"),e.k0s(),e.j41(29,"div",14)(30,"input",18),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.price.min,o)||(t.filterData.price.min=o),e.Njj(o)}),e.k0s()()(),e.j41(31,"div",12)(32,"div",13),e.EFF(33,"Max.Precio"),e.k0s(),e.j41(34,"div",14)(35,"input",19),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.price.max,o)||(t.filterData.price.max=o),e.Njj(o)}),e.k0s()()()(),e.j41(36,"div",12)(37,"div",13),e.EFF(38,"Subtipo propiedad"),e.k0s(),e.j41(39,"ion-list")(40,"ion-item")(41,"ion-select",20),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.propertySubtypes,o)||(t.filterData.propertySubtypes=o),e.Njj(o)}),e.bIt("ionChange",function(o){return e.eBV(r),e.Njj(t.setSubtypes(o))}),e.DNE(42,T,2,2,"ion-select-option",21),e.k0s()()()(),e.j41(43,"div",12)(44,"div",13),e.EFF(45,"Estado de obra"),e.k0s(),e.j41(46,"ion-list")(47,"ion-item")(48,"ion-select",22),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.constructionStatus,o)||(t.filterData.constructionStatus=o),e.Njj(o)}),e.bIt("ionChange",function(o){return e.eBV(r),e.Njj(t.setConstructionStatus(o))}),e.DNE(49,E,2,2,"ion-select-option",21),e.k0s()()()(),e.j41(50,"div",12)(51,"div",13),e.EFF(52,"Entrega"),e.k0s(),e.j41(53,"ion-list")(54,"ion-item")(55,"ion-select",23),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.keyDeliveryOption,o)||(t.keyDeliveryOption=o),e.Njj(o)}),e.bIt("ionChange",function(o){return e.eBV(r),e.Njj(t.setKeyDateOption(o))}),e.DNE(56,S,2,2,"ion-select-option",21),e.k0s()()()(),e.j41(57,"div",12)(58,"div",13),e.EFF(59,"Dormitorios"),e.k0s(),e.j41(60,"div",24),e.DNE(61,B,4,3,"div",25),e.k0s()(),e.j41(62,"div",12)(63,"div",13),e.EFF(64,"Ba\xf1os"),e.k0s(),e.j41(65,"div",24),e.DNE(66,L,4,3,"div",25),e.k0s()(),e.j41(67,"div",17)(68,"div",12)(69,"div",13),e.EFF(70,"Min.m2 Const"),e.k0s(),e.j41(71,"div",14)(72,"input",18),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.builtArea.min,o)||(t.filterData.builtArea.min=o),e.Njj(o)}),e.k0s()()(),e.j41(73,"div",12)(74,"div",13),e.EFF(75,"Max.m2 Const"),e.k0s(),e.j41(76,"div",14)(77,"input",19),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.builtArea.max,o)||(t.filterData.builtArea.max=o),e.Njj(o)}),e.k0s()()()(),e.j41(78,"div",17)(79,"div",12)(80,"div",13),e.EFF(81,"Min.m2 Parcela"),e.k0s(),e.j41(82,"div",14)(83,"input",18),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.plotArea.min,o)||(t.filterData.plotArea.min=o),e.Njj(o)}),e.k0s()()(),e.j41(84,"div",12)(85,"div",13),e.EFF(86,"Max.m2 Parcela"),e.k0s(),e.j41(87,"div",14)(88,"input",19),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.plotArea.max,o)||(t.filterData.plotArea.max=o),e.Njj(o)}),e.k0s()()()(),e.j41(89,"div",12)(90,"div",13),e.EFF(91,"Extras"),e.k0s(),e.j41(92,"div",26)(93,"div",27)(94,"ion-checkbox",28),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.communityPool,o)||(t.filterData.extras.communityPool=o),e.Njj(o)}),e.k0s(),e.j41(95,"div",29),e.EFF(96,"Piscina Comunidad"),e.k0s()(),e.j41(97,"div",27)(98,"ion-checkbox",30),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.privatePool,o)||(t.filterData.extras.privatePool=o),e.Njj(o)}),e.k0s(),e.j41(99,"div",29),e.EFF(100,"Piscina Privada"),e.k0s()(),e.j41(101,"div",27)(102,"ion-checkbox",31),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.parking,o)||(t.filterData.extras.parking=o),e.Njj(o)}),e.k0s(),e.j41(103,"div",29),e.EFF(104,"Parking"),e.k0s()(),e.j41(105,"div",27)(106,"ion-checkbox",32),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.elevator,o)||(t.filterData.extras.elevator=o),e.Njj(o)}),e.k0s(),e.j41(107,"div",29),e.EFF(108,"Ascensor"),e.k0s()(),e.j41(109,"div",27)(110,"ion-checkbox",33),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.touristLicense,o)||(t.filterData.extras.touristLicense=o),e.Njj(o)}),e.k0s(),e.j41(111,"div",29),e.EFF(112,"Licencia tur\xedstica"),e.k0s()(),e.j41(113,"div",27)(114,"ion-checkbox",34),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.storageRoom,o)||(t.filterData.extras.storageRoom=o),e.Njj(o)}),e.k0s(),e.j41(115,"div",29),e.EFF(116,"Trastero"),e.k0s()(),e.j41(117,"div",27)(118,"ion-checkbox",35),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.basement,o)||(t.filterData.extras.basement=o),e.Njj(o)}),e.k0s(),e.j41(119,"div",29),e.EFF(120,"S\xf3tano"),e.k0s()(),e.j41(121,"div",27)(122,"ion-checkbox",36),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.solarium,o)||(t.filterData.extras.solarium=o),e.Njj(o)}),e.k0s(),e.j41(123,"div",29),e.EFF(124,"Solarium"),e.k0s()(),e.j41(125,"div",27)(126,"ion-checkbox",37),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.beachfrontFirstLine,o)||(t.filterData.extras.beachfrontFirstLine=o),e.Njj(o)}),e.k0s(),e.j41(127,"div",29),e.EFF(128,"1\xaa l\xednea de playa"),e.k0s()(),e.j41(129,"div",27)(130,"ion-checkbox",38),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.beachfrontSecondLine,o)||(t.filterData.extras.beachfrontSecondLine=o),e.Njj(o)}),e.k0s(),e.j41(131,"div",29),e.EFF(132,"2\xaa l\xednea de playa"),e.k0s()(),e.j41(133,"div",27)(134,"ion-checkbox",39),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.golfFrontFirstLine,o)||(t.filterData.extras.golfFrontFirstLine=o),e.Njj(o)}),e.k0s(),e.j41(135,"div",29),e.EFF(136,"1\xaa l\xednea de golf"),e.k0s()(),e.j41(137,"div",27)(138,"ion-checkbox",40),e.mxI("ngModelChange",function(o){return e.eBV(r),e.DH7(t.filterData.extras.golfFrontSecondLine,o)||(t.filterData.extras.golfFrontSecondLine=o),e.Njj(o)}),e.k0s(),e.j41(139,"div",29),e.EFF(140,"2\xaa l\xednea de golf"),e.k0s()()()()()()()}2&i&&(e.R7$(17),e.R50("ngModel",t.filterData.province),e.Y8G("ngModelOptions",e.lJ4(30,F)),e.R7$(6),e.R50("ngModel",t.filterData.city),e.Y8G("ngModelOptions",e.lJ4(31,F)),e.R7$(7),e.R50("ngModel",t.filterData.price.min),e.R7$(5),e.R50("ngModel",t.filterData.price.max),e.R7$(6),e.R50("ngModel",t.filterData.propertySubtypes),e.R7$(),e.Y8G("ngForOf",t.subtypesOptions),e.R7$(6),e.R50("ngModel",t.filterData.constructionStatus),e.R7$(),e.Y8G("ngForOf",t.constructionStateOptions),e.R7$(6),e.R50("ngModel",t.keyDeliveryOption),e.R7$(),e.Y8G("ngForOf",t.keyDeliveryOptions),e.R7$(5),e.Y8G("ngForOf",t.bedroomOptions),e.R7$(5),e.Y8G("ngForOf",t.bathroomOptions),e.R7$(6),e.R50("ngModel",t.filterData.builtArea.min),e.R7$(5),e.R50("ngModel",t.filterData.builtArea.max),e.R7$(6),e.R50("ngModel",t.filterData.plotArea.min),e.R7$(5),e.R50("ngModel",t.filterData.plotArea.max),e.R7$(6),e.R50("ngModel",t.filterData.extras.communityPool),e.R7$(4),e.R50("ngModel",t.filterData.extras.privatePool),e.R7$(4),e.R50("ngModel",t.filterData.extras.parking),e.R7$(4),e.R50("ngModel",t.filterData.extras.elevator),e.R7$(4),e.R50("ngModel",t.filterData.extras.touristLicense),e.R7$(4),e.R50("ngModel",t.filterData.extras.storageRoom),e.R7$(4),e.R50("ngModel",t.filterData.extras.basement),e.R7$(4),e.R50("ngModel",t.filterData.extras.solarium),e.R7$(4),e.R50("ngModel",t.filterData.extras.beachfrontFirstLine),e.R7$(4),e.R50("ngModel",t.filterData.extras.beachfrontSecondLine),e.R7$(4),e.R50("ngModel",t.filterData.extras.golfFrontFirstLine),e.R7$(4),e.R50("ngModel",t.filterData.extras.golfFrontSecondLine))},dependencies:[_.Sq,v.qT,v.me,v.Q0,v.BC,v.cb,v.vS,v.cV,f.eY,f.uz,f.nf,f.Nm,f.Ip,f.hB,f.Je],styles:[".max-price-input[_ngcontent-%COMP%]{margin-top:15px}.crm-select-item[_ngcontent-%COMP%]{font-size:var(--crm-input-input-font-size)}.crm-select-item[_ngcontent-%COMP%]   ion-select-option[_ngcontent-%COMP%]{font-size:var(--crm-input-input-font-size)}"]}),m})();const R=a=>({"crm-button-secondary-primary":a});function A(a,m){1&a&&(e.j41(0,"button",33),e.nrm(1,"i",34),e.EFF(2," A\xf1adir promoci\xf3n "),e.k0s()),2&a&&e.Y8G("routerLink","/promotions/create")}function O(a,m){1&a&&(e.nrm(0,"i",35),e.EFF(1," Cerrar filtros "))}function N(a,m){1&a&&(e.nrm(0,"i",36),e.EFF(1," Filtros activados "))}function V(a,m){1&a&&(e.nrm(0,"i",36),e.EFF(1," Filtrar "))}function G(a,m){if(1&a&&e.DNE(0,N,2,0)(1,V,2,0),2&a){const u=e.XpG();e.vxM(u.filters?0:1)}}function Y(a,m){if(1&a&&(e.j41(0,"div",27),e.EFF(1),e.k0s()),2&a){const u=e.XpG();e.R7$(),e.SpI(" ",u.checkedPromotions," seleccionado ")}}function w(a,m){1&a&&(e.j41(0,"div",31),e.nrm(1,"app-card-promotion",37)(2,"app-card-promotion",37)(3,"app-card-promotion",37),e.k0s()),2&a&&(e.R7$(),e.Y8G("isSkeleton",!0),e.R7$(),e.Y8G("isSkeleton",!0),e.R7$(),e.Y8G("isSkeleton",!0))}function $(a,m){if(1&a){const u=e.RV6();e.j41(0,"app-card-promotion",40),e.bIt("togglePromotionCheckbox",function(){e.eBV(u);const t=e.XpG(2);return e.Njj(t.onTogglePromotionCheckbox())}),e.k0s()}2&a&&e.Y8G("promotion",m.$implicit)}function U(a,m){1&a&&(e.j41(0,"div",39),e.EFF(1," A\xfan no hay promociones "),e.k0s())}function H(a,m){if(1&a&&(e.j41(0,"div",31),e.Z7z(1,$,1,1,"app-card-promotion",38,e.fX1),e.DNE(3,U,2,0,"div",39),e.k0s()),2&a){const u=e.XpG();e.R7$(),e.Dyx(u.promotions),e.R7$(2),e.vxM(0===u.promotions.length?3:-1)}}function X(a,m){if(1&a){const u=e.RV6();e.j41(0,"div",32)(1,"app-promotions-filter-block",41),e.bIt("onFilter",function(t){e.eBV(u);const r=e.XpG();return e.Njj(r.onFilter(t))})("setFilter",function(t){e.eBV(u);const r=e.XpG();return e.Njj(r.isFilterSet=t)}),e.k0s()()}2&a&&e.Y8G("@biggerFadeSlideIn",void 0)}const W=[{path:"",component:(()=>{var a;class m{constructor(i,t,r,l,o,h){this.api=i,this.router=t,this.toastService=r,this.headerService=l,this.state=o,this.popoversService=h,this.promotions=[],this.allSystemPromotionsCount=0,this.checkedPromotions=0,this.isFilterSet=!1,this.searchString="",this.searchSubject=new P.B,this.promotionPrismaFilter={},this.promotionsJoinTables={},this.aside={type:"filters",visible:!1},this.filters=null,this.sort=null,this.pagination={page:0,itemsPerPage:25},this.promotionsCount=0,this.loadingList=!1}ngOnInit(){this.getState()}ionViewWillEnter(){this.headerService.setConfig({title:"promotions"}),this.getData()}onFilter(i){this.promotionPrismaFilter=i.filter,this.promotionsJoinTables=i.joinTables,this.pagination.page=0,this.getData()}onTogglePromotionCheckbox(){this.setNumberOfCheckedPromotions()}onToggleAllCheckboxes(i){this.promotions.forEach(t=>t.checked=i.detail.checked),this.setNumberOfCheckedPromotions()}onSearchInputChange(i){this.searchSubject.next(i.target.value)}onSearchChanged(i){this.searchString=i}onToggleAside(){this.aside.visible=!this.aside.visible}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemPromotionsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}updatePagination(){const i=this.pagination.page*this.pagination.itemsPerPage+1,t=Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemPromotionsCount);console.log(i),console.log(t)}setNumberOfCheckedPromotions(){this.checkedPromotions=this.promotions.filter(i=>i.checked).length}getData(){var i=this;return(0,C.A)(function*(){let t;try{var r,l,o,h;if(i.loadingList=!0,t=yield i.getPromotions(),null!==(r=t)&&void 0!==r&&r.error)throw new Error("Error fetching promotions");i.promotions=(null===(l=t)||void 0===l||null===(l=l.success)||void 0===l?void 0:l.data)||[],console.log("ALL PROMOTIONS",i.promotions),i.allSystemPromotionsCount=(null===(o=t)||void 0===o||null===(o=o.success)||void 0===o||null===(o=o.metadata)||void 0===o?void 0:o.count)||0,i.pagination.page=0,i.promotionsCount=(null===(h=t)||void 0===h||null===(h=h.success)||void 0===h||null===(h=h.metadata)||void 0===h?void 0:h.count)||0,i.setNumberOfCheckedPromotions(),i.updatePagination(),i.loadingList=!1}catch{i.toastService.showToast({text:"Ha ocurrido un error al cargar los procedimientos",theme:"red",icon:"fas fa-exclamation-triangle",time:1e4}),i.loadingList=!1}})()}getState(){this.state.getState().subscribe(i=>{this.currentUser=i.user})}getPromotions(){var i=this;return(0,C.A)(function*(){let t;return t=i.isFilterSet?yield i.api.getPromotions(i.promotionPrismaFilter,i.sort,i.pagination,{properties:{apply:!0,filter:null,onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},promoter:{apply:!0,filter:null,onlyCount:!1},...i.promotionsJoinTables}):yield i.api.getPromotions({},i.sort,i.pagination,{properties:{apply:!0,filter:null,onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},promoter:{apply:!0,filter:null,onlyCount:!1}}),t})()}onSort(i){var t=this;return(0,C.A)(function*(){const r=yield t.popoversService.onShowMenuPopover(i,"list-order");if(console.log("Popover result:",r),null!=r&&r.data){const l=r.data;if(l.includes("_")){const o=l.split("_")[0],h=l.split("_")[1];t.sort={field:o,order:h}}else t.sort={field:l,order:"asc"};t.getData()}})()}}return(a=m).\u0275fac=function(i){return new(i||a)(e.rXU(y.i),e.rXU(D.Ix),e.rXU(M.f),e.rXU(x.d),e.rXU(n.c),e.rXU(c.m))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-promotion-list"]],decls:42,vars:13,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content"],[1,"crm-block-body"],[1,"crm-block-body-fixed"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar promoci\xf3n",3,"input"],[1,"crm-buttons-group"],["class","crm-button",3,"routerLink",4,"ngIf"],[1,"crm-button-secondary",3,"click","ngClass"],[1,"crm-block-pagination-selectors"],[1,"crm-button-pagination"],[1,"crm-button-pagination-text"],[1,"crm-button-pagination-buttons"],[1,"crm-button-pagination-arrow","crm-button-icon-solo",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-button-pagination-number"],[1,"fas","fa-arrow-right"],[1,"crm-dropdown",3,"click"],[1,"crm-dropdown-text"],[1,"crm-dropdown-right"],[1,"crm-dropdown-value"],[1,"crm-dropdown-arrow"],[1,"fas","fa-chevron-down"],[1,"crm-input-checkbox"],[1,"crm-input-checkbox-pre-label"],[3,"ionChange"],[1,"crm-input-checkbox-label"],[1,"crm-block-body-blue-content",2,"overflow-x","auto"],[2,"display","flex","align-items","flex-start","flex-wrap","wrap","gap","20px"],[1,"crm-block-content-aside"],[1,"crm-button",3,"routerLink"],[1,"fa","fa-plus"],[1,"fa","fa-times"],[1,"fa","fa-filter"],[3,"isSkeleton"],[3,"promotion"],[1,"crm-empty-list","crm-text"],[3,"togglePromotionCheckbox","promotion"],[3,"onFilter","setFilter"]],template:function(i,t){1&i&&(e.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),e.nrm(7,"i",7),e.j41(8,"input",8),e.bIt("input",function(l){return t.onSearchInputChange(l)}),e.k0s()()(),e.j41(9,"div",9),e.DNE(10,A,3,1,"button",10),e.j41(11,"button",11),e.bIt("click",function(){return t.onToggleAside()}),e.DNE(12,O,2,0)(13,G,2,1),e.k0s()()(),e.j41(14,"div",12)(15,"div",13),e.nrm(16,"div",14),e.j41(17,"div",15)(18,"button",16),e.bIt("click",function(){return t.onGoPreviousPage()}),e.nrm(19,"i",17),e.k0s(),e.j41(20,"div",18),e.EFF(21),e.k0s(),e.j41(22,"button",16),e.bIt("click",function(){return t.onGoNextPage()}),e.nrm(23,"i",19),e.k0s()(),e.j41(24,"div",20),e.bIt("click",function(l){return t.onSort(l)}),e.j41(25,"div",21),e.EFF(26," Ordenar por "),e.k0s(),e.j41(27,"div",22)(28,"div",23),e.EFF(29),e.k0s(),e.j41(30,"div",24),e.nrm(31,"i",25),e.k0s()()()(),e.nrm(32,"div"),e.j41(33,"div",26),e.DNE(34,Y,2,1,"div",27),e.j41(35,"ion-checkbox",28),e.bIt("ionChange",function(l){return t.onToggleAllCheckboxes(l)}),e.k0s(),e.j41(36,"div",29),e.EFF(37),e.k0s()()()(),e.j41(38,"div",30),e.DNE(39,w,4,3,"div",31)(40,H,4,1,"div",31),e.k0s()(),e.DNE(41,X,2,1,"div",32),e.k0s()()),2&i&&(e.Y8G("fullscreen",!0)("scrollY",!1),e.R7$(10),e.Y8G("ngIf","promoter"===(null==t.currentUser?null:t.currentUser.accountType)),e.R7$(),e.Y8G("ngClass",e.eq3(11,R,!(null!=t.aside&&t.aside.visible)&&t.filters)),e.R7$(),e.vxM(null!=t.aside&&t.aside.visible?12:13),e.R7$(9),e.SpI(" P\xe1g ",t.pagination.page+1," "),e.R7$(8),e.SpI(" ",null!=t.sort&&t.sort.field?(null==t.sort?null:t.sort.field)+" "+(null==t.sort?null:t.sort.order):"Fecha de creaci\xf3n"," "),e.R7$(5),e.vxM(t.checkedPromotions?34:-1),e.R7$(3),e.SpI(" Seleccionar ",t.promotions.length," registros "),e.R7$(2),e.vxM(t.loadingList?39:40),e.R7$(2),e.vxM(null!=t.aside&&t.aside.visible?41:-1))},dependencies:[_.YU,_.bT,f.eY,f.W9,f.hB,f.N7,D.Wk,s.X,I],data:{animation:[(0,g.hZ)("biggerFadeSlideIn",[(0,g.kY)(":enter",[(0,g.iF)({opacity:0,transform:"translateX(150px)"}),(0,g.i0)("100ms ease-out",(0,g.iF)({opacity:1,transform:"translateX(0)"}))])])]}}),m})()}];let K=(()=>{var a;class m{}return(a=m).\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[D.iI.forChild(W),D.iI]}),m})();var J=d(7991);let z=(()=>{var a;class m{}return(a=m).\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[_.MD,v.YN,f.bv,K,J.S]}),m})()},4558:(j,k,d)=>{d.d(k,{w:()=>v});var _=d(3953);let v=(()=>{var f;class D{transform(g,...P){if(null==g||""===g)return"";let e;return e="string"==typeof g?parseFloat(g):g,isNaN(e)?"":e.toString().replace(/\.(?=\d+$)/,",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}}return(f=D).\u0275fac=function(g){return new(g||f)},f.\u0275pipe=_.EJ8({name:"thousandSeparator",type:f,pure:!0}),D})()},6552:(j,k,d)=>{d.d(k,{T:()=>e});var _=d(467),v=d(7376),D=d(6069),C=d(3953),g=d(5188),P=d(6039);let e=(()=>{var y;class M{constructor(n,c){this.router=n,this.api=c}parseBackendDateToFrontendDateInput(n){if(!n)return null;try{const c=new Date(n),s=c.getFullYear();return`${s}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`}catch(c){return console.error("Invalid date format",c),null}}parseProperties(n){for(let s in n)n[s]instanceof Date?n[s]=n[s].toISOString():"string"==typeof n[s]&&n[s].match(/^\d{4}-\d{2}-\d{2}$/)&&(n[s]=new Date(n[s]).toISOString()),"true"===n[s]?n[s]=!0:"false"===n[s]&&(n[s]=!1);const c=v.cloneDeep(n);return delete c.id,c}parseNameToValue(n){return n.toLowerCase().replace(/ /g,"_")}groupPropertiesByPromotion(n,c){return n.map(p=>{const b=c.filter(F=>F.promotionId===p.id);return{...p,properties:b}})}setStepsCompleted(n,c){return n.steps=v.orderBy(n.steps,["order"],["asc"]),n.steps=n.steps.map(s=>(s.order<c.order&&(s.isCompleted=!0),s)),n}hexToRgba(n,c){if(!n)return"";let s,p,b;if(3===(n=n.replace("#","")).length)s=parseInt(n[0]+n[0],16),p=parseInt(n[1]+n[1],16),b=parseInt(n[2]+n[2],16);else{if(6!==n.length)return"";s=parseInt(n.substring(0,2),16),p=parseInt(n.substring(2,4),16),b=parseInt(n.substring(4,6),16)}return`rgba(${s}, ${p}, ${b}, ${c})`}getLanguageInfo(n){return D.e.find(s=>s.code===n)||{}}getCountryInfo(n){return D.X.find(s=>s.code===n)||{}}countAvailableProperties(n){return n&&0!==n.length?n.filter(c=>"available"===c.availabilityStatus).length:0}calculateRangeOfPropertiesPrices(n){if(!n||0===n.length)return{min:0,max:0};const c=n.map(s=>s.price);return{min:Math.min(...c),max:Math.max(...c)}}calculateRangeOfPropertiesRooms(n){if(!n||0===n.length)return{min:0,max:0};const c=n.map(s=>s.bedrooms);return{min:Math.min(...c),max:Math.max(...c)}}onRemoveAgencyAccessToPromotion(n){console.log("onRemoveAgencyAccessToPromotion",n)}redirectToPromoter(n){this.router.navigate([`/promoters/${n.id}`])}filterFilesByCategoryAndSort(n,c){return n&&0!==n.length?n.filter(s=>s.category===c).sort((s,p)=>{var b,F;return(null!==(b=null==s?void 0:s.orderIndex)&&void 0!==b?b:0)-(null!==(F=null==p?void 0:p.orderIndex)&&void 0!==F?F:0)}):[]}transformThousandSeparator(n){if(null==n||""===n)return"";let c;return c="string"==typeof n?parseFloat(n):n,isNaN(c)?"":c.toString().replace(/\.(?=\d+$)/,",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}detectIfPromotionIsCompleted(n){var c=this;return(0,_.A)(function*(){var s;if(!n)return!1;const p=null===(s=yield c.api.getPromotionById(n.id))||void 0===s||null===(s=s.success)||void 0===s?void 0:s.data;return((null==p?void 0:p.deliveryDateModalityByStatus)||(null==p?void 0:p.deliveryDateModalityByMonths))&&!(null==p||!p.sellCommissionPercentage)&&!(null==p||!p.methodToPayCommissions)&&!(null==p||!p.reservePayment)&&((null==p?void 0:p.registersWithPreRegister)||(null==p?void 0:p.registersWithoutPreRegister))})()}isImageFile(n){var c;const p=null===(c=n.split(".").pop())||void 0===c?void 0:c.toLowerCase();return!!p&&["png","jpg","jpeg","gif","bmp","webp","svg","tiff","tif","ico","heic","jfif"].includes(p)}}return(y=M).\u0275fac=function(n){return new(n||y)(C.KVO(g.Ix),C.KVO(P.i))},y.\u0275prov=C.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),M})()}}]);