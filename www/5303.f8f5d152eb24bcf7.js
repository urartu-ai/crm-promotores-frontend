"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5303],{5303:(Xt,F,c)=>{c.r(F),c.d(F,{ContactDetailsPageModule:()=>At});var m=c(177),g=c(9417),_=c(9465),f=c(5188),d=c(467),R=c(7376),t=c(3953),M=c(4501),b=c(9333),C=c(8397),T=c(6552),k=c(1213),v=c(8147),D=c(2606),$=c(8433),P=c(5419),E=c(6039),O=c(3303);const S=["contactForm"];function A(o,i){if(1&o){const e=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onSaveContact())}),t.nrm(1,"i",8),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&o&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"CONTACT_DETAILS_INFO.SAVE_CONTACT")," "))}function U(o,i){if(1&o){const e=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onEditContact())}),t.nrm(1,"i",10),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&o&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"CONTACT_DETAILS_INFO.EDIT_CONTACT")," "))}let G=(()=>{var o;class i{constructor(a,n,l){this.api=a,this.toastService=n,this.contactsService=l,this.contact=null,this.saveContact=new t.bkB,this.editing=!1}setContactInfo(){this.editing=!0,setTimeout(()=>{this.editing=!1},10)}ngOnInit(){this.setContactInfo()}onEditContact(){this.editing=!0,this.contactForm.fileUploaderManager.setEditingMode(!0)}onSaveContact(){var a=this;return(0,d.A)(function*(){var n;(yield a.contactsService.createOrUpdateContactFromForm(a.contactForm,null===(n=a.contact)||void 0===n?void 0:n.id))&&(a.editing=!1,a.contactForm.fileUploaderManager.setEditingMode(!1),a.saveContact.emit())})()}}return(o=i).\u0275fac=function(a){return new(a||o)(t.rXU(E.i),t.rXU(C.f),t.rXU(b.F))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-contact-details-info"]],viewQuery:function(a,n){if(1&a&&t.GBs(S,5),2&a){let l;t.mGM(l=t.lsd())&&(n.contactForm=l.first)}},inputs:{contact:"contact"},outputs:{saveContact:"saveContact"},decls:8,vars:3,consts:[["contactForm",""],[1,"crm-header-modal","crm-header-modal-empty","details"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button-secondary"],[1,"crm-boxes-user-create"],[2,"width","100%",3,"contact","disabled"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa","fa-check"],[1,"crm-button-secondary",3,"click"],[1,"fa","fa-edit"]],template:function(a,n){1&a&&(t.j41(0,"div",1),t.nrm(1,"div"),t.j41(2,"div",2),t.DNE(3,A,4,3,"button",3)(4,U,4,3,"button",4),t.k0s()(),t.j41(5,"div",5),t.nrm(6,"app-contact-form",6,0),t.k0s()),2&a&&(t.R7$(3),t.vxM(n.editing?3:4),t.R7$(3),t.Y8G("contact",n.contact)("disabled",!n.editing))},dependencies:[O.q,v.D9]}),i})();var X=c(638),N=c(7380),Y=c(363),B=c(1852);const x=o=>({item:o}),J=o=>({index:o}),V=o=>({reference:o}),w=(o,i)=>({"background-color":o,color:i}),z=o=>({mode:"contact",contactId:o,itemsPerPage:5});function L(o,i){if(1&o&&(t.j41(0,"div",33),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"contacts.operations.property",t.eq3(4,V,null==e||null==e.mainProperty?null:e.mainProperty.reference))," ")}}function H(o,i){if(1&o&&(t.j41(0,"div",42),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit,a=t.XpG();t.Y8G("ngStyle",t.l_i(2,w,a.utils.hexToRgba(null==e||null==e.currentPipelineStep?null:e.currentPipelineStep.color,.1),null==e||null==e.currentPipelineStep?null:e.currentPipelineStep.color)),t.R7$(),t.SpI(" ",null==e||null==e.currentPipelineStep?null:e.currentPipelineStep.text," ")}}function K(o,i){1&o&&(t.j41(0,"div",43),t.EFF(1," fill "),t.k0s())}function Q(o,i){if(1&o){const e=t.RV6();t.j41(0,"div",27),t.bIt("click",function(){const n=t.eBV(e).$implicit,l=t.XpG();return t.Njj(l.onOpenOperation(n))}),t.j41(1,"div",28)(2,"div",29),t.nrm(3,"img",30),t.k0s(),t.j41(4,"div",31)(5,"div",32),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.DNE(8,L,3,6,"div",33),t.k0s()(),t.j41(9,"div",34)(10,"div",35)(11,"div",36)(12,"div",37),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"div",38)(16,"div"),t.EFF(17),t.nI1(18,"date"),t.k0s()()(),t.j41(19,"div",36)(20,"div",37),t.EFF(21),t.nI1(22,"translate"),t.k0s(),t.j41(23,"div",38)(24,"div",39)(25,"div",40),t.EFF(26),t.k0s()()()()()(),t.j41(27,"div",41),t.DNE(28,H,2,5,"div",42)(29,K,2,0,"div",43),t.k0s()()}if(2&o){const e=i.$implicit,a=i.$index;t.R7$(3),t.Y8G("src","assets/images/building.png",t.B4B),t.R7$(3),t.SpI(" ",t.i5U(7,8,"contacts.operations.item",t.eq3(18,J,a+1))," "),t.R7$(2),t.vxM(null!=e&&e.mainProperty?8:-1),t.R7$(5),t.JRh(t.bMT(14,11,"contacts.operations.created_at")),t.R7$(4),t.SpI(" ",t.i5U(18,13,e.createdAt,"dd/MM/yyyy")," "),t.R7$(4),t.JRh(t.bMT(22,16,"contacts.operations.responsible")),t.R7$(5),t.SpI(" ",(null==e||null==e.responsible?null:e.responsible.name)||(null==e||null==e.createdBy?null:e.createdBy.name)," "),t.R7$(2),t.vxM(null!=e&&null!=e.currentPipelineStep&&e.currentPipelineStep.text?28:29)}}function Z(o,i){if(1&o&&(t.j41(0,"div"),t.nrm(1,"app-autolead-email-list-viewer",44),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Y8G("options",t.eq3(1,z,null==e.contact?null:e.contact.id))}}function W(o,i){1&o&&t.nrm(0,"i",19)}function q(o,i){1&o&&t.nrm(0,"i",20)}function tt(o,i){if(1&o){const e=t.RV6();t.j41(0,"div",21)(1,"div",45)(2,"button",46),t.nrm(3,"i",47),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"button",48),t.nrm(7,"i",49),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"button",48),t.nrm(11,"i",50),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",48),t.nrm(15,"i",51),t.EFF(16),t.nI1(17,"translate"),t.k0s()(),t.j41(18,"app-activity-creation-block",52),t.bIt("onNoteCreated",function(n){t.eBV(e);const l=t.XpG();return t.Njj(l.onNoteCreated(n))}),t.k0s()()}if(2&o){const e=t.XpG();t.R7$(4),t.SpI(" ",t.bMT(5,5,"text.note")," "),t.R7$(4),t.SpI(" ",t.bMT(9,7,"text.visit")," "),t.R7$(4),t.SpI(" ",t.bMT(13,9,"text.mail")," "),t.R7$(4),t.SpI(" ",t.bMT(17,11,"text.task")," "),t.R7$(2),t.Y8G("options",e.creationBlockActivityCreationOptions)}}let nt=(()=>{var o;class i{constructor(a,n,l,s,r,p,u){this.modalService=a,this.api=n,this.router=l,this.toast=s,this.byvaroState=r,this.utils=p,this.translate=u,this.operationIdToOpenFromUrl=null,this.operationActivityData={notes:[],operationHistorics:[],operation:null},this.operations=[],this.collapsedActivityAdder=!1,this.creationBlockActivityCreationOptions={type:"note",activityType:"contact",contactId:null,operationId:null}}ngOnChanges(){this.contact&&(this.getUserInfo(),this.getOperations(),this.getUserNotes(),this.creationBlockActivityCreationOptions.contactId=this.contact.id)}onOpenOperation(a){var n=this;return(0,d.A)(function*(){yield(yield n.modalService.showOperationModal(null==a?void 0:a.id)).onDidDismiss(),n.getOperations()})()}onNoteCreated(a){console.log("note created",a),this.getUserNotes()}onAddOperation(){var a=this;return(0,d.A)(function*(){var n;const s=yield(yield a.modalService.showOperationPropertiesSearchModal()).onDidDismiss();null!=s&&null!==(n=s.data)&&void 0!==n&&n.checkedProperties&&a.createOperation(s.data.checkedProperties)})()}getUserInfo(){this.byvaroState.getState().subscribe(a=>{this.currentUser=a.user,this.userAgency=a.agency,this.userPromoter=a.promoter})}getUserNotes(){var a=this;return(0,d.A)(function*(){var n;const l=yield a.api.getNote({contactId:{equals:a.contact.id}},{field:"createdAt",order:"desc"},null,{createdBy:{apply:!0,filter:null,onlyCount:!1}});a.operationActivityData.notes=(null===(n=l.success)||void 0===n?void 0:n.data)||[]})()}getPipelines(){var a=this;return(0,d.A)(function*(){var n;return(null===(n=(yield a.api.getPipelines({},null,null,{steps:{apply:!0,filter:null,onlyCount:!1}})).success)||void 0===n?void 0:n.data)||[]})()}getOperations(){var a=this;return(0,d.A)(function*(){var n;const l=yield a.api.getOperation({contactId:{equals:a.contact.id}},null,null,{contact:{apply:!0,filter:null,onlyCount:!1},createdBy:{apply:!0,filter:null,onlyCount:!1},responsible:{apply:!0,filter:null,onlyCount:!1},mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1},selectedProperties:{apply:!0,filter:null,onlyCount:!1},notes:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1}});if(a.operations=(null===(n=l.success)||void 0===n?void 0:n.data)||[],a.operationIdToOpenFromUrl){const s=a.operations.find(r=>r.id===a.operationIdToOpenFromUrl);s&&(a.onOpenOperation(s),a.operationIdToOpenFromUrl=null)}})()}createOperation(a){var n=this;return(0,d.A)(function*(){var l,s,r,p;let u=null,h=yield n.getPipelines();h.length>0&&(u=h.find(I=>"operaciones"===I.title),u.steps=(0,R.sortBy)(u.steps,"order"));const Ut={operationType:n.currentUser.accountType,contactId:n.contact.id,promoterId:null===(l=n.userPromoter)||void 0===l?void 0:l.id,agencyId:null===(s=n.userAgency)||void 0===s?void 0:s.id,createdById:n.currentUser.id,responsibleId:n.currentUser.id,currentPipelineId:null===(r=u)||void 0===r?void 0:r.id,currentPipelineStepId:u?u.steps[0].id:null},y=yield n.api.createOperation(Ut),j=null===(p=y.success)||void 0===p?void 0:p.data,Gt=a.map(I=>I.id);yield n.api.linkPropertiesToOperation(j.id,Gt),yield n.setMainProperty(a[0].id,j.id),n.toast.showToast(y.success?{text:n.translate.instant("contacts.operations.creation_success"),theme:"success",time:2e3}:{text:n.translate.instant("contacts.operations.creation_error")+y.error.errorMessage,theme:"red",time:2e3}),n.getOperations()})()}setMainProperty(a,n){var l=this;return(0,d.A)(function*(){yield l.api.updateOperationById(n,{mainPropertyId:a})})()}}return(o=i).\u0275fac=function(a){return new(a||o)(t.rXU(X.M),t.rXU(E.i),t.rXU(f.Ix),t.rXU(C.f),t.rXU(k.c),t.rXU(T.T),t.rXU(v.c$))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-contact-details-operations"]],inputs:{contact:"contact",operationIdToOpenFromUrl:"operationIdToOpenFromUrl"},features:[t.OA$],decls:47,vars:21,consts:[[1,"crm-opp-contact-screen"],[1,"crm-opp-contact-screen-left"],[1,"crm-section","crm-section-padding","big-padding"],[1,"crm-header-icon","no-padding","no-line","no-background"],[1,"crm-header-icon-left"],[1,"crm-square-icon"],[1,"fa-solid","fa-bullseye"],[1,"crm-header-icon-title"],[1,"crm-header-icon-right"],[1,"crm-button",3,"click"],[1,"fas","fa-plus"],[1,"crm-section-operations"],[1,"crm-item-operation"],[1,"crm-opp-contact-screen-right"],[1,"crm-section","crm-section-padding"],[1,"crm-section"],[1,"crm-header-icon","crm-header-icon-less-padding","no-line","no-padding"],[1,"fa-solid","fa-add"],[1,"crm-button-icon-solo",3,"click"],[1,"fas","fa-chevron-up"],[1,"fas","fa-chevron-down"],[1,"crm-activity"],[1,"crm-horizontal-separator"],[1,"fa-solid","fa-clock-rotate-left"],[1,"crm-button-icon-solo"],[1,"fas","fa-filter"],[3,"data"],[1,"crm-item-operation",3,"click"],[1,"crm-item-operation-left"],[1,"crm-item-operation-left-image"],["alt","",3,"src"],[1,"crm-item-operation-left-info"],[1,"crm-item-operation-left-info-promotion"],[1,"crm-item-operation-left-info-property"],[1,"crm-item-operation-center"],[1,"crm-block-info-horizontal"],[1,"crm-info"],[1,"crm-info-title"],[1,"crm-info-content"],[1,"crm-item-reference"],[1,"crm-item-reference-text"],[1,"crm-item-operation-right"],[1,"crm-item-chip","crm-item-chip-warn",3,"ngStyle"],[1,"crm-item-chip","crm-item-chip-warn",2,"visibility","hidden"],[3,"options"],[1,"crm-activity-selector"],[1,"crm-button","crm-button-center"],[1,"fas","fa-note-sticky"],[1,"crm-button-secondary","crm-button-secondary-primary","crm-button-center"],[1,"fas","fa-calendar-alt"],[1,"fas","fa-envelope"],[1,"fas","fa-check"],[3,"onNoteCreated","options"]],template:function(a,n){1&a&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"i",6),t.k0s(),t.j41(7,"div",7),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.j41(10,"div",8)(11,"button",9),t.bIt("click",function(){return n.onAddOperation()}),t.nrm(12,"i",10),t.EFF(13),t.nI1(14,"translate"),t.nI1(15,"translate"),t.k0s()()(),t.j41(16,"div",11),t.Z7z(17,Q,30,20,"div",12,t.fX1),t.k0s(),t.DNE(19,Z,2,3,"div"),t.k0s()(),t.j41(20,"div",13)(21,"div",14)(22,"div",15)(23,"div",16)(24,"div",4)(25,"div",5),t.nrm(26,"i",17),t.k0s(),t.j41(27,"div",7),t.EFF(28),t.nI1(29,"translate"),t.k0s()(),t.j41(30,"div",8)(31,"button",18),t.bIt("click",function(){return n.collapsedActivityAdder=!n.collapsedActivityAdder}),t.DNE(32,W,1,0,"i",19)(33,q,1,0,"i",20),t.k0s()()(),t.DNE(34,tt,19,13,"div",21),t.nrm(35,"div",22),t.j41(36,"div",16)(37,"div",4)(38,"div",5),t.nrm(39,"i",23),t.k0s(),t.j41(40,"div",7),t.EFF(41),t.nI1(42,"translate"),t.k0s()(),t.j41(43,"div",8)(44,"button",24),t.nrm(45,"i",25),t.k0s()()(),t.nrm(46,"app-operation-activity-block",26),t.k0s()()()()),2&a&&(t.R7$(8),t.SpI(" ",t.bMT(9,8,"text.operations")," "),t.R7$(5),t.SpI(" ",t.i5U(15,12,"text.add_item",t.eq3(19,x,t.bMT(14,10,"text.operation")))," "),t.R7$(4),t.Dyx(n.operations),t.R7$(2),t.vxM(n.contact?19:-1),t.R7$(9),t.SpI(" ",t.bMT(29,15,"contacts.operations.add_activity")," "),t.R7$(4),t.vxM(n.collapsedActivityAdder?32:33),t.R7$(2),t.vxM(n.collapsedActivityAdder?-1:34),t.R7$(7),t.SpI(" ",t.bMT(42,17,"contacts.operations.history")," "),t.R7$(5),t.Y8G("data",n.operationActivityData))},dependencies:[m.B3,N.$,Y.T,B.n,m.vh,v.D9]}),i})();const et=o=>({"no-padding":o}),ot=(o,i,e)=>({startDate:o,destinataryEmail:i,senderEmail:e}),at=o=>({filter:o}),it=(o,i,e)=>({title:o,connectionId:i,filter:e,itemsPerPage:100}),lt=o=>({father:"contact",contactId:o});function ct(o,i){if(1&o&&(t.j41(0,"div",20)(1,"div",21)(2,"div",22),t.nrm(3,"span",23),t.k0s()()()),2&o){let e,a;const n=t.XpG().$implicit,l=t.XpG(2);t.R7$(3),t.HbH(null==(e=l.utils.getLanguageInfo(n))?null:e.flagClass),t.Y8G("title",null==(a=l.utils.getLanguageInfo(n))?null:a.name)}}function st(o,i){1&o&&t.DNE(0,ct,4,3,"div",20),2&o&&t.vxM(i.$index<4?0:-1)}function rt(o,i){if(1&o&&(t.j41(0,"div",16),t.EFF(1),t.k0s()),2&o){const e=t.XpG(2);t.R7$(),t.SpI(" +",(null==e.contact?null:e.contact.languages.length)-4," ")}}function dt(o,i){if(1&o&&(t.j41(0,"div",19),t.Z7z(1,st,1,1,null,null,t.fX1),t.k0s(),t.DNE(3,rt,2,1,"div",16)),2&o){const e=t.XpG();t.R7$(),t.Dyx(null==e.contact?null:e.contact.languages),t.R7$(2),t.vxM((null==e.contact?null:e.contact.languages.length)>4?3:-1)}}function ut(o,i){1&o&&t.nrm(0,"div",16)}function pt(o,i){1&o&&(t.j41(0,"span"),t.EFF(1,"s"),t.k0s())}function mt(o,i){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.JRh(null==e.contact||null==e.contact.phones?null:e.contact.phones[0])}}function vt(o,i){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.JRh(null==e.contact||null==e.contact.phones?null:e.contact.phones[1])}}function ft(o,i){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.SpI("+",(null==e.contact||null==e.contact.phones?null:e.contact.phones.length)-2,"")}}function _t(o,i){1&o&&(t.j41(0,"span"),t.EFF(1,"s"),t.k0s())}function ht(o,i){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.JRh(null==e.contact||null==e.contact.emails?null:e.contact.emails[0])}}function gt(o,i){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.JRh(null==e.contact||null==e.contact.emails?null:e.contact.emails[1])}}function Ct(o,i){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.SpI("+",(null==e.contact||null==e.contact.emails?null:e.contact.emails.length)-2,"")}}function yt(o,i){if(1&o&&(t.j41(0,"div",13)(1,"div",14),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",18)(5,"div",34)(6,"div",35),t.EFF(7),t.k0s()()()()),2&o){const e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,2,"contacts.details.related_to")),t.R7$(5),t.SpI(" ",(null==e.contact||null==e.contact.contactsRelation||null==e.contact.contactsRelation[0]||null==e.contact.contactsRelation[0].contact?null:e.contact.contactsRelation[0].contact.name)||(null==e.contact||null==e.contact.contactsRelated||null==e.contact.contactsRelated[0]||null==e.contact.contactsRelated[0].contact?null:e.contact.contactsRelated[0].contact.name)," ")}}function It(o,i){1&o&&(t.j41(0,"div",38),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"contacts.details.autolead_warning")," "))}function Ft(o,i){if(1&o){const e=t.RV6();t.j41(0,"div",40)(1,"ion-radio-group",41),t.mxI("ngModelChange",function(n){t.eBV(e);const l=t.XpG(3);return t.DH7(l.showReceivedEmails,n)||(l.showReceivedEmails=n),t.Njj(n)}),t.j41(2,"div",42),t.nrm(3,"ion-radio",43),t.j41(4,"div",44),t.EFF(5),t.nI1(6,"translate"),t.k0s()(),t.j41(7,"div",42),t.nrm(8,"ion-radio",43),t.j41(9,"div",44),t.EFF(10),t.nI1(11,"translate"),t.k0s()()(),t.nrm(12,"br")(13,"app-imap-email-list-viewer",37),t.k0s()}if(2&o){const e=t.XpG(3);t.R7$(),t.R50("ngModel",e.showReceivedEmails),t.R7$(2),t.Y8G("value",!0),t.R7$(2),t.SpI(" ",t.bMT(6,6,"contacts.details.received")," "),t.R7$(3),t.Y8G("value",!1),t.R7$(2),t.SpI(" ",t.bMT(11,8,"contacts.details.sent")," "),t.R7$(3),t.Y8G("options",t.sMw(16,it,e.translate.instant("contacts.details.email_list"),e.userEmailAccounts[0].id,t.eq3(14,at,t.sMw(10,ot,e.toIsoStringDate4YearsAgo,e.showReceivedEmails?e.userEmailAccounts[0].email:null==e.contact||null==e.contact.emails?null:e.contact.emails[0],e.showReceivedEmails?null==e.contact||null==e.contact.emails?null:e.contact.emails[0]:e.userEmailAccounts[0].email))))}}function Rt(o,i){if(1&o){const e=t.RV6();t.DNE(0,It,3,3,"div",38),t.j41(1,"app-contact-details-info",39),t.bIt("saveContact",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.ngOnInit())}),t.k0s(),t.DNE(2,Ft,14,20,"div",40),t.nrm(3,"br")(4,"br")(5,"br")(6,"br")(7,"br")}if(2&o){const e=t.XpG(2);t.vxM(null!=e.contact&&e.contact.isAutoCreatedFromAutoLead?0:-1),t.R7$(),t.Y8G("contact",e.contactCopy),t.R7$(),t.vxM(e.userEmailAccounts.length>0&&null!=e.contact&&null!=e.contact.emails&&e.contact.emails[0]?2:-1)}}function bt(o,i){if(1&o&&t.nrm(0,"app-contact-details-operations",36),2&o){const e=t.XpG(2);t.Y8G("contact",e.contact)("operationIdToOpenFromUrl",e.operationIdToOpenFromUrl)}}function Tt(o,i){if(1&o&&t.nrm(0,"app-operation-documents",37),2&o){const e=t.XpG(2);t.Y8G("options",t.eq3(1,lt,e.contact.id))}}function kt(o,i){if(1&o&&t.DNE(0,Rt,8,3)(1,bt,1,2,"app-contact-details-operations",36)(2,Tt,1,3,"app-operation-documents",37),2&o){const e=t.XpG();t.vxM("info"===e.activeTab?0:-1),t.R7$(),t.vxM("operations"===e.activeTab?1:-1),t.R7$(),t.vxM("documents"===e.activeTab?2:-1)}}const Dt=[{path:"",component:(()=>{var o;class i{constructor(a,n,l,s,r,p,u,h){this.headerService=a,this.activatedRoute=n,this.contactsService=l,this.toastService=s,this.router=r,this.utils=p,this.byvaroState=u,this.translate=h,this.contactParameterId=null,this.contact=null,this.contactCopy=null,this.activeTab="info",this.userEmailAccounts=[],this.showReceivedEmails=!0,this.toIsoStringDate4YearsAgo=new Date((new Date).setFullYear((new Date).getFullYear()-4)).toISOString(),this.tabs=[{id:"1",title:"info",active:!0},{id:"2",title:"operations",active:!1},{id:"3",title:"documents",active:!1}],this.operationIdToOpenFromUrl=null}ngOnInit(){this.contactParameterId=this.activatedRoute.snapshot.paramMap.get("id"),this.getData(),this.getUserInfo()}ionViewWillEnter(){this.headerService.setConfig({title:"contact_details"})}onTabClicked(a){this.activeTab=a}getUserInfo(){this.byvaroState.getState().subscribe(a=>{var n,l,s;this.currentUser=a.user,null!==(n=this.currentUser)&&void 0!==n&&n.imapEmailAccounts&&(null===(l=this.currentUser)||void 0===l?void 0:l.imapEmailAccounts.length)>0&&(this.userEmailAccounts=null===(s=this.currentUser)||void 0===s?void 0:s.imapEmailAccounts)})}getData(){var a=this;return(0,d.A)(function*(){if(a.contact=yield a.getContactById(),a.contactCopy=R.cloneDeep(a.contact),!a.contact)return a.toastService.showToast({text:a.translate.instant("contacts.details.error_not_found"),icon:"fas fa-exclamation-triangle",theme:"red",time:3e3}),void a.router.navigate(["/contacts"]);console.log(a.contact);const n=a.activatedRoute.snapshot.paramMap.get("operationId")||null;n&&(a.operationIdToOpenFromUrl=n,a.activeTab="operations")})()}getContactById(){var a=this;return(0,d.A)(function*(){return a.contactParameterId?a.contactsService.getContactById(a.contactParameterId):null})()}}return(o=i).\u0275fac=function(a){return new(a||o)(t.rXU(M.d),t.rXU(f.nX),t.rXU(b.F),t.rXU(C.f),t.rXU(f.Ix),t.rXU(T.T),t.rXU(k.c),t.rXU(v.c$))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-contact-details"]],decls:101,vars:65,consts:[[1,"crm-block-body"],[1,"crm-block-body-fixed"],[1,"crm-block-details-header"],[1,"crm-block-details-header-top"],[1,"crm-block-details-header-left"],[1,"crm-block-photo-and-info"],[1,"crm-block-photo-and-info-img"],["alt","",3,"src"],[1,"crm-block-photo-and-info-info"],[1,"crm-block-photo-and-info-info-title"],[1,"crm-block-photo-and-info-info-footer"],[1,"crm-vertical-separator"],[1,"crm-block-info-horizontal"],[1,"crm-info","crm-info-size-medium"],[1,"crm-info-title"],[1,"crm-info-content-langs"],[1,"crm-info-content-langs-plus"],[1,"crm-info","crm-info-size-small"],[1,"crm-info-content"],[1,"crm-info-content-langs-langs"],[1,"crm-item-option","crm-item-option-lang"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[3,"title"],[1,"crm-item-option-label"],[4,"ngIf"],[1,"crm-info"],[1,"crm-info-content","crm-info-content-with-icon"],[1,"fas","fa-bullseye"],[1,"crm-block-details-header-right"],[1,"crm-buttons-group"],[1,"crm-block-details-bottom"],[3,"tabClicked","tabs"],[1,"crm-block-body-blue-content",3,"ngClass"],[1,"crm-item-reference"],[1,"crm-item-reference-text"],[2,"flex","1",3,"contact","operationIdToOpenFromUrl"],[3,"options"],[1,"crm-item-chip","crm-item-chip-warn"],[3,"saveContact","contact"],[2,"width","600px"],[1,"crm-input-radios",3,"ngModelChange","ngModel"],[1,"crm-input-radio"],[3,"value"],[1,"crm-input-radio-label"]],template:function(a,n){if(1&a&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),t.nrm(7,"img",7),t.k0s(),t.j41(8,"div",8)(9,"div")(10,"div",9),t.EFF(11),t.k0s(),t.j41(12,"div",10),t.EFF(13),t.k0s()(),t.j41(14,"div")(15,"div",10),t.EFF(16),t.nI1(17,"translate"),t.nI1(18,"date"),t.k0s()()()(),t.nrm(19,"div",11),t.j41(20,"div",12)(21,"div",13)(22,"div",14),t.EFF(23),t.nI1(24,"translate"),t.k0s(),t.j41(25,"div",15),t.DNE(26,dt,4,1)(27,ut,1,0,"div",16),t.k0s()(),t.j41(28,"div",17)(29,"div",14),t.EFF(30),t.nI1(31,"translate"),t.k0s(),t.j41(32,"div",18)(33,"div",19)(34,"div",20)(35,"div",21)(36,"div",22),t.nrm(37,"span",23),t.k0s(),t.j41(38,"div",24),t.EFF(39),t.k0s()()()()()(),t.j41(40,"div",17)(41,"div",14),t.EFF(42),t.nI1(43,"translate"),t.k0s(),t.j41(44,"div",18)(45,"div"),t.EFF(46),t.k0s()()(),t.j41(47,"div",17)(48,"div",14),t.EFF(49),t.nI1(50,"translate"),t.k0s(),t.j41(51,"div",18)(52,"div"),t.EFF(53),t.k0s()()(),t.j41(54,"div",13)(55,"div",14),t.EFF(56),t.nI1(57,"translate"),t.DNE(58,pt,2,0,"span",25),t.k0s(),t.j41(59,"div",18),t.DNE(60,mt,2,1,"div",25)(61,vt,2,1,"div",25)(62,ft,2,1,"div",25),t.k0s()(),t.j41(63,"div",13)(64,"div",14),t.EFF(65),t.nI1(66,"translate"),t.DNE(67,_t,2,0,"span",25),t.k0s(),t.j41(68,"div",18),t.DNE(69,ht,2,1,"div",25)(70,gt,2,1,"div",25)(71,Ct,2,1,"div",25),t.k0s()(),t.j41(72,"div",17)(73,"div",14),t.EFF(74),t.nI1(75,"translate"),t.k0s(),t.j41(76,"div",18)(77,"div"),t.EFF(78),t.k0s()()(),t.j41(79,"div",17)(80,"div",14),t.EFF(81),t.nI1(82,"translate"),t.k0s(),t.j41(83,"div",18)(84,"div"),t.EFF(85),t.nI1(86,"date"),t.k0s()()(),t.j41(87,"div",26)(88,"div",14),t.EFF(89),t.nI1(90,"translate"),t.k0s(),t.j41(91,"div",27),t.nrm(92,"i",28),t.EFF(93),t.k0s()(),t.DNE(94,yt,8,4,"div",13),t.k0s()(),t.j41(95,"div",29),t.nrm(96,"div",30),t.k0s()(),t.j41(97,"div",31)(98,"app-tabs",32),t.bIt("tabClicked",function(s){return n.onTabClicked(s)}),t.k0s()()()(),t.j41(99,"div",33),t.DNE(100,kt,3,3),t.k0s()()),2&a){let l,s,r;t.R7$(7),t.Y8G("src",(null==n.contact?null:n.contact.photoUrl)||"assets/images/avatar.png",t.B4B),t.R7$(4),t.SpI(" ",null==n.contact?null:n.contact.name," "),t.R7$(2),t.SpI(" #",null==n.contact?null:n.contact.byvaroId," "),t.R7$(3),t.Lme(" ",t.bMT(17,37,"contacts.details.created_at")," ",t.i5U(18,39,null==n.contact?null:n.contact.createdAt,"dd/MM/yyyy")," "),t.R7$(7),t.JRh(t.bMT(24,42,"contacts.details.languages")),t.R7$(3),t.vxM(null!=n.contact&&n.contact.languages&&(null==n.contact?null:n.contact.languages.length)>0?26:27),t.R7$(4),t.JRh(t.bMT(31,44,"contacts.details.nationality")),t.R7$(7),t.HbH(null==(l=n.utils.getCountryInfo(null==n.contact?null:n.contact.nationality))?null:l.flagClass),t.Y8G("title",null==(s=n.utils.getCountryInfo(null==n.contact?null:n.contact.nationality))?null:s.name),t.R7$(2),t.SpI(" ",null==(r=n.utils.getCountryInfo(null==n.contact?null:n.contact.nationality))?null:r.name," "),t.R7$(3),t.JRh(t.bMT(43,46,"contacts.details.alias")),t.R7$(4),t.JRh(null==n.contact?null:n.contact.alias),t.R7$(3),t.JRh(t.bMT(50,48,"contacts.details.reference")),t.R7$(4),t.JRh(null==n.contact?null:n.contact.reference),t.R7$(3),t.SpI(" ",t.bMT(57,50,"contacts.details.phone"),""),t.R7$(2),t.Y8G("ngIf",(null==n.contact||null==n.contact.emails?null:n.contact.emails.length)>1),t.R7$(2),t.Y8G("ngIf",null==n.contact||null==n.contact.phones?null:n.contact.phones[0]),t.R7$(),t.Y8G("ngIf",null==n.contact||null==n.contact.phones?null:n.contact.phones[0]),t.R7$(),t.Y8G("ngIf",(null==n.contact||null==n.contact.phones?null:n.contact.phones.length)>2),t.R7$(3),t.SpI(" ",t.bMT(66,52,"contacts.details.email"),""),t.R7$(2),t.Y8G("ngIf",(null==n.contact||null==n.contact.emails?null:n.contact.emails.length)>1),t.R7$(2),t.Y8G("ngIf",null==n.contact||null==n.contact.emails?null:n.contact.emails[0]),t.R7$(),t.Y8G("ngIf",null==n.contact||null==n.contact.emails?null:n.contact.emails[0]),t.R7$(),t.Y8G("ngIf",(null==n.contact||null==n.contact.emails?null:n.contact.emails.length)>2),t.R7$(3),t.JRh(t.bMT(75,54,"contacts.details.origin")),t.R7$(4),t.JRh(null==n.contact?null:n.contact.origin),t.R7$(3),t.JRh(t.bMT(82,56,"contacts.details.created_at")),t.R7$(4),t.JRh(t.i5U(86,58,null==n.contact?null:n.contact.createdAt,"dd/MM/yyyy")),t.R7$(4),t.JRh(t.bMT(90,61,"contacts.details.operations")),t.R7$(4),t.Lme(" ",null==n.contact||null==n.contact.operations?null:n.contact.operations.length," / ",null==n.contact||null==n.contact.operations?null:n.contact.operations.length," "),t.R7$(),t.vxM((null==n.contact||null==n.contact.contactsRelation?null:n.contact.contactsRelation.length)>0||(null==n.contact||null==n.contact.contactsRelated?null:n.contact.contactsRelated.length)>0?94:-1),t.R7$(4),t.Y8G("tabs",n.tabs),t.R7$(),t.Y8G("ngClass",t.eq3(63,et,"operations"===n.activeTab)),t.R7$(),t.vxM(null!=n.contact&&n.contact.id?100:-1)}},dependencies:[m.YU,m.bT,g.BC,g.vS,_.KO,_.f0,_.Je,D.O,$.x,P.t,G,nt,m.vh,v.D9]}),i})()}];let $t=(()=>{var o;class i{}return(o=i).\u0275fac=function(a){return new(a||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[f.iI.forChild(Dt),f.iI]}),i})();var Et=c(7294),jt=c(179),Mt=c(3675),Pt=c(3274),Ot=c(3732),St=c(9066);let At=(()=>{var o;class i{}return(o=i).\u0275fac=function(a){return new(a||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[m.MD,g.YN,_.bv,$t,D.O,Et.J,v.h,jt.Y,Pt.K,Mt.S,$.x,Ot.D,St.K]}),i})()}}]);