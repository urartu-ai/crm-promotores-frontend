"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3732],{3732:(ve,T,a)=>{a.d(T,{D:()=>he});var m=a(177),M=a(4716),c=a(9417),h=a(9465),k=a(7944),U=a(7991),e=a(3953);let _=(()=>{var n;class i{}return(n=i).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.MD,c.YN]}),i})();var v=a(4842),y=a(2652),I=a(6812);let R=(()=>{var n;class i{}return(n=i).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.MD,c.YN]}),i})();var g=a(7282);let x=(()=>{var n;class i{}return(n=i).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.MD,c.YN,c.X1,h.bv,v.h,I.u,R,g.F]}),i})();var $=a(2606),E=a(179),A=a(3675),G=a(3895),D=a(9662);let N=(()=>{var n;class i{}return(n=i).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.MD,c.YN,c.X1,h.bv,y.T,g.F,D.Y,v.h]}),i})();var B=a(3274),Y=a(2306),X=a(68),V=a(144),j=a(8433),C=a(467),O=a(6552),P=a(5970),S=a(6039),w=a(8397),L=a(1129);const z=["fileUploaderManagerComponent"],f=n=>({"crm-input-input-error":n}),b=n=>({field:n}),H=n=>({item:n});function K(n,i){1&n&&(e.j41(0,"div",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function J(n,i){1&n&&(e.j41(0,"div",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function Z(n,i){1&n&&(e.j41(0,"div",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function Q(n,i){1&n&&(e.j41(0,"div",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function W(n,i){if(1&n){const r=e.RV6();e.j41(0,"div",15)(1,"div",25)(2,"div",26),e.nrm(3,"span"),e.k0s(),e.j41(4,"div",27),e.EFF(5),e.k0s()(),e.j41(6,"div",28),e.bIt("click",function(){const o=e.eBV(r).$implicit,s=e.XpG();return e.Njj(s.onRemoveLanguage(o))}),e.nrm(7,"i",29),e.k0s()()}if(2&n){let r,t;const o=i.$implicit,s=e.XpG();e.R7$(3),e.HbH(null==(r=s.getLanguageInfo(o))?null:r.flagClass),e.R7$(2),e.SpI(" ",null==(t=s.getLanguageInfo(o))?null:t.name," ")}}function q(n,i){if(1&n){const r=e.RV6();e.j41(0,"button",30),e.bIt("click",function(){e.eBV(r);const o=e.XpG();return e.Njj(o.changeUserInactiveState(!1))}),e.EFF(1,"Activar Usuario"),e.k0s()}}function ee(n,i){if(1&n){const r=e.RV6();e.j41(0,"button",31),e.bIt("click",function(){e.eBV(r);const o=e.XpG();return e.Njj(o.changeUserInactiveState(!0))}),e.EFF(1,"Desactivar Usuario"),e.k0s()}}let te=(()=>{var n;class i{constructor(t,o,s,l,d){this.fb=t,this.utils=o,this.popoverService=s,this.api=l,this.toast=d,this.user={},this.onChange=new e.bkB,this.userCopy=null,this.files=[],this.photoEdited=!1}ngOnInit(){this.userCopy=JSON.parse(JSON.stringify(this.user)),this.initForm(),this.user?(this.populateForm(this.userCopy),this.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]},this.fileUploaderManager.createProfileFilePic(this.user)):this.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]}}getLanguageInfo(t){return this.utils.getLanguageInfo(t)}onAddLanguage(t){var o=this;return(0,C.A)(function*(){var s,l;const d={languageSelector:!0,showCountryCode:!1,selectedCodes:null===(s=o.user)||void 0===s?void 0:s.languages},u=yield o.popoverService.onShowCountrySelectorPopover(t,d);var F,p;null!=u&&null!==(l=u.data)&&void 0!==l&&l.country&&(o.user=o.user||{},o.user.languages=(null===(F=o.user)||void 0===F?void 0:F.languages)||[],o.user.languages.push(null===(p=u.data)||void 0===p||null===(p=p.country)||void 0===p?void 0:p.code))})()}changeUserInactiveState(t){var o=this;return(0,C.A)(function*(){const s=yield o.api.updateUserById(o.user.id,{...o.user,inactive:t});s.success?(o.user.inactive=t,o.toast.showSuccessToast("Estado del usuario actualizado correctamente")):o.toast.showErrorToast("Ha ocurrido un error al actualizar el estado del usuario. "+s.error.errorMessage)})()}onRemoveLanguage(t){this.user.languages=this.user.languages.filter(o=>o!==t)}initForm(){this.userForm=this.fb.group({email:["",c.k0.required],name:["",c.k0.required],jobTitle:[""],phone:["+34 "],visibleForCollaborators:[]})}populateForm(t){var o,s,l,d,u;this.userForm.patchValue({email:null!==(o=null==t?void 0:t.email)&&void 0!==o?o:"",name:null!==(s=null==t?void 0:t.name)&&void 0!==s?s:"",jobTitle:null!==(l=null==t?void 0:t.jobTitle)&&void 0!==l?l:"",phone:null!==(d=null==t?void 0:t.phone)&&void 0!==d?d:"",visibleForCollaborators:null!==(u=null==t?void 0:t.visibleForCollaborators)&&void 0!==u&&u}),this.userForm.get("email").disable()}onSelectCountry(t){this.userForm.get("phone").setValue((null==t?void 0:t.phoneCode)+" ")}isControlInvalid(t){const o=this.userForm.get(t);return!(!o||!o.invalid||!o.dirty&&!o.touched)}}return(n=i).\u0275fac=function(t){return new(t||n)(e.rXU(c.ok),e.rXU(O.T),e.rXU(P.m),e.rXU(S.i),e.rXU(w.f))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-user-form"]],viewQuery:function(t,o){if(1&t&&e.GBs(z,7),2&t){let s;e.mGM(s=e.lsd())&&(o.fileUploaderManager=s.first)}},inputs:{user:"user"},outputs:{onChange:"onChange"},decls:67,vars:73,consts:[["fileUploaderManagerComponent",""],[1,"crm-section",3,"formGroup"],[1,"crm-section-small-title"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","formControlName","email",3,"placeholder"],["class","crm-input-error",4,"ngIf"],["type","text","formControlName","name",3,"placeholder"],["type","text","formControlName","jobTitle",3,"placeholder"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected"],["type","text","formControlName","phone",3,"placeholder"],[1,"crm-input","crm-input-medium"],[1,"crm-section-items"],[1,"crm-item-option","crm-item-option-lang","edit"],["type","button",1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fas","fa-add"],[1,"crm-input-checkboxes"],["appToggleCheckbox","",1,"crm-input-checkbox"],["formControlName","visibleForCollaborators"],[1,"crm-input-checkbox-label"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button-secondary","crm-button-secondary-red"],[1,"crm-input-error"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[1,"crm-item-option-label"],[1,"crm-item-option-remove",3,"click"],[1,"fas","fa-trash"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"crm-button-secondary","crm-button-secondary-red",3,"click"]],template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"form",1)(1,"div",2),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.nrm(4,"app-file-uploader-manager",null,0),e.j41(6,"div",3)(7,"div",4),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"div",5),e.nrm(11,"input",6),e.nI1(12,"translate"),e.nI1(13,"translate"),e.k0s(),e.DNE(14,K,3,3,"div",7),e.k0s(),e.j41(15,"div",3)(16,"div",4),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"div",5),e.nrm(20,"input",8),e.nI1(21,"translate"),e.nI1(22,"translate"),e.k0s(),e.DNE(23,J,3,3,"div",7),e.k0s(),e.j41(24,"div",3)(25,"div",4),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.j41(28,"div",5),e.nrm(29,"input",9),e.nI1(30,"translate"),e.nI1(31,"translate"),e.k0s(),e.DNE(32,Z,3,3,"div",7),e.k0s(),e.j41(33,"div",3)(34,"div",4),e.EFF(35),e.nI1(36,"translate"),e.k0s(),e.j41(37,"div",10)(38,"div",5)(39,"app-flag-country-selector",11),e.bIt("emitCountrySelected",function(d){return e.eBV(s),e.Njj(o.onSelectCountry(d))}),e.k0s(),e.nrm(40,"input",12),e.nI1(41,"translate"),e.nI1(42,"translate"),e.k0s()(),e.DNE(43,Q,3,3,"div",7),e.k0s(),e.j41(44,"div",13)(45,"div",4),e.EFF(46," Idiomas "),e.k0s(),e.j41(47,"div",14),e.Z7z(48,W,8,3,"div",15,e.fX1),e.j41(50,"button",16),e.bIt("click",function(d){return e.eBV(s),e.Njj(o.onAddLanguage(d))}),e.nrm(51,"i",17),e.EFF(52),e.nI1(53,"translate"),e.nI1(54,"translate"),e.k0s(),e.j41(55,"div",3)(56,"div",4),e.EFF(57,"Mostrar usuario a colaboradores"),e.k0s(),e.j41(58,"div",18)(59,"div",19),e.nrm(60,"ion-checkbox",20),e.j41(61,"div",21),e.EFF(62,"Mostrar"),e.k0s()()()()(),e.nrm(63,"br")(64,"br"),e.DNE(65,q,2,0,"button",22)(66,ee,2,0,"button",23),e.k0s()()}2&t&&(e.Y8G("formGroup",o.userForm),e.R7$(2),e.SpI(" ",e.bMT(3,20,"text.profile_pic")," "),e.R7$(6),e.SpI(" ",e.bMT(9,22,"text.email")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(55,f,o.isControlInvalid("email"))),e.R7$(),e.Y8G("placeholder",e.i5U(13,26,"text.input_placeholder",e.eq3(57,b,e.bMT(12,24,"text.email")))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("email")),e.R7$(3),e.SpI(" ",e.bMT(18,29,"text.name")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(59,f,o.isControlInvalid("name"))),e.R7$(),e.Y8G("placeholder",e.i5U(22,33,"text.input_placeholder",e.eq3(61,b,e.bMT(21,31,"text.name")))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("name")),e.R7$(3),e.SpI(" ",e.bMT(27,36,"text.job_title")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(63,f,o.isControlInvalid("jobTitle"))),e.R7$(),e.Y8G("placeholder",e.i5U(31,40,"text.input_placeholder",e.eq3(65,b,e.bMT(30,38,"text.job_title")))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("jobTitle")),e.R7$(3),e.SpI(" ",e.bMT(36,43,"text.phone")," "),e.R7$(3),e.Y8G("ngClass",e.eq3(67,f,o.isControlInvalid("phone"))),e.R7$(2),e.Y8G("placeholder",e.i5U(42,47,"text.input_placeholder",e.eq3(69,b,e.bMT(41,45,"text.phone")))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("phone")),e.R7$(5),e.Dyx(null==o.user?null:o.user.languages),e.R7$(4),e.SpI(" ",e.i5U(54,52,"text.add_item",e.eq3(71,H,e.bMT(53,50,"text.language")))," "),e.R7$(13),e.vxM(!0===(null==o.user?null:o.user.inactive)?65:66))},dependencies:[m.YU,m.bT,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,h.eY,h.hB,L.Z,g.F,v.D9]}),i})();var ne=a(8129),oe=a(904),re=a(8359),ie=a(1413),ae=a(152),se=a(5558);let le=(()=>{var n;class i{constructor(t){this.api=t,this.searchTermSubject=new ie.B,this.allAgencies=[],this.searchResults$=this.searchTermSubject.pipe((0,ae.B)(300),(0,se.n)(o=>this.performSearch(o)))}search(t){this.searchTermSubject.next(t)}performSearch(t){var o=this;return(0,C.A)(function*(){let s=[];if(t.includes("@")){const l=t.split("@")[1];s=(yield o.api.getAgency({email:{contains:"@"+l}},null,{page:0,itemsPerPage:50})).success.data}return s})()}}return(n=i).\u0275fac=function(t){return new(t||n)(e.KVO(S.i))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),i})();function ce(n,i){if(1&n){const r=e.RV6();e.j41(0,"div",8),e.bIt("click",function(o){const s=e.eBV(r).$implicit,l=e.XpG(2);return e.Njj(l.selectAgency(s,o))}),e.j41(1,"div",9)(2,"div",10),e.nrm(3,"img",11),e.k0s(),e.j41(4,"div",12)(5,"div",13),e.EFF(6),e.k0s(),e.j41(7,"div",14),e.EFF(8),e.k0s()()(),e.nrm(9,"div",15),e.k0s()}if(2&n){const r=i.$implicit;e.R7$(6),e.SpI(" ",null==r?null:r.name," "),e.R7$(2),e.SpI(" ",null==r?null:r.domain," ")}}function de(n,i){1&n&&(e.j41(0,"div",16),e.EFF(1," No hay resultados en Byvaro "),e.k0s())}function me(n,i){if(1&n){const r=e.RV6();e.j41(0,"div",8),e.bIt("click",function(o){e.eBV(r);const s=e.XpG(2);return e.Njj(s.selectAgency(null,o))}),e.j41(1,"div",9)(2,"div",10),e.nrm(3,"img",11),e.k0s(),e.j41(4,"div",12)(5,"div",13),e.EFF(6),e.k0s(),e.j41(7,"div",14),e.EFF(8," Esta agencia no est\xe1 registrada en Byvaro, haz clic para invitarla. "),e.k0s()()(),e.nrm(9,"div",15),e.k0s()}if(2&n){const r=e.XpG(2);e.R7$(6),e.SpI(" ",r.searchTerm," ")}}function ue(n,i){if(1&n&&(e.j41(0,"div",5),e.Z7z(1,ce,10,2,"div",6,e.fX1),e.DNE(3,de,2,0,"div",7)(4,me,10,1,"div",6),e.k0s()),2&n){const r=e.XpG();e.R7$(),e.Dyx(r.searchResults),e.R7$(2),e.Y8G("ngIf",0===r.searchResults.length&&!r.validEmail),e.R7$(),e.vxM(r.validEmail?4:-1)}}let pe=(()=>{var n;class i{constructor(t,o){this.renderer=t,this.searchbarService=o,this.selectedAgency=new e.bkB,this.textUpdated=new e.bkB,this.searchTerm="",this.dropdownOpen=!1,this.searchResults=[],this.validEmail=!1,this.globalClickUnlistener=null,this.searchSubscription=new re.yU}ngOnInit(){this.searchSubscription=this.searchbarService.searchResults$.subscribe(t=>{this.searchResults=t})}onInputClick(t){t.stopPropagation(),this.dropdownOpen||this.openDropdown()}onSearchTermChange(t){this.searchTerm=t,this.searchbarService.search(t),this.checkEmail(),this.textUpdated.emit(t)}checkEmail(){this.validEmail=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.searchTerm)}selectAgency(t,o){t||(t={name:this.searchTerm,email:"Esta agencia no est\xe1 registrada en Byvaro, se enviar\xe1 una invitaci\xf3n por e-mail."}),o.stopPropagation(),this.selectedAgency.emit({name:t.name,email:this.searchTerm,id:t.id}),this.closeDropdown()}openDropdown(){this.dropdownOpen=!0,this.attachDocumentClickListener()}closeDropdown(){this.dropdownOpen=!1,this.detachDocumentClickListener()}attachDocumentClickListener(){this.globalClickUnlistener=this.renderer.listen("document","click",t=>{t.target.closest(".agents-searchbar-container")||this.closeDropdown()})}detachDocumentClickListener(){this.globalClickUnlistener&&(this.globalClickUnlistener(),this.globalClickUnlistener=null)}ngOnDestroy(){this.detachDocumentClickListener(),this.searchSubscription.unsubscribe()}}return(n=i).\u0275fac=function(t){return new(t||n)(e.rXU(e.sFG),e.rXU(le))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-agencies-searchbar"]],outputs:{selectedAgency:"selectedAgency",textUpdated:"textUpdated"},decls:5,vars:2,consts:[[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar","crm-input-input-searchbar-square","agents-searchbar-container",3,"click"],[1,"fas","fa-search"],["type","text","placeholder","Email de la agencia",3,"ngModelChange","ngModel"],["class","dropdown-options",4,"ngIf"],[1,"dropdown-options"],[1,"crm-item-searchbar-agent-result"],["class","no-results",4,"ngIf"],[1,"crm-item-searchbar-agent-result",3,"click"],[1,"crm-item-searchbar-agent-result-left"],[1,"crm-item-searchbar-agent-result-left-image"],["src","assets/images/building.png","alt",""],[1,"crm-item-searchbar-agent-result-left-info"],[1,"crm-item-searchbar-agent-result-left-info-name"],[1,"crm-item-searchbar-agent-result-left-info-email"],[1,"crm-item-searchbar-agent-result-right"],[1,"no-results"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.bIt("click",function(l){return o.onInputClick(l)}),e.nrm(2,"i",2),e.j41(3,"input",3),e.mxI("ngModelChange",function(l){return e.DH7(o.searchTerm,l)||(o.searchTerm=l),l}),e.bIt("ngModelChange",function(l){return o.onSearchTermChange(l)}),e.k0s(),e.DNE(4,ue,5,2,"div",4),e.k0s()()),2&t&&(e.R7$(3),e.R50("ngModel",o.searchTerm),e.R7$(),e.Y8G("ngIf",o.dropdownOpen))},dependencies:[m.bT,c.me,c.BC,c.vS],styles:[".agents-searchbar-container[_ngcontent-%COMP%]{position:relative;cursor:pointer}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;z-index:9999;background-color:#fff;padding:8px 0;border-radius:0 0 8px 8px;border:1px solid var(--crm-border-light-color);max-height:200px;overflow-y:auto;font-size:14px}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.no-results[_ngcontent-%COMP%]{padding:8px;color:#888}"]}),i})(),he=(()=>{var n;class i{}return(n=i).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.MD,c.YN,c.X1,h.bv,U.S,_,v.h,y.T,x,$.O,A.S,E.Y,G.b,N,B.K,Y.T,X.k,I.u,g.F,j.x]}),i})();e.wjB(M.K,[m.bT,te,ne.K],[v.D9]),e.wjB(k.v,[m.bT,oe.X,pe],[]),e.wjB(V.f,[j.x],[])}}]);