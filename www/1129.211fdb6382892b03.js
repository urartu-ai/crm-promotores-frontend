"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1129],{4821:(F,E,l)=>{l.d(E,{e:()=>b});var d=l(3953);let b=(()=>{var v;class P{constructor(f){this.renderer=f,this.text="",this.maxLength=20,this.tooltipClass="",this.tooltipElement=null}ngOnInit(){}get trimmedText(){return this.text?this.text.length>this.maxLength?this.text.slice(0,this.maxLength)+"...":this.text:""}showTooltip(f){this.text.length<=this.maxLength||(this.tooltipElement=this.renderer.createElement("div"),this.tooltipElement.innerText=this.text,this.renderer.addClass(this.tooltipElement,"custom-tooltip"),this.tooltipClass&&this.tooltipClass.split(" ").forEach(T=>{T.trim()&&this.renderer.addClass(this.tooltipElement,T.trim())}),this.renderer.setStyle(this.tooltipElement,"position","fixed"),this.renderer.setStyle(this.tooltipElement,"top",f.clientY-30+"px"),this.renderer.setStyle(this.tooltipElement,"left",`${f.clientX}px`),this.renderer.setStyle(this.tooltipElement,"z-index","9999"),this.renderer.appendChild(document.body,this.tooltipElement))}hideTooltip(){this.tooltipElement&&(this.renderer.removeChild(document.body,this.tooltipElement),this.tooltipElement=null)}}return(v=P).\u0275fac=function(f){return new(f||v)(d.rXU(d.sFG))},v.\u0275cmp=d.VBU({type:v,selectors:[["app-tooltip-text"]],inputs:{text:"text",maxLength:"maxLength",tooltipClass:"tooltipClass"},standalone:!0,features:[d.aNF],decls:2,vars:1,consts:[[1,"text",3,"mouseenter","mouseleave"]],template:function(f,t){1&f&&(d.j41(0,"span",0),d.bIt("mouseenter",function(C){return t.showTooltip(C)})("mouseleave",function(){return t.hideTooltip()}),d.EFF(1),d.k0s()),2&f&&(d.R7$(),d.SpI(" ",t.trimmedText,"\n"))}}),P})()},6643:(F,E,l)=>{l.r(E),l.d(E,{PromotionListPageModule:()=>$});var d=l(177),b=l(9417),v=l(9465),P=l(5188),_=l(467),f=l(1413),t=l(3953),T=l(6039),C=l(8397),L=l(4501),I=l(1213),o=l(904);const i=n=>({"crm-button-secondary-primary":n});function e(n,c){1&n&&(t.j41(0,"button",32),t.nrm(1,"i",33),t.EFF(2," A\xf1adir promoci\xf3n "),t.k0s()),2&n&&t.Y8G("routerLink","/promotions/create")}function a(n,c){1&n&&(t.nrm(0,"i",34),t.EFF(1," Cerrar filtros "))}function u(n,c){1&n&&(t.nrm(0,"i",35),t.EFF(1," Filtros activados "))}function y(n,c){1&n&&(t.nrm(0,"i",35),t.EFF(1," Filtrar "))}function k(n,c){if(1&n&&t.DNE(0,u,2,0)(1,y,2,0),2&n){const m=t.XpG();t.vxM(m.filters?0:1)}}function x(n,c){if(1&n&&(t.j41(0,"div",27),t.EFF(1),t.k0s()),2&n){const m=t.XpG();t.R7$(),t.SpI(" ",m.checkedPromotions," seleccionado ")}}function S(n,c){1&n&&(t.j41(0,"div",31),t.nrm(1,"app-card-promotion",36)(2,"app-card-promotion",36)(3,"app-card-promotion",36),t.k0s()),2&n&&(t.R7$(),t.Y8G("isSkeleton",!0),t.R7$(),t.Y8G("isSkeleton",!0),t.R7$(),t.Y8G("isSkeleton",!0))}function M(n,c){if(1&n){const m=t.RV6();t.j41(0,"app-card-promotion",39),t.bIt("togglePromotionCheckbox",function(){t.eBV(m);const s=t.XpG(2);return t.Njj(s.onTogglePromotionCheckbox())}),t.k0s()}2&n&&t.Y8G("promotion",c.$implicit)}function D(n,c){1&n&&(t.j41(0,"div",38),t.EFF(1," A\xfan no hay promociones "),t.k0s())}function j(n,c){if(1&n&&(t.j41(0,"div",31),t.Z7z(1,M,1,1,"app-card-promotion",37,t.fX1),t.DNE(3,D,2,0,"div",38),t.k0s()),2&n){const m=t.XpG();t.R7$(),t.Dyx(m.promotions),t.R7$(2),t.vxM(0===m.promotions.length?3:-1)}}const O=[{path:"",component:(()=>{var n;class c{constructor(r,s,g,h,p){this.api=r,this.router=s,this.toastService=g,this.headerService=h,this.state=p,this.promotions=[],this.allSystemPromotionsCount=0,this.checkedPromotions=0,this.searchString="",this.searchSubject=new f.B,this.aside={type:"filters",visible:!1},this.filters=null,this.sort=null,this.pagination={page:0,itemsPerPage:25},this.promotionsCount=0,this.loadingList=!1}ngOnInit(){this.getState()}ionViewWillEnter(){this.headerService.setConfig({title:"promotions"}),this.getData()}onTogglePromotionCheckbox(){this.setNumberOfCheckedPromotions()}onToggleAllCheckboxes(r){this.promotions.forEach(s=>s.checked=r.detail.checked),this.setNumberOfCheckedPromotions()}onSearchInputChange(r){this.searchSubject.next(r.target.value)}onSearchChanged(r){this.searchString=r}onToggleAside(){this.aside.visible=!this.aside.visible}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemPromotionsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemPromotionsCount)}}setNumberOfCheckedPromotions(){this.checkedPromotions=this.promotions.filter(r=>r.checked).length}getData(){var r=this;return(0,_.A)(function*(){try{var s,g,h;r.loadingList=!0;const p=yield r.getPromotions();if(null!=p&&p.error)throw new Error("Error fetching promotions");r.promotions=(null==p||null===(s=p.success)||void 0===s?void 0:s.data)||[],console.log("ALL PROMOTIONS",r.promotions),r.allSystemPromotionsCount=(null==p||null===(g=p.success)||void 0===g||null===(g=g.metadata)||void 0===g?void 0:g.count)||0,r.pagination.page=0,r.promotionsCount=(null==p||null===(h=p.success)||void 0===h||null===(h=h.metadata)||void 0===h?void 0:h.count)||0,r.setNumberOfCheckedPromotions(),r.updatePagination(),r.loadingList=!1}catch{r.toastService.showToast({text:"Ha ocurrido un error al cargar los procedimientos",theme:"red",icon:"fas fa-exclamation-triangle",time:1e4}),r.loadingList=!1}})()}getState(){this.state.getState().subscribe(r=>{this.currentUser=r.user})}getPromotions(){var r=this;return(0,_.A)(function*(){return yield r.api.getPromotions({},r.sort,r.pagination,{properties:{apply:!0,filter:null,onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},promoter:{apply:!0,filter:null,onlyCount:!1}})})()}onSort(r){return(0,_.A)(function*(){})()}}return(n=c).\u0275fac=function(r){return new(r||n)(t.rXU(T.i),t.rXU(P.Ix),t.rXU(C.f),t.rXU(L.d),t.rXU(I.c))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-promotion-list"]],decls:42,vars:15,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content"],[1,"crm-block-body"],[1,"crm-block-body-fixed"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar promoci\xf3n",3,"input"],[1,"crm-buttons-group"],["class","crm-button",3,"routerLink",4,"ngIf"],[1,"crm-button-secondary",3,"click","ngClass"],[1,"crm-block-pagination-selectors"],[1,"crm-button-pagination"],[1,"crm-button-pagination-text"],[1,"crm-button-pagination-buttons"],[1,"crm-button-pagination-arrow","crm-button-icon-solo",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-button-pagination-number"],[1,"fas","fa-arrow-right"],[1,"crm-dropdown",3,"click"],[1,"crm-dropdown-text"],[1,"crm-dropdown-right"],[1,"crm-dropdown-value"],[1,"crm-dropdown-arrow"],[1,"fas","fa-chevron-down"],[1,"crm-input-checkbox"],[1,"crm-input-checkbox-pre-label"],[3,"ionChange"],[1,"crm-input-checkbox-label"],[1,"crm-block-body-blue-content",2,"overflow-x","auto"],[2,"display","flex","align-items","flex-start","flex-wrap","wrap","gap","20px"],[1,"crm-button",3,"routerLink"],[1,"fa","fa-plus"],[1,"fa","fa-times"],[1,"fa","fa-filter"],[3,"isSkeleton"],[3,"promotion"],[1,"crm-empty-list","crm-text"],[3,"togglePromotionCheckbox","promotion"]],template:function(r,s){1&r&&(t.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),t.nrm(7,"i",7),t.j41(8,"input",8),t.bIt("input",function(h){return s.onSearchInputChange(h)}),t.k0s()()(),t.j41(9,"div",9),t.DNE(10,e,3,1,"button",10),t.j41(11,"button",11),t.bIt("click",function(){return s.onToggleAside()}),t.DNE(12,a,2,0)(13,k,2,1),t.k0s()()(),t.j41(14,"div",12)(15,"div",13)(16,"div",14),t.EFF(17),t.k0s(),t.j41(18,"div",15)(19,"button",16),t.bIt("click",function(){return s.onGoPreviousPage()}),t.nrm(20,"i",17),t.k0s(),t.j41(21,"div",18),t.EFF(22),t.k0s(),t.j41(23,"button",16),t.bIt("click",function(){return s.onGoNextPage()}),t.nrm(24,"i",19),t.k0s()(),t.j41(25,"div",20),t.bIt("click",function(h){return s.onSort(h)}),t.j41(26,"div",21),t.EFF(27," Ordenar por "),t.k0s(),t.j41(28,"div",22)(29,"div",23),t.EFF(30),t.k0s(),t.j41(31,"div",24),t.nrm(32,"i",25),t.k0s()()()(),t.nrm(33,"div"),t.j41(34,"div",26),t.DNE(35,x,2,1,"div",27),t.j41(36,"ion-checkbox",28),t.bIt("ionChange",function(h){return s.onToggleAllCheckboxes(h)}),t.k0s(),t.j41(37,"div",29),t.EFF(38),t.k0s()()()(),t.j41(39,"div",30),t.DNE(40,S,4,3,"div",31)(41,j,4,1,"div",31),t.k0s()()()()),2&r&&(t.Y8G("fullscreen",!0)("scrollY",!1),t.R7$(10),t.Y8G("ngIf","promoter"===(null==s.currentUser?null:s.currentUser.accountType)),t.R7$(),t.Y8G("ngClass",t.eq3(13,i,!(null!=s.aside&&s.aside.visible)&&s.filters)),t.R7$(),t.vxM(null!=s.aside&&s.aside.visible?12:13),t.R7$(5),t.E5c(" ",s.updatePagination().startIndex," - ",s.updatePagination().endIndex," de ",s.allSystemPromotionsCount," "),t.R7$(5),t.SpI(" P\xe1g ",s.pagination.page+1," "),t.R7$(8),t.SpI(" ",null!=s.sort&&s.sort.field?(null==s.sort?null:s.sort.field)+" "+(null==s.sort?null:s.sort.order):"Fecha de creaci\xf3n"," "),t.R7$(5),t.vxM(s.checkedPromotions?35:-1),t.R7$(3),t.SpI(" Seleccionar ",s.promotions.length," registros "),t.R7$(2),t.vxM(s.loadingList?40:41))},dependencies:[d.YU,d.bT,v.eY,v.W9,v.hB,v.N7,P.Wk,o.X]}),c})()}];let R=(()=>{var n;class c{}return(n=c).\u0275fac=function(r){return new(r||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[P.iI.forChild(O),P.iI]}),c})();var A=l(7991);let $=(()=>{var n;class c{}return(n=c).\u0275fac=function(r){return new(r||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[d.MD,b.YN,v.bv,R,A.S]}),c})()},6552:(F,E,l)=>{l.d(E,{T:()=>T});var d=l(467),b=l(7376),P=l(6069),_=l(3953),f=l(5188),t=l(6039);let T=(()=>{var C;class L{constructor(o,i){this.router=o,this.api=i}parseBackendDateToFrontendDateInput(o){if(!o)return null;try{const i=new Date(o),e=i.getFullYear();return`${e}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`}catch(i){return console.error("Invalid date format",i),null}}parseProperties(o){for(let e in o)o[e]instanceof Date?o[e]=o[e].toISOString():"string"==typeof o[e]&&o[e].match(/^\d{4}-\d{2}-\d{2}$/)&&(o[e]=new Date(o[e]).toISOString()),"true"===o[e]?o[e]=!0:"false"===o[e]&&(o[e]=!1);const i=b.cloneDeep(o);return delete i.id,i}parseNameToValue(o){return o.toLowerCase().replace(/ /g,"_")}groupPropertiesByPromotion(o,i){return o.map(a=>{const u=i.filter(y=>y.promotionId===a.id);return{...a,properties:u}})}setStepsCompleted(o,i){return o.steps=b.orderBy(o.steps,["order"],["asc"]),o.steps=o.steps.map(e=>(e.order<i.order&&(e.isCompleted=!0),e)),o}hexToRgba(o,i){if(!o)return"";let e,a,u;if(3===(o=o.replace("#","")).length)e=parseInt(o[0]+o[0],16),a=parseInt(o[1]+o[1],16),u=parseInt(o[2]+o[2],16);else{if(6!==o.length)return"";e=parseInt(o.substring(0,2),16),a=parseInt(o.substring(2,4),16),u=parseInt(o.substring(4,6),16)}return`rgba(${e}, ${a}, ${u}, ${i})`}getLanguageInfo(o){return P.e.find(e=>e.code===o)||{}}getCountryInfo(o){return P.X.find(e=>e.code===o)||{}}countAvailableProperties(o){return o&&0!==o.length?o.filter(i=>"available"===i.availabilityStatus).length:0}calculateRangeOfPropertiesPrices(o){if(!o||0===o.length)return{min:0,max:0};const i=o.map(e=>e.price);return{min:Math.min(...i),max:Math.max(...i)}}calculateRangeOfPropertiesRooms(o){if(!o||0===o.length)return{min:0,max:0};const i=o.map(e=>e.bedrooms);return{min:Math.min(...i),max:Math.max(...i)}}onRemoveAgencyAccessToPromotion(o){console.log("onRemoveAgencyAccessToPromotion",o)}redirectToPromoter(o){this.router.navigate([`/promoters/${o.id}`])}filterFilesByCategoryAndSort(o,i){return o&&0!==o.length?o.filter(e=>e.category===i).sort((e,a)=>{var u,y;return(null!==(u=null==e?void 0:e.orderIndex)&&void 0!==u?u:0)-(null!==(y=null==a?void 0:a.orderIndex)&&void 0!==y?y:0)}):[]}transformThousandSeparator(o){if(null==o||""===o)return"";let i;return i="string"==typeof o?parseFloat(o):o,isNaN(i)?"":i.toString().replace(/\.(?=\d+$)/,",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}detectIfPromotionIsCompleted(o){var i=this;return(0,d.A)(function*(){var e;if(!o)return!1;const a=null===(e=yield i.api.getPromotionById(o.id))||void 0===e||null===(e=e.success)||void 0===e?void 0:e.data;return((null==a?void 0:a.deliveryDateModalityByStatus)||(null==a?void 0:a.deliveryDateModalityByMonths))&&!(null==a||!a.sellCommissionPercentage)&&!(null==a||!a.methodToPayCommissions)&&!(null==a||!a.reservePayment)&&((null==a?void 0:a.registersWithPreRegister)||(null==a?void 0:a.registersWithoutPreRegister))})()}isImageFile(o){var i;const a=null===(i=o.split(".").pop())||void 0===i?void 0:i.toLowerCase();return!!a&&["png","jpg","jpeg","gif","bmp","webp","svg","tiff","tif","ico","heic","jfif"].includes(a)}}return(C=L).\u0275fac=function(o){return new(o||C)(_.KVO(f.Ix),_.KVO(t.i))},C.\u0275prov=_.jDH({token:C,factory:C.\u0275fac,providedIn:"root"}),L})()}}]);