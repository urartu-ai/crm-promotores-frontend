"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9659],{9659:(zt,b,r)=>{r.r(b),r.d(b,{ContactDetailsPageModule:()=>Vt});var p=r(177),v=r(9417),_=r(9465),f=r(5188),d=r(467),E=r(7376),t=r(3953),S=r(4501),D=r(9333),h=r(8397),y=r(6552),F=r(1213),T=r(2606),j=r(8433),O=r(5419),k=r(6039),P=r(3837),C=r(8147);const U=["contactForm"];function M(o,a){if(1&o){const n=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.onSaveContact())}),t.nrm(1,"i",8),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&o&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"CONTACT_DETAILS_INFO.SAVE_CONTACT")," "))}function G(o,a){if(1&o){const n=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.onEditContact())}),t.nrm(1,"i",10),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&o&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"CONTACT_DETAILS_INFO.EDIT_CONTACT")," "))}let x=(()=>{var o;class a{constructor(i,e,l){this.api=i,this.toastService=e,this.contactsService=l,this.contact=null,this.saveContact=new t.bkB,this.editing=!1}setContactInfo(){this.editing=!0,setTimeout(()=>{this.editing=!1},10)}ngOnInit(){this.setContactInfo()}onEditContact(){this.editing=!0,this.contactForm.fileUploaderManager.setEditingMode(!0)}onSaveContact(){var i=this;return(0,d.A)(function*(){var e;(yield i.contactsService.createOrUpdateContactFromForm(i.contactForm,null===(e=i.contact)||void 0===e?void 0:e.id))&&(i.editing=!1,i.contactForm.fileUploaderManager.setEditingMode(!1),i.saveContact.emit())})()}}return(o=a).\u0275fac=function(i){return new(i||o)(t.rXU(k.i),t.rXU(h.f),t.rXU(D.F))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-contact-details-info"]],viewQuery:function(i,e){if(1&i&&t.GBs(U,5),2&i){let l;t.mGM(l=t.lsd())&&(e.contactForm=l.first)}},inputs:{contact:"contact"},outputs:{saveContact:"saveContact"},decls:8,vars:3,consts:[["contactForm",""],[1,"crm-header-modal","crm-header-modal-empty","details"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button-secondary"],[1,"crm-boxes-user-create"],[2,"width","100%",3,"contact","disabled"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa","fa-check"],[1,"crm-button-secondary",3,"click"],[1,"fa","fa-edit"]],template:function(i,e){1&i&&(t.j41(0,"div",1),t.nrm(1,"div"),t.j41(2,"div",2),t.DNE(3,M,4,3,"button",3)(4,G,4,3,"button",4),t.k0s()(),t.j41(5,"div",5),t.nrm(6,"app-contact-form",6,0),t.k0s()),2&i&&(t.R7$(3),t.vxM(e.editing?3:4),t.R7$(3),t.Y8G("contact",e.contact)("disabled",!e.editing))},dependencies:[P.q,C.D9]}),a})();var B=r(5952);const N=o=>({item:o}),X=o=>({field:o});function Y(o,a){if(1&o){const n=t.RV6();t.j41(0,"div",1)(1,"div",4)(2,"textarea",5),t.nI1(3,"translate"),t.nI1(4,"translate"),t.mxI("ngModelChange",function(e){t.eBV(n);const l=t.XpG();return t.DH7(l.textNote,e)||(l.textNote=e),t.Njj(e)}),t.k0s()()()}if(2&o){const n=t.XpG();t.R7$(2),t.FS9("placeholder",t.i5U(4,4,"text.input_placeholder_fem",t.eq3(7,X,t.bMT(3,2,"text."+n.options.type)))),t.R50("ngModel",n.textNote)}}let w=(()=>{var o;class a{constructor(i,e,l){this.api=i,this.toast=e,this.byvaroState=l,this.onNoteCreated=new t.bkB,this.textNote=""}ngOnInit(){this.getUserInfo()}getUserInfo(){this.byvaroState.getState().subscribe(i=>{this.currentUser=i.user,this.currentUserAgency=i.agency,this.currentUserPromoter=i.promoter})}onCreateNote(){var i=this;return(0,d.A)(function*(){var e,l,c;if(!i.textNote)return void i.toast.showToast({text:"La nota no puede estar vac\xeda",theme:"red",time:3e3});const s={id:void 0,createdAt:void 0,updatedAt:void 0,text:i.textNote,createdById:null===(e=i.currentUser)||void 0===e?void 0:e.id,contactId:i.options.contactId,promoterId:null===(l=i.currentUserPromoter)||void 0===l?void 0:l.id,agencyId:null===(c=i.currentUserAgency)||void 0===c?void 0:c.id,operationId:i.options.operationId},u=yield i.api.createNote(s);u.success?(i.toast.showToast({text:"Nota creada correctamente",theme:"success",time:2e3}),i.textNote="",i.onNoteCreated.emit(u.success.data)):i.toast.showToast({text:"Error al crear la nota."+u.error.errorMessage,theme:"red",time:3e3})})()}}return(o=a).\u0275fac=function(i){return new(i||o)(t.rXU(k.i),t.rXU(h.f),t.rXU(F.c))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-activity-creation-block"]],inputs:{options:"options"},outputs:{onNoteCreated:"onNoteCreated"},decls:7,vars:9,consts:[[1,"crm-activity-content"],[1,"crm-input"],[1,"crm-section-buttons-right"],[1,"crm-button",3,"click"],[1,"crm-input-input","crm-input-input-textarea"],[3,"ngModelChange","ngModel","placeholder"]],template:function(i,e){1&i&&(t.j41(0,"div",0),t.DNE(1,Y,5,9,"div",1),t.j41(2,"div",2)(3,"button",3),t.bIt("click",function(){return e.onCreateNote()}),t.EFF(4),t.nI1(5,"translate"),t.nI1(6,"translate"),t.k0s()()()),2&i&&(t.R7$(),t.vxM("note"===(null==e.options?null:e.options.type)?1:-1),t.R7$(3),t.SpI(" ",t.i5U(6,4,"text.add_item",t.eq3(7,N,t.bMT(5,2,"text."+(null==e.options?null:e.options.type))))," "))},dependencies:[v.me,v.BC,v.vS,C.D9]}),a})();var V=r(363);const g=(o,a)=>({"background-color":o,color:a});function J(o,a){}function H(o,a){if(1&o&&(t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),t.nrm(4,"i",5),t.k0s(),t.j41(5,"div",6),t.EFF(6," Nota "),t.k0s(),t.j41(7,"div",7),t.EFF(8),t.nI1(9,"date"),t.j41(10,"span",8),t.EFF(11),t.nI1(12,"date"),t.k0s()()(),t.j41(13,"div",9)(14,"button",10),t.nrm(15,"i",11),t.k0s()()(),t.j41(16,"div",12)(17,"div",13),t.EFF(18),t.k0s()(),t.j41(19,"div",14),t.DNE(20,J,0,0),t.j41(21,"div")(22,"div",15)(23,"div",16),t.nrm(24,"img",17),t.k0s(),t.j41(25,"div",18),t.EFF(26),t.k0s()()()()()),2&o){const n=t.XpG().$implicit;t.R7$(8),t.SpI(" ",t.i5U(9,6,n.createdAt,"dd/MM/yyyy")," "),t.R7$(3),t.SpI(" ",t.i5U(12,9,n.createdAt,"HH:mm")," "),t.R7$(7),t.SpI(" ",null==n.element?null:n.element.text," "),t.R7$(2),t.vxM(null!=n.element&&n.element.operationId?20:-1),t.R7$(4),t.Y8G("src",(null==n.element?null:n.element.createdBy.photoUrl)||"assets/images/avatar.png",t.B4B),t.R7$(2),t.SpI(" ",null==n.element||null==n.element.createdBy?null:n.element.createdBy.name," ")}}function z(o,a){if(1&o&&(t.j41(0,"div",13),t.EFF(1),t.k0s()),2&o){const n=t.XpG(2).$implicit;t.R7$(),t.SpI(" ",null==n.element?null:n.element.comment," ")}}function L(o,a){if(1&o&&(t.EFF(0," Pipeline cambiada de "),t.j41(1,"b"),t.EFF(2),t.k0s(),t.EFF(3," a "),t.j41(4,"b"),t.EFF(5),t.k0s(),t.EFF(6,". Del paso "),t.j41(7,"span",20),t.EFF(8),t.k0s(),t.EFF(9," \xa0 al paso \xa0 "),t.j41(10,"span",20),t.EFF(11),t.k0s()),2&o){const n=t.XpG(2).$implicit,i=t.XpG();t.R7$(2),t.JRh(null==n.element?null:n.element.oldPipeline.title),t.R7$(3),t.JRh(null==n.element?null:n.element.newPipeline.title),t.R7$(2),t.Y8G("ngStyle",t.l_i(6,g,i.utils.hexToRgba(null==n.element?null:n.element.oldStep.color,.1),null==n.element?null:n.element.oldStep.color)),t.R7$(),t.SpI(" ",null==n.element?null:n.element.oldStep.text," "),t.R7$(2),t.Y8G("ngStyle",t.l_i(9,g,i.utils.hexToRgba(null==n.element?null:n.element.newStep.color,.1),null==n.element?null:n.element.newStep.color)),t.R7$(),t.SpI(" ",null==n.element?null:n.element.newStep.text," ")}}function K(o,a){if(1&o&&(t.EFF(0," Paso de la pipeline "),t.j41(1,"b"),t.EFF(2),t.k0s(),t.EFF(3," cambiado de "),t.j41(4,"span",20),t.EFF(5),t.k0s(),t.EFF(6," \xa0 a \xa0 "),t.j41(7,"span",20),t.EFF(8),t.k0s()),2&o){const n=t.XpG(2).$implicit,i=t.XpG();t.R7$(2),t.JRh(null==n.element?null:n.element.oldPipeline.title),t.R7$(2),t.Y8G("ngStyle",t.l_i(5,g,i.utils.hexToRgba(null==n.element?null:n.element.oldStep.color,.1),null==n.element?null:n.element.oldStep.color)),t.R7$(),t.SpI(" ",null==n.element?null:n.element.oldStep.text," "),t.R7$(2),t.Y8G("ngStyle",t.l_i(8,g,i.utils.hexToRgba(null==n.element?null:n.element.newStep.color,.1),null==n.element?null:n.element.newStep.color)),t.R7$(),t.SpI(" ",null==n.element?null:n.element.newStep.text," ")}}function Z(o,a){if(1&o&&(t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),t.nrm(4,"i",19),t.k0s(),t.j41(5,"div",6),t.EFF(6," Cambio de estado "),t.k0s(),t.j41(7,"div",7),t.EFF(8),t.nI1(9,"date"),t.j41(10,"span",8),t.EFF(11),t.nI1(12,"date"),t.k0s()()(),t.j41(13,"div",9)(14,"button",10),t.nrm(15,"i",11),t.k0s()()(),t.j41(16,"div",12),t.DNE(17,z,2,1,"div",13)(18,L,12,12)(19,K,9,11),t.k0s(),t.j41(20,"div",14)(21,"div")(22,"div",15)(23,"div",16),t.nrm(24,"img",17),t.k0s(),t.j41(25,"div",18),t.EFF(26),t.k0s()()()()()),2&o){const n=t.XpG().$implicit;t.R7$(8),t.SpI(" ",t.i5U(9,7,null==n.element?null:n.element.createdAt,"dd/MM/yyyy")," "),t.R7$(3),t.SpI(" ",t.i5U(12,10,null==n.element?null:n.element.createdAt,"HH:mm")," "),t.R7$(6),t.vxM(null!=n.element&&n.element.comment?17:-1),t.R7$(),t.vxM("changePipeline"===(null==n.element?null:n.element.type)?18:-1),t.R7$(),t.vxM("changePipelineStep"===(null==n.element?null:n.element.type)?19:-1),t.R7$(5),t.Y8G("src",(null==n.element?null:n.element.createdBy.photoUrl)||"assets/images/avatar.png",t.B4B),t.R7$(2),t.SpI(" ",null==n.element||null==n.element.createdBy?null:n.element.createdBy.name," ")}}function Q(o,a){if(1&o&&t.DNE(0,H,27,12,"div",1)(1,Z,27,13,"div",1),2&o){const n=a.$implicit;t.vxM("note"===(null==n?null:n.type)?0:-1),t.R7$(),t.vxM("operationHistoric"===(null==n?null:n.type)?1:-1)}}let W=(()=>{var o;class a{constructor(i){this.utils=i,this.items=[]}ngDoCheck(){const i=JSON.stringify(this.data);i!==this.previousData&&(this.previousData=i,this.items=this.transformDataToItemsAndOrderByCreatedAt(this.data))}transformDataToItemsAndOrderByCreatedAt(i){const e=[];return i.notes.forEach(l=>{e.push({type:"note",element:l,createdAt:l.createdAt,updatedAt:l.updatedAt})}),i.operationHistorics.forEach(l=>{e.push({type:"operationHistoric",element:l,createdAt:l.createdAt,updatedAt:l.updatedAt})}),e.sort((l,c)=>new Date(c.createdAt).getTime()-new Date(l.createdAt).getTime()),e}}return(o=a).\u0275fac=function(i){return new(i||o)(t.rXU(y.T))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-operation-activity-block"]],inputs:{data:"data"},decls:3,vars:0,consts:[[1,"crm-section-operations"],[1,"crm-operation-activity"],[1,"crm-operation-activity-header"],[1,"crm-operation-activity-header-left"],[1,"crm-square-icon","crm-square-icon-small"],[1,"fa","fa-note-sticky"],[1,"crm-operation-activity-header-title"],[1,"crm-operation-activity-header-timestamp"],[1,"crm-operation-activity-header-timestamp-time"],[2,"display","flex","align-items","center","gap","8px"],[1,"crm-button-icon-solo"],[1,"fas","fa-ellipsis-vertical"],[1,"crm-operation-activity-content"],[1,"crm-text","small"],[1,"crm-operation-activity-footer"],[1,"crm-item-reference","small"],[1,"crm-item-reference-img"],["alt","",3,"src"],[1,"crm-item-reference-text"],[1,"fa","fa-exchange-alt"],[1,"crm-item-chip","crm-item-chip-warn",3,"ngStyle"]],template:function(i,e){1&i&&(t.j41(0,"div",0),t.Z7z(1,Q,2,2,null,null,t.fX1),t.k0s()),2&i&&(t.R7$(),t.Dyx(e.items))},dependencies:[p.B3,p.vh]}),a})();const q=o=>({item:o}),tt=(o,a)=>({"background-color":o,color:a}),nt=o=>({mode:"contact",contactId:o,itemsPerPage:5});function et(o,a){if(1&o&&(t.j41(0,"div",33),t.EFF(1),t.k0s()),2&o){const n=t.XpG().$implicit;t.R7$(),t.SpI(" Propiedad ",null==n||null==n.mainProperty?null:n.mainProperty.reference," ")}}function ot(o,a){if(1&o&&(t.j41(0,"div",42),t.EFF(1),t.k0s()),2&o){const n=t.XpG().$implicit,i=t.XpG();t.Y8G("ngStyle",t.l_i(2,tt,i.utils.hexToRgba(null==n||null==n.currentPipelineStep?null:n.currentPipelineStep.color,.1),null==n||null==n.currentPipelineStep?null:n.currentPipelineStep.color)),t.R7$(),t.SpI(" ",null==n||null==n.currentPipelineStep?null:n.currentPipelineStep.text," ")}}function it(o,a){1&o&&(t.j41(0,"div",43),t.EFF(1," fill "),t.k0s())}function at(o,a){if(1&o){const n=t.RV6();t.j41(0,"div",27),t.bIt("click",function(){const e=t.eBV(n).$implicit,l=t.XpG();return t.Njj(l.onOpenOperation(e))}),t.j41(1,"div",28)(2,"div",29),t.nrm(3,"img",30),t.k0s(),t.j41(4,"div",31)(5,"div",32),t.EFF(6),t.k0s(),t.DNE(7,et,2,1,"div",33),t.k0s()(),t.j41(8,"div",34)(9,"div",35)(10,"div",36)(11,"div",37),t.EFF(12,"Fecha de creaci\xf3n"),t.k0s(),t.j41(13,"div",38)(14,"div"),t.EFF(15),t.nI1(16,"date"),t.k0s()()(),t.j41(17,"div",36)(18,"div",37),t.EFF(19,"Responsable"),t.k0s(),t.j41(20,"div",38)(21,"div",39)(22,"div",40),t.EFF(23),t.k0s()()()()()(),t.j41(24,"div",41),t.DNE(25,ot,2,5,"div",42)(26,it,2,0,"div",43),t.k0s()()}if(2&o){const n=a.$implicit,i=a.$index;t.R7$(3),t.Y8G("src","assets/images/building.png",t.B4B),t.R7$(3),t.SpI(" Operaci\xf3n ",i+1," "),t.R7$(),t.vxM(null!=n&&n.mainProperty?7:-1),t.R7$(8),t.SpI(" ",t.i5U(16,6,n.createdAt,"dd/MM/yyyy")," "),t.R7$(8),t.SpI(" ",(null==n||null==n.responsible?null:n.responsible.name)||(null==n||null==n.createdBy?null:n.createdBy.name)," "),t.R7$(2),t.vxM(null!=n&&null!=n.currentPipelineStep&&n.currentPipelineStep.text?25:26)}}function lt(o,a){if(1&o&&(t.j41(0,"div"),t.nrm(1,"app-autolead-email-list-viewer",44),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.Y8G("options",t.eq3(1,nt,null==n.contact?null:n.contact.id))}}function ct(o,a){1&o&&t.nrm(0,"i",19)}function rt(o,a){1&o&&t.nrm(0,"i",20)}function st(o,a){if(1&o){const n=t.RV6();t.j41(0,"div",21)(1,"div",45)(2,"button",46),t.nrm(3,"i",47),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"button",48),t.nrm(7,"i",49),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"button",48),t.nrm(11,"i",50),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",48),t.nrm(15,"i",51),t.EFF(16),t.nI1(17,"translate"),t.k0s()(),t.j41(18,"app-activity-creation-block",52),t.bIt("onNoteCreated",function(e){t.eBV(n);const l=t.XpG();return t.Njj(l.onNoteCreated(e))}),t.k0s()()}if(2&o){const n=t.XpG();t.R7$(4),t.SpI(" ",t.bMT(5,5,"text.note")," "),t.R7$(4),t.SpI(" ",t.bMT(9,7,"text.visit")," "),t.R7$(4),t.SpI(" ",t.bMT(13,9,"text.mail")," "),t.R7$(4),t.SpI(" ",t.bMT(17,11,"text.task")," "),t.R7$(2),t.Y8G("options",n.creationBlockActivityCreationOptions)}}let dt=(()=>{var o;class a{constructor(i,e,l,c,s,u){this.modalService=i,this.api=e,this.router=l,this.toast=c,this.byvaroState=s,this.utils=u,this.operationIdToOpenFromUrl=null,this.operationActivityData={notes:[],operationHistorics:[],operation:null},this.operations=[],this.collapsedActivityAdder=!1,this.creationBlockActivityCreationOptions={type:"note",activityType:"contact",contactId:null,operationId:null}}ngOnChanges(){this.contact&&(this.getUserInfo(),this.getOperations(),this.getUserNotes(),this.creationBlockActivityCreationOptions.contactId=this.contact.id)}onOpenOperation(i){var e=this;return(0,d.A)(function*(){yield(yield e.modalService.showOperationModal(null==i?void 0:i.id)).onDidDismiss(),e.getOperations()})()}onNoteCreated(i){console.log("note created",i),this.getUserNotes()}onAddOperation(){var i=this;return(0,d.A)(function*(){var e;const c=yield(yield i.modalService.showOperationPropertiesSearchModal()).onDidDismiss();null!=c&&null!==(e=c.data)&&void 0!==e&&e.checkedProperties&&i.createOperation(c.data.checkedProperties)})()}getUserInfo(){this.byvaroState.getState().subscribe(i=>{this.currentUser=i.user,this.userAgency=i.agency,this.userPromoter=i.promoter})}getUserNotes(){var i=this;return(0,d.A)(function*(){var e;const l=yield i.api.getNote({contactId:{equals:i.contact.id}},{field:"createdAt",order:"desc"},null,{createdBy:{apply:!0,filter:null,onlyCount:!1}});i.operationActivityData.notes=(null===(e=l.success)||void 0===e?void 0:e.data)||[]})()}getPipelines(){var i=this;return(0,d.A)(function*(){var e;return(null===(e=(yield i.api.getPipelines({},null,null,{steps:{apply:!0,filter:null,onlyCount:!1}})).success)||void 0===e?void 0:e.data)||[]})()}getOperations(){var i=this;return(0,d.A)(function*(){var e;const l=yield i.api.getOperation({contactId:{equals:i.contact.id}},null,null,{contact:{apply:!0,filter:null,onlyCount:!1},createdBy:{apply:!0,filter:null,onlyCount:!1},responsible:{apply:!0,filter:null,onlyCount:!1},mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1},selectedProperties:{apply:!0,filter:null,onlyCount:!1},notes:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1}});if(i.operations=(null===(e=l.success)||void 0===e?void 0:e.data)||[],i.operationIdToOpenFromUrl){const c=i.operations.find(s=>s.id===i.operationIdToOpenFromUrl);c&&(i.onOpenOperation(c),i.operationIdToOpenFromUrl=null)}})()}createOperation(i){var e=this;return(0,d.A)(function*(){var l,c,s,u;let m=null,$=yield e.getPipelines();$.length>0&&(m=$.find(R=>"operaciones"===R.title),m.steps=(0,E.sortBy)(m.steps,"order"));const Jt={operationType:e.currentUser.accountType,contactId:e.contact.id,promoterId:null===(l=e.userPromoter)||void 0===l?void 0:l.id,agencyId:null===(c=e.userAgency)||void 0===c?void 0:c.id,createdById:e.currentUser.id,responsibleId:e.currentUser.id,currentPipelineId:null===(s=m)||void 0===s?void 0:s.id,currentPipelineStepId:m?m.steps[0].id:null},I=yield e.api.createOperation(Jt),A=null===(u=I.success)||void 0===u?void 0:u.data,Ht=i.map(R=>R.id);yield e.api.linkPropertiesToOperation(A.id,Ht),yield e.setMainProperty(i[0].id,A.id),e.toast.showToast(I.success?{text:"Operaci\xf3n creada correctamente",theme:"success",time:2e3}:{text:"Error al crear la operaci\xf3n. "+I.error.errorMessage,theme:"red",time:2e3}),e.getOperations()})()}setMainProperty(i,e){var l=this;return(0,d.A)(function*(){yield l.api.updateOperationById(e,{mainPropertyId:i})})()}}return(o=a).\u0275fac=function(i){return new(i||o)(t.rXU(B.M),t.rXU(k.i),t.rXU(f.Ix),t.rXU(h.f),t.rXU(F.c),t.rXU(y.T))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-contact-details-operations"]],inputs:{contact:"contact",operationIdToOpenFromUrl:"operationIdToOpenFromUrl"},features:[t.OA$],decls:45,vars:15,consts:[[1,"crm-opp-contact-screen"],[1,"crm-opp-contact-screen-left"],[1,"crm-section","crm-section-padding","big-padding"],[1,"crm-header-icon","no-padding","no-line","no-background"],[1,"crm-header-icon-left"],[1,"crm-square-icon"],[1,"fa-solid","fa-bullseye"],[1,"crm-header-icon-title"],[1,"crm-header-icon-right"],[1,"crm-button",3,"click"],[1,"fas","fa-plus"],[1,"crm-section-operations"],[1,"crm-item-operation"],[1,"crm-opp-contact-screen-right"],[1,"crm-section","crm-section-padding"],[1,"crm-section"],[1,"crm-header-icon","crm-header-icon-less-padding","no-line","no-padding"],[1,"fa-solid","fa-add"],[1,"crm-button-icon-solo",3,"click"],[1,"fas","fa-chevron-up"],[1,"fas","fa-chevron-down"],[1,"crm-activity"],[1,"crm-horizontal-separator"],[1,"fa-solid","fa-clock-rotate-left"],[1,"crm-button-icon-solo"],[1,"fas","fa-filter"],[3,"data"],[1,"crm-item-operation",3,"click"],[1,"crm-item-operation-left"],[1,"crm-item-operation-left-image"],["alt","",3,"src"],[1,"crm-item-operation-left-info"],[1,"crm-item-operation-left-info-promotion"],[1,"crm-item-operation-left-info-property"],[1,"crm-item-operation-center"],[1,"crm-block-info-horizontal"],[1,"crm-info"],[1,"crm-info-title"],[1,"crm-info-content"],[1,"crm-item-reference"],[1,"crm-item-reference-text"],[1,"crm-item-operation-right"],[1,"crm-item-chip","crm-item-chip-warn",3,"ngStyle"],[1,"crm-item-chip","crm-item-chip-warn",2,"visibility","hidden"],[3,"options"],[1,"crm-activity-selector"],[1,"crm-button","crm-button-center"],[1,"fas","fa-note-sticky"],[1,"crm-button-secondary","crm-button-secondary-primary","crm-button-center"],[1,"fas","fa-calendar-alt"],[1,"fas","fa-envelope"],[1,"fas","fa-check"],[3,"onNoteCreated","options"]],template:function(i,e){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"i",6),t.k0s(),t.j41(7,"div",7),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.j41(10,"div",8)(11,"button",9),t.bIt("click",function(){return e.onAddOperation()}),t.nrm(12,"i",10),t.EFF(13),t.nI1(14,"translate"),t.nI1(15,"translate"),t.k0s()()(),t.j41(16,"div",11),t.Z7z(17,at,27,9,"div",12,t.fX1),t.k0s(),t.DNE(19,lt,2,3,"div"),t.k0s()(),t.j41(20,"div",13)(21,"div",14)(22,"div",15)(23,"div",16)(24,"div",4)(25,"div",5),t.nrm(26,"i",17),t.k0s(),t.j41(27,"div",7),t.EFF(28," A\xf1adir actividad "),t.k0s()(),t.j41(29,"div",8)(30,"button",18),t.bIt("click",function(){return e.collapsedActivityAdder=!e.collapsedActivityAdder}),t.DNE(31,ct,1,0,"i",19)(32,rt,1,0,"i",20),t.k0s()()(),t.DNE(33,st,19,13,"div",21),t.nrm(34,"div",22),t.j41(35,"div",16)(36,"div",4)(37,"div",5),t.nrm(38,"i",23),t.k0s(),t.j41(39,"div",7),t.EFF(40," Historial "),t.k0s()(),t.j41(41,"div",8)(42,"button",24),t.nrm(43,"i",25),t.k0s()()(),t.nrm(44,"app-operation-activity-block",26),t.k0s()()()()),2&i&&(t.R7$(8),t.SpI(" ",t.bMT(9,6,"text.operations")," "),t.R7$(5),t.SpI(" ",t.i5U(15,10,"text.add_item",t.eq3(13,q,t.bMT(14,8,"text.operation")))," "),t.R7$(4),t.Dyx(e.operations),t.R7$(2),t.vxM(e.contact?19:-1),t.R7$(12),t.vxM(e.collapsedActivityAdder?31:32),t.R7$(2),t.vxM(e.collapsedActivityAdder?-1:33),t.R7$(11),t.Y8G("data",e.operationActivityData))},dependencies:[p.B3,w,V.T,W,p.vh,C.D9]}),a})();const ut=o=>({"no-padding":o}),pt=(o,a,n)=>({startDate:o,destinataryEmail:a,senderEmail:n}),mt=o=>({filter:o}),vt=(o,a)=>({title:"Listado de correos",connectionId:o,filter:a,itemsPerPage:100}),ft=o=>({father:"contact",contactId:o});function _t(o,a){if(1&o&&(t.j41(0,"div",20)(1,"div",21)(2,"div",22),t.nrm(3,"span",23),t.k0s()()()),2&o){let n,i;const e=t.XpG().$implicit,l=t.XpG(2);t.R7$(3),t.HbH(null==(n=l.utils.getLanguageInfo(e))?null:n.flagClass),t.Y8G("title",null==(i=l.utils.getLanguageInfo(e))?null:i.name)}}function ht(o,a){1&o&&t.DNE(0,_t,4,3,"div",20),2&o&&t.vxM(a.$index<4?0:-1)}function Ct(o,a){if(1&o&&(t.j41(0,"div",16),t.EFF(1),t.k0s()),2&o){const n=t.XpG(2);t.R7$(),t.SpI(" +",(null==n.contact?null:n.contact.languages.length)-4," ")}}function gt(o,a){if(1&o&&(t.j41(0,"div",19),t.Z7z(1,ht,1,1,null,null,t.fX1),t.k0s(),t.DNE(3,Ct,2,1,"div",16)),2&o){const n=t.XpG();t.R7$(),t.Dyx(null==n.contact?null:n.contact.languages),t.R7$(2),t.vxM((null==n.contact?null:n.contact.languages.length)>4?3:-1)}}function yt(o,a){1&o&&t.nrm(0,"div",16)}function Ft(o,a){1&o&&(t.j41(0,"span"),t.EFF(1,"s"),t.k0s())}function kt(o,a){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.JRh(null==n.contact||null==n.contact.phones?null:n.contact.phones[0])}}function It(o,a){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.JRh(null==n.contact||null==n.contact.phones?null:n.contact.phones[1])}}function Rt(o,a){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.SpI("+",(null==n.contact||null==n.contact.phones?null:n.contact.phones.length)-2,"")}}function bt(o,a){1&o&&(t.j41(0,"span"),t.EFF(1,"s"),t.k0s())}function Et(o,a){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.JRh(null==n.contact||null==n.contact.emails?null:n.contact.emails[0])}}function Dt(o,a){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.JRh(null==n.contact||null==n.contact.emails?null:n.contact.emails[1])}}function Tt(o,a){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.SpI("+",(null==n.contact||null==n.contact.emails?null:n.contact.emails.length)-2,"")}}function jt(o,a){if(1&o&&(t.j41(0,"div",13)(1,"div",14),t.EFF(2,"Relacionado con"),t.k0s(),t.j41(3,"div",18)(4,"div",34)(5,"div",35),t.EFF(6),t.k0s()()()()),2&o){const n=t.XpG();t.R7$(6),t.SpI(" ",(null==n.contact||null==n.contact.contactsRelation||null==n.contact.contactsRelation[0]||null==n.contact.contactsRelation[0].contact?null:n.contact.contactsRelation[0].contact.name)||(null==n.contact||null==n.contact.contactsRelated||null==n.contact.contactsRelated[0]||null==n.contact.contactsRelated[0].contact?null:n.contact.contactsRelated[0].contact.name)," ")}}function $t(o,a){1&o&&(t.j41(0,"div",38),t.EFF(1," Este lead ha sido creado autom\xe1ticamente desde un correo, verifica que no hayan errores "),t.k0s())}function At(o,a){if(1&o){const n=t.RV6();t.j41(0,"div",40)(1,"ion-radio-group",41),t.mxI("ngModelChange",function(e){t.eBV(n);const l=t.XpG(3);return t.DH7(l.showReceivedEmails,e)||(l.showReceivedEmails=e),t.Njj(e)}),t.j41(2,"div",42),t.nrm(3,"ion-radio",43),t.j41(4,"div",44),t.EFF(5," Recibidos "),t.k0s()(),t.j41(6,"div",42),t.nrm(7,"ion-radio",43),t.j41(8,"div",44),t.EFF(9," Enviados "),t.k0s()()(),t.nrm(10,"br")(11,"app-imap-email-list-viewer",37),t.k0s()}if(2&o){const n=t.XpG(3);t.R7$(),t.R50("ngModel",n.showReceivedEmails),t.R7$(2),t.Y8G("value",!0),t.R7$(4),t.Y8G("value",!1),t.R7$(4),t.Y8G("options",t.l_i(10,vt,n.userEmailAccounts[0].id,t.eq3(8,mt,t.sMw(4,pt,n.toIsoStringDate4YearsAgo,n.showReceivedEmails?n.userEmailAccounts[0].email:null==n.contact||null==n.contact.emails?null:n.contact.emails[0],n.showReceivedEmails?null==n.contact||null==n.contact.emails?null:n.contact.emails[0]:n.userEmailAccounts[0].email))))}}function St(o,a){if(1&o){const n=t.RV6();t.DNE(0,$t,2,0,"div",38),t.j41(1,"app-contact-details-info",39),t.bIt("saveContact",function(){t.eBV(n);const e=t.XpG(2);return t.Njj(e.ngOnInit())}),t.k0s(),t.DNE(2,At,12,13,"div",40),t.nrm(3,"br")(4,"br")(5,"br")(6,"br")(7,"br")}if(2&o){const n=t.XpG(2);t.vxM(null!=n.contact&&n.contact.isAutoCreatedFromAutoLead?0:-1),t.R7$(),t.Y8G("contact",n.contactCopy),t.R7$(),t.vxM(n.userEmailAccounts.length>0&&null!=n.contact&&null!=n.contact.emails&&n.contact.emails[0]?2:-1)}}function Ot(o,a){if(1&o&&t.nrm(0,"app-contact-details-operations",36),2&o){const n=t.XpG(2);t.Y8G("contact",n.contact)("operationIdToOpenFromUrl",n.operationIdToOpenFromUrl)}}function Pt(o,a){if(1&o&&t.nrm(0,"app-operation-documents",37),2&o){const n=t.XpG(2);t.Y8G("options",t.eq3(1,ft,n.contact.id))}}function Ut(o,a){if(1&o&&t.DNE(0,St,8,3)(1,Ot,1,2,"app-contact-details-operations",36)(2,Pt,1,3,"app-operation-documents",37),2&o){const n=t.XpG();t.vxM("info"===n.activeTab?0:-1),t.R7$(),t.vxM("operations"===n.activeTab?1:-1),t.R7$(),t.vxM("documents"===n.activeTab?2:-1)}}const Mt=[{path:"",component:(()=>{var o;class a{constructor(i,e,l,c,s,u,m){this.headerService=i,this.activatedRoute=e,this.contactsService=l,this.toastService=c,this.router=s,this.utils=u,this.byvaroState=m,this.contactParameterId=null,this.contact=null,this.contactCopy=null,this.activeTab="info",this.userEmailAccounts=[],this.showReceivedEmails=!0,this.toIsoStringDate4YearsAgo=new Date((new Date).setFullYear((new Date).getFullYear()-4)).toISOString(),this.tabs=[{id:"1",title:"info",active:!0},{id:"2",title:"operations",active:!1},{id:"3",title:"documents",active:!1}],this.operationIdToOpenFromUrl=null}ngOnInit(){this.contactParameterId=this.activatedRoute.snapshot.paramMap.get("id"),this.getData(),this.getUserInfo()}ionViewWillEnter(){this.headerService.setConfig({title:"contact_details"})}onTabClicked(i){this.activeTab=i}getUserInfo(){this.byvaroState.getState().subscribe(i=>{var e,l,c;this.currentUser=i.user,null!==(e=this.currentUser)&&void 0!==e&&e.imapEmailAccounts&&(null===(l=this.currentUser)||void 0===l?void 0:l.imapEmailAccounts.length)>0&&(this.userEmailAccounts=null===(c=this.currentUser)||void 0===c?void 0:c.imapEmailAccounts)})}getData(){var i=this;return(0,d.A)(function*(){if(i.contact=yield i.getContactById(),i.contactCopy=E.cloneDeep(i.contact),!i.contact)return i.toastService.showToast({text:"No existe ning\xfan contacto con ese ID",icon:"fas fa-exclamation-triangle",theme:"red",time:3e3}),void i.router.navigate(["/contacts"]);console.log(i.contact);const e=i.activatedRoute.snapshot.paramMap.get("operationId")||null;e&&(i.operationIdToOpenFromUrl=e,i.activeTab="operations")})()}getContactById(){var i=this;return(0,d.A)(function*(){return i.contactParameterId?i.contactsService.getContactById(i.contactParameterId):null})()}}return(o=a).\u0275fac=function(i){return new(i||o)(t.rXU(S.d),t.rXU(f.nX),t.rXU(D.F),t.rXU(h.f),t.rXU(f.Ix),t.rXU(y.T),t.rXU(F.c))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-contact-details"]],decls:91,vars:35,consts:[[1,"crm-block-body"],[1,"crm-block-body-fixed"],[1,"crm-block-details-header"],[1,"crm-block-details-header-top"],[1,"crm-block-details-header-left"],[1,"crm-block-photo-and-info"],[1,"crm-block-photo-and-info-img"],["alt","",3,"src"],[1,"crm-block-photo-and-info-info"],[1,"crm-block-photo-and-info-info-title"],[1,"crm-block-photo-and-info-info-footer"],[1,"crm-vertical-separator"],[1,"crm-block-info-horizontal"],[1,"crm-info","crm-info-size-medium"],[1,"crm-info-title"],[1,"crm-info-content-langs"],[1,"crm-info-content-langs-plus"],[1,"crm-info","crm-info-size-small"],[1,"crm-info-content"],[1,"crm-info-content-langs-langs"],[1,"crm-item-option","crm-item-option-lang"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[3,"title"],[1,"crm-item-option-label"],[4,"ngIf"],[1,"crm-info"],[1,"crm-info-content","crm-info-content-with-icon"],[1,"fas","fa-bullseye"],[1,"crm-block-details-header-right"],[1,"crm-buttons-group"],[1,"crm-block-details-bottom"],[3,"tabClicked","tabs"],[1,"crm-block-body-blue-content",3,"ngClass"],[1,"crm-item-reference"],[1,"crm-item-reference-text"],[2,"flex","1",3,"contact","operationIdToOpenFromUrl"],[3,"options"],[1,"crm-item-chip","crm-item-chip-warn"],[3,"saveContact","contact"],[2,"width","600px"],[1,"crm-input-radios",3,"ngModelChange","ngModel"],[1,"crm-input-radio"],[3,"value"],[1,"crm-input-radio-label"]],template:function(i,e){if(1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),t.nrm(7,"img",7),t.k0s(),t.j41(8,"div",8)(9,"div")(10,"div",9),t.EFF(11),t.k0s(),t.j41(12,"div",10),t.EFF(13),t.k0s()(),t.j41(14,"div")(15,"div",10),t.EFF(16),t.nI1(17,"date"),t.k0s()()()(),t.nrm(18,"div",11),t.j41(19,"div",12)(20,"div",13)(21,"div",14),t.EFF(22,"Idiomas"),t.k0s(),t.j41(23,"div",15),t.DNE(24,gt,4,1)(25,yt,1,0,"div",16),t.k0s()(),t.j41(26,"div",17)(27,"div",14),t.EFF(28,"Nacionalidad"),t.k0s(),t.j41(29,"div",18)(30,"div",19)(31,"div",20)(32,"div",21)(33,"div",22),t.nrm(34,"span",23),t.k0s(),t.j41(35,"div",24),t.EFF(36),t.k0s()()()()()(),t.j41(37,"div",17)(38,"div",14),t.EFF(39,"Alias"),t.k0s(),t.j41(40,"div",18)(41,"div"),t.EFF(42),t.k0s()()(),t.j41(43,"div",17)(44,"div",14),t.EFF(45,"Referencia"),t.k0s(),t.j41(46,"div",18)(47,"div"),t.EFF(48),t.k0s()()(),t.j41(49,"div",13)(50,"div",14),t.EFF(51," Tel\xe9fono"),t.DNE(52,Ft,2,0,"span",25),t.k0s(),t.j41(53,"div",18),t.DNE(54,kt,2,1,"div",25)(55,It,2,1,"div",25)(56,Rt,2,1,"div",25),t.k0s()(),t.j41(57,"div",13)(58,"div",14),t.EFF(59," E-mail"),t.DNE(60,bt,2,0,"span",25),t.k0s(),t.j41(61,"div",18),t.DNE(62,Et,2,1,"div",25)(63,Dt,2,1,"div",25)(64,Tt,2,1,"div",25),t.k0s()(),t.j41(65,"div",17)(66,"div",14),t.EFF(67,"Origen"),t.k0s(),t.j41(68,"div",18)(69,"div"),t.EFF(70),t.k0s()()(),t.j41(71,"div",17)(72,"div",14),t.EFF(73,"Creado el"),t.k0s(),t.j41(74,"div",18)(75,"div"),t.EFF(76),t.nI1(77,"date"),t.k0s()()(),t.j41(78,"div",26)(79,"div",14),t.EFF(80,"Operaciones"),t.k0s(),t.j41(81,"div",27),t.nrm(82,"i",28),t.EFF(83),t.k0s()(),t.DNE(84,jt,7,1,"div",13),t.k0s()(),t.j41(85,"div",29),t.nrm(86,"div",30),t.k0s()(),t.j41(87,"div",31)(88,"app-tabs",32),t.bIt("tabClicked",function(c){return e.onTabClicked(c)}),t.k0s()()()(),t.j41(89,"div",33),t.DNE(90,Ut,3,3),t.k0s()()),2&i){let l,c,s;t.R7$(7),t.Y8G("src",(null==e.contact?null:e.contact.photoUrl)||"assets/images/avatar.png",t.B4B),t.R7$(4),t.SpI(" ",null==e.contact?null:e.contact.name," "),t.R7$(2),t.SpI(" #",null==e.contact?null:e.contact.byvaroId," "),t.R7$(3),t.SpI(" Creado el ",t.i5U(17,27,null==e.contact?null:e.contact.createdAt,"dd/MM/yyyy")," "),t.R7$(8),t.vxM(null!=e.contact&&e.contact.languages&&(null==e.contact?null:e.contact.languages.length)>0?24:25),t.R7$(10),t.HbH(null==(l=e.utils.getCountryInfo(null==e.contact?null:e.contact.nationality))?null:l.flagClass),t.Y8G("title",null==(c=e.utils.getCountryInfo(null==e.contact?null:e.contact.nationality))?null:c.name),t.R7$(2),t.SpI(" ",null==(s=e.utils.getCountryInfo(null==e.contact?null:e.contact.nationality))?null:s.name," "),t.R7$(6),t.JRh(null==e.contact?null:e.contact.alias),t.R7$(6),t.JRh(null==e.contact?null:e.contact.reference),t.R7$(4),t.Y8G("ngIf",(null==e.contact||null==e.contact.emails?null:e.contact.emails.length)>1),t.R7$(2),t.Y8G("ngIf",null==e.contact||null==e.contact.phones?null:e.contact.phones[0]),t.R7$(),t.Y8G("ngIf",null==e.contact||null==e.contact.phones?null:e.contact.phones[0]),t.R7$(),t.Y8G("ngIf",(null==e.contact||null==e.contact.phones?null:e.contact.phones.length)>2),t.R7$(4),t.Y8G("ngIf",(null==e.contact||null==e.contact.emails?null:e.contact.emails.length)>1),t.R7$(2),t.Y8G("ngIf",null==e.contact||null==e.contact.emails?null:e.contact.emails[0]),t.R7$(),t.Y8G("ngIf",null==e.contact||null==e.contact.emails?null:e.contact.emails[0]),t.R7$(),t.Y8G("ngIf",(null==e.contact||null==e.contact.emails?null:e.contact.emails.length)>2),t.R7$(6),t.JRh(null==e.contact?null:e.contact.origin),t.R7$(6),t.JRh(t.i5U(77,30,null==e.contact?null:e.contact.createdAt,"dd/MM/yyyy")),t.R7$(7),t.Lme(" ",null==e.contact||null==e.contact.operations?null:e.contact.operations.length," / ",null==e.contact||null==e.contact.operations?null:e.contact.operations.length," "),t.R7$(),t.vxM((null==e.contact||null==e.contact.contactsRelation?null:e.contact.contactsRelation.length)>0||(null==e.contact||null==e.contact.contactsRelated?null:e.contact.contactsRelated.length)>0?84:-1),t.R7$(4),t.Y8G("tabs",e.tabs),t.R7$(),t.Y8G("ngClass",t.eq3(33,ut,"operations"===e.activeTab)),t.R7$(),t.vxM(null!=e.contact&&e.contact.id?90:-1)}},dependencies:[p.YU,p.bT,v.BC,v.vS,_.KO,_.f0,_.Je,T.O,j.x,O.t,x,dt,p.vh]}),a})()}];let Gt=(()=>{var o;class a{}return(o=a).\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[f.iI.forChild(Mt),f.iI]}),a})();var xt=r(7294),Bt=r(179),Nt=r(3675),Xt=r(3274),Yt=r(3732),wt=r(9066);let Vt=(()=>{var o;class a{}return(o=a).\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[p.MD,v.YN,_.bv,Gt,T.O,xt.J,C.h,Bt.Y,Xt.K,Nt.S,j.x,Yt.D,wt.K]}),a})()}}]);