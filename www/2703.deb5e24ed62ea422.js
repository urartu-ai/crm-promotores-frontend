"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2703],{9604:(D,_,d)=>{d.d(_,{b:()=>R});var c=d(467),t=d(3953),v=d(6039);let f=(()=>{var i;class a{constructor(e){this.api=e}createPromoterFolder(e){var o=this;return(0,c.A)(function*(){const r=[],s={type:"documents_folder",name:"Documentos",parent:e};return r.push(o.createDirectoryItem({type:"promotions_folder",name:"Promociones",parent:e})),r.push(o.createDirectoryItem(s)),r})()}createAgencyFolder(e){var o=this;return(0,c.A)(function*(){const r=[];return r.push(o.createDirectoryItem({type:"documents_folder",name:"Documentos",parent:e})),r})()}createPromotionsFolder(e){var o=this;return(0,c.A)(function*(){const r=[];console.log("promoter",e);const s=(yield o.api.getPromotions({promoterId:{equals:null==e?void 0:e.id}},null,{itemsPerPage:100,page:0})).success.data;for(const p of s)r.push(o.createDirectoryItem({type:"promotion_folder",name:null==p?void 0:p.projectName,parent:p}));return r})()}createPromotionFolder(e){var o=this;return(0,c.A)(function*(){const r=[],s=(yield o.api.getPromotionFullDataById(null==e?void 0:e.id)).success.data,u={type:"promotion_planos_folder",name:"Planos",parent:s},x={type:"promotion_photos_folder",name:"Fotos",parent:s},E={type:"promotion_catalog_folder",name:"Cat\xe1logos",parent:s},P={type:"documents_folder",name:"Documentos",parent:s};return r.push(o.createDirectoryItem({type:"properties_folder",name:"Unidades",parent:s})),r.push(o.createDirectoryItem(u)),r.push(o.createDirectoryItem(x)),r.push(o.createDirectoryItem(E)),r.push(o.createDirectoryItem(P)),r})()}createPropertiesFolder(e){var o=this;return(0,c.A)(function*(){const r=[],s=(yield o.api.getProperty({promotionId:{equals:null==e?void 0:e.id}},null,{itemsPerPage:100,page:0})).success.data;for(const p of s)r.push(o.createDirectoryItem({type:"property_folder",name:null==p?void 0:p.title,parent:p}));return r})()}createPropertyFolder(e){var o=this;return(0,c.A)(function*(){const r=[],s={type:"property_photos_folder",name:"Fotos",parent:e};return r.push(o.createDirectoryItem({type:"property_plans_folder",name:"Planos",parent:e})),r.push(o.createDirectoryItem(s)),r})()}createPropertyPlansFolder(e){var o=this;return(0,c.A)(function*(){const r=[],n=[];for(const s of n)r.push(o.createDirectoryItem(s));return r})()}createPropertyPhotosFolder(e){var o=this;return(0,c.A)(function*(){const r=[],n=yield o.api.getProperty({id:{equals:null==e?void 0:e.id}},null,null,{propertyFile:{apply:!0,onlyCount:!1,filter:null}}),[s]=n.success.data,p=s.propertyFiles;for(const u of p)r.push(o.createDirectoryItem(u));return r})()}createPromotionPlansFolder(e){var o=this;return(0,c.A)(function*(){const r=[],n=[];for(const s of n)r.push(o.createDirectoryItem(s));return r})()}createPromotionPhotosFolder(e){var o=this;return(0,c.A)(function*(){const r=[],n=yield o.api.getPromotions({id:{equals:null==e?void 0:e.id}},null,null,{promotionFiles:{apply:!0,onlyCount:!1,filter:null}}),[s]=n.success.data,p=null==s?void 0:s.promotionFiles;for(const u of p)r.push(o.createDirectoryItem(u));return r})()}createPromotionCatalogFolder(e){var o=this;return(0,c.A)(function*(){const r=[],n=[];for(const s of n)r.push(o.createDirectoryItem(s));return r})()}createDirectoryItem(e){const r={type:null!=e&&e.url?"file":"folder",subtype:this.getSubtype(e),object:e,url:null==e?void 0:e.url},n=this.getItemNameAndSubtitle(e);return r.name=n.name,r.subtitle=n.subtitle,r}getSubtype(e){if(null!=e&&e.url){var o;let r=this.getFileExtension((null==e?void 0:e.label)||(null==e?void 0:e.name));return r=null===(o=r)||void 0===o?void 0:o.toLowerCase().trim(),["pdf"].includes(r)?"pdf":["jpg","jpeg","png","gif","webp","heic","heif","bmp","tiff","svg","ico","jfif","raw","indd","ai","eps"].includes(r)?"img":"other-file"}return"folder"}getFileExtension(e){const r=e.split("?")[0].split(".").pop();return r.includes("/")?null:r}getItemNameAndSubtitle(e){var o,r;let n={name:(null==e?void 0:e.label)||(null==e?void 0:e.name),subtitle:""};switch(null==e?void 0:e.type){case"promotion_folder":n.subtitle="Promoci\xf3n",n.name=null==e||null===(o=e.parent)||void 0===o?void 0:o.projectName;break;case"properties_folder":case"property_plans_folder":case"property_photos_folder":case"promotion_planos_folder":case"promotion_photos_folder":case"promotion_catalog_folder":break;case"property_folder":n.subtitle="Propiedad",n.name=null==e||null===(r=e.parent)||void 0===r?void 0:r.reference}return n}}return(i=a).\u0275fac=function(e){return new(e||i)(t.KVO(v.i))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),a})(),h=(()=>{var i;class a{constructor(e,o){this.fileExplorerDirectoryBuilderService=e,this.api=o}createFileExplorerDirectory(e){var o=this;return(0,c.A)(function*(){const r={};return r.object=e,r.items=yield o.createDirectoryItems(e),r})()}createDirectoryItems(e){var o=this;return(0,c.A)(function*(){const r=[];switch(null==e?void 0:e.type){case"promoter_folder":const n=yield o.fileExplorerDirectoryBuilderService.createPromoterFolder(e.parent);r.push(...n);break;case"agency_folder":const s=yield o.fileExplorerDirectoryBuilderService.createAgencyFolder(e.parent);r.push(...s);break;case"documents_folder":break;case"promotions_folder":const p=yield o.fileExplorerDirectoryBuilderService.createPromotionsFolder(e.parent);r.push(...p);break;case"promotion_folder":const u=yield o.fileExplorerDirectoryBuilderService.createPromotionFolder(e.parent);r.push(...u);break;case"properties_folder":const x=yield o.fileExplorerDirectoryBuilderService.createPropertiesFolder(e.parent);r.push(...x);break;case"property_folder":const E=yield o.fileExplorerDirectoryBuilderService.createPropertyFolder(e.parent);r.push(...E);break;case"property_plans_folder":const P=yield o.fileExplorerDirectoryBuilderService.createPropertyPlansFolder(e.parent);r.push(...P);break;case"property_photos_folder":const G=yield o.fileExplorerDirectoryBuilderService.createPropertyPhotosFolder(e.parent);r.push(...G);break;case"promotion_planos_folder":const U=yield o.fileExplorerDirectoryBuilderService.createPromotionPlansFolder(e.parent);r.push(...U);break;case"promotion_photos_folder":const X=yield o.fileExplorerDirectoryBuilderService.createPromotionPhotosFolder(e.parent);r.push(...X);break;case"promotion_catalog_folder":const $=yield o.fileExplorerDirectoryBuilderService.createPromotionCatalogFolder(e.parent);r.push(...$)}return r})()}}return(i=a).\u0275fac=function(e){return new(e||i)(t.KVO(f),t.KVO(v.i))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),a})();var m=d(8374),y=d(5970),F=d(517),g=d(177);const I=i=>({"crm-block-breadcrumbs-item-separator":i});function k(i,a){1&i&&(t.j41(0,"div",6)(1,"div",13),t.EFF(2," / "),t.k0s()())}function C(i,a){if(1&i){const l=t.RV6();t.DNE(0,k,3,0,"div",6),t.j41(1,"div",11),t.bIt("click",function(){t.eBV(l);const o=t.XpG().$implicit,r=t.XpG();return t.Njj(r.onClickNavigation(o))}),t.j41(2,"div",12),t.EFF(3),t.k0s()()}if(2&i){const l=t.XpG(),e=l.$implicit,o=l.$index,r=t.XpG();t.vxM(o>0?0:-1),t.R7$(2),t.Y8G("ngClass",t.eq3(3,I,o>0)),t.R7$(),t.SpI(" ",r.getFolderName(e)," ")}}function S(i,a){if(1&i&&t.DNE(0,C,4,5,"div",6),2&i){const l=a.$implicit,e=t.XpG();t.vxM(e.getFolderName(l)?0:-1)}}function A(i,a){1&i&&t.nrm(0,"img",16)}function b(i,a){1&i&&t.nrm(0,"img",17)}function B(i,a){1&i&&t.nrm(0,"img",18)}function O(i,a){if(1&i&&t.nrm(0,"img",19),2&i){const l=t.XpG().$implicit;t.Y8G("src",l.url,t.B4B)}}function M(i,a){if(1&i&&(t.j41(0,"div",20),t.EFF(1),t.k0s()),2&i){const l=t.XpG().$implicit;t.R7$(),t.SpI(" ",null==l?null:l.subtitle," ")}}function T(i,a){if(1&i){const l=t.RV6();t.j41(0,"div",14),t.bIt("click",function(){const o=t.eBV(l).$implicit,r=t.XpG();return t.Njj(r.onItemClick(o))}),t.j41(1,"div",15),t.DNE(2,A,1,0,"img",16)(3,b,1,0,"img",17)(4,B,1,0,"img",18)(5,O,1,1,"img",19),t.k0s(),t.DNE(6,M,2,1,"div",20),t.j41(7,"div",21),t.EFF(8),t.k0s()()}if(2&i){const l=a.$implicit;t.R7$(2),t.vxM("folder"===(null==l?null:l.subtype)?2:"pdf"===(null==l?null:l.subtype)?3:"other-file"===(null==l?null:l.subtype)?4:5),t.R7$(4),t.vxM(null!=l&&l.subtitle?6:-1),t.R7$(2),t.SpI(" ",null==l?null:l.name," ")}}function N(i,a){1&i&&t.EFF(0," No hay archivos ")}let R=(()=>{var i;class a{constructor(e,o,r,n){this.fileExplorerService=e,this.modalsService=o,this.popoversService=r,this.router=n,this.options={type:"promoterFolder"},this.history=[],this.navigation=[]}ngAfterViewInit(){}ngOnChanges(){this.directoryBaseElement&&(console.log("directoryBaseElement",this.directoryBaseElement),this.navigation=[],this.navigation.push(this.directoryBaseElement),this.buildDirectory())}getFolderName(e){var o,r,n,s;return null!=e&&e.name?e.name:null!=e&&null!==(o=e.parent)&&void 0!==o&&o.reference?null==e||null===(n=e.parent)||void 0===n?void 0:n.reference:null!=e&&null!==(r=e.parent)&&void 0!==r&&r.projectName?null==e||null===(s=e.parent)||void 0===s?void 0:s.projectName:""}onItemMenuClick(e){var o=this;return(0,c.A)(function*(){e.stopPropagation(),e.preventDefault();yield o.popoversService.onShowMenuPopover(e,"file-explorer-item-options")})()}onUploadFiles(){var e=this;return(0,c.A)(function*(){const o=yield e.modalsService.onShowUploadFilesModal();o.data&&console.log("Archivos a subir",o.data)})()}onItemClick(e){var o,r;"Documentos"!==e.name?("folder"===e.type&&this.buildDirectory(null==e?void 0:e.object),"file"===e.type&&window.open(e.url,"_blank")):this.router.navigate(["/documents"],{queryParams:{agencyId:"agencyFolder"===this.options.type?null===(o=this.directoryBaseElement)||void 0===o||null===(o=o.parent)||void 0===o?void 0:o.id:void 0,promotionId:"promotion_folder"===this.directoryBaseElement.type?null===(r=this.directoryBaseElement)||void 0===r||null===(r=r.parent)||void 0===r?void 0:r.id:void 0}})}onClickNavigation(e){const o=this.navigation.findIndex(r=>r===e);this.navigation=this.navigation.slice(0,o+1),this.buildDirectory(e,!0)}onGoRoot(){this.buildDirectory(this.directoryBaseElement,!0)}onGoBack(){this.navigation.length>1&&(this.navigation.pop(),this.buildDirectory(this.navigation[this.navigation.length-1],!0))}buildDirectory(e,o){var r=this;return(0,c.A)(function*(){r.directory=yield r.fileExplorerService.createFileExplorerDirectory(e||r.directoryBaseElement),o||r.navigation.push(e),console.log("directory",r.directory)})()}}return(i=a).\u0275fac=function(e){return new(e||i)(t.rXU(h),t.rXU(m.M),t.rXU(y.m),t.rXU(F.Ix))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-file-explorer"]],inputs:{directoryBaseElement:"directoryBaseElement",options:"options"},features:[t.OA$],decls:17,vars:1,consts:[[1,"crm-section"],[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-buttons-group"],[1,"crm-button-icon-solo",3,"click"],[1,"fa","fa-arrow-left"],[1,"crm-block-breadcrumbs"],[1,"crm-block-breadcrumbs-item"],[1,"crm-block-breadcrumbs-item-icon"],[1,"fas","fa-folder"],[1,"crm-section-files"],[1,"crm-directory-item"],[1,"crm-block-breadcrumbs-item",3,"click"],[1,"crm-block-breadcrumbs-item-text",3,"ngClass"],[1,"crm-block-breadcrumbs-item-text","crm-block-breadcrumbs-item-separator"],[1,"crm-directory-item",3,"click"],[1,"crm-directory-item-icon"],["src","assets/images/folder.png"],["src","assets/images/pdf1.png"],["src","assets/images/doc.png"],[3,"src"],[1,"crm-directory-item-subtitle"],[1,"crm-directory-item-title"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"div")(3,"div",2)(4,"button",3),t.bIt("click",function(){return o.onGoBack()}),t.nrm(5,"i",4),t.k0s(),t.j41(6,"div",5)(7,"div",6)(8,"div",7),t.nrm(9,"i",8),t.k0s()(),t.Z7z(10,S,1,1,null,null,t.fX1),t.k0s()()(),t.nrm(12,"div",2),t.k0s(),t.j41(13,"div",9),t.Z7z(14,T,9,3,"div",10,t.fX1),t.DNE(16,N,1,0),t.k0s()()),2&e&&(t.R7$(10),t.Dyx(o.navigation),t.R7$(4),t.Dyx(null==o.directory?null:o.directory.items),t.R7$(2),t.vxM(0===(null==o.directory||null==o.directory.items?null:o.directory.items.length)?16:-1))},dependencies:[g.YU]}),a})()},8284:(D,_,d)=>{d.d(_,{o:()=>h});var c=d(177),t=d(9417),v=d(4842),f=d(3953);let h=(()=>{var m;class y{}return(m=y).\u0275fac=function(g){return new(g||m)},m.\u0275mod=f.$C({type:m}),m.\u0275inj=f.G2t({imports:[c.MD,t.YN,v.h]}),y})()}}]);