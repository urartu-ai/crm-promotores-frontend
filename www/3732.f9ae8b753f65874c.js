"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3732,3666,1285],{3274:($,B,i)=>{i.d(B,{K:()=>g});var l=i(177),t=i(3953);let g=(()=>{var k;class _{}return(k=_).\u0275fac=function(e){return new(e||k)},k.\u0275mod=t.$C({type:k}),k.\u0275inj=t.G2t({imports:[l.MD]}),_})()},179:($,B,i)=>{i.d(B,{Y:()=>v});var l=i(177),t=i(9417),g=i(9465),k=i(8147),_=i(3953);let v=(()=>{var e;class M{}return(e=M).\u0275fac=function(D){return new(D||e)},e.\u0275mod=_.$C({type:e}),e.\u0275inj=_.G2t({imports:[l.MD,t.YN,g.bv,k.h]}),M})()},6580:($,B,i)=>{i.d(B,{k:()=>k});var l=i(3953);function t(_,v){if(1&_&&(l.j41(0,"div",15),l.EFF(1),l.k0s()),2&_){const e=l.XpG(2);l.R7$(),l.SpI(" ",null==e.listPaginationConfig?null:e.listPaginationConfig.checkedItems," seleccionado ")}}function g(_,v){if(1&_&&(l.j41(0,"div",14),l.DNE(1,t,2,1,"div",15),l.k0s()),2&_){const e=l.XpG();l.R7$(),l.vxM(null!=e.listPaginationConfig&&e.listPaginationConfig.checkedItems||0===(null==e.listPaginationConfig?null:e.listPaginationConfig.checkedItems)?1:-1)}}let k=(()=>{var _;class v{constructor(){this.listPaginationConfig={},this.goPreviousPage=new l.bkB,this.goNextPage=new l.bkB,this.sort=new l.bkB}ngOnInit(){}onGoPreviousPage(M){this.goPreviousPage.emit(M)}onGoNextPage(M){this.goNextPage.emit(M)}onSort(M){this.sort.emit(M)}}return(_=v).\u0275fac=function(M){return new(M||_)},_.\u0275cmp=l.VBU({type:_,selectors:[["app-list-pagination-selectors"]],inputs:{listPaginationConfig:"listPaginationConfig"},outputs:{goPreviousPage:"goPreviousPage",goNextPage:"goNextPage",sort:"sort"},decls:21,vars:6,consts:[[1,"crm-block-pagination-selectors"],[1,"crm-button-pagination"],[1,"crm-button-pagination-text"],[1,"crm-button-pagination-buttons"],[1,"crm-button-pagination-arrow","crm-button-icon-solo",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-button-pagination-number"],[1,"fas","fa-arrow-right"],[1,"crm-dropdown",3,"click"],[1,"crm-dropdown-text"],[1,"crm-dropdown-right"],[1,"crm-dropdown-value"],[1,"crm-dropdown-arrow"],[1,"fas","fa-chevron-down"],[1,"crm-input-checkbox"],[1,"crm-input-checkbox-pre-label"]],template:function(M,f){1&M&&(l.j41(0,"div",0)(1,"div",1)(2,"div",2),l.EFF(3),l.k0s(),l.j41(4,"div",3)(5,"button",4),l.bIt("click",function(j){return f.onGoPreviousPage(j)}),l.nrm(6,"i",5),l.k0s(),l.j41(7,"div",6),l.EFF(8),l.k0s(),l.j41(9,"button",4),l.bIt("click",function(j){return f.onGoNextPage(j)}),l.nrm(10,"i",7),l.k0s()(),l.j41(11,"div",8),l.bIt("click",function(j){return f.onSort(j)}),l.j41(12,"div",9),l.EFF(13," Ordenar por "),l.k0s(),l.j41(14,"div",10)(15,"div",11),l.EFF(16),l.k0s(),l.j41(17,"div",12),l.nrm(18,"i",13),l.k0s()()()(),l.j41(19,"div"),l.DNE(20,g,2,1,"div",14),l.k0s()()),2&M&&(l.R7$(3),l.E5c(" ",null==f.listPaginationConfig?null:f.listPaginationConfig.pageStartIndex," - ",null==f.listPaginationConfig?null:f.listPaginationConfig.pageEndIndex," de ",null==f.listPaginationConfig?null:f.listPaginationConfig.totalCount," "),l.R7$(5),l.SpI(" P\xe1g ",null==f.listPaginationConfig?null:f.listPaginationConfig.paginationPage," "),l.R7$(8),l.SpI(" ",null==f.listPaginationConfig?null:f.listPaginationConfig.sortField," "),l.R7$(4),l.vxM(null!=f.listPaginationConfig&&f.listPaginationConfig.showSelectItems?20:-1))}}),v})()},5603:($,B,i)=>{i.d(B,{P:()=>k});var l=i(177),t=i(9417),g=i(3953);let k=(()=>{var _;class v{}return(_=v).\u0275fac=function(M){return new(M||_)},_.\u0275mod=g.$C({type:_}),_.\u0275inj=g.G2t({imports:[l.MD,t.YN]}),v})()},3675:($,B,i)=>{i.d(B,{S:()=>_});var l=i(177),t=i(9465),g=i(9417),k=i(3953);let _=(()=>{var v;class e{}return(v=e).\u0275fac=function(f){return new(f||v)},v.\u0275mod=k.$C({type:v}),v.\u0275inj=k.G2t({imports:[l.MD,t.bv,g.YN]}),e})()},1129:($,B,i)=>{i.d(B,{Z:()=>_});var l=i(3953),t=i(6069),g=i(1982);function k(v,e){if(1&v){const M=l.RV6();l.j41(0,"app-country-selector-popover",4),l.bIt("countrySelected",function(D){l.eBV(M);const j=l.XpG();return l.Njj(j.selectCountry(D))})("closePopover",function(){l.eBV(M);const D=l.XpG();return l.Njj(D.dropdownOpen=!1)}),l.k0s()}2&v&&l.Y8G("showCountryCode",!0)}let _=(()=>{var v;class e{constructor(){this.emitCountrySelected=new l.bkB,this.countries=t.X,this.selectedCountry=t.X[0],this.dropdownOpen=!1}ngOnChanges(){const f=this.extractCountryPhoneCodeFromPhoneNumber(this.selectedPhoneNumber);f!==this.extractCountryPhoneCodeFromPhoneNumber(this.selectedCountry.phoneCode)&&this.selectCountryByPhoneCode(f)}toggleDropdown(f){f.stopPropagation(),this.dropdownOpen=!this.dropdownOpen}selectCountry(f){f.event.stopPropagation(),this.selectedCountry=f.country,this.emitCountrySelected.emit(f.country),this.dropdownOpen=!1}selectCountryByPhoneCode(f){const D=this.countries.find(j=>j.phoneCode===f);D&&(this.selectedCountry=D,this.emitCountrySelected.emit(D))}extractCountryPhoneCodeFromPhoneNumber(f){return null==f?void 0:f.split(" ")[0]}}return(v=e).\u0275fac=function(f){return new(f||v)},v.\u0275cmp=l.VBU({type:v,selectors:[["app-flag-country-selector"]],inputs:{selectedPhoneNumber:"selectedPhoneNumber"},outputs:{emitCountrySelected:"emitCountrySelected"},features:[l.OA$],decls:5,vars:3,consts:[["tabindex","0",1,"flag-country-selector-container",3,"click"],[1,"selected-country"],[1,"fas","fa-caret-down","dropdown-arrow"],[3,"showCountryCode"],[3,"countrySelected","closePopover","showCountryCode"]],template:function(f,D){1&f&&(l.j41(0,"div",0),l.bIt("click",function(Q){return D.toggleDropdown(Q)}),l.j41(1,"div",1),l.nrm(2,"span")(3,"i",2),l.k0s(),l.DNE(4,k,1,1,"app-country-selector-popover",3),l.k0s()),2&f&&(l.R7$(2),l.HbH(null==D.selectedCountry?null:D.selectedCountry.flagClass),l.R7$(2),l.vxM(D.dropdownOpen?4:-1))},dependencies:[g.u],styles:[".flag-country-selector-container[_ngcontent-%COMP%]{position:relative;width:50px;cursor:pointer;color:#000}.selected-country[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:50px}.dropdown-arrow[_ngcontent-%COMP%]{margin-left:8px}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:200px;z-index:9999;background-color:#fff;border:1px solid #ccc;padding:8px 0;border-radius:12px;border:1px solid var(--crm-border-light-color);color:#000;max-height:150px;overflow-y:auto}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;display:inline-block;margin-right:8px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.flag-country-selector-container[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{color:#000}.selected-country[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;width:18px;height:18px}"]}),e})()},6812:($,B,i)=>{i.d(B,{u:()=>_});var l=i(177),t=i(9417),g=i(7754),k=i(3953);let _=(()=>{var v;class e{}return(v=e).\u0275fac=function(f){return new(f||v)},v.\u0275mod=k.$C({type:v}),v.\u0275inj=k.G2t({imports:[l.MD,t.YN,g.X]}),e})()},9066:($,B,i)=>{i.d(B,{K:()=>k});var l=i(177),t=i(9465),g=i(3953);let k=(()=>{var _;class v{}return(_=v).\u0275fac=function(M){return new(M||_)},_.\u0275mod=g.$C({type:_}),_.\u0275inj=g.G2t({imports:[l.MD,t.bv]}),v})()},68:($,B,i)=>{i.d(B,{k:()=>k});var l=i(177),t=i(9417),g=i(3953);let k=(()=>{var _;class v{}return(_=v).\u0275fac=function(M){return new(M||_)},_.\u0275mod=g.$C({type:_}),_.\u0275inj=g.G2t({imports:[l.MD,t.YN]}),v})()},2306:($,B,i)=>{i.d(B,{T:()=>k});var l=i(177),t=i(9417),g=i(3953);let k=(()=>{var _;class v{}return(_=v).\u0275fac=function(M){return new(M||_)},_.\u0275mod=g.$C({type:_}),_.\u0275inj=g.G2t({imports:[l.MD,t.YN]}),v})()},3732:($,B,i)=>{i.d(B,{D:()=>G});var l=i(177),t=i(4716),g=i(9417),k=i(9465),_=i(7944),v=i(7991),e=i(3953);let M=(()=>{var u;class P{}return(u=P).\u0275fac=function(c){return new(c||u)},u.\u0275mod=e.$C({type:u}),u.\u0275inj=e.G2t({imports:[l.MD,g.YN]}),P})();var f=i(8147),D=i(2652),j=i(6812);let Q=(()=>{var u;class P{}return(u=P).\u0275fac=function(c){return new(c||u)},u.\u0275mod=e.$C({type:u}),u.\u0275inj=e.G2t({imports:[l.MD,g.YN]}),P})();var a=i(6279);let L=(()=>{var u;class P{}return(u=P).\u0275fac=function(c){return new(c||u)},u.\u0275mod=e.$C({type:u}),u.\u0275inj=e.G2t({imports:[l.MD,g.YN,g.X1,k.bv,f.h,j.u,Q,a.F]}),P})();var U=i(2606),X=i(179),O=i(3675),Y=i(1968),w=i(3895),I=i(9662);let V=(()=>{var u;class P{}return(u=P).\u0275fac=function(c){return new(c||u)},u.\u0275mod=e.$C({type:u}),u.\u0275inj=e.G2t({imports:[l.MD,g.YN,g.X1,k.bv,D.T,a.F,I.Y,f.h]}),P})();var N=i(3274),E=i(2306),x=i(68),K=i(144),W=i(8433),ne=i(9066),ie=i(7774),q=i(467),le=i(6552),ae=i(5970),se=i(6039),ce=i(8397),de=i(1129);const ue=["fileUploaderManagerComponent"],te=u=>({"crm-input-input-error":u}),oe=u=>({field:u}),pe=u=>({item:u});function me(u,P){1&u&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&u&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function _e(u,P){1&u&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&u&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function ve(u,P){1&u&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&u&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function fe(u,P){1&u&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&u&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function ge(u,P){if(1&u){const C=e.RV6();e.j41(0,"div",15)(1,"div",27)(2,"div",28),e.nrm(3,"span"),e.k0s(),e.j41(4,"div",29),e.EFF(5),e.k0s()(),e.j41(6,"div",30),e.bIt("click",function(){const m=e.eBV(C).$implicit,S=e.XpG();return e.Njj(S.onRemoveLanguage(m))}),e.nrm(7,"i",31),e.k0s()()}if(2&u){let C,c;const m=P.$implicit,S=e.XpG();e.R7$(3),e.HbH(null==(C=S.getLanguageInfo(m))?null:C.flagClass),e.R7$(2),e.SpI(" ",null==(c=S.getLanguageInfo(m))?null:c.name," ")}}function Ce(u,P){if(1&u&&(e.j41(0,"option",34),e.EFF(1),e.k0s()),2&u){const C=P.$implicit;e.Y8G("value",C.id),e.R7$(),e.JRh(C.name)}}function he(u,P){if(1&u&&(e.j41(0,"div",32)(1,"select",33),e.Z7z(2,Ce,2,2,"option",34,e.fX1),e.k0s()()),2&u){const C=e.XpG();e.R7$(2),e.Dyx(C.roles)}}function be(u,P){1&u&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&u&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function ye(u,P){if(1&u){const C=e.RV6();e.j41(0,"button",35),e.bIt("click",function(){e.eBV(C);const m=e.XpG();return e.Njj(m.changeUserInactiveState(!1))}),e.EFF(1,"Activar Usuario"),e.k0s()}}function ke(u,P){if(1&u){const C=e.RV6();e.j41(0,"button",36),e.bIt("click",function(){e.eBV(C);const m=e.XpG();return e.Njj(m.changeUserInactiveState(!0))}),e.EFF(1,"Desactivar Usuario"),e.k0s()}}let Me=(()=>{var u;class P{constructor(c,m,S,R,z){this.fb=c,this.utils=m,this.popoverService=S,this.api=R,this.toast=z,this.user={},this.onChange=new e.bkB,this.userCopy=null,this.files=[],this.photoEdited=!1,this.roles=[]}ngOnInit(){var c=this;return(0,q.A)(function*(){c.userCopy=JSON.parse(JSON.stringify(c.user)),c.initForm(),c.user?(c.populateForm(c.userCopy),c.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]},c.fileUploaderManager.createProfileFilePic(c.user)):c.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]};const m=yield c.api.getAccessRole();m.success?c.roles=m.success.data:c.toast.showErrorToast("Error al cargar los roles de acceso. "+m.error.errorMessage)})()}getLanguageInfo(c){return this.utils.getLanguageInfo(c)}onAddLanguage(c){var m=this;return(0,q.A)(function*(){var S,R;const z={languageSelector:!0,showCountryCode:!1,selectedCodes:null===(S=m.user)||void 0===S?void 0:S.languages},H=yield m.popoverService.onShowCountrySelectorPopover(c,z);var ee,Z;null!=H&&null!==(R=H.data)&&void 0!==R&&R.country&&(m.user=m.user||{},m.user.languages=(null===(ee=m.user)||void 0===ee?void 0:ee.languages)||[],m.user.languages.push(null===(Z=H.data)||void 0===Z||null===(Z=Z.country)||void 0===Z?void 0:Z.code))})()}changeUserInactiveState(c){var m=this;return(0,q.A)(function*(){const S=yield m.api.updateUserById(m.user.id,{...m.user,inactive:c});S.success?(m.user.inactive=c,m.toast.showSuccessToast("Estado del usuario actualizado correctamente")):m.toast.showErrorToast("Ha ocurrido un error al actualizar el estado del usuario. "+S.error.errorMessage)})()}onRemoveLanguage(c){this.user.languages=this.user.languages.filter(m=>m!==c)}initForm(){this.userForm=this.fb.group({email:["",g.k0.required],name:["",g.k0.required],jobTitle:[""],phone:["+34 "],visibleForCollaborators:[],accessRoleId:["",g.k0.required],allowSignOnBehalf:[]})}populateForm(c){var m,S,R,z,H,ee,Z;this.userForm.patchValue({email:null!==(m=null==c?void 0:c.email)&&void 0!==m?m:"",name:null!==(S=null==c?void 0:c.name)&&void 0!==S?S:"",jobTitle:null!==(R=null==c?void 0:c.jobTitle)&&void 0!==R?R:"",phone:null!==(z=null==c?void 0:c.phone)&&void 0!==z?z:"",visibleForCollaborators:null!==(H=null==c?void 0:c.visibleForCollaborators)&&void 0!==H&&H,accessRoleId:null!==(ee=null==c?void 0:c.accessRoleId)&&void 0!==ee?ee:"",allowSignOnBehalf:null!==(Z=null==c?void 0:c.allowSignOnBehalf)&&void 0!==Z&&Z}),this.userForm.get("email").disable()}onSelectCountry(c){this.userForm.get("phone").setValue((null==c?void 0:c.phoneCode)+" ")}isControlInvalid(c){const m=this.userForm.get(c);return!(!m||!m.invalid||!m.dirty&&!m.touched)}}return(u=P).\u0275fac=function(c){return new(c||u)(e.rXU(g.ok),e.rXU(le.T),e.rXU(ae.m),e.rXU(se.i),e.rXU(ce.f))},u.\u0275cmp=e.VBU({type:u,selectors:[["app-user-form"]],viewQuery:function(c,m){if(1&c&&e.GBs(ue,7),2&c){let S;e.mGM(S=e.lsd())&&(m.fileUploaderManager=S.first)}},inputs:{user:"user"},outputs:{onChange:"onChange"},decls:83,vars:75,consts:[["fileUploaderManagerComponent",""],[1,"crm-section",3,"formGroup"],[1,"crm-section-small-title"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","formControlName","email",3,"placeholder"],["class","crm-input-error",4,"ngIf"],["type","text","formControlName","name",3,"placeholder"],["type","text","formControlName","jobTitle",3,"placeholder"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected"],["type","text","formControlName","phone",3,"placeholder"],[1,"crm-input","crm-input-medium"],[1,"crm-section-items"],[1,"crm-item-option","crm-item-option-lang","edit"],["type","button",1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fas","fa-add"],["class","crm-input-input",4,"ngIf"],[1,"crm-input-checkboxes"],["appToggleCheckbox","",1,"crm-input-checkbox"],["formControlName","visibleForCollaborators"],[1,"crm-input-checkbox-label"],["formControlName","allowSignOnBehalf"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button-secondary","crm-button-secondary-red"],[1,"crm-input-error"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[1,"crm-item-option-label"],[1,"crm-item-option-remove",3,"click"],[1,"fas","fa-trash"],[1,"crm-input-input"],["placeholder","Seleccione","formControlName","accessRoleId"],[3,"value"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"crm-button-secondary","crm-button-secondary-red",3,"click"]],template:function(c,m){if(1&c){const S=e.RV6();e.j41(0,"form",1)(1,"div",2),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.nrm(4,"app-file-uploader-manager",null,0),e.j41(6,"div",3)(7,"div",4),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"div",5),e.nrm(11,"input",6),e.nI1(12,"translate"),e.nI1(13,"translate"),e.k0s(),e.DNE(14,me,3,3,"div",7),e.k0s(),e.j41(15,"div",3)(16,"div",4),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"div",5),e.nrm(20,"input",8),e.nI1(21,"translate"),e.nI1(22,"translate"),e.k0s(),e.DNE(23,_e,3,3,"div",7),e.k0s(),e.j41(24,"div",3)(25,"div",4),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.j41(28,"div",5),e.nrm(29,"input",9),e.nI1(30,"translate"),e.nI1(31,"translate"),e.k0s(),e.DNE(32,ve,3,3,"div",7),e.k0s(),e.j41(33,"div",3)(34,"div",4),e.EFF(35),e.nI1(36,"translate"),e.k0s(),e.j41(37,"div",10)(38,"div",5)(39,"app-flag-country-selector",11),e.bIt("emitCountrySelected",function(z){return e.eBV(S),e.Njj(m.onSelectCountry(z))}),e.k0s(),e.nrm(40,"input",12),e.nI1(41,"translate"),e.nI1(42,"translate"),e.k0s()(),e.DNE(43,fe,3,3,"div",7),e.k0s(),e.j41(44,"div",13)(45,"div",4),e.EFF(46," Idiomas "),e.k0s(),e.j41(47,"div",14),e.Z7z(48,ge,8,3,"div",15,e.fX1),e.j41(50,"button",16),e.bIt("click",function(z){return e.eBV(S),e.Njj(m.onAddLanguage(z))}),e.nrm(51,"i",17),e.EFF(52),e.nI1(53,"translate"),e.nI1(54,"translate"),e.k0s(),e.nrm(55,"br"),e.j41(56,"div",3)(57,"div",4),e.EFF(58,"Seleccionar Rol"),e.k0s(),e.DNE(59,he,4,0,"div",18),e.k0s(),e.DNE(60,be,3,3,"div",7),e.nrm(61,"br"),e.j41(62,"div",3)(63,"div",4),e.EFF(64,"Mostrar usuario a colaboradores"),e.k0s(),e.j41(65,"div",19)(66,"div",20),e.nrm(67,"ion-checkbox",21),e.j41(68,"div",22),e.EFF(69,"Mostrar"),e.k0s()()()(),e.nrm(70,"br"),e.j41(71,"div",3)(72,"div",4),e.EFF(73,"Permitir que el usuario firme en nombre de la empresa"),e.k0s(),e.j41(74,"div",19)(75,"div",20),e.nrm(76,"ion-checkbox",23),e.j41(77,"div",22),e.EFF(78,"Permitir"),e.k0s()()()()(),e.nrm(79,"br")(80,"br"),e.DNE(81,ye,2,0,"button",24)(82,ke,2,0,"button",25),e.k0s()()}2&c&&(e.Y8G("formGroup",m.userForm),e.R7$(2),e.SpI(" ",e.bMT(3,22,"text.profile_pic")," "),e.R7$(6),e.SpI(" ",e.bMT(9,24,"text.email")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(57,te,m.isControlInvalid("email"))),e.R7$(),e.Y8G("placeholder",e.i5U(13,28,"text.input_placeholder",e.eq3(59,oe,e.bMT(12,26,"text.email")))),e.R7$(3),e.Y8G("ngIf",m.isControlInvalid("email")),e.R7$(3),e.SpI(" ",e.bMT(18,31,"text.name")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(61,te,m.isControlInvalid("name"))),e.R7$(),e.Y8G("placeholder",e.i5U(22,35,"text.input_placeholder",e.eq3(63,oe,e.bMT(21,33,"text.name")))),e.R7$(3),e.Y8G("ngIf",m.isControlInvalid("name")),e.R7$(3),e.SpI(" ",e.bMT(27,38,"text.job_title")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(65,te,m.isControlInvalid("jobTitle"))),e.R7$(),e.Y8G("placeholder",e.i5U(31,42,"text.input_placeholder",e.eq3(67,oe,e.bMT(30,40,"text.job_title")))),e.R7$(3),e.Y8G("ngIf",m.isControlInvalid("jobTitle")),e.R7$(3),e.SpI(" ",e.bMT(36,45,"text.phone")," "),e.R7$(3),e.Y8G("ngClass",e.eq3(69,te,m.isControlInvalid("phone"))),e.R7$(2),e.Y8G("placeholder",e.i5U(42,49,"text.input_placeholder",e.eq3(71,oe,e.bMT(41,47,"text.phone")))),e.R7$(3),e.Y8G("ngIf",m.isControlInvalid("phone")),e.R7$(5),e.Dyx(null==m.user?null:m.user.languages),e.R7$(4),e.SpI(" ",e.i5U(54,54,"text.add_item",e.eq3(73,pe,e.bMT(53,52,"text.language")))," "),e.R7$(7),e.Y8G("ngIf",m.roles),e.R7$(),e.Y8G("ngIf",m.isControlInvalid("visibleForCollaborators")),e.R7$(21),e.vxM(!0===(null==m.user?null:m.user.inactive)?81:82))},dependencies:[l.YU,l.bT,g.qT,g.xH,g.y7,g.me,g.wz,g.BC,g.cb,g.j4,g.JD,k.eY,k.hB,de.Z,a.F,f.D9]}),P})();var Pe=i(8129),re=i(904),Te=i(8359),Ee=i(1413),De=i(152),s=i(5558);let b=(()=>{var u;class P{constructor(c){this.api=c,this.searchTermSubject=new Ee.B,this.allAgencies=[],this.searchResults$=this.searchTermSubject.pipe((0,De.B)(300),(0,s.n)(m=>this.performSearch(m)))}search(c){this.searchTermSubject.next(c)}performSearch(c){var m=this;return(0,q.A)(function*(){let S=[];if(c.includes("@")){const R=c.split("@")[1];let H;H=["gmail.com","yahoo.com","hotmail.com","outlook.com","icloud.com","aol.com","msn.com","live.com","mail.com","protonmail.com","zoho.com","gmx.com","yandex.com","ymail.com","rocketmail.com","fastmail.com","tutanota.com","hushmail.com","inbox.com","me.com","mac.com","live.co.uk","hotmail.co.uk","yahoo.co.uk","hotmail.fr","yahoo.fr","hotmail.de","yahoo.de","hotmail.it","yahoo.it","hotmail.es","yahoo.es","hotmail.uz","yahoo.uz","hotmail.mn"].includes(R)?yield m.api.getAgency({email:{equals:c}},null,{page:0,itemsPerPage:50}):yield m.api.getAgency({email:{contains:"@"+R}},null,{page:0,itemsPerPage:50}),S=H.success.data}return S})()}}return(u=P).\u0275fac=function(c){return new(c||u)(e.KVO(se.i))},u.\u0275prov=e.jDH({token:u,factory:u.\u0275fac,providedIn:"root"}),P})();function r(u,P){if(1&u&&e.nrm(0,"img",11),2&u){const C=e.XpG().$implicit;e.Y8G("src",C.photoUrl,e.B4B)}}function n(u,P){1&u&&e.nrm(0,"img",12)}function o(u,P){if(1&u&&(e.j41(0,"span",18),e.EFF(1),e.k0s()),2&u){const C=e.XpG().$implicit;e.R7$(),e.E5c(" ",C.city,",",C.province," / ",C.country,"")}}function d(u,P){if(1&u){const C=e.RV6();e.j41(0,"div",8),e.bIt("click",function(m){const S=e.eBV(C).$implicit,R=e.XpG(2);return e.Njj(R.selectAgency(S,m))}),e.j41(1,"div",9)(2,"div",10),e.DNE(3,r,1,1,"img",11)(4,n,1,0,"img",12),e.k0s(),e.j41(5,"div",13)(6,"div",14)(7,"div",15)(8,"span"),e.EFF(9),e.k0s(),e.j41(10,"div",16),e.nrm(11,"img",17),e.k0s(),e.DNE(12,o,2,3,"span",18),e.k0s()(),e.j41(13,"div",19)(14,"span",20),e.EFF(15),e.k0s()()()(),e.nrm(16,"div",21),e.k0s()}if(2&u){const C=P.$implicit;e.R7$(3),e.vxM(C.photoUrl?3:4),e.R7$(6),e.JRh(null==C?null:C.name),e.R7$(3),e.vxM(C.city&&C.province&&C.country?12:-1),e.R7$(3),e.SpI(" ",null==C?null:C.email,"")}}function p(u,P){1&u&&(e.j41(0,"div",22),e.EFF(1," No hay resultados en Byvaro "),e.k0s())}function y(u,P){if(1&u){const C=e.RV6();e.j41(0,"div",8),e.bIt("click",function(m){e.eBV(C);const S=e.XpG(2);return e.Njj(S.selectAgency(null,m))}),e.j41(1,"div",9)(2,"div",10),e.nrm(3,"img",12),e.k0s(),e.j41(4,"div",13)(5,"div",14),e.EFF(6),e.k0s(),e.j41(7,"div",19),e.EFF(8," Esta agencia no est\xe1 registrada en Byvaro, haz clic para invitarla. "),e.k0s()()(),e.nrm(9,"div",21),e.k0s()}if(2&u){const C=e.XpG(2);e.R7$(6),e.SpI(" ",C.searchTerm," ")}}function A(u,P){if(1&u&&(e.j41(0,"div",5),e.Z7z(1,d,17,4,"div",6,e.fX1),e.DNE(3,p,2,0,"div",7)(4,y,10,1,"div",6),e.k0s()),2&u){const C=e.XpG();e.R7$(),e.Dyx(C.searchResults),e.R7$(2),e.Y8G("ngIf",0===C.searchResults.length&&!C.validEmail),e.R7$(),e.vxM(0===C.searchResults.length&&C.validEmail?4:-1)}}let F=(()=>{var u;class P{constructor(c,m){this.renderer=c,this.searchbarService=m,this.selectedAgency=new e.bkB,this.textUpdated=new e.bkB,this.searchTerm="",this.dropdownOpen=!1,this.searchResults=[],this.validEmail=!1,this.globalClickUnlistener=null,this.searchSubscription=new Te.yU}ngOnInit(){this.searchSubscription=this.searchbarService.searchResults$.subscribe(c=>{this.searchResults=c,console.log(54353543,this.searchResults),this.searchResults.length||this.selectedAgency.emit(null)})}onInputClick(c){c.stopPropagation(),this.dropdownOpen||this.openDropdown()}onSearchTermChange(c){this.searchTerm=c,this.searchbarService.search(c),this.checkEmail(),this.textUpdated.emit(c)}checkEmail(){this.validEmail=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.searchTerm)}selectAgency(c,m){c||(c={name:this.searchTerm,email:"Esta agencia no est\xe1 registrada en Byvaro, se enviar\xe1 una invitaci\xf3n por e-mail."}),m.stopPropagation(),this.selectedAgency.emit({name:c.name,email:c.email,id:c.id,city:c.city,province:c.province,country:c.country,photoUrl:c.photoUrl}),this.closeDropdown()}openDropdown(){this.dropdownOpen=!0,this.attachDocumentClickListener()}closeDropdown(){this.dropdownOpen=!1,this.detachDocumentClickListener()}attachDocumentClickListener(){this.globalClickUnlistener=this.renderer.listen("document","click",c=>{c.target.closest(".agents-searchbar-container")||this.closeDropdown()})}detachDocumentClickListener(){this.globalClickUnlistener&&(this.globalClickUnlistener(),this.globalClickUnlistener=null)}ngOnDestroy(){this.detachDocumentClickListener(),this.searchSubscription.unsubscribe()}}return(u=P).\u0275fac=function(c){return new(c||u)(e.rXU(e.sFG),e.rXU(b))},u.\u0275cmp=e.VBU({type:u,selectors:[["app-agencies-searchbar"]],outputs:{selectedAgency:"selectedAgency",textUpdated:"textUpdated"},decls:5,vars:2,consts:[[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar","crm-input-input-searchbar-square","agents-searchbar-container","secondary-border-1",3,"click"],[1,"fas","fa-search"],["type","text","placeholder","Email de la agencia",3,"ngModelChange","ngModel"],["class","dropdown-options",4,"ngIf"],[1,"dropdown-options"],[1,"crm-item-searchbar-agent-result"],["class","no-results",4,"ngIf"],[1,"crm-item-searchbar-agent-result",3,"click"],[1,"crm-item-searchbar-agent-result-left"],[1,"crm-item-searchbar-agent-result-left-image"],["alt","",3,"src"],["src","assets/images/building.png","alt",""],[1,"crm-item-searchbar-agent-result-left-info"],[1,"crm-item-searchbar-agent-result-left-info-name"],[1,"d-flex","align-center"],[1,"mx-10"],["src","assets/icon/blue-star-icon.svg","alt",""],[1,"text-16","text-secondary"],[1,"crm-item-searchbar-agent-result-left-info-email"],[1,"text-secondary"],[1,"crm-item-searchbar-agent-result-right"],[1,"no-results"]],template:function(c,m){1&c&&(e.j41(0,"div",0)(1,"div",1),e.bIt("click",function(R){return m.onInputClick(R)}),e.nrm(2,"i",2),e.j41(3,"input",3),e.mxI("ngModelChange",function(R){return e.DH7(m.searchTerm,R)||(m.searchTerm=R),R}),e.bIt("ngModelChange",function(R){return m.onSearchTermChange(R)}),e.k0s(),e.DNE(4,A,5,2,"div",4),e.k0s()()),2&c&&(e.R7$(3),e.R50("ngModel",m.searchTerm),e.R7$(),e.Y8G("ngIf",m.dropdownOpen))},dependencies:[l.bT,g.me,g.BC,g.vS],styles:[".agents-searchbar-container[_ngcontent-%COMP%]{position:relative;cursor:pointer}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;z-index:9999;background-color:#fff;padding:8px 0;border-radius:0 0 8px 8px;border:1px solid var(--crm-border-light-color);max-height:200px;overflow-y:auto;font-size:14px}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.no-results[_ngcontent-%COMP%]{padding:8px;color:#888}"]}),P})();var J=i(4821),h=i(4426),T=i(4558);let G=(()=>{var u;class P{}return(u=P).\u0275fac=function(c){return new(c||u)},u.\u0275mod=e.$C({type:u}),u.\u0275inj=e.G2t({imports:[l.MD,g.YN,g.X1,k.bv,v.S,M,f.h,D.T,L,U.O,O.S,X.Y,w.b,V,N.K,E.T,x.k,j.u,a.F,W.x,ne.K,ie.G,I.Y]}),P})();e.wjB(t.K,[l.bT,Me,Pe.K],[f.D9]),e.wjB(_.v,[l.bT,re.X,F],[]),e.wjB(Y.r,[re.X,J.e,h.O],[f.D9,T.w]),e.wjB(K.f,[W.x],[])},8433:($,B,i)=>{i.d(B,{x:()=>w});var l=i(467),t=i(177),g=i(9417),k=i(9465),_=i(3895),v=i(5603),e=i(3953),M=i(5970),f=i(6039),D=i(1296),j=i(4501),Q=i(8397),a=i(345),L=i(5952),U=i(5188),X=i(6580),O=i(1880);const Y=(I,V,N,E,x)=>({pageStartIndex:I,pageEndIndex:V,totalCount:N,paginationPage:E,sortField:x});let w=(()=>{var I;class V{constructor(E,x,K,W,ne,ie,q,le,ae){this.popoversService=E,this.api=x,this.tableService=K,this.headerService=W,this.toastService=ne,this.sanitizer=ie,this.modalsService=q,this.router=le,this.activatedRoute=ae,this.documents=[],this.allSystemOperationsCount=0,this.filters=null,this.sort={field:"createdAt",order:"desc"},this.pagination={page:0,itemsPerPage:50},this.agencyId=null,this.promotionId=null,this.documentsTableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"createdAt",label:"A\xf1adido en",size:"medium",type:"date"},{key:"title",label:"T\xedtulo",size:"large",type:"text"},{key:"fileName",label:"Nombre del archivo",size:"large",type:"text"},{key:"documentType",label:"Tipo de documento",size:"medium",type:"text"}],rows:[]}}ngOnInit(){this.getData()}ionViewWillEnter(){var E=this;return(0,l.A)(function*(){E.getData()})()}getData(){var E=this;return(0,l.A)(function*(){var x;let K;if(K="operation"===E.options.father?yield E.api.getOperationDocuments(E.options.operationId):yield E.api.getContactOperationDocuments({contactId:E.options.contactId}),E.documents=null===(x=K)||void 0===x||null===(x=x.success)||void 0===x?void 0:x.data,E.documents){let W=E.tableService.convertDataToTableRows(E.documents,E.documentsTableConfig);E.documentsTableConfig.rows=W}})()}openCreateDocumentModal(){var E=this;return(0,l.A)(function*(){yield E.modalsService.onShowCreateOperationDocumentModal(E.options.operationId),E.getData()})()}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemOperationsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemOperationsCount)}}onSort(E){}onRowClicked(E){return(0,l.A)(function*(){})()}onTableButtonClick(E){return(0,l.A)(function*(){})()}}return(I=V).\u0275fac=function(E){return new(E||I)(e.rXU(M.m),e.rXU(f.i),e.rXU(D.a),e.rXU(j.d),e.rXU(Q.f),e.rXU(a.up),e.rXU(L.M),e.rXU(U.Ix),e.rXU(U.nX))},I.\u0275cmp=e.VBU({type:I,selectors:[["app-operation-documents"]],inputs:{options:"options"},standalone:!0,features:[e.aNF],decls:15,vars:8,consts:[[1,"crm-block-content"],[1,"crm-block-body",2,"padding","20px"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar documento"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[1,"fa","fa-plus"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[1,"crm-section"],[3,"actionButtonClick","rowClicked","table"]],template:function(E,x){1&E&&(e.j41(0,"div")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),e.nrm(6,"i",5)(7,"input",6),e.k0s()(),e.j41(8,"div",7)(9,"button",8),e.bIt("click",function(){return x.openCreateDocumentModal()}),e.nrm(10,"i",9),e.EFF(11," A\xf1adir Documento "),e.k0s()()(),e.j41(12,"app-list-pagination-selectors",10),e.bIt("goPreviousPage",function(){return x.onGoPreviousPage()})("goNextPage",function(){return x.onGoNextPage()})("sort",function(W){return x.onSort(W)}),e.k0s(),e.j41(13,"div",11)(14,"app-table",12),e.bIt("actionButtonClick",function(W){return x.onTableButtonClick(W)})("rowClicked",function(W){return x.onRowClicked(W)}),e.k0s()()()()()),2&E&&(e.R7$(12),e.Y8G("listPaginationConfig",e.s1E(2,Y,x.updatePagination().startIndex,x.updatePagination().endIndex,x.allSystemOperationsCount,x.pagination.page+1,null!=x.sort&&x.sort.field?(null==x.sort?null:x.sort.field)+" "+(null==x.sort?null:x.sort.order):"Fecha de creaci\xf3n")),e.R7$(2),e.Y8G("table",x.documentsTableConfig))},dependencies:[t.MD,k.bv,g.YN,g.X1,v.P,X.k,_.b,O.O]}),V})()},7754:($,B,i)=>{i.d(B,{X:()=>_});var l=i(177),t=i(9417),g=i(9465),k=i(3953);let _=(()=>{var v;class e{}return(v=e).\u0275fac=function(f){return new(f||v)},v.\u0275mod=k.$C({type:v}),v.\u0275inj=k.G2t({imports:[l.MD,t.YN,g.bv]}),e})()},7774:($,B,i)=>{i.d(B,{G:()=>v});var l=i(177),t=i(9417),g=i(3895),k=i(9465),_=i(3953);let v=(()=>{var e;class M{}return(e=M).\u0275fac=function(D){return new(D||e)},e.\u0275mod=_.$C({type:e}),e.\u0275inj=_.G2t({imports:[l.MD,t.YN,g.b,k.bv,l.MD,t.YN]}),M})()},4426:($,B,i)=>{i.d(B,{O:()=>De});var l=i(467),t=i(3953),g=i(5824),k=i(7376),_=i(9465),v=i(600),e=i(177),M=i(9417),f=i(1748),D=i(4476);function j(s,b){if(1&s&&(t.j41(0,"div",12),t.nrm(1,"app-general-toast",13),t.k0s()),2&s){const r=t.XpG();t.R7$(),t.Y8G("options",r.toastConfig)}}function Q(s,b){if(1&s){const r=t.RV6();t.j41(0,"ion-checkbox",15),t.bIt("ngModelChange",function(){t.eBV(r);const o=t.XpG().$implicit,d=t.XpG();return t.Njj(d.onCheckboxChange(o))}),t.mxI("ngModelChange",function(o){t.eBV(r);const d=t.XpG().$implicit;return t.DH7(d.selected,o)||(d.selected=o),t.Njj(o)}),t.k0s(),t.j41(1,"div",16),t.EFF(2),t.k0s()}if(2&s){const r=t.XpG().$implicit,n=t.XpG();t.Y8G("id",r.label)("disabled",!r.selected&&n.selectionLimitReached),t.R50("ngModel",r.selected),t.R7$(),t.Y8G("id",r.label),t.R7$(),t.JRh(r.label)}}function a(s,b){if(1&s&&(t.j41(0,"div",14),t.DNE(1,Q,3,5),t.k0s()),2&s){const r=b.$implicit;t.R7$(),t.vxM(r.hidden?-1:1)}}let L=(()=>{var s;class b{constructor(n,o){this.modalCtrl=n,this.navParams=o,this.promotion=null,this.warning=!1,this.MAX_SELECTION=50,this.allColumns=[],this.selectedKeys=[],this.toastConfig={text:"Has alcanzado el l\xedmite de columnas seleccionadas. No puedes a\xf1adir m\xe1s.\n",theme:"orange",fullWidth:!0,showCloseButton:!1,smaller:!0},this.localColumns=[]}ngOnInit(){this.promotion=this.navParams.get("promotion")||null,this.allColumns=this.navParams.get("columns")||[],this.selectedKeys=this.navParams.get("selectedColumnKeys")||[],this.localColumns=this.allColumns.map(n=>({key:n.key,label:n.label,hidden:n.hideSelectColumnsList,selected:this.selectedKeys.includes(n.key)})),this.checkSelectionCount()}checkSelectionCount(){const n=this.localColumns.filter(o=>o.selected).length;this.warning=n>11}onCheckboxChange(n){n.selected&&this.selectedCount>this.MAX_SELECTION&&(n.selected=!1)}get selectedCount(){return this.localColumns.filter(n=>n.selected).length}get selectionLimitReached(){return this.selectedCount>=this.MAX_SELECTION}onCancel(){this.modalCtrl.dismiss(null,"cancel")}onSave(){const n=this.localColumns.filter(o=>o.selected).map(o=>o.key);console.log(n,"updatedSelectedKeys"),this.modalCtrl.dismiss(n,"save")}}return(s=b).\u0275fac=function(n){return new(n||s)(t.rXU(_.W3),t.rXU(v.y8))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-select-table-columns-modal"]],decls:15,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-times"],[1,"crm-button","crm-button-success",3,"click"],[1,"fa-solid","fa-check"],["class","crm-warning-message p-15","style","",4,"ngIf"],[1,"modal-body"],[1,"modal-body-content"],[1,"crm-section-inputs"],["class","crm-input-checkbox","appToggleCheckbox","","style","margin-bottom: 12px;",4,"ngFor","ngForOf"],[1,"crm-warning-message","p-15"],[3,"options"],["appToggleCheckbox","",1,"crm-input-checkbox",2,"margin-bottom","12px"],[3,"ngModelChange","id","disabled","ngModel"],[1,"crm-input-checkbox-label",3,"id"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," Seleccionar columnas "),t.k0s(),t.j41(3,"div",2)(4,"button",3),t.bIt("click",function(){return o.onCancel()}),t.nrm(5,"i",4),t.EFF(6," Cerrar "),t.k0s(),t.j41(7,"button",5),t.bIt("click",function(){return o.onSave()}),t.nrm(8,"i",6),t.EFF(9," Guardar "),t.k0s()()(),t.DNE(10,j,2,1,"div",7),t.j41(11,"div",8)(12,"div",9)(13,"div",10),t.DNE(14,a,2,1,"div",11),t.k0s()()()),2&n&&(t.R7$(10),t.Y8G("ngIf",o.selectionLimitReached),t.R7$(4),t.Y8G("ngForOf",o.localColumns))},dependencies:[e.Sq,e.bT,M.BC,M.vS,_.eY,_.hB,f.z,D.l],styles:[".modal-body[_ngcontent-%COMP%]{overflow-y:auto}"]}),b})();function U(s,b){if(1&s&&t.nrm(0,"img",0),2&s){const r=t.XpG();t.Y8G("src",r.icon,t.B4B)}}let X=(()=>{var s;class b{constructor(){this.className=""}ngOnInit(){}}return(s=b).\u0275fac=function(n){return new(n||s)},s.\u0275cmp=t.VBU({type:s,selectors:[["app-badge"]],inputs:{text:"text",icon:"icon",className:"className"},standalone:!0,features:[t.aNF],decls:3,vars:5,consts:[["alt","",1,"badge__icon",3,"src"]],template:function(n,o){1&n&&(t.j41(0,"div"),t.DNE(1,U,1,1,"img",0),t.EFF(2),t.k0s()),2&n&&(t.ZvI("badge ",o.className,""),t.R7$(),t.vxM(o.icon?1:-1),t.R7$(),t.SpI(" ",o.text,"\n"))}}),b})();function O(s,b){if(1&s&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&s){const r=t.XpG();t.R7$(),t.JRh(r.price)}}function Y(s,b){if(1&s&&t.nrm(0,"app-badge",1),2&s){const r=t.XpG();t.Mz_("className","badge--",null==r.statusMap[r.status]?null:r.statusMap[r.status].key,""),t.FS9("text",null==r.statusMap[r.status]?null:r.statusMap[r.status].text),t.FS9("icon",null==r.statusMap[r.status]?null:r.statusMap[r.status].icon)}}function w(s,b){if(1&s&&t.EFF(0),2&s){const r=t.XpG();t.SpI(" ",r.status," ")}}let I=(()=>{var s;class b{constructor(n,o){this.price=n,this.status=o,this.statusMap={blocked:{key:"blocked",text:"Blocked",icon:"assets/icon/lock-icon.svg"},reserved:{key:"reserved",text:"Reserved",icon:"assets/icon/loading-icon-warn.svg"},sold:{key:"sold",text:"Sold",icon:""},retired:{key:"retired",text:"Retired",icon:"assets/icon/toggle-icon-left.svg"}}}ngOnInit(){}}return(s=b).\u0275fac=function(n){return new(n||s)(t.rXU("price"),t.rXU("status"))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-price-status-cell"]],standalone:!0,features:[t.aNF],decls:3,vars:1,consts:[[1,"col-medium","text-left"],[3,"className","text","icon"]],template:function(n,o){1&n&&t.DNE(0,O,2,1,"div",0)(1,Y,1,4,"app-badge",1)(2,w,1,1),2&n&&t.vxM("available"===o.status?0:null!=o.statusMap[o.status]&&o.statusMap[o.status].key?1:2)},dependencies:[X]}),b})(),V=(()=>{var s;class b{constructor(n){this.status=n}ngOnInit(){this.status="available"===this.status?"success":this.status}}return(s=b).\u0275fac=function(n){return new(n||s)(t.rXU("status"))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-table-cell-actions"]],decls:3,vars:4,consts:[[1,"d-flex","justify-end","col-small","align-center"],[2,"padding","10px 5px"],["alt","",3,"src"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"img",2),t.k0s()()),2&n&&(t.R7$(),t.ZvI("table-row-background-",o.status," rowMenu-icon-wrapper"),t.R7$(),t.Y8G("src","assets/icon/more-vertical-icon.svg",t.B4B))}}),b})(),N=(()=>{var s;class b{constructor(n){this.onClick=n}ngOnInit(){}}return(s=b).\u0275fac=function(n){return new(n||s)(t.rXU("onClick"))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-table-header-cell-actions"]],decls:3,vars:1,consts:[[1,"d-flex","justify-end","col-small","align-center","pr-13",3,"click"],[1,"rowMenu-icon-wrapper",2,"padding","10px 5px","background","white"],["alt","",1,"cursor-pointer",3,"src"]],template:function(n,o){1&n&&(t.j41(0,"div",0),t.bIt("click",function(){return null==o.onClick?null:o.onClick()}),t.j41(1,"div",1),t.nrm(2,"img",2),t.k0s()()),2&n&&(t.R7$(2),t.Y8G("src","assets/icon/switch-horizontal-icon.svg",t.B4B))}}),b})();var E=i(1296),x=i(6039),K=i(1213),W=i(8397),ne=i(5952),ie=i(6552),q=i(8031),le=i(1880);const ae=["tableComponent"],se=(s,b)=>({"border-bottom-unset":s,"border-radius-16":b});function ce(s,b){if(1&s&&(t.j41(0,"div",4),t.nrm(1,"app-general-toast",10),t.k0s()),2&s){const r=t.XpG(2);t.R7$(),t.Y8G("options",r.toastConfig)}}function de(s,b){if(1&s&&t.DNE(0,ce,2,1,"div",9),2&s){const r=t.XpG();t.Y8G("ngIf",!(null!=r.promotion&&r.promotion.promotionPaymentInfoIsCompleted))}}function ue(s,b){if(1&s){const r=t.RV6();t.qex(0),t.j41(1,"div",16)(2,"div",17)(3,"input",18),t.mxI("ngModelChange",function(o){t.eBV(r);const d=t.XpG(2);return t.DH7(d.editedBlockName,o)||(d.editedBlockName=o),t.Njj(o)}),t.k0s()(),t.j41(4,"div",19)(5,"div",20)(6,"i",21),t.bIt("click",function(){t.eBV(r);const o=t.XpG(),d=o.$implicit,p=o.$index,y=t.XpG();return t.Njj(y.onSaveBlockTitle(d,p))}),t.k0s(),t.j41(7,"i",22),t.bIt("click",function(){t.eBV(r);const o=t.XpG(2);return t.Njj(o.onCancelBlockTitle())}),t.k0s()()()(),t.bVm()}if(2&s){const r=t.XpG(2);t.R7$(3),t.R50("ngModel",r.editedBlockName)}}function te(s,b){if(1&s){const r=t.RV6();t.j41(0,"img",24),t.bIt("click",function(){t.eBV(r);const o=t.XpG(2),d=o.$implicit,p=o.$index,y=t.XpG();return t.Njj(y.onEditBlockTitle(d,p))}),t.k0s()}2&s&&t.Y8G("src","assets/icon/edit-icon.svg",t.B4B)}function oe(s,b){if(1&s&&(t.EFF(0),t.DNE(1,te,1,1,"img",23)),2&s){const r=t.XpG().$implicit,n=t.XpG();t.SpI(" ",r.name||"Bloque "+r.index," "),t.R7$(),t.vxM("page"===n.context?1:-1)}}function pe(s,b){if(1&s){const r=t.RV6();t.qex(0),t.j41(1,"button",31),t.bIt("click",function(){t.eBV(r);const o=t.XpG(4).$index,d=t.XpG();return t.Njj(d.onSaveTable(o))}),t.nrm(2,"i",32),t.EFF(3," Guardar "),t.k0s(),t.bVm()}}function me(s,b){if(1&s){const r=t.RV6();t.j41(0,"button",31),t.bIt("click",function(){t.eBV(r);const o=t.XpG(5).$index,d=t.XpG();return t.Njj(d.onEditTable(o))}),t.nrm(1,"i",34),t.EFF(2," Edici\xf3n masiva "),t.k0s()}}function _e(s,b){if(1&s&&t.DNE(0,me,3,0,"button",33),2&s){const r=t.XpG(5);t.Y8G("ngIf","promoter"===(null==r.currentUser?null:r.currentUser.accountType))}}function ve(s,b){if(1&s&&t.DNE(0,pe,4,0,"ng-container",13)(1,_e,1,1,"ng-template",null,1,t.C5r),2&s){const r=t.sdS(2),n=t.XpG(3).$index,o=t.XpG();t.Y8G("ngIf",o.editingTableBlockIndex===n)("ngIfElse",r)}}function fe(s,b){if(1&s){const r=t.RV6();t.j41(0,"button",31),t.bIt("click",function(o){t.eBV(r);const d=t.XpG(4);return t.Njj(d.onDuplicateProperty(o))}),t.nrm(1,"i",35),t.EFF(2," Duplicar propiedad "),t.k0s()}}function ge(s,b){if(1&s){const r=t.RV6();t.j41(0,"button",36),t.bIt("click",function(){t.eBV(r);const o=t.XpG(3).$implicit,d=t.XpG();return t.Njj(d.onAddProperty(o))}),t.nrm(1,"i",37),t.EFF(2," A\xf1adir propiedad "),t.k0s()}if(2&s){const r=t.XpG(4);t.Y8G("disabled",!(null!=r.promotion&&r.promotion.promotionPaymentInfoIsCompleted))}}function Ce(s,b){if(1&s){const r=t.RV6();t.DNE(0,ve,3,2)(1,fe,3,0,"button",28)(2,ge,3,1,"button",29),t.j41(3,"div",26)(4,"img",30),t.bIt("click",function(){t.eBV(r);const o=t.XpG(2).$implicit,d=t.XpG();return t.Njj(d.onDeleteBlock(o))}),t.k0s()()}if(2&s){const r=t.XpG(2),n=r.$implicit,o=r.$index,d=t.XpG();t.vxM(null!=n&&null!=n.tableConfig&&null!=n.tableConfig.rows&&n.tableConfig.rows.length?0:-1),t.R7$(),t.vxM(d.showDuplicateButtonBlockIndex.includes(o)&&-1===d.editingTableBlockIndex?1:-1),t.R7$(),t.vxM(d.editingTableBlockIndex!==o?2:-1),t.R7$(2),t.Y8G("src","assets/icon/trash-icon.svg",t.B4B)}}function he(s,b){if(1&s){const r=t.RV6();t.j41(0,"img",39),t.bIt("click",function(){t.eBV(r);const o=t.XpG(3).$index,d=t.XpG();return t.Njj(d.onToggleBlock(o))}),t.k0s()}2&s&&t.Y8G("src","assets/icon/chevron-up-icon.svg",t.B4B)}function be(s,b){if(1&s){const r=t.RV6();t.j41(0,"img",39),t.bIt("click",function(){t.eBV(r);const o=t.XpG(3).$index,d=t.XpG();return t.Njj(d.onToggleBlock(o))}),t.k0s()}2&s&&t.Y8G("src","assets/icon/chevron-down-icon.svg",t.B4B)}function ye(s,b){if(1&s&&(t.j41(0,"div",27),t.DNE(1,he,1,1,"img",38)(2,be,1,1,"img",38),t.k0s()),2&s){const r=t.XpG(2).$implicit;t.R7$(),t.vxM(r.isOpen?1:2)}}function ke(s,b){if(1&s&&(t.j41(0,"div",25),t.DNE(1,Ce,5,4,"div",26)(2,ye,3,1,"div",27),t.k0s()),2&s){const r=t.XpG().$implicit,n=t.XpG();t.R7$(),t.vxM("page"===n.context?1:-1),t.R7$(),t.vxM(null!=r&&null!=r.tableConfig&&null!=r.tableConfig.rows&&r.tableConfig.rows.length?2:-1)}}function Me(s,b){if(1&s){const r=t.RV6();t.j41(0,"app-table",40,2),t.bIt("columnClick",function(o){t.eBV(r);const d=t.XpG().$implicit,p=t.XpG();return t.Njj(p.onColumnClicked(o,d))})("rowClicked",function(o){t.eBV(r);const d=t.XpG(2);return t.Njj(d.onRowClicked(o))})("clickGlobalCheckbox",function(o){t.eBV(r);const d=t.XpG(2);return t.Njj(d.onClickGlobalCheckbox(o))})("rowCheckboxClicked",function(o){t.eBV(r);const d=t.XpG().$index,p=t.XpG();return t.Njj(p.onRowChecked(o,d))}),t.k0s()}if(2&s){const r=t.XpG().$implicit;t.Y8G("table",null==r?null:r.tableConfig)}}function Pe(s,b){if(1&s&&(t.j41(0,"div",6)(1,"div",11)(2,"div",12),t.DNE(3,ue,8,1,"ng-container",13)(4,oe,2,2,"ng-template",null,0,t.C5r),t.k0s(),t.DNE(6,ke,3,2,"div",14),t.k0s(),t.DNE(7,Me,2,1,"app-table",15),t.k0s()),2&s){const r=b.$implicit,n=b.$index,o=t.sdS(5),d=t.XpG();t.R7$(),t.Y8G("ngClass",t.l_i(5,se,r.isOpen,!r.isOpen)),t.R7$(2),t.Y8G("ngIf",d.editingBlockTitleIndex===n)("ngIfElse",o),t.R7$(3),t.Y8G("ngIf","promoter"===(null==d.currentUser?null:d.currentUser.accountType)),t.R7$(),t.vxM(r.isOpen?7:-1)}}function re(s,b){1&s&&(t.j41(0,"div",7)(1,"div",41),t.EFF(2," A\xfan no hay bloques "),t.k0s()())}function Te(s,b){if(1&s){const r=t.RV6();t.j41(0,"button",43),t.bIt("click",function(){t.eBV(r);const o=t.XpG(2);return t.Njj(o.onAddBlock())}),t.nrm(1,"i",37),t.EFF(2," A\xf1adir bloque "),t.k0s()}}function Ee(s,b){if(1&s&&(t.j41(0,"div",8),t.DNE(1,Te,3,0,"button",42),t.k0s()),2&s){const r=t.XpG();t.R7$(),t.Y8G("ngIf","promoter"===(null==r.currentUser?null:r.currentUser.accountType))}}let De=(()=>{var s;class b{constructor(n,o,d,p,y,A,F,J){this.modalCtrl=n,this.tableService=o,this.api=d,this.state=p,this.toastService=y,this.modalsService=A,this.utils=F,this.promotionService=J,this.context="page",this.reloadPromotion=new t.bkB,this.sortBlock=new t.bkB,this.rowCheckboxClicked=new t.bkB,this.clickGlobalCheckbox=new t.bkB,this.hashMap=[],this.loadingBlocks=!1,this.blocks=[],this.toastConfig={text:"Por favor, rellena todos los campos obligatorios de la promoci\xf3n",theme:"orange",fullWidth:!0,showCloseButton:!1,smaller:!0},this.allColumnsKeysSelected=["externalReference","reference","promotionType","floor","bedrooms","bathrooms","totalMeasures_squareMetersBuilt","totalMeasures_squareMetersUseful","totalMeasures_squareMetersCoveredTerraces","totalMeasures_squareMetersUncoveredTerraces","f_pool_comunitaria","planos","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!0,editCellsMode:!1,columns:[{key:"reference",label:"Id",size:"small",customCssClass:"sticky-second-column bg-white",editMode:{inputType:"text"}},{key:"byvaroId",label:"Ref",size:"medium",editMode:{inputType:"text"}},{key:"promotionType",label:"Subtipo",size:"medium",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"villa",value:"Villa",selected:!1},{key:"chalet",value:"Chalet",selected:!1},{key:"country_house",value:"Finca",selected:!1},{key:"semi_detached",value:"Adosado",selected:!1},{key:"twin_house",value:"Pareado",selected:!1},{key:"bungalow",value:"Bungalow",selected:!1},{key:"flat",value:"Piso / Apartamento",selected:!1},{key:"studio",value:"Estudio",selected:!1},{key:"basement",value:"Bajo",selected:!1},{key:"loft",value:"Loft",selected:!1},{key:"mezzanine",value:"Entresuelo",selected:!1},{key:"duplex",value:"D\xfaplex",selected:!1},{key:"triplex",value:"Triplex",selected:!1},{key:"penthouse",value:"\xc1tico",selected:!1},{key:"penthouse_duplex",value:"\xc1tico d\xfaplex",selected:!1},{key:"commercial_space",value:"Local comercial",selected:!1}]}},{key:"floor",label:"Planta",size:"small",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersBuilt",label:"M2 constr.",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersUseful",label:"M2 \xfatiles",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"m2constr",label:"M2 constr. (sin incluir terrazas)",size:"small",extraString:" m\xb2",editMode:{inputType:"number"},fn:h=>{let P=(h.totalMeasures_squareMetersBuilt||0)-((h.totalMeasures_squareMetersCoveredTerraces||0)+(h.totalMeasures_squareMetersUncoveredTerraces||0));return P<0&&(P=0),P}},{key:"totalMeasures_squareMetersTerraces",label:"M2 Terrazas",size:"small",showOnlyViewMode:!0,extraString:" m\xb2",fn:h=>h.totalMeasures_squareMetersCoveredTerraces+h.totalMeasures_squareMetersUncoveredTerraces},{key:"totalMeasures_squareMetersPatch",label:"Parcela",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersCoveredTerraces",label:"terraza cubierta",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersUncoveredTerraces",label:"terraza descubierta",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"bedrooms",label:"Dorm.",size:"small",editMode:{inputType:"number"}},{key:"bathrooms",label:"Ba\xf1os",size:"small",editMode:{inputType:"number"}},{key:"f_pool_comunitaria",label:"Piscina",size:"medium",fn:h=>h.f_pool_comunitaria?"comunitaria":h.f_pool_privada?"privada":"No",editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"comunitaria",value:"Comunitaria",selected:!1},{key:"privada",value:"Privada",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_trastero",label:"Trastero",size:"medium",fn:h=>h.fcustom_trastero?h.fcustom_trasteroPrice?this.utils.transformThousandSeparator(h.fcustom_trasteroPrice)+" \u20ac":h.fcustom_trasteroIncludedInPrice?"Incluido":"S\xed":"No",editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"S\xed",value:"S\xed",selected:!1},{key:"Incluido",value:"Incluido",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_parking",label:"Parking",size:"medium",fn:h=>{let T="";return T=h.fcustom_parking?"S\xed":"No",h.fcustom_parkingPrice&&(T=this.utils.transformThousandSeparator(h.fcustom_parkingPrice)+" \u20ac"),h.fcustom_parkingIncludedInPrice&&(T="Incluido"),null!=h&&h.fcustom_parkingComunitario&&(T+=" (Comunitario)"),T},editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"S\xed",value:"S\xed",selected:!1},{key:"Incluido",value:"Incluido",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"solarium",label:"Solarium",size:"small",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"yes",value:"S\xed",selected:!1},{key:"no",value:"No",selected:!1}]},fn:h=>h.fcustom_solarium?"S\xed":"No"},{key:"availabilityStatus",label:"Estado",size:"medium",translate:!0,showOnlyEditMode:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"available",value:"Disponible",selected:!1},{key:"sold",value:"Vendido",selected:!1},{key:"reserved",value:"Reservado",selected:!1},{key:"blocked",value:"Bloqueado",selected:!1},{key:"retired",value:"Retirado",selected:!1}]}},{key:"deliveryDate",label:"Fecha de Entrega",size:"medium",editMode:{inputType:"date"},fn:h=>null!=h&&h.deliveryDate?new Date(null==h?void 0:h.deliveryDate).toLocaleDateString("es-ES"):null},{key:"status",label:"Estado de obra",size:"medium",type:"text",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"proyecto-sin-licencia",value:"Proyecto sin licencia",selected:!1},{key:"proyecto-con-licencia",value:"Proyecto con licencia",selected:!1},{key:"fase-excavacion",value:"En fase de excavaci\xf3n",selected:!1},{key:"cimentacion-completada",value:"Cimentaci\xf3n completada",selected:!1},{key:"estructura-construccion",value:"Estructura en construcci\xf3n",selected:!1},{key:"cerramiento-completado",value:"Cerramiento completado",selected:!1},{key:"instalaciones-proceso",value:"Instalaciones en proceso",selected:!1},{key:"acabados-interiores",value:"Acabados interiores",selected:!1},{key:"obra-finalizada",value:"Obra finalizada",selected:!1}]}},{key:"catalog",label:"Cat\xe1logo",size:"small",type:"file",fn:h=>{var T;return null==h||null===(T=h.propertyFiles)||void 0===T||null===(T=T.find(G=>"catalog"===G.category))||void 0===T?void 0:T.url}},{key:"planos",label:"Plano",size:"small",type:"file",fn:h=>{var T;return null==h||null===(T=h.propertyFiles)||void 0===T||null===(T=T.find(G=>"plan"===G.category))||void 0===T?void 0:T.url}},{key:"price",label:"Precio",size:"medium",fn:h=>{let T=null==h?void 0:h.price;return T&&(T=this.utils.transformThousandSeparator(T)),T+" \u20ac"},editMode:{inputType:"number",parseAsAPrice:!0}},{key:"rowMenu",label:"rowMenu",size:"small",hideSelectColumnsList:!0,customCssClass:"sticky-last-column",type:"component"}],rows:[]},this.checkedRows=[],this.editingTableBlockIndex=-1,this.showDuplicateButtonBlockIndex=[],this.editingBlockTitleIndex=-1,this.editedBlockName=""}ngOnInit(){this.getState()}ngOnChanges(){this.getData()}ionViewWillEnter(){this.reloadPromotion.emit()}getState(){this.state.getState().subscribe(n=>{this.currentUser=n.user})}getData(){var n=this;return(0,l.A)(function*(){var o,d;n.showDuplicateButtonBlockIndex=[],n.checkedRows=[],n.allColumnsKeysSelected=(null===(o=n.promotion)||void 0===o?void 0:o.tableColumnsKeysSelected)||n.allColumnsKeysSelected,n.blocks=(null===(d=n.promotion)||void 0===d?void 0:d.promotionBlocks)||[];for(let p=0;p<n.blocks.length;p++)n.blocks[p].isOpen=!0,n.blocks[p].properties&&0!==n.blocks[p].properties.length&&(n.blocks[p].tableConfig=k.cloneDeep(n.tableConfig),n.allColumnsKeysSelected.includes("rowMenu")||n.allColumnsKeysSelected.push("rowMenu"),n.blocks[p].tableConfig.columns=n.blocks[p].tableConfig.columns.map(y=>(y.show=!!n.allColumnsKeysSelected.includes(y.key),y)),n.blocks[p].tableConfig.rows=n.tableService.convertDataToTableRows(k.cloneDeep(n.blocks[p].properties),k.cloneDeep(n.blocks[p].tableConfig)),"modal"===n.context&&n.blocks[p].tableConfig.rows.forEach(y=>{let A=n.promotion.propertiesTable.rows.find(F=>F.rowId===y.rowId);A&&(y.checked=A.checked)}),n.blocks[p].tableConfig.rows=n.addBackgroundColorsToTableRows(n.blocks[p].tableConfig.rows),n.blocks[p].tableConfig.rows=n.customizeRowsWithComponents(n.blocks[p].tableConfig.rows),"page"===n.context&&n.blocks[p].tableConfig.columns.forEach((y,A)=>{if("rowMenu"===y.key){let F={...y};F.component=N,F.componentInputs={onClick:()=>{n.onEditColumns()}},n.blocks[p].tableConfig.columns[A]=F}}));"modal"===n.context&&(n.blocks=n.blocks.filter(p=>p.properties.length))})()}customizeRowsWithComponents(n){return n.map(o=>{var d;return o.cells.rowMenu.type="component",o.cells.rowMenu.component=V,o.cells.rowMenu.componentInputs={status:o.cells.availabilityStatus.value},o.cells.price.type="component",o.cells.price.component=I,o.cells.price.componentInputs={status:o.cells.availabilityStatus.value,price:o.cells.price.value},o.cells.reference.customCssClass=`bg-${null==o||null===(d=o.style)||void 0===d?void 0:d.backgroundColor}`,"available"===o.cells.availabilityStatus.value&&(o.checkboxCssClass="border-black"),o})}addBackgroundColorsToTableRows(n){for(let o=0;o<n.length;o++)switch(n[o].rawObject.availabilityStatus){case"available":n[o].style={backgroundColor:"success"};break;case"sold":n[o].style={backgroundColor:"sold"};break;case"reserved":n[o].style={backgroundColor:"reserved"};break;case"blocked":default:n[o].style={backgroundColor:"blocked"};break;case"retired":n[o].style={backgroundColor:"retired"}}return n}onAddProperty(n){var o=this;return(0,l.A)(function*(){const d=yield o.modalCtrl.create({component:g.E,componentProps:{block:n,promotion:o.promotion},cssClass:"modal-create-property"});yield d.present();const{data:p}=yield d.onWillDismiss();p&&(o.reloadPromotion.emit(),o.toastService.showSuccessToast("Propiedad a\xf1adida correctamente"))})()}onAddBlock(){var n=this;return(0,l.A)(function*(){let o={index:n.blocks.length+1,promotionId:n.promotion.id};o=(yield n.api.addBlock(o)).success.data,n.blocks.push(o)})()}onToggleBlock(n){this.blocks[n].isOpen=!this.blocks[n].isOpen}onDeleteBlock(n){var o=this;return(0,l.A)(function*(){if(n.properties.length>0)return void o.toastService.showErrorToast("No se puede eliminar un bloque que tiene propiedades");const d=yield o.modalsService.openConfirmationModal({title:"Eliminar fase",message:"\xbfEst\xe1s seguro de que quieres eliminar esta fase?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]});"delete"===(null==d?void 0:d.data)&&(yield o.api.deleteBlock(n.id),o.blocks=o.blocks.filter(y=>y.id!==n.id))})()}onClickGlobalCheckbox(n){"modal"===this.context&&this.clickGlobalCheckbox.emit(n)}onRowClicked(n){var o=this;return(0,l.A)(function*(){const d=yield o.modalCtrl.create({component:g.E,componentProps:{property:n.rawObject,promotion:o.promotion},cssClass:"modal-create-property"});yield d.present();const{data:p}=yield d.onWillDismiss();p?(console.log("HOLA2"),o.reloadPromotion.emit()):(console.log("HOLA"),o.reloadPromotion.emit())})()}onColumnClicked(n,o){var d=this;return(0,l.A)(function*(){const p={field:"",order:n.order},y=(A,F)=>(J,h)=>{const T=J[A],G=h[A];return null==T?"asc"===F?-1:1:null==G?"asc"===F?1:-1:"string"==typeof T&&"string"==typeof G?"asc"===F?T.localeCompare(G):G.localeCompare(T):"asc"===F?T-G:G-T};switch(n.column.key){case"reference":default:p.field="reference",o.properties.sort(y(p.field,p.order));break;case"promotionType":p.field="promotionType",o.properties.sort(y(p.field,p.order));break;case"floor":p.field="floor",o.properties.sort(y(p.field,p.order));break;case"totalMeasures_squareMetersBuilt":p.field="totalMeasures_squareMetersBuilt",o.properties.sort(y(p.field,p.order));break;case"totalMeasures_squareMetersUseful":p.field="totalMeasures_squareMetersUseful",o.properties.sort(y(p.field,p.order));break;case"totalMeasures_squareMetersPatch":p.field="totalMeasures_squareMetersPatch",o.properties.sort(y(p.field,p.order));break;case"bedrooms":p.field="bedrooms",o.properties.sort(y(p.field,p.order));break;case"bathrooms":p.field="bathrooms",o.properties.sort(y(p.field,p.order))}d.getData()})()}updateEditedRowsFromTable(n){var o=this;return(0,l.A)(function*(){const p=JSON.parse(JSON.stringify(n.table.rows)).filter(y=>y.hasBeenEdited);for(const y of p){const A=o.buildPropertyValuesToUpdate(y);null==A||delete A.catalog,null==A||delete A.planos,yield o.api.updatePropertyById(y.rawObject.id,A)}p.length>0&&(o.toastService.showSuccessToast("Propiedades actualizadas correctamente"),o.reloadPromotion.emit())})()}buildPropertyValuesToUpdate(n){const o={};return Object.entries(n.cells).forEach(([d,p])=>{var y;if(!p.hasBeenEdited)return;const A=this.tableConfig.columns.find(F=>F.key===d);"f_pool_comunitaria"===d?(console.log("f_pool_comunitaria",p.value),o.f_pool_comunitaria="comunitaria"===p.value,o.f_pool_privada="privada"===p.value,"No"===p.value&&(o.f_pool_comunitaria=!1,o.f_pool_privada=!1)):"fcustom_trastero"===d?"S\xed"===p.value?(o.fcustom_trastero=!0,o.fcustom_trasteroIncludedInPrice=!1):"Incluido"===p.value?(o.fcustom_trastero=!0,o.fcustom_trasteroIncludedInPrice=!0):(o.fcustom_trastero=!1,o.fcustom_trasteroIncludedInPrice=!1):"fcustom_parking"===d?"S\xed"===p.value?(o.fcustom_parking=!0,o.fcustom_parkingIncludedInPrice=!1,o.fcustom_parkingComunitario=!1):"Incluido"===p.value?(o.fcustom_parking=!0,o.fcustom_parkingIncludedInPrice=!0,o.fcustom_parkingComunitario=!1):(o.fcustom_parking=!1,o.fcustom_parkingIncludedInPrice=!1,o.fcustom_parkingComunitario=!1):o[d]=d.startsWith("fcustom_")?"S\xed"===p.value:"price"===d?parseFloat(p.value):p.value,"date"===(null==A||null===(y=A.editMode)||void 0===y?void 0:y.inputType)&&(o[d]=new Date(p.value).toISOString())}),o}onEditTable(n){var o=this;return(0,l.A)(function*(){const d=o.tableComponents.toArray();if(-1!==o.editingTableBlockIndex&&o.editingTableBlockIndex!==n){const y=d[o.editingTableBlockIndex];null!=y&&y.editCellsMode&&(console.log("HACE UN TOGGLE"),y.resetAndCloseTableEditCellsMode())}const p=d[n];p?(p.enableTableEditCellsMode(),o.editingTableBlockIndex=p.editCellsMode?n:-1):console.warn("Table not found for block index:",n)})()}onSaveTable(n){var o=this;return(0,l.A)(function*(){const p=o.tableComponents.toArray()[n];p?p.editCellsMode&&(yield o.updateEditedRowsFromTable(p),p.resetAndCloseTableEditCellsMode(),o.editingTableBlockIndex=-1):console.warn("Table not found for block index:",n)})()}onEditColumns(){var n=this;return(0,l.A)(function*(){const o=yield n.modalCtrl.create({component:L,componentProps:{promotion:n.promotion,columns:n.tableConfig.columns,selectedColumnKeys:n.allColumnsKeysSelected},cssClass:"modal-edit-table-columns"});yield o.present();const{data:d,role:p}=yield o.onWillDismiss();if("save"===p&&d){const y=d;n.allColumnsKeysSelected=y,n.blocks.forEach(F=>{var J;null!=F&&null!==(J=F.tableConfig)&&void 0!==J&&J.columns&&F.tableConfig.columns.forEach(h=>{h.show=y.includes(h.key)})}),yield n.api.updatePromotionById(n.promotion.id,{tableColumnsKeysSelected:n.allColumnsKeysSelected})}})()}onRowChecked(n,o){var d=this;return(0,l.A)(function*(){const p=d.blocks[o].tableConfig.rows[n],y=d.checkedRows.findIndex(F=>F.rawObject.id===p.rawObject.id);-1!==y?d.checkedRows.splice(y,1):(d.checkedRows=d.checkedRows.filter(F=>d.blocks.findIndex(h=>{var T;return null===(T=h.properties)||void 0===T?void 0:T.some(G=>G.id===F.rawObject.id)})!==o),d.checkedRows.push(p));const A=d.checkedRows.filter(F=>d.blocks.findIndex(h=>{var T;return null===(T=h.properties)||void 0===T?void 0:T.some(G=>G.id===F.rawObject.id)})===o).length;Array.isArray(d.showDuplicateButtonBlockIndex)||(d.showDuplicateButtonBlockIndex=[]),1===A?d.showDuplicateButtonBlockIndex.includes(o)||d.showDuplicateButtonBlockIndex.push(o):d.showDuplicateButtonBlockIndex=d.showDuplicateButtonBlockIndex.filter(F=>F!==o),d.rowCheckboxClicked.emit({rowIndex:n,blockIndex:o})})()}onDuplicateProperty(n){var o=this;return(0,l.A)(function*(){const p=o.checkedRows[0].rawObject;(yield o.promotionService.onDuplicateProperty(n,p))&&o.reloadPromotion.emit()})()}onEditBlockTitle(n,o){this.editingBlockTitleIndex=o,this.editedBlockName=n.name||"Bloque "+n.index}onSaveBlockTitle(n,o){var d=this;return(0,l.A)(function*(){n.name=d.editedBlockName;const p=yield d.api.editBlock(n);p&&p.success?d.toastService.showSuccessToast("Nombre del bloque actualizado correctamente"):d.toastService.showErrorToast("Error al actualizar el nombre del bloque"),d.editingBlockTitleIndex=-1})()}onCancelBlockTitle(){this.editingBlockTitleIndex=-1}}return(s=b).\u0275fac=function(n){return new(n||s)(t.rXU(_.W3),t.rXU(E.a),t.rXU(x.i),t.rXU(K.c),t.rXU(W.f),t.rXU(ne.M),t.rXU(ie.T),t.rXU(q.J))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-promotion-details-availability"]],viewQuery:function(n,o){if(1&n&&t.GBs(ae,5),2&n){let d;t.mGM(d=t.lsd())&&(o.tableComponents=d)}},inputs:{promotion:"promotion",context:"context"},outputs:{reloadPromotion:"reloadPromotion",sortBlock:"sortBlock",rowCheckboxClicked:"rowCheckboxClicked",clickGlobalCheckbox:"clickGlobalCheckbox"},features:[t.OA$],decls:7,vars:3,consts:[["viewMode",""],["notEditingBlock",""],["tableComponent",""],[1,"crm-section"],[1,"crm-section",2,"margin-bottom","16px","width","100%"],[1,"",2,"border-radius","16px","padding","24px","background","white"],[2,"margin-bottom","40px"],[1,"crm-header-modal","crm-header-modal-empty"],[1,"d-flex","justify-center"],["style","margin-bottom: 16px; width: 100%;","class","crm-section",4,"ngIf"],[3,"options"],[1,"crm-header-modal","crm-header-modal-empty",2,"padding","24px 16px","border","1px solid #E0E0E0","border-top-right-radius","16px","border-top-left-radius","16px",3,"ngClass"],[1,"crm-section-title"],[4,"ngIf","ngIfElse"],["class","crm-buttons-group",4,"ngIf"],[3,"table"],[1,"crm-input-input-and-icon"],[1,"crm-input-input"],["type","text","placeholder","Nombre del bloque",3,"ngModelChange","ngModel"],[1,"crm-input-input-and-icon-right"],[1,"title-edit-icons"],[1,"fa-solid","fa-check",3,"click"],[1,"fa-solid","fa-times",3,"click"],["alt","",1,"cursor-pointer",2,"margin-left","8px",3,"src"],["alt","",1,"cursor-pointer",2,"margin-left","8px",3,"click","src"],[1,"crm-buttons-group"],[1,"crm-trash-btn"],[1,"cursor-pointer"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button",3,"disabled"],["alt","",3,"click","src"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-save"],["class","crm-button-secondary crm-button-secondary-primary",3,"click",4,"ngIf"],[1,"fa-solid","fa-pencil"],[1,"fa-solid","fa-copy"],[1,"crm-button",3,"click","disabled"],[1,"fa-solid","fa-plus"],["alt","",1,"mb-4",3,"src"],["alt","",1,"mb-4",3,"click","src"],[3,"columnClick","rowClicked","clickGlobalCheckbox","rowCheckboxClicked","table"],[1,"crm-text"],["class","crm-button crm-button-outline-primary",3,"click",4,"ngIf"],[1,"crm-button","crm-button-outline-primary",3,"click"]],template:function(n,o){1&n&&(t.j41(0,"div",3),t.DNE(1,de,1,1,"div",4),t.j41(2,"div",5),t.Z7z(3,Pe,8,8,"div",6,t.fX1),t.DNE(5,re,3,0,"div",7)(6,Ee,2,1,"div",8),t.k0s()()),2&n&&(t.R7$(),t.vxM("page"===o.context?1:-1),t.R7$(2),t.Dyx(o.blocks),t.R7$(2),t.vxM(0===o.blocks.length?5:-1),t.R7$(),t.vxM("page"===o.context?6:-1))},dependencies:[e.YU,e.bT,M.me,M.BC,M.vS,le.O,D.l],styles:[".title-edit-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;color:var(--crm-red-color)}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:first-child{color:var(--crm-success-color)}"]}),b})()},8031:($,B,i)=>{i.d(B,{J:()=>f});var l=i(467),t=i(7376),k=i(3953),_=i(5970),v=i(8397),e=i(6039),M=i(6552);let f=(()=>{var D;class j{constructor(a,L,U,X){this.popoversService=a,this.toastService=L,this.api=U,this.utils=X}transformPromotionFormStepOne(a){return{projectName:null==a?void 0:a.projectName,constructionType:null==a?void 0:a.constructionType,constructionSubType:null==a?void 0:a.constructionSubType,constructionStatus:null==a?void 0:a.constructionStatus,constructionYear:null==a?void 0:a.constructionYear,constructionStart:null==a?void 0:a.constructionStart,commercializationStart:null==a?void 0:a.commercializationStart,keyDeliveryDate:null==a?void 0:a.keyDeliveryDate,country:null==a?void 0:a.country,province:null==a?void 0:a.province,city:null==a?void 0:a.city,neighborhood:null==a?void 0:a.neighborhood,address:null==a?void 0:a.address,postalCode:null==a?void 0:a.postalCode,number:null==a?void 0:a.number,showAddressPublicly:null==a?void 0:a.showAddressPublicly,showGeoreferencePublicly:null==a?void 0:a.showGeoreferencePublicly,energyEfficiencyCertificate:null==a?void 0:a.energyEfficiencyCertificate,co2EmissionsCertificate:null==a?void 0:a.co2EmissionsCertificate,energyEfficiencyValue:null==a?void 0:a.energyEfficiencyValue,co2EmissionsValue:null==a?void 0:a.co2EmissionsValue}}transformPromotionFormStepThree(a){return{title_es:null==a?void 0:a.title_es,title_en:null==a?void 0:a.title_en,title_de:null==a?void 0:a.title_de,title_fr:null==a?void 0:a.title_fr,title_ru:null==a?void 0:a.title_ru,description_es:null==a?void 0:a.description_es,description_en:null==a?void 0:a.description_en,description_de:null==a?void 0:a.description_de,description_fr:null==a?void 0:a.description_fr,description_ru:null==a?void 0:a.description_ru,promotionFiles:null==a?void 0:a.promotionFiles}}deleteAllPromotionPropertiesExceptFeatures(a){const L=t.cloneDeep(a);for(const U in L)U.startsWith("f_")||U.startsWith("fcustom_")||delete L[U];return L}onDuplicateProperty(a,L){var U=this;return(0,l.A)(function*(){let X=null;const O=yield U.popoversService.onShowDuplicatePropertyPopover(a);var Y,w,I,V,N;if(console.log("POPOVER RESULT",O),O&&(null!=O&&null!==(Y=O.data)&&void 0!==Y&&Y.count&&(null==O||null===(w=O.data)||void 0===w?void 0:w.count)>0&&(null==O||null===(I=O.data)||void 0===I?void 0:I.count)<=25?X=null==O||null===(N=O.data)||void 0===N?void 0:N.count:(null==O||null===(V=O.data)||void 0===V?void 0:V.count)>25&&(yield U.toastService.showErrorToast("La cantidad de propiedades a duplicar debe ser mayor a 0 y menor o igual a 25"))),!X)return!1;for(let E=0;E<X;E++)console.log("DUPLICATING PROPERTY",E),yield U.duplicateProperty(L,E);return yield U.toastService.showSuccessToast("Propiedad duplicada exitosamente"),!0})()}duplicateProperty(a,L){var U=this;return(0,l.A)(function*(){var X,O,Y,w;let I=t.cloneDeep(a);I=U.utils.parseProperties(I),I.promotionBlockId=a.promotionBlockId,I.promotionId=a.promotionId,I.reference=null!==(X=I)&&void 0!==X&&X.reference?`${null===(O=I)||void 0===O?void 0:O.reference} - Copia ${L+1}`:null,I.availabilityStatus=null;const V=t.cloneDeep((null===(Y=I)||void 0===Y?void 0:Y.propertyFiles)||[]);delete I.id,delete I.propertyFiles,delete I.measurements_floors,delete I.byvaroId,delete I.updatedAt,delete I.createdAt;const N=yield U.api.createProperty(I);null==N||null===(w=N.success)||void 0===w||(w=w.data),console.log("LA PROPERTYYYYYYY",I),console.log("PROPERTY FILES",V)})()}}return(D=j).\u0275fac=function(a){return new(a||D)(k.KVO(_.m),k.KVO(v.f),k.KVO(e.i),k.KVO(M.T))},D.\u0275prov=k.jDH({token:D,factory:D.\u0275fac,providedIn:"root"}),j})()}}]);