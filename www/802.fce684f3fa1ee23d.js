"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[802],{9491:(X,j,c)=>{c.d(j,{j:()=>p});var f=c(177),P=c(9465),v=c(9417),y=c(3953);let p=(()=>{var n;class k{}return(n=k).\u0275fac=function(R){return new(R||n)},n.\u0275mod=y.$C({type:n}),n.\u0275inj=y.G2t({imports:[f.MD,P.bv,v.YN,v.X1]}),k})()},802:(X,j,c)=>{c.r(j),c.d(j,{AgenciesListPageModule:()=>O});var f=c(177),P=c(9417),v=c(9465),y=c(5188),p=c(2465),n=c(3953);const k=[{path:"",component:p.F}];let E=(()=>{var r;class m{}return(r=m).\u0275fac=function(A){return new(A||r)},r.\u0275mod=n.$C({type:r}),r.\u0275inj=n.G2t({imports:[y.iI.forChild(k),y.iI]}),m})(),R=(()=>{var r;class m{}return(r=m).\u0275fac=function(A){return new(A||r)},r.\u0275mod=n.$C({type:r}),r.\u0275inj=n.G2t({imports:[f.MD,P.YN,P.X1,v.bv]}),m})();var S=c(5603),L=c(9491);let O=(()=>{var r;class m{}return(r=m).\u0275fac=function(A){return new(A||r)},r.\u0275mod=n.$C({type:r}),r.\u0275inj=n.G2t({imports:[f.MD,P.YN,v.bv,E,R,S.P,L.j]}),m})()},2465:(X,j,c)=>{c.d(j,{F:()=>kn});var f=c(467),P=c(1413),v=c(7944),y=c(7376),p=c(9969),n=c(3953),k=c(5188),E=c(8397),R=c(4501),S=c(9465),L=c(6039),O=c(1213),r=c(177),m=c(6552);function x(e,l){if(1&e&&n.nrm(0,"span",26),2&e){let o;const t=n.XpG().$implicit,i=n.XpG(3);n.HbH(null==(o=i.utils.getLanguageInfo(t))?null:o.flagClass)}}function A(e,l){if(1&e&&(n.qex(0),n.DNE(1,x,1,2,"span",25),n.bVm()),2&e){const o=l.index;n.R7$(),n.Y8G("ngIf",o<3)}}function w(e,l){if(1&e&&(n.j41(0,"span",27),n.EFF(1),n.k0s()),2&e){const o=n.XpG(3);n.R7$(),n.SpI(" +",o.agency.languages.length-3," ")}}function z(e,l){if(1&e&&(n.j41(0,"div",22),n.DNE(1,A,2,1,"ng-container",23)(2,w,2,1,"span",24),n.k0s()),2&e){const o=n.XpG(2);n.R7$(),n.Y8G("ngForOf",o.agency.languages),n.R7$(),n.Y8G("ngIf",o.agency.languages.length>3)}}function W(e,l){1&e&&(n.j41(0,"div",28),n.EFF(1," Sin idiomas "),n.k0s())}function Z(e,l){1&e&&(n.j41(0,"button",19),n.EFF(1," Pendiente "),n.nrm(2,"i",29),n.k0s())}function K(e,l){1&e&&(n.j41(0,"button",20),n.EFF(1," Colaborador "),n.nrm(2,"i",30),n.k0s())}function H(e,l){if(1&e){const o=n.RV6();n.j41(0,"button",31),n.bIt("click",function(i){n.eBV(o);const a=n.XpG(2);return n.Njj(a.onInviteAgencyClick(i))}),n.nrm(1,"i",32),n.EFF(2," Invitar agencia "),n.k0s()}}function Q(e,l){if(1&e){const o=n.RV6();n.j41(0,"div",3),n.bIt("click",function(){n.eBV(o);const i=n.XpG();return n.Njj(i.onNavigateToAgency())}),n.j41(1,"div",4),n.nrm(2,"img",5),n.j41(3,"div",6)(4,"div",7)(5,"span",8),n.EFF(6),n.k0s()(),n.j41(7,"div",9),n.EFF(8),n.k0s(),n.DNE(9,z,3,2,"div",10)(10,W,2,0,"ng-template",null,0,n.C5r),n.k0s()(),n.j41(12,"div",11),n.EFF(13),n.k0s(),n.nrm(14,"div",12),n.j41(15,"div",13)(16,"div",14),n.nrm(17,"i",15),n.j41(18,"span"),n.EFF(19),n.k0s()(),n.j41(20,"div",14),n.nrm(21,"i",16),n.j41(22,"span"),n.EFF(23),n.k0s()(),n.j41(24,"div",14),n.nrm(25,"i",17),n.j41(26,"span"),n.EFF(27,"Operaciones"),n.k0s()()(),n.j41(28,"div",18),n.DNE(29,Z,3,0,"button",19)(30,K,3,0,"button",20)(31,H,3,0,"button",21),n.k0s()()}if(2&e){const o=n.sdS(11),t=n.XpG();n.R7$(2),n.FS9("alt",null==t.agency?null:t.agency.name),n.Y8G("src",(null==t.agency?null:t.agency.photoUrl)||"assets/images/building.png",n.B4B),n.R7$(4),n.JRh(null==t.agency?null:t.agency.name),n.R7$(2),n.Lme(" ",(null==t.agency?null:t.agency.city)||"Valencia"," / ",(null==t.agency?null:t.agency.country)||"Spain"," "),n.R7$(),n.Y8G("ngIf",(null==t.agency||null==t.agency.languages?null:t.agency.languages.length)>0)("ngIfElse",o),n.R7$(4),n.Lme(" Promociones compartidas: ",(null==t.agency||null==t.agency.promotions?null:t.agency.promotions.length)||0," / ",t.promoterPromotions||0," "),n.R7$(6),n.SpI("Oificinas: ",(null==t.agency||null==t.agency.offices?null:t.agency.offices.length)||0,""),n.R7$(4),n.SpI("Agentes: ",(null==t.agency?null:t.agency.agentsCount)||0,""),n.R7$(6),n.vxM("pending"===(null==t.options?null:t.options.invitationStatus)?29:"collaborator"===(null==t.options?null:t.options.invitationStatus)?30:31)}}function J(e,l){1&e&&(n.j41(0,"div",2)(1,"div",4),n.nrm(2,"div",33),n.j41(3,"div",6),n.nrm(4,"div",34)(5,"div",35)(6,"div",36),n.k0s()(),n.nrm(7,"div",37)(8,"div",38),n.j41(9,"div",13),n.nrm(10,"div",39)(11,"div",39)(12,"div",39),n.k0s(),n.nrm(13,"div",40),n.k0s())}let q=(()=>{var e;class l{constructor(t,i){this.router=t,this.utils=i,this.promoterPromotions=0,this.inviteAgencyClick=new n.bkB}ngOnInit(){console.log(this.options)}onInviteAgencyClick(t){t.stopPropagation(),t.preventDefault(),this.inviteAgencyClick.emit({agency:this.agency,options:this.options})}onNavigateToAgency(){this.router.navigate([`/agencies/${this.agency.id}`])}}return(e=l).\u0275fac=function(t){return new(t||e)(n.rXU(k.Ix),n.rXU(m.T))},e.\u0275cmp=n.VBU({type:e,selectors:[["app-card-agency"]],inputs:{agency:"agency",isSkeleton:"isSkeleton",options:"options",promoterPromotions:"promoterPromotions"},outputs:{inviteAgencyClick:"inviteAgencyClick"},decls:2,vars:1,consts:[["noLangs",""],[1,"collaboration-card"],[1,"collaboration-card","collaboration-card--skeleton"],[1,"collaboration-card",3,"click"],[1,"collaboration-card__header"],[1,"collaboration-card__logo",3,"src","alt"],[1,"collaboration-card__info"],[1,"collaboration-card__top-row"],[1,"collaboration-card__name"],[1,"collaboration-card__location"],["class","collaboration-card__languages",4,"ngIf","ngIfElse"],[1,"collaboration-card__shared"],[1,"collaboration-card__divider"],[1,"collaboration-card__meta"],[1,"collaboration-card__meta-item"],[1,"fas","fa-building"],[1,"fas","fa-user"],[1,"fas","fa-chart-line"],[1,"collaboration-card__footer",2,"margin-top","8px"],[1,"collaboration-card__button","collaboration-card__button--pending"],[1,"collaboration-card__button","collaboration-card__button--collaborator"],[1,"crm-button",2,"width","100%","justify-content","center"],[1,"collaboration-card__languages"],[4,"ngFor","ngForOf"],["class","collaboration-card__flag-plus",4,"ngIf"],["class","collaboration-card__flag",3,"class",4,"ngIf"],[1,"collaboration-card__flag"],[1,"collaboration-card__flag-plus"],[1,"collaboration-card__languages-empty"],[1,"fas","fa-clock"],[1,"fas","fa-check-circle"],[1,"crm-button",2,"width","100%","justify-content","center",3,"click"],[1,"fas","fa-add"],[1,"collaboration-card__logo","skeleton-block"],[1,"collaboration-card__top-row","skeleton-block"],[1,"collaboration-card__location","skeleton-block"],[1,"collaboration-card__languages","skeleton-block"],[1,"collaboration-card__shared","skeleton-block"],[1,"collaboration-card__divider","skeleton-block"],[1,"collaboration-card__meta-item","skeleton-block"],[1,"collaboration-card__footer","skeleton-block"]],template:function(t,i){1&t&&n.DNE(0,Q,32,12,"div",1)(1,J,14,0,"div",2),2&t&&n.vxM(i.isSkeleton?1:0)},dependencies:[r.Sq,r.bT],styles:[".collaboration-card[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #eaeaea;border-radius:12px;padding:16px;width:340px;box-sizing:border-box;display:flex;flex-direction:column;cursor:pointer;position:relative}.collaboration-card__header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.collaboration-card__logo[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;object-fit:cover;flex-shrink:0}.collaboration-card__info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.collaboration-card__top-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.collaboration-card__name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;margin-bottom:4px;color:#111}.collaboration-card__verified[_ngcontent-%COMP%]{font-size:14px;color:#1890ff;display:inline-flex;align-items:center}.collaboration-card__location[_ngcontent-%COMP%]{font-size:14px;color:#888}.collaboration-card__languages[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.collaboration-card__languages[_ngcontent-%COMP%]   .collaboration-card__flag[_ngcontent-%COMP%]{width:20px;height:14px;border-radius:2px;background-size:cover;background-position:center}.collaboration-card__languages[_ngcontent-%COMP%]   .collaboration-card__flag-plus[_ngcontent-%COMP%]{font-size:13px;color:#666}.collaboration-card__languages-empty[_ngcontent-%COMP%]{font-size:13px;color:#999}.collaboration-card__shared[_ngcontent-%COMP%]{margin-top:12px;font-size:14px;color:#333;font-weight:500}.collaboration-card__divider[_ngcontent-%COMP%]{width:100%;height:1px;background-color:#eaeaea;border:none;margin:12px 0}.collaboration-card__meta[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:12px}.collaboration-card__meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:12px;color:#666}.collaboration-card__meta-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:13px}.collaboration-card__footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:8px;margin-top:auto}.collaboration-card__chip[_ngcontent-%COMP%]{font-size:13px;padding:4px 8px;border-radius:6px;display:inline-flex;align-items:center;gap:4px}.collaboration-card__chip--warning[_ngcontent-%COMP%]{background-color:#fff8e6;color:#e69900;border:1px solid #ffe5b4}.collaboration-card__button[_ngcontent-%COMP%]{font-size:14px;border-radius:4px;padding:6px 12px;outline:none;cursor:pointer;display:inline-flex;align-items:center;gap:8px;border:1px solid transparent}.collaboration-card__button--collaborator[_ngcontent-%COMP%]{background-color:#ecf2ff;color:#3a50e4}.collaboration-card__button--pending[_ngcontent-%COMP%]{background-color:#fbf4ec;color:#e49d3a}.collaboration-card__button--invite[_ngcontent-%COMP%]{background-color:#1890ff;color:#fff}.collaboration-card--skeleton[_ngcontent-%COMP%]{pointer-events:none}.collaboration-card--skeleton[_ngcontent-%COMP%]   .skeleton-block[_ngcontent-%COMP%]{background-color:#eee;border-radius:4px;width:100%;height:16px}.collaboration-card--skeleton__logo.skeleton-block[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%}.collaboration-card--skeleton__divider.skeleton-block[_ngcontent-%COMP%]{height:1px;margin:12px 0}.collaboration-card--skeleton__footer.skeleton-block[_ngcontent-%COMP%]{height:24px;width:100px}"]}),l})();var nn=c(6580),G=c(9417);const tn=["countryInput"],en=["provinceInput"],on=["cityInput"];let an=(()=>{var e;class l{constructor(t){this.ngZone=t,this.filterData={country:"Espa\xf1a",city:"",province:"",languages:[],offices:[],agentsCount:[],annualSales:[]}}ngOnInit(){}ngAfterViewInit(){this.countryAutocomplete=new google.maps.places.Autocomplete(this.countryInput.nativeElement,{types:["country"],componentRestrictions:{country:"es"},fields:["address_component","formatted_address"]}),this.countryAutocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{var t;const a=null===(t=this.countryAutocomplete.getPlace().address_components)||void 0===t?void 0:t.find(d=>d.types.includes("country"));a&&(this.filterData.country=a.long_name,this.countryInput.nativeElement.value=this.filterData.country)})}),this.provinceAutocomplete=new google.maps.places.Autocomplete(this.provinceInput.nativeElement,{types:["(regions)"],componentRestrictions:{country:"es"},fields:["address_component","geometry"]}),this.provinceAutocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{var t,i;const a=this.provinceAutocomplete.getPlace(),d=null===(t=a.address_components)||void 0===t?void 0:t.find(g=>g.types.includes("administrative_area_level_2"));d&&(this.filterData.province=d.long_name,this.provinceInput.nativeElement.value=this.filterData.province),null!==(i=a.geometry)&&void 0!==i&&i.viewport&&(this.cityAutocomplete.setBounds(a.geometry.viewport),this.cityAutocomplete.setOptions({strictBounds:!0}))})}),this.cityAutocomplete=new google.maps.places.Autocomplete(this.cityInput.nativeElement,{types:["locality"],componentRestrictions:{country:"es"}}),this.cityAutocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{var t;const a=null===(t=this.cityAutocomplete.getPlace().address_components)||void 0===t?void 0:t.find(d=>d.types.includes("locality"));a&&(this.filterData.city=a.long_name,this.cityInput.nativeElement.value=this.filterData.city)})})}onClickFilter(){console.log("Filtering with",this.filterData)}onResetFilters(){this.filterData.city="",this.filterData.province="",this.cityAutocomplete.setBounds(void 0),this.cityInput.nativeElement.value="",this.provinceInput.nativeElement.value=""}}return(e=l).\u0275fac=function(t){return new(t||e)(n.rXU(n.SKi))},e.\u0275cmp=n.VBU({type:e,selectors:[["app-agencies-filter-block"]],viewQuery:function(t,i){if(1&t&&(n.GBs(tn,5),n.GBs(en,5),n.GBs(on,5)),2&t){let a;n.mGM(a=n.lsd())&&(i.countryInput=a.first),n.mGM(a=n.lsd())&&(i.provinceInput=a.first),n.mGM(a=n.lsd())&&(i.cityInput=a.first)}},decls:31,vars:3,consts:[["countryInput",""],["provinceInput",""],["cityInput",""],[2,"position","relative"],["autocomplete","off","novalidate",""],["type","text","autocomplete","username",2,"display","none"],["type","password","autocomplete","new-password",2,"display","none"],[1,"crm-header-modal","crm-header-modal-fixed-top"],[1,"crm-modal-header-title"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[1,"crm-button-secondary","crm-button-secondary-red",3,"click"],[1,"crm-block-inputs","crm-block-filters-inputs"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input"],["type","text","placeholder","Espa\xf1a","autocomplete","off","autocorrect","off","spellcheck","false",3,"value"],["type","text","placeholder","Seleccione provincia","autocomplete","off","autocorrect","off","spellcheck","false",3,"value"],["type","text","placeholder","Seleccione ciudad","autocomplete","off","autocorrect","off","spellcheck","false",3,"value"]],template:function(t,i){if(1&t){const a=n.RV6();n.j41(0,"div",3)(1,"form",4),n.nrm(2,"input",5)(3,"input",6),n.j41(4,"div",7)(5,"div",8),n.EFF(6,"Filtrar"),n.k0s(),n.j41(7,"div",9)(8,"button",10),n.bIt("click",function(){return n.eBV(a),n.Njj(i.onClickFilter())}),n.EFF(9,"Filtrar"),n.k0s(),n.j41(10,"button",11),n.bIt("click",function(){return n.eBV(a),n.Njj(i.onResetFilters())}),n.EFF(11," Reiniciar "),n.k0s()()(),n.j41(12,"div",12)(13,"div",13)(14,"div",14),n.EFF(15,"Pa\xeds"),n.k0s(),n.j41(16,"div",15),n.nrm(17,"input",16,0),n.k0s()(),n.j41(19,"div",13)(20,"div",14),n.EFF(21,"Provincia"),n.k0s(),n.j41(22,"div",15),n.nrm(23,"input",17,1),n.k0s()(),n.j41(25,"div",13)(26,"div",14),n.EFF(27,"Ciudad"),n.k0s(),n.j41(28,"div",15),n.nrm(29,"input",18,2),n.k0s()()()()()}2&t&&(n.R7$(17),n.Y8G("value",i.filterData.country),n.R7$(6),n.Y8G("value",i.filterData.province),n.R7$(6),n.Y8G("value",i.filterData.city))},dependencies:[G.qT,G.cb,G.cV]}),l})();const ln=e=>({"crm-block-body-fixed":e}),cn=e=>({"crm-button-secondary-primary":e}),V=(e,l,o,t,i)=>({pageStartIndex:e,pageEndIndex:l,totalCount:o,paginationPage:t,sortField:i}),sn=e=>({active:e}),rn=(e,l)=>({"background-color":e,border:l});function dn(e,l){if(1&e){const o=n.RV6();n.j41(0,"button",17),n.bIt("click",function(){n.eBV(o);const i=n.XpG();return n.Njj(i.onInviteAgencies())}),n.nrm(1,"i",18),n.EFF(2," Invitar agencia "),n.k0s()}}function gn(e,l){1&e&&(n.nrm(0,"i",19),n.EFF(1," Cerrar filtros "))}function pn(e,l){1&e&&(n.nrm(0,"i",20),n.EFF(1," Filtros activados "))}function un(e,l){1&e&&(n.nrm(0,"i",20),n.EFF(1," Filtrar "))}function mn(e,l){if(1&e&&n.DNE(0,pn,2,0)(1,un,2,0),2&e){const o=n.XpG();n.vxM(o.filters?0:1)}}function _n(e,l){if(1&e){const o=n.RV6();n.j41(0,"app-list-pagination-selectors",21),n.bIt("goPreviousPage",function(){n.eBV(o);const i=n.XpG();return n.Njj(i.onGoPreviousPage())})("goNextPage",function(){n.eBV(o);const i=n.XpG();return n.Njj(i.onGoNextPage())})("sort",function(i){n.eBV(o);const a=n.XpG();return n.Njj(a.onSort(i))}),n.k0s()}if(2&e){const o=n.XpG();n.Y8G("listPaginationConfig",n.s1E(1,V,o.updatePagination().startIndex,o.updatePagination().endIndex,o.allSystemAgenciesCount,o.pagination.page+1,null!=o.sort&&o.sort.field?(null==o.sort?null:o.sort.field)+" "+(null==o.sort?null:o.sort.order):"Fecha de creaci\xf3n"))}}function fn(e,l){if(1&e){const o=n.RV6();n.j41(0,"div",13)(1,"app-list-pagination-selectors",21),n.bIt("goPreviousPage",function(){n.eBV(o);const i=n.XpG();return n.Njj(i.onGoPreviousPage())})("goNextPage",function(){n.eBV(o);const i=n.XpG();return n.Njj(i.onGoNextPage())})("sort",function(i){n.eBV(o);const a=n.XpG();return n.Njj(a.onSort(i))}),n.k0s()()}if(2&e){const o=n.XpG();n.R7$(),n.Y8G("listPaginationConfig",n.s1E(1,V,o.updatePagination().startIndex,o.updatePagination().endIndex,o.allSystemAgenciesCount,o.pagination.page+1,null!=o.sort&&o.sort.field?(null==o.sort?null:o.sort.field)+" "+(null==o.sort?null:o.sort.order):"Fecha de creaci\xf3n"))}}function vn(e,l){1&e&&(n.j41(0,"div",15),n.nrm(1,"app-card-agency",22)(2,"app-card-agency",22)(3,"app-card-agency",22),n.k0s()),2&e&&(n.R7$(),n.Y8G("isSkeleton",!0),n.R7$(),n.Y8G("isSkeleton",!0),n.R7$(),n.Y8G("isSkeleton",!0))}function yn(e,l){if(1&e&&n.EFF(0),2&e){const o=n.XpG().$implicit;n.SpI(" (",null==o?null:o.count,") ")}}function Cn(e,l){if(1&e){const o=n.RV6();n.j41(0,"div",26),n.bIt("click",function(){const i=n.eBV(o).$implicit,a=n.XpG(2);return n.Njj(a.onClickAgencyRelation(i))}),n.j41(1,"div",27),n.EFF(2),n.DNE(3,yn,1,1),n.nrm(4,"div",28),n.k0s()()}if(2&e){const o=l.$implicit;n.Y8G("ngClass",n.eq3(4,sn,null==o?null:o.isSelected)),n.R7$(2),n.SpI(" ",null==o?null:o.title," "),n.R7$(),n.vxM(null!==(null==o?null:o.count)?3:-1),n.R7$(),n.Y8G("ngStyle",n.l_i(6,rn,null==o?null:o.color,"1px solid "+(null==o?null:o.color)))}}function bn(e,l){if(1&e){const o=n.RV6();n.j41(0,"app-card-agency",29),n.bIt("inviteAgencyClick",function(i){n.eBV(o);const a=n.XpG(2);return n.Njj(a.onInviteAgencyClick(i))}),n.k0s()}if(2&e){const o=l.$implicit,t=n.XpG(2);n.Y8G("promoterPromotions",t.promoterPromotions)("agency",o)("options",o.agencyCardOptions)}}function hn(e,l){if(1&e&&(n.j41(0,"div",23),n.Z7z(1,Cn,5,9,"div",24,n.fX1),n.k0s(),n.j41(3,"div",15),n.Z7z(4,bn,1,3,"app-card-agency",25,n.fX1),n.k0s()),2&e){const o=n.XpG();n.R7$(),n.Dyx(o.agencyRelations),n.R7$(3),n.Dyx(o.agencies)}}function Pn(e,l){1&e&&(n.j41(0,"div",16),n.nrm(1,"app-agencies-filter-block"),n.k0s()),2&e&&n.Y8G("@biggerFadeSlideIn",void 0)}let kn=(()=>{var e;class l{constructor(t,i,a,d,g,u){this.router=t,this.toastService=i,this.headerService=a,this.modalCtrl=d,this.api=g,this.state=u,this.promotion=null,this.agenciesAlreadyLinked=[],this.agenciesNotLinked=[],this.agencies=[],this.allSystemAgenciesCount=0,this.searchString="",this.searchSubject=new P.B,this.agencyCardOptions={type:"globalAgencies"},this.aside={type:"filters",visible:!0},this.agencyRelations=[{id:"agencias-colaboradoras",title:"Agencias colaboradoras",subtitle:"",color:"#4CAF50",isSelected:!0,count:0},{id:"agencias-no-colaboradoras",title:"Agencias no colaboradoras",subtitle:"",color:"#FF9800",isSelected:null,count:null}],this.filters=null,this.sort=null,this.pagination={page:0,itemsPerPage:25},this.promoterPromotions=0,this.loadingList=!1}ngOnInit(){this.getState(),this.getData()}ionViewWillEnter(){this.promotion?this.agencyCardOptions.type="promotionAgencies":this.headerService.setConfig({title:"agencies"})}getState(){this.state.getState().subscribe(t=>{this.currentUser=t.user,this.currentPromoter=t.promoter})}onInviteAgencies(){var t=this;return(0,f.A)(function*(){yield(yield t.modalCtrl.create({component:v.v,cssClass:"modal-invite-agency"})).present()})()}onSearchInputChange(t){this.searchSubject.next(t.target.value)}onSearchChanged(t){this.searchString=t}onToggleAside(){this.aside.visible=!this.aside.visible}onFilter(t){console.log("filters",t)}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemAgenciesCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}onInviteAgencyClick(t){var i=this;return(0,f.A)(function*(){const{agency:a,options:d}=t;if("globalAgencies"===d.type)yield(yield i.modalCtrl.create({component:v.v,cssClass:"modal-invite-agency",componentProps:{agencyCardOpen:a}})).present();else if("promotionAgencies"===d.type){const g=d.promotion;let u={status:"pending",type:"register",agencyEmail:a.email,agencyId:a.id};const C=(yield i.api.createAgencyInvitationToPromotions(u)).success.data,b=[g.id],F=yield i.api.addPromotionsToAgencyInvitationToPromotions(b,C.id);if(F.error)return void i.toastService.showErrorToast("Ha ocurrido un error al invitar la agencia."+F.error.errorMessage);i.toastService.showSuccessToast("Agencia invitada correctamente"),i.getData()}})()}onClickAgencyRelation(t){this.agencyRelations.forEach(i=>{i.isSelected=i.id===t.id}),this.getData()}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemAgenciesCount)}}getData(){var t=this;return(0,f.A)(function*(){var i,a,d,g,u,T,C;let b,F;t.loadingList=!0,console.log("this.currentPromoter",t.currentPromoter),t.currentPromoter||(yield new Promise(s=>{setTimeout(s,100)}),t.getData()),t.promotion&&(t.agencyCardOptions.type="promotionAgencies"),console.log(3244324324,t.agencyRelations,"this.agencyRelations");const I=t.agencyRelations.find(s=>"agencias-colaboradoras"===s.id).isSelected,M=t.agencyRelations.find(s=>"agencias-no-colaboradoras"===s.id).isSelected;if(console.log(88888888,I),console.log(999999999,M),!0===I||null===I&&null===M||!1===I&&!1===M){var D;let s={promoters:{apply:!0,filter:{id:{equals:null===(D=t.currentPromoter)||void 0===D?void 0:D.id}},onlyCount:!1}};var N;if(t.promotion&&(s={...s,promotions:{apply:!0,filter:{id:{equals:t.promotion.id}},onlyCount:!1}}),b=yield t.api.getAgency({},t.sort,t.pagination,s),b.error)return t.toastService.showToast({text:"Ha ocurrido un error al cargar las agencias, "+(null===(N=b.error)||void 0===N?void 0:N.errorMessage),theme:"red",icon:"fas fa-exclamation-triangle",time:1e4}),void(t.loadingList=!1);t.agencyRelations.map(h=>{var _;"agencias-colaboradoras"===h.id&&(h.count=null===(_=b)||void 0===_||null===(_=_.success)||void 0===_?void 0:_.metadata)})}if(!0===M||null===I&&null===M||!1===I&&!1===M){let s={};var $;s=t.promotion?{promotions:{apply:!0,filter:{id:{equals:t.promotion.id}},onlyCount:!1,negativeFiler:!0},agencyInvitationToPromotions:{apply:!0,mode:"include",filter:{status:{equals:"pending"}},onlyCount:!1}}:{promoters:{apply:!0,filter:{id:{equals:null===($=t.currentPromoter)||void 0===$?void 0:$.id}},onlyCount:!1,negativeFiler:!0}},F=yield t.api.getAgency({},t.sort,t.pagination,s)}let B=(null===(i=b)||void 0===i||null===(i=i.success)||void 0===i?void 0:i.data)||[];B=B.map(s=>(s.isLinked=!0,s.agencyCardOptions=y.cloneDeep(t.agencyCardOptions),t.promotion&&(s.agencyCardOptions.promotion=t.promotion,s.agencyCardOptions.invitationStatus="collaborator"),s));let Y=(null===(a=F)||void 0===a||null===(a=a.success)||void 0===a?void 0:a.data)||[];Y=Y.map(s=>{if(s.agencyCardOptions=y.cloneDeep(t.agencyCardOptions),t.promotion){s.agencyCardOptions.promotion=t.promotion;for(const h of s.agencyInvitationToPromotions)h.promotions.find(_=>_.id===t.promotion.id)&&"pending"===h.status&&(s.agencyCardOptions.invitationStatus="pending")}return s}),t.agencies=B.concat((null===(d=F)||void 0===d||null===(d=d.success)||void 0===d?void 0:d.data)||[]),t.allSystemAgenciesCount=((null===(g=b)||void 0===g||null===(g=g.success)||void 0===g||null===(g=g.metadata)||void 0===g?void 0:g.count)||0)+((null===(u=F)||void 0===u||null===(u=u.success)||void 0===u||null===(u=u.metadata)||void 0===u?void 0:u.count)||0),t.pagination.page=0,t.updatePagination(),t.loadingList=!1,console.log("this.agencies",t.agencies);const U=yield t.api.getPromotions({},null,{page:0,itemsPerPage:1e3},null);console.log("ELL RESULT DE OTTES LES PROMOCIONS",U),t.promoterPromotions=U.success.data.length;let xn={promoters:{apply:!0,filter:{id:{equals:null===(T=t.currentPromoter)||void 0===T?void 0:T.id}},onlyCount:!1},promotions:{apply:!0,filter:{},onlyCount:!1}};const An=(null===(C=yield t.api.getAgency({},t.sort,t.pagination,xn))||void 0===C||null===(C=C.success)||void 0===C?void 0:C.data)||[];t.agencies=t.agencies.map(s=>{const h=An.find(_=>_.id===s.id);return h&&(s.promotions=h.promotions),s})})()}onSort(t){return(0,f.A)(function*(){})()}}return(e=l).\u0275fac=function(t){return new(t||e)(n.rXU(k.Ix),n.rXU(E.f),n.rXU(R.d),n.rXU(S.W3),n.rXU(L.i),n.rXU(O.c))},e.\u0275cmp=n.VBU({type:e,selectors:[["app-agencies-list"]],inputs:{promotion:"promotion"},decls:29,vars:14,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content",2,"padding-top","10px","background","#F9F9F9"],[1,"crm-block-body"],[3,"ngClass"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar agencia",3,"input"],[1,"crm-buttons-group"],[1,"crm-button"],[1,"crm-button-secondary",3,"click","ngClass"],[3,"listPaginationConfig"],[1,"crm-block-body-fixed","crm-block-body-fixed-padding-bigger"],[1,"crm-block-body-blue-content"],[1,"crm-section-inline-cards"],[1,"crm-block-content-aside"],[1,"crm-button",3,"click"],[1,"fas","fa-envelope"],[1,"fa","fa-times"],[1,"fa","fa-filter"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[3,"isSkeleton"],[1,"crm-section-operations-list-buttons",2,"padding","0"],[1,"crm-operations-list-pipe-button",3,"ngClass"],[3,"promoterPromotions","agency","options"],[1,"crm-operations-list-pipe-button",3,"click","ngClass"],[1,"crm-operations-list-pipe-button-subtitle"],[1,"crm-dot","success",3,"ngStyle"],[3,"inviteAgencyClick","promoterPromotions","agency","options"]],template:function(t,i){1&t&&(n.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),n.nrm(7,"i",7),n.j41(8,"input",8),n.bIt("input",function(d){return i.onSearchInputChange(d)}),n.k0s()()(),n.j41(9,"div",9),n.DNE(10,dn,3,0,"button",10),n.j41(11,"button",11),n.bIt("click",function(){return i.onToggleAside()}),n.DNE(12,gn,2,0)(13,mn,2,1),n.k0s()()(),n.DNE(14,_n,1,7,"app-list-pagination-selectors",12),n.k0s(),n.DNE(15,fn,2,7,"div",13),n.j41(16,"div",14),n.DNE(17,vn,4,3,"div",15)(18,hn,6,0),n.nrm(19,"br")(20,"br")(21,"br")(22,"br")(23,"br")(24,"br")(25,"br")(26,"br")(27,"br"),n.k0s()(),n.DNE(28,Pn,2,1,"div",16),n.k0s()()),2&t&&(n.Y8G("fullscreen",!0)("scrollY",!1),n.R7$(3),n.Y8G("ngClass",n.eq3(10,ln,!i.promotion)),n.R7$(7),n.vxM(i.promotion?-1:10),n.R7$(),n.Y8G("ngClass",n.eq3(12,cn,!(null!=i.aside&&i.aside.visible)&&i.filters)),n.R7$(),n.vxM(null!=i.aside&&i.aside.visible?12:13),n.R7$(2),n.vxM(i.promotion?-1:14),n.R7$(),n.vxM(i.promotion?15:-1),n.R7$(2),n.vxM(i.loadingList?17:18),n.R7$(11),n.vxM(null!=i.aside&&i.aside.visible?28:-1))},dependencies:[r.YU,r.B3,S.W9,q,nn.k,an],data:{animation:[(0,p.hZ)("fadeSlideIn",[(0,p.kY)(":enter",[(0,p.iF)({opacity:0,transform:"translateX(30px)"}),(0,p.i0)("150ms ease-out",(0,p.iF)({opacity:1,transform:"translateX(0)"}))])]),(0,p.hZ)("biggerFadeSlideIn",[(0,p.kY)(":enter",[(0,p.iF)({opacity:0,transform:"translateX(150px)"}),(0,p.i0)("100ms ease-out",(0,p.iF)({opacity:1,transform:"translateX(0)"}))])])]}}),l})()}}]);