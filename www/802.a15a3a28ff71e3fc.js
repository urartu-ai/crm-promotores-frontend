"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[802],{9491:(V,I,r)=>{r.d(I,{j:()=>m});var f=r(177),F=r(9465),b=r(9417),C=r(3953);let m=(()=>{var e;class x{}return(e=x).\u0275fac=function(T){return new(T||e)},e.\u0275mod=C.$C({type:e}),e.\u0275inj=C.G2t({imports:[f.MD,F.bv,b.YN,b.X1]}),x})()},802:(V,I,r)=>{r.r(I),r.d(I,{AgenciesListPageModule:()=>B});var f=r(177),F=r(9417),b=r(9465),C=r(5188),m=r(2465),e=r(3953);const x=[{path:"",component:m.F}];let S=(()=>{var p;class u{}return(p=u).\u0275fac=function(A){return new(A||p)},p.\u0275mod=e.$C({type:p}),p.\u0275inj=e.G2t({imports:[C.iI.forChild(x),C.iI]}),u})(),T=(()=>{var p;class u{}return(p=u).\u0275fac=function(A){return new(A||p)},p.\u0275mod=e.$C({type:p}),p.\u0275inj=e.G2t({imports:[f.MD,F.YN,F.X1,b.bv]}),u})();var M=r(5603),E=r(9491);let B=(()=>{var p;class u{}return(p=u).\u0275fac=function(A){return new(A||p)},p.\u0275mod=e.$C({type:p}),p.\u0275inj=e.G2t({imports:[f.MD,F.YN,b.bv,S,T,M.P,E.j]}),u})()},2465:(V,I,r)=>{r.d(I,{F:()=>Me});var f=r(467),F=r(1413),b=r(7944),C=r(7376),m=r(9969),e=r(3953),x=r(5188),S=r(8397),T=r(4501),M=r(9465),E=r(6039),B=r(1213),p=r(5970),u=r(177),k=r(6552);function A(i,s){if(1&i&&e.nrm(0,"span",26),2&i){let o;const n=e.XpG().$implicit,t=e.XpG(3);e.HbH(null==(o=t.utils.getLanguageInfo(n))?null:o.flagClass)}}function z(i,s){if(1&i&&(e.qex(0),e.DNE(1,A,1,2,"span",25),e.bVm()),2&i){const o=s.index;e.R7$(),e.Y8G("ngIf",o<3)}}function J(i,s){if(1&i&&(e.j41(0,"span",27),e.EFF(1),e.k0s()),2&i){const o=e.XpG(3);e.R7$(),e.SpI(" +",o.agency.languages.length-3," ")}}function H(i,s){if(1&i&&(e.j41(0,"div",22),e.DNE(1,z,2,1,"ng-container",23)(2,J,2,1,"span",24),e.k0s()),2&i){const o=e.XpG(2);e.R7$(),e.Y8G("ngForOf",o.agency.languages),e.R7$(),e.Y8G("ngIf",o.agency.languages.length>3)}}function W(i,s){1&i&&(e.j41(0,"div",28),e.EFF(1," Sin idiomas "),e.k0s())}function Z(i,s){1&i&&(e.j41(0,"button",19),e.EFF(1," Pendiente "),e.nrm(2,"i",29),e.k0s())}function K(i,s){1&i&&(e.j41(0,"button",20),e.EFF(1," Colaborador "),e.nrm(2,"i",30),e.k0s())}function Q(i,s){if(1&i){const o=e.RV6();e.j41(0,"button",31),e.bIt("click",function(t){e.eBV(o);const a=e.XpG(2);return e.Njj(a.onInviteAgencyClick(t))}),e.nrm(1,"i",32),e.EFF(2," Invitar agencia "),e.k0s()}}function q(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",3),e.bIt("click",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.onNavigateToAgency())}),e.j41(1,"div",4),e.nrm(2,"img",5),e.j41(3,"div",6)(4,"div",7)(5,"span",8),e.EFF(6),e.k0s()(),e.j41(7,"div",9),e.EFF(8),e.k0s(),e.DNE(9,H,3,2,"div",10)(10,W,2,0,"ng-template",null,0,e.C5r),e.k0s()(),e.j41(12,"div",11),e.EFF(13),e.k0s(),e.nrm(14,"div",12),e.j41(15,"div",13)(16,"div",14),e.nrm(17,"i",15),e.j41(18,"span"),e.EFF(19),e.k0s()(),e.j41(20,"div",14),e.nrm(21,"i",16),e.j41(22,"span"),e.EFF(23),e.k0s()(),e.j41(24,"div",14),e.nrm(25,"i",17),e.j41(26,"span"),e.EFF(27,"Operaciones"),e.k0s()()(),e.j41(28,"div",18),e.DNE(29,Z,3,0,"button",19)(30,K,3,0,"button",20)(31,Q,3,0,"button",21),e.k0s()()}if(2&i){const o=e.sdS(11),n=e.XpG();e.R7$(2),e.FS9("alt",null==n.agency?null:n.agency.name),e.Y8G("src",(null==n.agency?null:n.agency.photoUrl)||"assets/images/building.png",e.B4B),e.R7$(4),e.JRh(null==n.agency?null:n.agency.name),e.R7$(2),e.Lme(" ",(null==n.agency?null:n.agency.city)||"Valencia"," / ",(null==n.agency?null:n.agency.country)||"Spain"," "),e.R7$(),e.Y8G("ngIf",(null==n.agency||null==n.agency.languages?null:n.agency.languages.length)>0)("ngIfElse",o),e.R7$(4),e.Lme(" Promociones compartidas: ",(null==n.agency||null==n.agency.promotions?null:n.agency.promotions.length)||0," / ",n.promoterPromotions||0," "),e.R7$(6),e.SpI("Oficinas: ",(null==n.agency||null==n.agency.agencyOffices?null:n.agency.agencyOffices.length)||0,""),e.R7$(4),e.SpI("Agentes: ",(null==n.agency||null==n.agency._count?null:n.agency._count.users)||0,""),e.R7$(6),e.vxM("pending"===(null==n.options?null:n.options.invitationStatus)?29:"collaborator"===(null==n.options?null:n.options.invitationStatus)?30:31)}}function ee(i,s){1&i&&(e.j41(0,"div",2)(1,"div",4),e.nrm(2,"div",33),e.j41(3,"div",6),e.nrm(4,"div",34)(5,"div",35)(6,"div",36),e.k0s()(),e.nrm(7,"div",37)(8,"div",38),e.j41(9,"div",13),e.nrm(10,"div",39)(11,"div",39)(12,"div",39),e.k0s(),e.nrm(13,"div",40),e.k0s())}let ne=(()=>{var i;class s{constructor(n,t){this.router=n,this.utils=t,this.promoterPromotions=0,this.inviteAgencyClick=new e.bkB}ngOnInit(){console.log(this.options)}onInviteAgencyClick(n){n.stopPropagation(),n.preventDefault(),this.inviteAgencyClick.emit({agency:this.agency,options:this.options})}onNavigateToAgency(){this.router.navigate([`/agencies/${this.agency.id}`])}}return(i=s).\u0275fac=function(n){return new(n||i)(e.rXU(x.Ix),e.rXU(k.T))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-card-agency"]],inputs:{agency:"agency",isSkeleton:"isSkeleton",options:"options",promoterPromotions:"promoterPromotions"},outputs:{inviteAgencyClick:"inviteAgencyClick"},decls:2,vars:1,consts:[["noLangs",""],[1,"collaboration-card"],[1,"collaboration-card","collaboration-card--skeleton"],[1,"collaboration-card",3,"click"],[1,"collaboration-card__header"],[1,"collaboration-card__logo",3,"src","alt"],[1,"collaboration-card__info"],[1,"collaboration-card__top-row"],[1,"collaboration-card__name"],[1,"collaboration-card__location"],["class","collaboration-card__languages",4,"ngIf","ngIfElse"],[1,"collaboration-card__shared"],[1,"collaboration-card__divider"],[1,"collaboration-card__meta"],[1,"collaboration-card__meta-item"],[1,"fas","fa-building"],[1,"fas","fa-user"],[1,"fas","fa-chart-line"],[1,"collaboration-card__footer",2,"margin-top","8px"],[1,"collaboration-card__button","collaboration-card__button--pending"],[1,"collaboration-card__button","collaboration-card__button--collaborator"],[1,"crm-button",2,"width","100%","justify-content","center"],[1,"collaboration-card__languages"],[4,"ngFor","ngForOf"],["class","collaboration-card__flag-plus",4,"ngIf"],["class","collaboration-card__flag",3,"class",4,"ngIf"],[1,"collaboration-card__flag"],[1,"collaboration-card__flag-plus"],[1,"collaboration-card__languages-empty"],[1,"fas","fa-clock"],[1,"fas","fa-check-circle"],[1,"crm-button",2,"width","100%","justify-content","center",3,"click"],[1,"fas","fa-add"],[1,"collaboration-card__logo","skeleton-block"],[1,"collaboration-card__top-row","skeleton-block"],[1,"collaboration-card__location","skeleton-block"],[1,"collaboration-card__languages","skeleton-block"],[1,"collaboration-card__shared","skeleton-block"],[1,"collaboration-card__divider","skeleton-block"],[1,"collaboration-card__meta-item","skeleton-block"],[1,"collaboration-card__footer","skeleton-block"]],template:function(n,t){1&n&&e.DNE(0,q,32,12,"div",1)(1,ee,14,0,"div",2),2&n&&e.vxM(t.isSkeleton?1:0)},dependencies:[u.Sq,u.bT],styles:[".collaboration-card[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #eaeaea;border-radius:12px;padding:16px;width:340px;box-sizing:border-box;display:flex;flex-direction:column;cursor:pointer;position:relative}.collaboration-card__header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.collaboration-card__logo[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;object-fit:cover;flex-shrink:0}.collaboration-card__info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.collaboration-card__top-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.collaboration-card__name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;margin-bottom:4px;color:#111}.collaboration-card__verified[_ngcontent-%COMP%]{font-size:14px;color:#1890ff;display:inline-flex;align-items:center}.collaboration-card__location[_ngcontent-%COMP%]{font-size:14px;color:#888}.collaboration-card__languages[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.collaboration-card__languages[_ngcontent-%COMP%]   .collaboration-card__flag[_ngcontent-%COMP%]{width:20px;height:14px;border-radius:2px;background-size:cover;background-position:center}.collaboration-card__languages[_ngcontent-%COMP%]   .collaboration-card__flag-plus[_ngcontent-%COMP%]{font-size:13px;color:#666}.collaboration-card__languages-empty[_ngcontent-%COMP%]{font-size:13px;color:#999}.collaboration-card__shared[_ngcontent-%COMP%]{margin-top:12px;font-size:14px;color:#333;font-weight:500}.collaboration-card__divider[_ngcontent-%COMP%]{width:100%;height:1px;background-color:#eaeaea;border:none;margin:12px 0}.collaboration-card__meta[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:12px}.collaboration-card__meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:12px;color:#666}.collaboration-card__meta-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:13px}.collaboration-card__footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:8px;margin-top:auto}.collaboration-card__chip[_ngcontent-%COMP%]{font-size:13px;padding:4px 8px;border-radius:6px;display:inline-flex;align-items:center;gap:4px}.collaboration-card__chip--warning[_ngcontent-%COMP%]{background-color:#fff8e6;color:#e69900;border:1px solid #ffe5b4}.collaboration-card__button[_ngcontent-%COMP%]{font-size:14px;border-radius:4px;padding:6px 12px;outline:none;cursor:pointer;display:inline-flex;align-items:center;gap:8px;border:1px solid transparent}.collaboration-card__button--collaborator[_ngcontent-%COMP%]{background-color:#ecf2ff;color:#3a50e4}.collaboration-card__button--pending[_ngcontent-%COMP%]{background-color:#fbf4ec;color:#e49d3a}.collaboration-card__button--invite[_ngcontent-%COMP%]{background-color:#1890ff;color:#fff}.collaboration-card--skeleton[_ngcontent-%COMP%]{pointer-events:none}.collaboration-card--skeleton[_ngcontent-%COMP%]   .skeleton-block[_ngcontent-%COMP%]{background-color:#eee;border-radius:4px;width:100%;height:16px}.collaboration-card--skeleton__logo.skeleton-block[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%}.collaboration-card--skeleton__divider.skeleton-block[_ngcontent-%COMP%]{height:1px;margin:12px 0}.collaboration-card--skeleton__footer.skeleton-block[_ngcontent-%COMP%]{height:24px;width:100px}"]}),s})();var te=r(6580),R=r(9417);const oe=["provinceInput"],ie=["cityInput"],G=()=>({standalone:!0}),ae=i=>({"crm-item-tag-active":i});function le(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",31)(1,"div",32)(2,"div",33),e.nrm(3,"span"),e.k0s(),e.j41(4,"div",34),e.EFF(5),e.k0s()(),e.j41(6,"div",35),e.bIt("click",function(){const t=e.eBV(o).$implicit,a=e.XpG();return e.Njj(a.onRemoveLanguage(t))}),e.nrm(7,"i",36),e.k0s()()}if(2&i){let o,n;const t=s.$implicit,a=e.XpG();e.R7$(3),e.HbH(null==(o=a.utils.getLanguageInfo(t))?null:o.flagClass),e.R7$(2),e.SpI(" ",null==(n=a.utils.getLanguageInfo(t))?null:n.name," ")}}function se(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",25)(1,"ion-checkbox",37),e.bIt("ionChange",function(t){const a=e.eBV(o).$implicit,l=e.XpG();return e.Njj(l.onCheckboxChange(a.value,t,"offices"))}),e.k0s(),e.j41(2,"div",27),e.EFF(3),e.k0s()()}if(2&i){const o=s.$implicit,n=e.XpG();e.R7$(),e.Y8G("value",o.value)("checked",n.filterData.offices.includes(o.value)),e.R7$(2),e.JRh(o.label)}}function ce(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",25)(1,"ion-checkbox",37),e.bIt("ionChange",function(t){const a=e.eBV(o).$implicit,l=e.XpG();return e.Njj(l.onCheckboxChange(a.value,t,"agentsCount"))}),e.k0s(),e.j41(2,"div",27),e.EFF(3),e.k0s()()}if(2&i){const o=s.$implicit,n=e.XpG();e.R7$(),e.Y8G("value",o.value)("checked",n.filterData.agentsCount.includes(o.value)),e.R7$(2),e.JRh(o.label)}}function re(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",25)(1,"ion-checkbox",37),e.bIt("ionChange",function(t){const a=e.eBV(o).$implicit,l=e.XpG();return e.Njj(l.onCheckboxChange(a.value,t,"annualSales"))}),e.k0s(),e.j41(2,"div",27),e.EFF(3),e.k0s()()}if(2&i){const o=s.$implicit,n=e.XpG();e.R7$(),e.Y8G("value",o.value)("checked",n.filterData.annualSales.includes(o.value)),e.R7$(2),e.JRh(o.label)}}function de(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",38),e.bIt("click",function(){const t=e.eBV(o).$implicit,a=e.XpG();return e.Njj(a.onTogglePromotion(t))}),e.EFF(1),e.k0s()}if(2&i){const o=s.$implicit,n=e.XpG();e.Y8G("ngClass",e.eq3(2,ae,n.filterData.sharedPromotionsIds.includes(o.id))),e.R7$(),e.SpI(" ",o.projectName," ")}}let ge=(()=>{var i;class s{constructor(n,t,a,l){this.ngZone=n,this.popoverService=t,this.utils=a,this.api=l,this.onFilter=new e.bkB,this.filterData={country:"Espa\xf1a",province:"",city:"",languages:[],offices:[],agentsCount:[],annualSales:[],hasOperations:!1,hasVisits:!1,sharedPromotionsIds:[]},this.officeOptions=[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4 o m\xe1s"}],this.commercialOptions=[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4 o m\xe1s"}],this.annualSalesOptions=[{value:2e5,label:"200 k"},{value:4e5,label:"400 k"},{value:6e5,label:"600 k"},{value:1e6,label:"1 M o m\xe1s"}],this.sort=null,this.pagination={page:0,itemsPerPage:25},this.promotions=[]}ngOnInit(){}ngAfterViewInit(){this.getPromotions(),this.provinceAutocomplete=new google.maps.places.Autocomplete(this.provinceInput.nativeElement,{types:["(regions)"],componentRestrictions:{country:"es"},fields:["address_component","geometry"]}),this.provinceAutocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{var n,t;const a=this.provinceAutocomplete.getPlace(),l=null===(n=a.address_components)||void 0===n?void 0:n.find(c=>c.types.includes("administrative_area_level_2"));l&&(this.filterData.province=l.long_name,this.provinceInput.nativeElement.value=l.long_name),null!==(t=a.geometry)&&void 0!==t&&t.viewport&&this.cityAutocomplete.setBounds(a.geometry.viewport)})}),this.cityAutocomplete=new google.maps.places.Autocomplete(this.cityInput.nativeElement,{types:["locality"],componentRestrictions:{country:"es"},fields:["address_component"]}),this.cityAutocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{var n;const a=null===(n=this.cityAutocomplete.getPlace().address_components)||void 0===n?void 0:n.find(l=>l.types.includes("locality"));a&&(this.filterData.city=a.long_name,this.cityInput.nativeElement.value=a.long_name)})})}getPromotions(){var n=this;return(0,f.A)(function*(){const t=yield n.api.getPromotions({},n.sort,n.pagination,null);n.promotions=t.success.data||[]})()}onAddLanguage(n){this.popoverService.onShowCountrySelectorPopover(n,{languageSelector:!0,showCountryCode:!1,selectedCodes:this.filterData.languages}).then(a=>{var l;null!=a&&null!==(l=a.data)&&void 0!==l&&l.country&&this.filterData.languages.push(a.data.country.code)})}onRemoveLanguage(n){this.filterData.languages=this.filterData.languages.filter(t=>t!==n)}onCheckboxChange(n,t,a){const l=this.filterData[a],c={offices:this.officeOptions,agentsCount:this.commercialOptions,annualSales:this.annualSalesOptions}[a].map(g=>g.value);if(t.detail.checked)c.filter(g=>g>=n).forEach(g=>{l.includes(g)||l.push(g)});else{const g=l.indexOf(n);g>-1&&l.splice(g,1)}}onTogglePromotion(n){const t=this.filterData.sharedPromotionsIds,a=t.indexOf(n.id);a>-1?t.splice(a,1):t.push(n.id)}onClickFilter(){const n={};this.filterData.province&&(n.province={equals:this.filterData.province}),this.filterData.city&&(n.city={equals:this.filterData.city}),this.filterData.languages.length&&(n.languages={hasSome:this.filterData.languages}),0!=this.filterData.offices.length&&(n.officesCount=1==this.filterData.offices.length&&4!=this.filterData.offices[0]?{equals:this.filterData.offices[0]}:{gte:this.filterData.offices[0]}),0!=this.filterData.annualSales.length&&(n.annualSales=1==this.filterData.annualSales.length&&1e6!=this.filterData.annualSales[0]?{equals:this.filterData.annualSales[0]}:{gte:this.filterData.annualSales[0]}),this.filterData.hasOperations&&(n.hasOperations=!0),console.log("sharedPromotionsIds",this.filterData.sharedPromotionsIds);const l={};this.filterData.sharedPromotionsIds.length&&(l.promotions={apply:!0,filter:{id:{in:this.filterData.sharedPromotionsIds}},onlyCount:!1}),this.filterData.hasVisits&&(l.visits={apply:!0,filter:{},onlyCount:!1}),console.log(this.filterData),console.log(n),console.log("join",l),this.onFilter.emit({filter:n,joinTables:l})}onResetFilters(){this.filterData={country:"Espa\xf1a",province:"",city:"",languages:[],offices:[],agentsCount:[],annualSales:[],hasOperations:!1,hasVisits:!1,sharedPromotionsIds:[]},this.provinceInput.nativeElement.value="",this.cityInput.nativeElement.value="",this.cityAutocomplete.setBounds(void 0),this.onFilter.emit({filter:{},joinTables:{}})}}return(i=s).\u0275fac=function(n){return new(n||i)(e.rXU(e.SKi),e.rXU(p.m),e.rXU(k.T),e.rXU(E.i))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-agencies-filter-block"]],viewQuery:function(n,t){if(1&n&&(e.GBs(oe,5),e.GBs(ie,5)),2&n){let a;e.mGM(a=e.lsd())&&(t.provinceInput=a.first),e.mGM(a=e.lsd())&&(t.cityInput=a.first)}},outputs:{onFilter:"onFilter"},decls:73,vars:17,consts:[["provinceInput",""],["cityInput",""],[2,"position","relative","background","white"],["autocomplete","off","novalidate",""],["type","text","autocomplete","username",2,"display","none"],["type","password","autocomplete","new-password",2,"display","none"],[1,"crm-header-modal","crm-header-modal-fixed-top"],[1,"crm-modal-header-title"],[1,"crm-buttons-group"],["type","button",1,"crm-button",3,"click"],["type","button",1,"crm-button-secondary","crm-button-secondary-red",3,"click"],[1,"crm-block-inputs","crm-block-filters-inputs"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input"],["type","text","placeholder","Seleccione provincia","name","province","autocomplete","off","autocorrect","off","spellcheck","false",3,"ngModelChange","ngModel","ngModelOptions"],["type","text","placeholder","Seleccione ciudad","name","city","autocomplete","off","autocorrect","off","spellcheck","false",3,"ngModelChange","ngModel","ngModelOptions"],[1,"crm-input","crm-input-medium"],[1,"crm-section-items"],["class","crm-item-option crm-item-option-lang edit",4,"ngFor","ngForOf"],["type","button",1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fas","fa-add"],[1,"crm-input-checkboxes",2,"grid-template-columns","1fr"],["class","crm-input-checkbox",4,"ngFor","ngForOf"],[1,"crm-input-checkboxes"],[1,"crm-input-checkbox"],["name","hasOperations",3,"ngModelChange","ngModel","ngModelOptions"],[1,"crm-input-checkbox-label"],["name","hasVisits",3,"ngModelChange","ngModel","ngModelOptions"],[1,"crm-section-tags"],["class","crm-item-tag",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"crm-item-option","crm-item-option-lang","edit"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[1,"crm-item-option-label"],[1,"crm-item-option-remove",3,"click"],[1,"fas","fa-trash"],[3,"ionChange","value","checked"],[1,"crm-item-tag",3,"click","ngClass"]],template:function(n,t){if(1&n){const a=e.RV6();e.j41(0,"div",2)(1,"form",3),e.nrm(2,"input",4)(3,"input",5),e.j41(4,"div",6)(5,"div",7),e.EFF(6,"Filtrar"),e.k0s(),e.j41(7,"div",8)(8,"button",9),e.bIt("click",function(){return e.eBV(a),e.Njj(t.onClickFilter())}),e.EFF(9,"Filtrar"),e.k0s(),e.j41(10,"button",10),e.bIt("click",function(){return e.eBV(a),e.Njj(t.onResetFilters())}),e.EFF(11,"Reiniciar"),e.k0s()()(),e.j41(12,"div",11)(13,"div",12)(14,"div",13),e.EFF(15,"Provincia"),e.k0s(),e.j41(16,"div",14)(17,"input",15,0),e.mxI("ngModelChange",function(c){return e.eBV(a),e.DH7(t.filterData.province,c)||(t.filterData.province=c),e.Njj(c)}),e.k0s()()(),e.j41(19,"div",12)(20,"div",13),e.EFF(21,"Ciudad"),e.k0s(),e.j41(22,"div",14)(23,"input",16,1),e.mxI("ngModelChange",function(c){return e.eBV(a),e.DH7(t.filterData.city,c)||(t.filterData.city=c),e.Njj(c)}),e.k0s()()(),e.j41(25,"div",17)(26,"div",13),e.EFF(27,"Idiomas"),e.k0s(),e.j41(28,"div",18),e.DNE(29,le,8,3,"div",19),e.j41(30,"button",20),e.bIt("click",function(c){return e.eBV(a),e.Njj(t.onAddLanguage(c))}),e.nrm(31,"i",21),e.EFF(32," A\xf1adir idioma "),e.k0s()()(),e.j41(33,"div",12)(34,"div",13),e.EFF(35,"Oficinas"),e.k0s(),e.j41(36,"div",22),e.DNE(37,se,4,3,"div",23),e.k0s()(),e.j41(38,"div",12)(39,"div",13),e.EFF(40,"Comerciales"),e.k0s(),e.j41(41,"div",22),e.DNE(42,ce,4,3,"div",23),e.k0s()(),e.j41(43,"div",12)(44,"div",13),e.EFF(45,"Facturaci\xf3n anual"),e.k0s(),e.j41(46,"div",22),e.DNE(47,re,4,3,"div",23),e.k0s()(),e.j41(48,"div",12)(49,"div",13),e.EFF(50,"Agencias con operaciones"),e.k0s(),e.j41(51,"div",24)(52,"div",25)(53,"ion-checkbox",26),e.mxI("ngModelChange",function(c){return e.eBV(a),e.DH7(t.filterData.hasOperations,c)||(t.filterData.hasOperations=c),e.Njj(c)}),e.k0s(),e.j41(54,"div",27),e.EFF(55,"S\xed"),e.k0s()()()(),e.j41(56,"div",12)(57,"div",13),e.EFF(58,"Agencias con visitas"),e.k0s(),e.j41(59,"div",24)(60,"div",25)(61,"ion-checkbox",28),e.mxI("ngModelChange",function(c){return e.eBV(a),e.DH7(t.filterData.hasVisits,c)||(t.filterData.hasVisits=c),e.Njj(c)}),e.k0s(),e.j41(62,"div",27),e.EFF(63,"S\xed"),e.k0s()()()(),e.j41(64,"div",12)(65,"div",13),e.EFF(66,"Promociones compartidas"),e.k0s(),e.j41(67,"div",29),e.DNE(68,de,2,4,"div",30),e.k0s()(),e.nrm(69,"br")(70,"br")(71,"br")(72,"br"),e.k0s()()()}2&n&&(e.R7$(17),e.R50("ngModel",t.filterData.province),e.Y8G("ngModelOptions",e.lJ4(13,G)),e.R7$(6),e.R50("ngModel",t.filterData.city),e.Y8G("ngModelOptions",e.lJ4(14,G)),e.R7$(6),e.Y8G("ngForOf",t.filterData.languages),e.R7$(8),e.Y8G("ngForOf",t.officeOptions),e.R7$(5),e.Y8G("ngForOf",t.commercialOptions),e.R7$(5),e.Y8G("ngForOf",t.annualSalesOptions),e.R7$(6),e.R50("ngModel",t.filterData.hasOperations),e.Y8G("ngModelOptions",e.lJ4(15,G)),e.R7$(8),e.R50("ngModel",t.filterData.hasVisits),e.Y8G("ngModelOptions",e.lJ4(16,G)),e.R7$(7),e.Y8G("ngForOf",t.promotions))},dependencies:[u.YU,u.Sq,R.qT,R.me,R.BC,R.cb,R.vS,R.cV,M.eY,M.hB]}),s})();const pe=i=>({"crm-block-body-fixed":i}),ue=i=>({"crm-button-secondary-primary":i}),Y=(i,s,o,n,t)=>({pageStartIndex:i,pageEndIndex:s,totalCount:o,paginationPage:n,sortField:t}),me=i=>({active:i}),_e=(i,s)=>({"background-color":i,border:s});function fe(i,s){if(1&i){const o=e.RV6();e.j41(0,"button",17),e.bIt("click",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.onInviteAgencies())}),e.nrm(1,"i",18),e.EFF(2," Invitar agencia "),e.k0s()}}function ve(i,s){1&i&&(e.nrm(0,"i",19),e.EFF(1," Cerrar filtros "))}function he(i,s){1&i&&(e.nrm(0,"i",20),e.EFF(1," Filtros activados "))}function ye(i,s){1&i&&(e.nrm(0,"i",20),e.EFF(1," Filtrar "))}function be(i,s){if(1&i&&e.DNE(0,he,2,0)(1,ye,2,0),2&i){const o=e.XpG();e.vxM(o.filters?0:1)}}function Ce(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",12)(1,"app-list-pagination-selectors",21),e.bIt("goPreviousPage",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.onGoPreviousPage())})("goNextPage",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.onGoNextPage())})("sort",function(t){e.eBV(o);const a=e.XpG();return e.Njj(a.onSort(t))}),e.k0s()()}if(2&i){const o=e.XpG();e.R7$(),e.Y8G("listPaginationConfig",e.s1E(1,Y,o.updatePagination().startIndex,o.updatePagination().endIndex,o.allSystemAgenciesCount,o.pagination.page+1,null!=o.sort&&o.sort.field?(null==o.sort?null:o.sort.field)+" "+(null==o.sort?null:o.sort.order):"Fecha de creaci\xf3n"))}}function ke(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",13)(1,"app-list-pagination-selectors",21),e.bIt("goPreviousPage",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.onGoPreviousPage())})("goNextPage",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.onGoNextPage())})("sort",function(t){e.eBV(o);const a=e.XpG();return e.Njj(a.onSort(t))}),e.k0s()()}if(2&i){const o=e.XpG();e.R7$(),e.Y8G("listPaginationConfig",e.s1E(1,Y,o.updatePagination().startIndex,o.updatePagination().endIndex,o.allSystemAgenciesCount,o.pagination.page+1,null!=o.sort&&o.sort.field?(null==o.sort?null:o.sort.field)+" "+(null==o.sort?null:o.sort.order):"Fecha de creaci\xf3n"))}}function Pe(i,s){1&i&&(e.j41(0,"div",15),e.nrm(1,"app-card-agency",22)(2,"app-card-agency",22)(3,"app-card-agency",22),e.k0s()),2&i&&(e.R7$(),e.Y8G("isSkeleton",!0),e.R7$(),e.Y8G("isSkeleton",!0),e.R7$(),e.Y8G("isSkeleton",!0))}function Fe(i,s){if(1&i&&e.EFF(0),2&i){const o=e.XpG().$implicit;e.SpI(" (",null==o?null:o.count,") ")}}function xe(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",26),e.bIt("click",function(){const t=e.eBV(o).$implicit,a=e.XpG(2);return e.Njj(a.onClickAgencyRelation(t))}),e.j41(1,"div",27),e.EFF(2),e.DNE(3,Fe,1,1),e.nrm(4,"div",28),e.k0s()()}if(2&i){const o=s.$implicit;e.Y8G("ngClass",e.eq3(4,me,null==o?null:o.isSelected)),e.R7$(2),e.SpI(" ",null==o?null:o.title," "),e.R7$(),e.vxM(null!==(null==o?null:o.count)?3:-1),e.R7$(),e.Y8G("ngStyle",e.l_i(6,_e,null==o?null:o.color,"1px solid "+(null==o?null:o.color)))}}function Ae(i,s){if(1&i){const o=e.RV6();e.j41(0,"app-card-agency",29),e.bIt("inviteAgencyClick",function(t){e.eBV(o);const a=e.XpG(2);return e.Njj(a.onInviteAgencyClick(t))}),e.k0s()}if(2&i){const o=s.$implicit,n=e.XpG(2);e.Y8G("promoterPromotions",n.promoterPromotions)("agency",o)("options",o.agencyCardOptions)}}function je(i,s){if(1&i&&(e.j41(0,"div",23),e.Z7z(1,xe,5,9,"div",24,e.fX1),e.k0s(),e.j41(3,"div",15),e.Z7z(4,Ae,1,3,"app-card-agency",25,e.fX1),e.k0s()),2&i){const o=e.XpG();e.R7$(),e.Dyx(o.agencyRelations),e.R7$(3),e.Dyx(o.agencies)}}function Ie(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",16)(1,"app-agencies-filter-block",30),e.bIt("onFilter",function(t){e.eBV(o);const a=e.XpG();return e.Njj(a.onFilter(t))}),e.k0s()()}2&i&&e.Y8G("@biggerFadeSlideIn",void 0)}let Me=(()=>{var i;class s{constructor(n,t,a,l,c,g,v){this.router=n,this.toastService=t,this.headerService=a,this.modalCtrl=l,this.api=c,this.state=g,this.popoversService=v,this.promotion=null,this.agenciesAlreadyLinked=[],this.agenciesNotLinked=[],this.agencies=[],this.allSystemAgenciesCount=0,this.searchString="",this.searchSubject=new F.B,this.agencyCardOptions={type:"globalAgencies"},this.aside={type:"filters",visible:!0},this.agencyRelations=[{id:"agencias-colaboradoras",title:"Agencias colaboradoras",subtitle:"",color:"#4CAF50",isSelected:!0,count:0},{id:"agencias-no-colaboradoras",title:"Agencias no colaboradoras",subtitle:"",color:"#FF9800",isSelected:null,count:null}],this.filters=null,this.sort=null,this.pagination={page:0,itemsPerPage:25},this.agencyPrismaFilter={},this.agencyJoinTables={},this.promoterPromotions=0,this.loadingList=!1}ngOnInit(){this.getState(),this.getData()}ionViewWillEnter(){this.promotion?this.agencyCardOptions.type="promotionAgencies":this.headerService.setConfig({title:"agencies"})}getState(){this.state.getState().subscribe(n=>{this.currentUser=n.user,this.currentPromoter=n.promoter})}onInviteAgencies(){var n=this;return(0,f.A)(function*(){yield(yield n.modalCtrl.create({component:b.v,cssClass:"modal-invite-agency"})).present()})()}onSearchInputChange(n){const t=n.target.value.trim();clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(()=>{if(t){const a={contains:t,mode:"insensitive"};this.agencyPrismaFilter={OR:[{email:a},{emails:{has:t}},{phones:{has:t}},{nifCif:a},{name:a},{legalName:a}]}}else this.agencyPrismaFilter={};this.pagination.page=0,this.getData()},500)}onSearchChanged(n){this.searchString=n}onToggleAside(){this.aside.visible=!this.aside.visible}onFilter(n){this.agencyPrismaFilter=n.filter,this.agencyJoinTables=n.joinTables,this.pagination.page=0,this.getData()}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemAgenciesCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}onInviteAgencyClick(n){var t=this;return(0,f.A)(function*(){const{agency:a,options:l}=n;if("globalAgencies"===l.type)yield(yield t.modalCtrl.create({component:b.v,cssClass:"modal-invite-agency",componentProps:{agencyCardOpen:a}})).present();else if("promotionAgencies"===l.type){const c=l.promotion;let g={status:"pending",type:"register",agencyEmail:a.email,agencyId:a.id};const _=(yield t.api.createAgencyInvitationToPromotions(g)).success.data,h=[c.id],j=yield t.api.addPromotionsToAgencyInvitationToPromotions(h,_.id);if(j.error)return void t.toastService.showErrorToast("Ha ocurrido un error al invitar la agencia."+j.error.errorMessage);t.toastService.showSuccessToast("Agencia invitada correctamente"),t.getData()}})()}onClickAgencyRelation(n){this.agencyRelations.forEach(t=>{t.isSelected=t.id===n.id}),this.getData()}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemAgenciesCount)}}getData(){var n=this;return(0,f.A)(function*(){var t,a,l,c,g,v,_;let h,j;n.loadingList=!0,console.log("this.currentPromoter",n.currentPromoter),n.currentPromoter||(yield new Promise(d=>{setTimeout(d,100)}),n.getData()),n.promotion&&(n.agencyCardOptions.type="promotionAgencies"),console.log(3244324324,n.agencyRelations,"this.agencyRelations");const D=n.agencyRelations.find(d=>"agencias-colaboradoras"===d.id).isSelected,O=n.agencyRelations.find(d=>"agencias-no-colaboradoras"===d.id).isSelected;if(console.log(88888888,D),console.log(999999999,O),!0===D||null===D&&null===O||!1===D&&!1===O){var L;let d={promoters:{apply:!0,filter:{id:{equals:null===(L=n.currentPromoter)||void 0===L?void 0:L.id}},onlyCount:!1}};var N;if(d=n.promotion?{...d,promotions:{apply:!0,filter:{id:{equals:n.promotion.id}},onlyCount:!1}}:{...d,...n.agencyJoinTables},d={...d,users:{apply:!0,filter:{},onlyCount:!0}},h=yield n.api.getAgency(n.agencyPrismaFilter,n.sort,n.pagination,d),h.error)return n.toastService.showToast({text:"Ha ocurrido un error al cargar las agencias, "+(null===(N=h.error)||void 0===N?void 0:N.errorMessage),theme:"red",icon:"fas fa-exclamation-triangle",time:1e4}),void(n.loadingList=!1);n.agencyRelations.map(P=>{var y;"agencias-colaboradoras"===P.id&&(P.count=null===(y=h)||void 0===y||null===(y=y.success)||void 0===y?void 0:y.metadata)})}if(!0===O||null===D&&null===O||!1===D&&!1===O){let d={};var $;d=n.promotion?{promotions:{apply:!0,filter:{id:{equals:n.promotion.id}},onlyCount:!1,negativeFiler:!0},agencyInvitationToPromotions:{apply:!0,mode:"include",filter:{status:{equals:"pending"}},onlyCount:!1}}:{promoters:{apply:!0,filter:{id:{equals:null===($=n.currentPromoter)||void 0===$?void 0:$.id}},onlyCount:!1,negativeFiler:!0}},d={...d,users:{apply:!0,filter:{},onlyCount:!0}},j=yield n.api.getAgency(n.agencyPrismaFilter,n.sort,n.pagination,d)}let X=(null===(t=h)||void 0===t||null===(t=t.success)||void 0===t?void 0:t.data)||[];X=X.map(d=>(d.isLinked=!0,d.agencyCardOptions=C.cloneDeep(n.agencyCardOptions),n.promotion&&(d.agencyCardOptions.promotion=n.promotion,d.agencyCardOptions.invitationStatus="collaborator"),d));let U=(null===(a=j)||void 0===a||null===(a=a.success)||void 0===a?void 0:a.data)||[];U=U.map(d=>{if(d.agencyCardOptions=C.cloneDeep(n.agencyCardOptions),n.promotion){d.agencyCardOptions.promotion=n.promotion;for(const P of d.agencyInvitationToPromotions)P.promotions.find(y=>y.id===n.promotion.id)&&"pending"===P.status&&(d.agencyCardOptions.invitationStatus="pending")}return d}),n.agencies=X.concat((null===(l=j)||void 0===l||null===(l=l.success)||void 0===l?void 0:l.data)||[]),n.allSystemAgenciesCount=((null===(c=h)||void 0===c||null===(c=c.success)||void 0===c||null===(c=c.metadata)||void 0===c?void 0:c.count)||0)+((null===(g=j)||void 0===g||null===(g=g.success)||void 0===g||null===(g=g.metadata)||void 0===g?void 0:g.count)||0),n.pagination.page=0,n.updatePagination(),n.loadingList=!1,console.log("this.agencies",n.agencies);const w=yield n.api.getPromotions({},null,{page:0,itemsPerPage:1e3},null);console.log("ELL RESULT DE OTTES LES PROMOCIONS",w),n.promoterPromotions=w.success.data.length;let Re={promoters:{apply:!0,filter:{id:{equals:null===(v=n.currentPromoter)||void 0===v?void 0:v.id}},onlyCount:!1},...n.agencyJoinTables};const De=(null===(_=yield n.api.getAgency(n.agencyPrismaFilter,n.sort,n.pagination,Re))||void 0===_||null===(_=_.success)||void 0===_?void 0:_.data)||[];n.agencies=n.agencies.map(d=>{const P=De.find(y=>y.id===d.id);return P&&(d.promotions=P.promotions),d})})()}onSort(n){var t=this;return(0,f.A)(function*(){const a=yield t.popoversService.onShowMenuPopover(n,"list-order");if(console.log("Popover result:",a),null!=a&&a.data){const l=a.data;if(l.includes("_")){const c=l.split("_")[0],g=l.split("_")[1];t.sort={field:c,order:g}}else t.sort={field:l,order:"asc"};t.getData()}})()}}return(i=s).\u0275fac=function(n){return new(n||i)(e.rXU(x.Ix),e.rXU(S.f),e.rXU(T.d),e.rXU(M.W3),e.rXU(E.i),e.rXU(B.c),e.rXU(p.m))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-agencies-list"]],inputs:{promotion:"promotion"},decls:29,vars:14,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content",2,"padding-top","10px","background","#F9F9F9"],[1,"crm-block-body"],[3,"ngClass"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar agencia",3,"input"],[1,"crm-buttons-group"],[1,"crm-button"],[1,"crm-button-secondary",3,"click","ngClass"],[2,"background","white"],[1,"crm-block-body-fixed","crm-block-body-fixed-padding-bigger"],[1,"crm-block-body-blue-content"],[1,"crm-section-inline-cards"],[1,"crm-block-content-aside"],[1,"crm-button",3,"click"],[1,"fas","fa-envelope"],[1,"fa","fa-times"],[1,"fa","fa-filter"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[3,"isSkeleton"],[1,"crm-section-operations-list-buttons",2,"padding","0"],[1,"crm-operations-list-pipe-button",3,"ngClass"],[3,"promoterPromotions","agency","options"],[1,"crm-operations-list-pipe-button",3,"click","ngClass"],[1,"crm-operations-list-pipe-button-subtitle"],[1,"crm-dot","success",3,"ngStyle"],[3,"inviteAgencyClick","promoterPromotions","agency","options"],[3,"onFilter"]],template:function(n,t){1&n&&(e.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),e.nrm(7,"i",7),e.j41(8,"input",8),e.bIt("input",function(l){return t.onSearchInputChange(l)}),e.k0s()()(),e.j41(9,"div",9),e.DNE(10,fe,3,0,"button",10),e.j41(11,"button",11),e.bIt("click",function(){return t.onToggleAside()}),e.DNE(12,ve,2,0)(13,be,2,1),e.k0s()()(),e.DNE(14,Ce,2,7,"div",12),e.k0s(),e.DNE(15,ke,2,7,"div",13),e.j41(16,"div",14),e.DNE(17,Pe,4,3,"div",15)(18,je,6,0),e.nrm(19,"br")(20,"br")(21,"br")(22,"br")(23,"br")(24,"br")(25,"br")(26,"br")(27,"br"),e.k0s()(),e.DNE(28,Ie,2,1,"div",16),e.k0s()()),2&n&&(e.Y8G("fullscreen",!0)("scrollY",!1),e.R7$(3),e.Y8G("ngClass",e.eq3(10,pe,!t.promotion)),e.R7$(7),e.vxM(t.promotion?-1:10),e.R7$(),e.Y8G("ngClass",e.eq3(12,ue,!(null!=t.aside&&t.aside.visible)&&t.filters)),e.R7$(),e.vxM(null!=t.aside&&t.aside.visible?12:13),e.R7$(2),e.vxM(t.promotion?-1:14),e.R7$(),e.vxM(t.promotion?15:-1),e.R7$(2),e.vxM(t.loadingList?17:18),e.R7$(11),e.vxM(null!=t.aside&&t.aside.visible?28:-1))},dependencies:[u.YU,u.B3,M.W9,ne,te.k,ge],data:{animation:[(0,m.hZ)("fadeSlideIn",[(0,m.kY)(":enter",[(0,m.iF)({opacity:0,transform:"translateX(30px)"}),(0,m.i0)("150ms ease-out",(0,m.iF)({opacity:1,transform:"translateX(0)"}))])]),(0,m.hZ)("biggerFadeSlideIn",[(0,m.kY)(":enter",[(0,m.iF)({opacity:0,transform:"translateX(150px)"}),(0,m.i0)("100ms ease-out",(0,m.iF)({opacity:1,transform:"translateX(0)"}))])])]}}),s})()}}]);